"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9547,5146],{76585:function(e,n,t){t.d(n,{z:function(){return r}});var o,a=t(52209),r=(0,t(54397).Ps)(o||(o=(0,a.Z)(["\n  fragment AccountFields on Account {\n    id\n    type\n    name\n    status\n    vatId\n  }\n"])))},42160:function(e,n,t){var o=t(45697),a=function(e){var n=e.accountId,t=e.bookable,o=e.categoryId,a=e.customFilters,r=e.date,i=e.excludeCategoryId,s=e.locationId,c=e.limit,l=e.offset,d=e.orderBy,u=(e.q,{});return n&&(u.accountId={_eq:n}),t&&(u.bookable={_eq:t}),o&&(u.categoryId={_eq:o}),a&&(u.customFilters={_contains:a}),s&&(u.locationId={_eq:s}),name&&(u.name={_ilike:name}),i&&(u._not={categoryId:{_eq:i}}),{date:r,limit:c||50,offset:l||0,orderBy:d||"asc",where:u}};a.propTypes={filters:o.object},a.defaultProps={filters:{}},n.Z=a},53444:function(e,n,t){t.d(n,{_:function(){return j}});var o=t(92809),a=t(30266),r=t(80318),i=t(64687),s=t.n(i),c=t(67294),l=t(24237),d=t(75709),u=t(64930),m=t(42283),y=t(97202),p=t(11570),v=t(22796),b=t(97625),f=t(52719),g=t(34717),h=t(15198),_=t(95146),x=t(85893);function I(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function q(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?I(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):I(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var j=function(e){var n,t,o,i,l,h,I,j,S,P,k,A,C,O=e.data,N=e.id,F=e.locationId,z=(e.name,e.onSuccess),L=[{id:1,name:(0,x.jsx)(b.Z,{iconName:"thermometer",size:24}),icon:"thermometer"},{id:2,name:(0,x.jsx)(b.Z,{iconName:"sensor",size:24}),icon:"sensor"},{id:3,name:(0,x.jsx)(b.Z,{iconName:"smokeDetector",size:24}),icon:"smokeDetector"},{id:4,name:(0,x.jsx)(b.Z,{iconName:"airConditioner",size:24}),icon:"airConditioner"},{id:5,name:(0,x.jsx)(b.Z,{iconName:"siren",size:24}),icon:"siren"},{id:6,name:(0,x.jsx)(b.Z,{iconName:"desktop",size:24}),icon:"desktop"},{id:7,name:(0,x.jsx)(b.Z,{iconName:"meetingRoom",size:24}),icon:"meetingRoom"},{id:8,name:(0,x.jsx)(b.Z,{iconName:"television",size:24}),icon:"thermometer"},{id:9,name:(0,x.jsx)(b.Z,{iconName:"projector",size:24}),icon:"projector"},{id:10,name:(0,x.jsx)(b.Z,{iconName:"desk",size:24}),icon:"desk"},{id:11,name:(0,x.jsx)(b.Z,{iconName:"coffeeMachine",size:24}),icon:"coffeeMachine"},{id:12,name:(0,x.jsx)(b.Z,{iconName:"microwave",size:24}),icon:"microwave"},{id:13,name:(0,x.jsx)(b.Z,{iconName:"oven",size:24}),icon:"oven"},{id:14,name:(0,x.jsx)(b.Z,{iconName:"pump",size:24}),icon:"pump"},{id:15,name:(0,x.jsx)(b.Z,{iconName:"boiler",size:24}),icon:"boiler"},{id:16,name:(0,x.jsx)(b.Z,{iconName:"washingMachine",size:24}),icon:"washingMachine"},{id:17,name:(0,x.jsx)(b.Z,{iconName:"dishwasher",size:24}),icon:"dishwasher"},{id:18,name:(0,x.jsx)(b.Z,{iconName:"bicycle",size:24}),icon:"bicycle"},{id:19,name:(0,x.jsx)(b.Z,{iconName:"fridge",size:24}),icon:"fridge"},{id:20,name:(0,x.jsx)(b.Z,{iconName:"freezer",size:24}),icon:"freezer"},{id:21,name:(0,x.jsx)(b.Z,{iconName:"sprinkle",size:24}),icon:"sprinkle"},{id:22,name:(0,x.jsx)(b.Z,{iconName:"fuseBox",size:24}),icon:"fuseBox"}],D=(0,c.useState)(null===(n=O.meta)||void 0===n?void 0:n.coordinates),T=D[0],G=D[1],R=(0,c.useState)((null===(t=O.meta)||void 0===t||null===(o=t.markerStyles)||void 0===o?void 0:o.color)||"green"),U=R[0],E=R[1],M=(0,c.useState)((null===(i=O.meta)||void 0===i||null===(l=i.markerStyles)||void 0===l?void 0:l.shape)||{id:1,icon:"thermometer"}),B=M[0],H=M[1],V=(0,c.useState)({label:null===(h=O.parentId)||void 0===h?void 0:h.value,filename:"".concat("https://d1hk88326p7ilp.cloudfront.net","/").concat(null===(I=O.parentId)||void 0===I||null===(j=I.media[0])||void 0===j?void 0:j.item.filename),text:null===(S=O.parentId)||void 0===S?void 0:S.label,hasImage:(null===(P=O.parentId)||void 0===P||null===(k=P.media)||void 0===k?void 0:k.length)>0}),W=V[0],J=V[1],Q=(0,m.cI)(),X=Q.control,K=Q.errors,Y=Q.handleSubmit,ee=Q.register,ne=Q.setValue,te=(0,d.D)(u.Wx,{onCompleted:function(e){z&&z()}}),oe=(0,r.Z)(te,1)[0],ae=function(){var e=(0,a.Z)(s().mark((function e(n){var t,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=q({},O.meta)).coordinates=T,t.markerStyles={color:U,shape:{id:B.id,icon:B.icon}},o={parentId:n.baseAsset.value,meta:t},oe({variables:{id:N,changes:o}});case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),re={control:X,errors:K,isClearable:!1,register:ee},ie={label:null===(A=O.parentId)||void 0===A?void 0:A.label,value:null===(C=O.parentId)||void 0===C?void 0:C.value};return(0,x.jsxs)(y.Z,{id:"offCanvasForm",handleSubmit:Y(ae),children:[null===O.parentId&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(p.Z,{content:"Please assign a parent sub-location to enable asset placement",context:"info"}),(0,x.jsx)(v.Z,{})]}),(0,x.jsx)(_.P,q(q({},re),{},{errors:K,defaultValue:ie,label:"Parent Asset",locationId:F,name:"baseAsset",type:"sublocation",onChange:function(e){!function(e){var n,t,o;J({label:e.label,filename:"".concat("https://d1hk88326p7ilp.cloudfront.net","/").concat(null===(n=e.media[0])||void 0===n||null===(t=n.item)||void 0===t?void 0:t.filename),text:e.value,hasImage:(null===(o=e.media)||void 0===o?void 0:o.length)>0}),ne("baseAsset",{label:e.label,value:e.value})}(e)}})),W.hasImage&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(Z,{children:[(null===B||void 0===B?void 0:B.icon)&&(0,x.jsx)(b.Z,{iconName:B.icon,size:24}),(0,x.jsx)($,{elementType:"list",items:L,onChange:function(e){var n;H({id:(n=e).id,icon:n.icon})},children:"Select an icon"}),(0,x.jsx)(w,{assetIconColor:U}),(0,x.jsx)($,{elementType:"colour",items:f.Z,onChange:function(e){E(e.colour)},children:"Select a colour"})]}),(0,x.jsx)(g.Z,{coordinatesChange:function(e){return G(e.coordinates)},customIcon:B.icon,initialCoordinates:T,item:{label:W.label,filename:W.filename,text:W.text},markerStyles:{color:U}})]})]})},Z=l.ZP.div.withConfig({displayName:"assetLocation__StyledContainer",componentId:"sc-ntcvpk-0"})(["align-items:center;display:flex;"]),$=(0,l.ZP)(h.Z).withConfig({displayName:"assetLocation__StyledDropdown",componentId:"sc-ntcvpk-1"})(["margin-right:1rem;.dropdown--toggle{color:rgb(0,55,83);}.dropdown--menu{min-width:14rem;}.dropdown--menu div{display:inline-block;}.dropdown--link{padding:0.15rem 0.4rem;}"]),w=l.ZP.div.withConfig({displayName:"assetLocation__StyledColour",componentId:"sc-ntcvpk-2"})(["background-color:",";height:1rem;margin-right:0.25rem;width:1rem;"],(function(e){return e.assetIconColor}))},60683:function(e,n,t){t.d(n,{R:function(){return P}});var o=t(92809),a=t(80318),r=t(67294),i=t(75709),s=t(64930),c=t(42283),l=t(79665),d=t(47385),u=t(97202),m=t(65375),y=t(71247),p=t(83528),v=t(84550),b=t(46482),f=t(95146),g=t(72197),h=t(40140),_=t(19501),x=function(e){var n=(0,_.Ry)().shape({customerSelected:(0,_.Ry)().required(),locationSelected:(0,_.Ry)().required(),assetCategory:(0,_.Ry)().required(),name:(0,_.Z_)().required(),description:(0,_.Z_)().required(),parentId:(0,_.Ry)().nullable(),userId:(0,_.Ry)(),status:(0,_.Z_)().oneOf(["active","inactive"]).required()}),t=(0,h.Xj)(e,{object:_.Ry,string:_.Z_});return n.concat(t)},I=[{disabled:!0,text:"Asset category",value:""},{text:"Furniture",value:"furniture"},{text:"Meeting Room",value:"meetingroom"},{text:"Plant",value:"plant"},{text:"Product",value:"product"},{text:"Sensor",value:"sensor"},{text:"Sub-location",value:"sublocation"},{text:"Desk",value:"desk"}],q=t(75838),j=t(23461),Z=t(42160),$=t(85893);function w(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function S(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?w(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var P=function(e){var n,t,o,_,w,P=e.categoryIdSublocation,k=e.data,A=e.disableSelects,C=e.id,O=e.initialData,N=(e.locationId,e.onSuccess),F=e.sublocation,z=(0,r.useState)(),L=z[0],D=z[1],T=(0,c.cI)({defaultValues:k?(0,h.$g)(k):{},resolver:(0,l.S)(x(L))}),G=T.control,R=T.errors,U=T.handleSubmit,E=T.register,M=T.setValue,B=T.watch,H=B("customerSelected",null===k||void 0===k?void 0:k.customerSelected),V=B("locationSelected",null===k||void 0===k?void 0:k.locationSelected),W=B("assetCategory",null===k||void 0===k||null===(n=k.category)||void 0===n?void 0:n.name);_=null===(t=I.find((function(e){return e.text===(null===W||void 0===W?void 0:W.label)})))||void 0===t?void 0:t.value,w=W&&W.childs.filter((function(e){return"assetQuestion"===e.type}))||[];var J=(0,d.Z)(H);(0,r.useEffect)((function(){H!==J&&J&&M("locationSelected",null),D(w)}),[H,W]);var Q=(0,i.D)(s.RL,{update:function(e,n){var t=n.data.insert_Asset.returning[0],o=e.readQuery({query:s.tG,variables:(0,Z.Z)(O)})||{assets:[]},a=o.assets.concat(t);e.writeQuery({query:s.tG,variables:(0,Z.Z)(O),data:{assets:a,meta:{aggregate:{totalCount:o.meta.aggregate.totalCount+1}}}})},onCompleted:N&&N}),X=(0,a.Z)(Q,1)[0],K=(0,i.D)(s.Wx,{onCompleted:N&&N}),Y=(0,a.Z)(K,1)[0],ee={control:G,isClearable:!1,errors:R,register:E};return(0,$.jsxs)(u.Z,{id:"offCanvasForm",handleSubmit:U((function(e){var n=(0,h.V2)(e);C?Y({variables:{id:C,changes:n}}):X({variables:{objects:[n],date:O.date}})})),children:[(0,$.jsx)(f.P,S(S({},ee),{},{errors:S({},R),isDisabled:A,label:"Customer",name:"customerSelected",type:"customer"})),(0,$.jsx)(f.P,S(S({},ee),{},{errors:S({},R),accountId:null===H||void 0===H?void 0:H.value,isDisabled:A,label:"Property",name:"locationSelected",type:"property"})),(0,$.jsx)(g.l,S(S({},ee),{},{label:"Category",name:"assetCategory",type:"assetCategory",filters:F&&{id:P}})),(0,$.jsx)(m.Z,{label:"Name",children:(0,$.jsx)(y.Z,S(S({},ee),{},{name:"name"}))}),(0,$.jsx)(m.Z,{label:"Description",children:(0,$.jsx)(p.Z,S(S({},ee),{},{name:"description",rows:3}))}),(0,$.jsx)(m.Z,{label:"",children:(0,$.jsx)(v.Z,S(S({},ee),{},{name:"bookable",data:[{label:"Bookable",value:"yes"}]}))}),null===(o=w)||void 0===o?void 0:o.map((function(e){var n,t,o,a;return(0,r.createElement)(j.f,S(S({},ee),{},{input:null===(n=e.meta)||void 0===n?void 0:n.input,inputType:null===(t=e.meta)||void 0===t?void 0:t.inputType,key:e.taxonomyId,label:null===(o=e.meta)||void 0===o?void 0:o.label,name:e.name,options:null===(a=e.meta)||void 0===a?void 0:a.options}))})),!["sublocation"].includes(_)&&(0,$.jsx)(f.P,S(S({},ee),{},{errors:S({},R),locationId:null===V||void 0===V?void 0:V.value,label:"Parent",name:"parentId",type:"asset"})),(0,$.jsx)(f.P,S(S({},ee),{},{errors:S({},R),accountId:null===H||void 0===H?void 0:H.value,label:"Primary user",name:"userId",type:"user"})),(0,$.jsx)(m.Z,{label:"Status",children:(0,$.jsx)(b.Z,S(S({},ee),{},{name:"status",options:q.bg}))})]})}},64930:function(e,n,t){t.d(n,{RL:function(){return f},yC:function(){return b},tG:function(){return v},Al:function(){return p},Wx:function(){return g}});var o,a,r,i,s,c,l,d,u=t(52209),m=t(54397),y=(0,m.Ps)(o||(o=(0,u.Z)(["\n  fragment AssetFields on Asset {\n    id\n    name\n    bookable\n    customFields\n    description\n    meta\n    status\n    createdAt\n  }\n"]))),p=(0,m.Ps)(a||(a=(0,u.Z)(['\n  query GetAssets(\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $orderBy: Asset_order_by!\n    $where: Asset_bool_exp\n  ) {\n    assets: Asset(limit: $limit, offset: $offset, where: $where, order_by: [$orderBy]) {\n      ...AssetFields\n      category: Category {\n        id\n        meta\n        name\n        childs: Taxonomies(order_by: { id: asc }) {\n          taxonomyId: id\n          name\n          type\n          meta\n        }\n      }\n      customer: Account {\n        id\n        name\n        type\n      }\n      location: Location {\n        id\n        name\n      }\n      userId: User {\n        value: id\n        label: fullName\n      }\n      parentId: ParentAsset {\n        value: id\n        label: fullName\n        category\n        media: Media(where: { entity: { _eq: "Asset" } }) {\n          id\n          item: Medium {\n            id\n            name\n            filename\n            category\n          }\n        }\n      }\n      media: Media {\n        medium: Medium {\n          id\n          filename\n        }\n      }\n\n      bookings: AssetBookings(\n        where: {\n          bookingStart: { _lte: $date }\n          bookingEnd: { _gte: $date }\n          status: { _eq: "active" }\n        }\n      ) {\n        id\n      }\n    }\n    meta: Asset_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n"])),y),v=(0,m.Ps)(r||(r=(0,u.Z)(['\n  query GetAssets(\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $orderBy: Asset_order_by!\n    $where: Asset_bool_exp\n  ) {\n    assets: Asset(limit: $limit, offset: $offset, where: $where, order_by: [$orderBy]) {\n      ...AssetFields\n      category: Category {\n        id\n        meta\n        name\n        childs: Taxonomies(order_by: { id: asc }) {\n          taxonomyId: id\n          name\n          type\n          meta\n        }\n      }\n      customer: Account {\n        id\n        name\n        type\n      }\n      location: Location {\n        id\n        name\n      }\n      userId: User {\n        value: id\n        label: fullName\n      }\n      parentId: ParentAsset {\n        value: id\n        label: fullName\n        category\n        media: Media(where: { entity: { _eq: "Asset" } }) {\n          id\n          item: Medium {\n            id\n            name\n            filename\n            category\n          }\n        }\n      }\n      media: Media {\n        medium: Medium {\n          id\n          filename\n        }\n      }\n      childAssets: Assets(limit: 1) {\n        logs: AssetLogs(limit: 1, order_by: { eventTime: desc }) {\n          value\n          eventTime\n        }\n      }\n      bookings: AssetBookings(\n        where: {\n          bookingStart: { _lte: $date }\n          bookingEnd: { _gte: $date }\n          status: { _eq: "active" }\n        }\n      ) {\n        id\n      }\n    }\n    meta: Asset_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n"])),y),b=(0,m.Ps)(i||(i=(0,u.Z)(['\n  query GetAsset($id: Int!) {\n    asset: Asset_by_pk(id: $id) {\n      ...AssetFields\n      sensorType: customFields(path: "$.Type")\n      category: Category {\n        id\n        name\n        sublocation: meta(path: "$.sublocation")\n        childs: Taxonomies(order_by: { id: asc }) {\n          taxonomyId: id\n          name\n          type\n          meta\n        }\n      }\n      customer: Account {\n        id\n        name\n        type\n      }\n      location: Location {\n        id\n        name\n      }\n      userId: User {\n        value: id\n        label: fullName\n      }\n      parentId: ParentAsset {\n        value: id\n        label: fullName\n        category\n        media: Media(where: { entity: { _eq: "Asset" } }) {\n          id\n          item: Medium {\n            id\n            name\n            filename\n            category\n          }\n        }\n      }\n    }\n  }\n  ',"\n"])),y),f=((0,m.Ps)(s||(s=(0,u.Z)(["\n  subscription GetAssetMeterByAssetId($assetId: Int!) {\n    meters: AssetMeter(where: { assetId: { _eq: $assetId } }, order_by: { id: desc }) {\n      id\n      name\n      unit\n      frequency\n      rangeLower\n      rangeUpper\n      status\n      meta\n      logs: AssetLogs(limit: 1000, order_by: { id: desc }) {\n        id\n        status\n        eventTime\n        type\n        value\n      }\n    }\n  }\n"]))),(0,m.Ps)(c||(c=(0,u.Z)(['\n  mutation AddAsset($objects: [Asset_insert_input!]!, $date: timestamptz) {\n    insert_Asset(objects: $objects) {\n      returning {\n        ...AssetFields\n        category: Category {\n          id\n          meta\n          name\n          childs: Taxonomies(order_by: { id: asc }) {\n            taxonomyId: id\n            name\n            type\n            meta\n          }\n        }\n        customer: Account {\n          id\n          name\n          type\n        }\n        location: Location {\n          id\n          name\n        }\n        userId: User {\n          value: id\n          label: fullName\n        }\n        parentId: ParentAsset {\n          value: id\n          label: fullName\n          category\n          media: Media(where: { entity: { _eq: "Asset" } }) {\n            id\n            item: Medium {\n              id\n              name\n              filename\n              category\n            }\n          }\n        }\n        media: Media {\n          medium: Medium {\n            id\n            filename\n          }\n        }\n        childAssets: Assets(limit: 1) {\n          logs: AssetLogs(limit: 1, order_by: { eventTime: desc }) {\n            value\n            eventTime\n          }\n        }\n        bookings: AssetBookings(\n          where: {\n            bookingStart: { _lte: $date }\n            bookingEnd: { _gte: $date }\n            status: { _eq: "active" }\n          }\n        ) {\n          id\n        }\n      }\n    }\n  }\n  ',"\n"])),y)),g=(0,m.Ps)(l||(l=(0,u.Z)(["\n  mutation UpdateAsset($id: Int!, $changes: Asset_set_input) {\n    update_Asset_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      name\n      bookable\n      customFields\n      description\n      meta\n      status\n    }\n  }\n"])));(0,m.Ps)(d||(d=(0,u.Z)(["\n  mutation DeleteAsset($id: Int!) {\n    delete_Asset_by_pk(id: $id) {\n      id\n    }\n  }\n"])))},48080:function(e,n,t){t.d(n,{B:function(){return Z}});var o=t(92809),a=t(67294),r=t(80880),i=t(93443),s=t(20305),c=t(14347),l=t(80284),d=t(22796),u=t(26398),m=t(73165),y=t(75515),p=t(18862),v=t(60683),b=t(24237),f=t(47357),g=t(85893),h=function(e){e.sensorType;return(0,g.jsx)(_,{children:(0,g.jsx)(x,{role:"img","aria-label":"temperature",children:(0,g.jsx)(I,{alt:"Temperature",src:"/static/sensors/temperature.svg"})})})},_=b.ZP.div.withConfig({displayName:"icon__StyledContainer",componentId:"sc-2l3v3z-0"})(["background-color:#fff;border-radius:3px;box-shadow:0 2px 4px 0 rgba(0,0,0,0.5);height:64px;position:relative;width:64px;z-index:2;&::before{background-color:#f79530;border-radius:50%;content:'';display:block;height:5px;left:3px;position:relative;top:4px;width:5px;}"]),x=b.ZP.div.withConfig({displayName:"icon__StyledIcon",componentId:"sc-2l3v3z-1"})(["background-repeat:no-repeat no-repeat;bottom:7px;display:inline-block;fill:currentColor;height:24px;margin:auto;min-width:32px;min-height:32px;position:absolute;right:0;vertical-align:middle;width:24px;"]),I=(0,b.ZP)(f.Z).withConfig({displayName:"icon__StyledImage",componentId:"sc-2l3v3z-2"})(["display:block;pointer-events:none;"]);function q(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function j(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?q(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Z=function(e){var n,t,o,b,f=e.asset,_=e.edit,x=e.meters,I=e.refetch,q=e.title,Z=(0,a.useContext)(r.Z),$=function(){I(),Z.close()},w=f.customFields,S=void 0===w?{}:w,P=function(){var e;if(!x||!x.length)return null;var n=x[0].unit,t=null===(e=x[0])||void 0===e?void 0:e.logs,o=t[t.length-1],a=null===o||void 0===o?void 0:o.eventTime;return o?(0,g.jsx)(i.Z,{content:"last value",text:"".concat(o.value," ").concat(n,"  ").concat((0,s.Z)(a))}):(0,g.jsx)(g.Fragment,{})},k=(0,g.jsx)(c.Z,{content:"Edit",context:"secondary",onClick:function(e){e.stopPropagation();var n=j(j({},f),{},{assetCategory:f.category});Z.show({content:(0,g.jsx)(v.R,{data:n,id:n.id,onSuccess:$}),title:"Edit asset"})},size:"sm"});return(0,g.jsxs)(l.Z,{fitParentHeight:!0,open:!0,title:q,toolbar:_&&k,children:["Sensor"===(null===(n=f.category)||void 0===n?void 0:n.name)&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(h,{sensorType:f.sensorType}),(0,g.jsx)(d.Z,{}),(0,g.jsx)(P,{})]}),(0,g.jsx)(i.Z,{content:"ID",text:(0,g.jsx)(u.Z,{to:"/dashboard/assets/view?id=".concat(f.id),children:f.id})}),(0,g.jsx)(i.Z,{content:"Name",text:f.name}),(0,g.jsx)(i.Z,{content:"Description",text:f.description}),(0,g.jsx)(i.Z,{content:"Primary user",text:(0,g.jsx)(u.Z,{to:"/dashboard/users/view?id=".concat(null===(t=f.userId)||void 0===t?void 0:t.value),children:null===(o=f.userId)||void 0===o?void 0:o.label})}),f.parentId&&(0,g.jsx)(i.Z,{content:"Parent asset",text:(0,g.jsx)(u.Z,{to:"/dashboard/assets/view?id=".concat(f.parentId.value),children:f.parentId.label})}),(0,g.jsx)(i.Z,{content:"Customer",text:(0,g.jsx)(u.Z,{to:"/dashboard/customers/view?id=".concat(f.customer.id,"&tab=details"),children:f.customer.name})}),(0,g.jsx)(i.Z,{content:"Property",text:(0,g.jsx)(u.Z,{to:"/dashboard/properties/view?id=".concat(f.location.id,"&tab=details"),children:f.location.name})}),(0,g.jsx)(i.Z,{content:"Category",text:(null===(b=f.category)||void 0===b?void 0:b.name)||""}),(0,g.jsx)(i.Z,{content:"Bookable",text:f.bookable}),Object.keys(S).map((function(e){return(0,g.jsx)(i.Z,{content:(0,m.Z)(y.Z.decamelize(e)),text:e.includes("date")?(0,p.Z)(S[e]):S[e]},e)})),(0,g.jsx)(i.Z,{content:"Date created",text:(0,p.Z)(f.createdAt)}),(0,g.jsx)(i.Z,{content:"Status",text:f.status})]})};Z.defaultProps={edit:!0,title:"Details"}},8046:function(e,n,t){t.d(n,{f:function(){return u}});var o=t(67294),a=t(80880),r=t(14347),i=t(80284),s=t(34717),c=t(11570),l=t(53444),d=t(85893),u=function(e){var n,t,u,m,y,p,v,b,f,g,h,_=e.asset,x=e.edit,I=e.refetch,q=(0,o.useContext)(a.Z),j=function(){I(),q.close()},Z=null===(n=_.parentId)||void 0===n||null===(t=n.media[0])||void 0===t?void 0:t.item.filename,$=(0,d.jsx)(r.Z,{content:"Edit",context:"secondary",onClick:function(e,n){e.stopPropagation(),q.show({content:(0,d.jsx)(l._,{data:_,id:_.id,name:_.name,locationId:_.location.id,onSuccess:j}),title:"Edit place asset on floorplan",width:"33%"})},size:"sm"});return(0,d.jsx)(i.Z,{fitParentHeight:!0,open:!0,title:"Place asset on floorplan",toolbar:x&&$,children:null!==(u=_.parentId)&&void 0!==u&&u.media[0]?(0,d.jsx)(s.Z,{coordinatesChange:function(){},customIcon:null===(m=_.meta)||void 0===m||null===(y=m.markerStyles)||void 0===y||null===(p=y.shape)||void 0===p?void 0:p.icon,initialCoordinates:null===(v=_.meta)||void 0===v?void 0:v.coordinates,item:{filename:"".concat("https://d1hk88326p7ilp.cloudfront.net","/").concat(Z),label:null===(b=_.parentId)||void 0===b?void 0:b.value,name:"Location",text:null===(f=_.parentId)||void 0===f?void 0:f.label},markerStyles:{color:null===(g=_.meta)||void 0===g||null===(h=g.markerStyles)||void 0===h?void 0:h.color}}):(0,d.jsx)(c.Z,{content:"Please assign a parent sub-location to enable asset placement",context:"info"})})};u.defaultProps={edit:!0}},14399:function(e,n,t){t.d(n,{cz:function(){return q},qd:function(){return j},nD:function(){return Z},UH:function(){return $},SW:function(){return w},Qn:function(){return S},he:function(){return P},j$:function(){return k},_d:function(){return A},kx:function(){return C},t1:function(){return O},by:function(){return N},yR:function(){return F},RJ:function(){return z},Cj:function(){return L},Ve:function(){return D},kU:function(){return T},kB:function(){return G}});var o,a,r,i,s,c,l,d,u,m,y,p,v,b,f,g,h,_,x=t(52209),I=t(54397),q=(0,I.Ps)(o||(o=(0,x.Z)(["\n  query GetAddressForSelect($q: String, $entity: String!, $entityId: Int!) {\n    items: Address(\n      where: {\n        Address_Entities: { entity: { _eq: $entity }, entityId: { _eq: $entityId } }\n        _or: [\n          { addressLine1: { _eq: $q } }\n          { addressLine2: { _eq: $q } }\n          { addressLine3: { _eq: $q } }\n          { county: { _eq: $q } }\n          { postCode: { _eq: $q } }\n          { city: { _eq: $q } }\n        ]\n      }\n    ) {\n      label: addressLine1\n      value: id\n      id\n      name\n      addressLine1\n      addressLine2\n      addressLine3\n      postCode\n      county\n      country: Country {\n        name\n      }\n      city\n      Address_Entities {\n        invoice\n      }\n    }\n  }\n"]))),j=(0,I.Ps)(a||(a=(0,x.Z)(["\n  query GetAccountsForSelect($q: String) {\n    items: Account(where: { name: { _ilike: $q } }, order_by: { name: asc }) {\n      label: name\n      value: id\n    }\n  }\n"]))),Z=(0,I.Ps)(r||(r=(0,x.Z)(['\n  query GetTaxonomy($q: String, $id: Int) {\n    items: Taxonomy(\n      where: { type: { _eq: "assetCategory" }, status: { _eq: "active" } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      options: Taxonomies(\n        where: {\n          type: { _eq: "assetCategory" }\n          name: { _ilike: $q }\n          id: { _eq: $id }\n          status: { _eq: "active" }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']))),$=(0,I.Ps)(i||(i=(0,x.Z)(["\n  query GetAssetsForSelect($locationId: Int, $q: String, $categoryId: Int, $bookable: String) {\n    items: Asset(\n      where: {\n        categoryId: { _eq: $categoryId }\n        locationId: { _eq: $locationId }\n        name: { _ilike: $q }\n        bookable: { _eq: $bookable }\n      }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n      parent: ParentAsset {\n        id\n        name\n      }\n      media: Media {\n        id\n        item: Medium {\n          id\n          name\n          filename\n          meta\n          category\n          type\n        }\n      }\n    }\n  }\n"]))),w=(0,I.Ps)(s||(s=(0,x.Z)(['\n  query GetCustomersForSelect($q: String) {\n    items: Account(\n      where: { name: { _ilike: $q }, type: { _eq: "customer" } }\n      order_by: { name: asc }\n    ) {\n      admin: Admins {\n        id: adminId\n      }\n      label: name\n      spendThreshold: meta(path: "$.finance.spendThreshold")\n      serviceRateLabour: meta(path: "$.finance.serviceRateLabour")\n      serviceRateExpenses: meta(path: "$.finance.serviceRateExpenses")\n      value: id\n    }\n  }\n']))),S=(0,I.Ps)(c||(c=(0,x.Z)(["\n  query GetJobsForSelect($_q: Int, $locationId: Int) {\n    items: Job(\n      where: {\n        Location: { id: { _eq: $locationId } }\n        _or: [{ id: { _eq: $_q } }, { Invoices: { id: { _eq: $_q } } }]\n      }\n      order_by: { title: asc }\n    ) {\n      label: label\n      value: id\n      number\n      createdAt\n      description\n      status\n      timingStart\n      title\n      type\n      Location {\n        name\n      }\n      Taxonomy {\n        Taxonomy {\n          shortJobDescription: name\n        }\n      }\n    }\n  }\n"]))),P=(0,I.Ps)(l||(l=(0,x.Z)(['\n  query GetManagersForSelect($accountId: Int!, $q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          role: { _in: ["owner", "manager"] }\n          status: { _eq: "active" }\n          Account: { id: { _eq: $accountId } }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n']))),k=(0,I.Ps)(d||(d=(0,x.Z)(["\n  query GetPostCodeAreaForSelect($countryId: Int, $q: String) {\n    items: PostcodeArea(\n      where: { name: { _ilike: $q }, countryId: { _eq: $countryId } }\n      order_by: { name: asc }\n    ) {\n      area\n      label: name\n      value: id\n    }\n  }\n"]))),A=(0,I.Ps)(u||(u=(0,x.Z)(["\n  query GetPropertiesForSelect($where: Location_bool_exp) {\n    items: Location(where: $where, order_by: { name: asc }) {\n      label: name\n      value: id\n      access\n      registeredAddress: Addresses(where: { registered: { _eq: true } }) {\n        address: Address {\n          id\n          addressLine1\n          addressLine2\n          addressLine3\n          county\n          country: Country {\n            name\n          }\n          postCode\n          city\n        }\n      }\n    }\n  }\n"]))),C=(0,I.Ps)(m||(m=(0,x.Z)(['\n  query GetServicesForSelect($q: String) {\n    items: Service(\n      where: { name: { _ilike: $q }, status: { _eq: "active" } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']))),O=(0,I.Ps)(y||(y=(0,x.Z)(["\n  query GetSlasForSelect($q: String, $adminId: Int, $type: String) {\n    items: SLA(\n      where: { name: { _ilike: $q }, type: { _eq: $type }, adminId: { _eq: $adminId } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]))),N=(0,I.Ps)(p||(p=(0,x.Z)(["\n  query GetSuppliersForSelect($where: Account_bool_exp) {\n    items: Account(where: $where, order_by: { name: asc }) {\n      label: name\n      value: id\n    }\n  }\n"]))),F=(0,I.Ps)(v||(v=(0,x.Z)(['\n  query GetUsersForSelect($accountId: Int, $q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          accountId: { _eq: $accountId }\n          isContact: { _eq: true }\n          status: { _eq: "active" }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n      email\n      phone\n    }\n  }\n']))),z=(0,I.Ps)(b||(b=(0,x.Z)(['\n  query GetUsersForSelect($q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n      email\n      phone\n    }\n  }\n']))),L=(0,I.Ps)(f||(f=(0,x.Z)(["\n  query GetTaxonomyGroupForSelect($q: String, $type: String!) {\n    items: Taxonomy(\n      where: { isGroup: { _eq: true }, name: { _ilike: $q }, type: { _eq: $type } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]))),D=(0,I.Ps)(g||(g=(0,x.Z)(['\n  query GetTaxonomy($q: String) {\n    items: Taxonomy(where: { type: { _eq: "expenseCategoryGroup" } }, order_by: { name: asc }) {\n      label: name\n      options: Taxonomies(\n        where: { type: { _eq: "expenseCategory" }, name: { _ilike: $q } }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']))),T=(0,I.Ps)(h||(h=(0,x.Z)(['\n  query GetCompliancesForSelect($q: String, $locationId: Int) {\n    items: Taxonomy(where: { type: { _eq: "complianceCategory" } }, order_by: { name: asc }) {\n      label: name\n      options: Compliances(\n        where: {\n          name: { _ilike: $q }\n          Compliance_Entities: { Location: { id: { _eq: $locationId } } }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']))),G=(0,I.Ps)(_||(_=(0,x.Z)(["\n  query GetUserRole($userId: Int!, $accountId: Int!) {\n    accountUsers: Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n    ) {\n      role\n    }\n  }\n"])))},95146:function(e,n,t){t.d(n,{P:function(){return Z}});var o=t(92809),a=t(30266),r=t(10219),i=t(64687),s=t.n(i),c=t(67294),l=t(24237),d=t(26075),u=t(14399),m=t(80880),y=t(42593),p=t(65375),v=t(78215),b=t(2356),f=t(93515),g=t(14347),h=t(85893),_=["AddForm","accountId","area","assetCategoryId","control","entity","entityId","errors","id","isClearable","isDisabled","label","locationId","name","serviceId","taxonomyGroupType","customerId","customerRole","type","userId"];function x(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function I(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?x(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):x(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var q=function(e,n){var t,o,a=!0;return(null===(t=e.errors[e.name])||void 0===t?void 0:t.message)!==(null===(o=n.errors[n.name])||void 0===o?void 0:o.message)&&(a=!1),["accountId","assetCategoryId","entity","entityId","locationId","serviceId","type","value","customerId","customerRole"].forEach((function(t){e[t]!==n[t]&&(a=!1)})),a},j=function(e){var n=e.accountId,t=e.area,o=e.assetCategoryId,a=e.entity,r=e.entityId,i=(e.hasRole,e.id),s=e.locationId,c=e.serviceId,l=e.taxonomyGroupType,d=e.customerId,m=e.customerRole,y=e.type,p=e.userId,v=y;switch(m&&(v="".concat(y,"_").concat(m)),v){case"address":return{query:u.cz,variables:{entity:a,entityId:r}};case"asset":return{query:u.UH,variables:{categoryId:o,locationId:s}};case"assetBookable":return{query:u.UH,variables:{categoryId:o,locationId:s,bookable:"yes"}};case"assetCategory":return{query:u.nD,variables:{id:i}};case"compliance":return{query:u.kU,variables:{locationId:s}};case"coverage":return{query:u.j$};case"customer":return{query:u.SW};case"job":return{query:u.Qn,variables:{locationId:s}};case"manager":return{query:u.he,variables:{accountId:n}};case"product":return{query:u.UH,variables:{category:"product",locationId:s}};case"property":return{query:u._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:n}}}}};case"property_user":return{query:u._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:n},Account:{type:{_eq:"customer"},Account_Users:{role:{_eq:"user"},userId:{_eq:d}}},User_Account_Locations:{Account_User:{userId:{_eq:d},accountId:{_eq:n}}}}}}};case"sensor":return{query:u.UH,variables:{category:"sensor",locationId:s}};case"service":return{query:u.kx};case"sla":return{query:u.t1,variables:{type:"priority",adminId:n}};case"sublocation":return{query:u.UH,variables:{category:"sublocation",adminId:n,locationId:s}};case"supplier":var b={type:{_eq:"supplier"}};return t&&(b.PostcodeAreas={PostcodeArea:{area:{_eq:t}},status:{_eq:"active"}}),c&&(b.Services={serviceId:{_eq:c},status:{_eq:"active"}}),{query:u.by,variables:{where:b}};case"user":return{query:u.yR,variables:{accountId:n}};case"usersForBookings":return{query:u.yR,variables:{accountId:p}};case"tenant":return{query:u.RJ};case"taxonomyGroup":return{query:u.Cj,variables:{type:l}};case"expenseCategory":return{query:u.Ve};default:return{query:u.qd}}},Z=(0,c.memo)((function(e){var n=e.AddForm,t=e.accountId,o=e.area,i=e.assetCategoryId,l=e.control,u=e.entity,x=e.entityId,q=e.errors,Z=e.id,w=e.isClearable,S=e.isDisabled,P=e.label,k=e.locationId,A=e.name,C=e.serviceId,O=e.taxonomyGroupType,N=e.customerId,F=e.customerRole,z=e.type,L=e.userId,D=(0,r.Z)(e,_),T=(0,d.x)(),G=(0,c.useState)(!1),R=G[0],U=G[1],E=(0,c.useState)(),M=E[0],B=E[1],H=(0,c.useState)(!1),V=H[0],W=H[1],J=(0,c.useContext)(m.Z),Q=(0,c.useContext)(y.Z).hasRole,X=(0,c.useState)(!1),K=X[0],Y=X[1];(0,c.useEffect)((function(){return Y(!1),W(!1),function(){}}),[t,i,u,x,k,C,z,N,F,L]);var ee=function(){var e=(0,a.Z)(s().mark((function e(){var n,a,r,c,l,d,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!V){e.next=3;break}return Y(!0),e.abrupt("return",null);case 3:return U(!0),n=j({accountId:t,area:o,assetCategoryId:i,entity:u,entityId:x,hasRole:Q,id:Z,locationId:k,serviceId:C,taxonomyGroupType:O,customerId:N,customerRole:F,type:z,userId:L}),a=n.query,r=n.variables,c=void 0===r?{}:r,e.next=7,T.query({query:a,variables:I({},c)});case 7:l=e.sent,d=l.data,m=(d=void 0===d?{items:[]}:d).items,B(m),U(!1),W(!0),Y(!0);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,h.jsx)(p.Z,{id:A,label:P,children:(0,h.jsxs)(v.Z,{children:[(0,h.jsx)(b.Z,{md:n?11:12,children:(0,h.jsx)(f.Z,I({autoload:!1,blurInputOnSelect:!0,cacheOptions:!0,control:l,errors:q,isDisabled:S,isClearable:w,isLoading:R,menuIsOpen:K,options:M,onFocus:ee,onBlur:function(){Y(!1)},name:A,searchable:!0},D),D.defaultValue)}),n&&(0,h.jsx)(b.Z,{md:1,children:(0,h.jsx)($,{children:(0,h.jsx)(g.Z,{content:null,startIcon:"plus",size:"sm",onClick:function(){J.show({content:(0,h.jsx)("div",{children:(0,h.jsx)(n,{})}),title:"Add form"})}})})})]})})}),q),$=l.ZP.div.withConfig({displayName:"select__ButtonWrapper",componentId:"sc-v7qj9m-0"})(["position:relative;right:25px;top:2px;"]);Z.defaultProps={isClearable:!0,label:"Account",name:"account",type:"account"}},26496:function(e,n,t){t.d(n,{l:function(){return o}});var o=function(e,n){var t=Math.pow(10,n);return Math.round(e*t)/t}},75838:function(e,n,t){t.d(n,{bg:function(){return o},WG:function(){return a}});var o=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}],a=[{text:"Status",value:""},{text:"Open",value:"open"},{text:"Resolved",value:"resolved"},{text:"Closed",value:"closed"}]}}]);