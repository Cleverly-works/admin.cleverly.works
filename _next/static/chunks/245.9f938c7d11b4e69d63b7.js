"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[245],{15067:function(t,e,n){n.d(e,{K:function(){return S}});var i=n(67294),s=n(14347),o=n(80284),r=n(92809),a=n(93633),c=n(40682),l=n(80880),u=n(91126),d=n(18862),p=n(64509),f=n(58448),m=n(25610),g=n(75201),x=n(81185),h=n(49705),j=n(85893);function b(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?b(Object(n),!0).forEach((function(e){(0,r.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var v={item:"bookingStart",order:"asc"},w=function(t){var e=t.assetId,n=t.locationId,o=t.userId,r=(0,h.x)({filters:{},initialSort:v}),b=r.initialData,w=r.ref,Z=(0,i.useContext)(l.Z),S=(0,a.a)(c.M8,{variables:y(y({},b),{},{assetId:e,userId:o})}),O=S.loading,k=S.data,_=(k=void 0===k?{asset:null}:k).assetBookings,I=k.meta,P=S.refetch,D=function(){Z.close()},C=[{hidden:!0},{text:"Asset",hidden:e},{text:"Title"},{text:"Start"},{text:"End"},{text:"Description"},{text:"Name"},{text:"All Day"},{formatter:u.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:function(t,i){return function(t,i){t.stopPropagation(),Z.show({content:(0,j.jsx)(m.D,{assetId:e,data:i.data,locationId:n,onSuccess:D}),title:"Edit Booking",width:"40%"})}(t,i)},tooltip:"Edit"}],text:"Actions"}];return(0,j.jsxs)(j.Fragment,{children:[_&&(0,j.jsx)(x.t,{columns:C,initialSort:v,loading:O,meta:I,ref:w,refetch:P,rowClick:function(t){Z.show({content:(0,j.jsx)(g.e,{assetId:e,data:t.data,locationId:n}),submit:!1,title:"View Booking",width:"40%"})},rows:_.map((function(t){return{data:y(y({},t),{assetSelected:{label:t.asset.name,value:t.asset.id}}),asset:t.asset.name,title:t.title,bookingStart:"".concat((0,d.Z)(t.bookingStart)," - ").concat((0,p.Z)(t.bookingStart)),bookingEnd:"".concat((0,d.Z)(t.bookingEnd)," - ").concat((0,p.Z)(t.bookingEnd)),description:t.description,name:t.user.fullName,allDay:t.allDay,actions:""}}))}),(0,j.jsx)(f.Z,{align:"flex-end",children:(0,j.jsx)(s.Z,{content:"Make a booking",context:"secondary",onClick:function(){Z.show({content:(0,j.jsx)(m.D,{assetId:e,locationId:n}),title:"Make a Booking",width:"40%"})},size:"sm"})})]})},Z=n(56881),S=function(t){var e=t.assetId,n=t.locationId,r=(0,i.useState)(!0),a=r[0],c=r[1],l=function(){return(0,j.jsx)(s.Z,{context:"info",onClick:function(t){return function(t){t.stopPropagation(),c(!a)}(t)},size:"sm",startIcon:a?"table":"calendar-alt",startIconProps:{size:"lg"}})};return(0,j.jsx)(o.Z,{fitParentHeight:!0,open:!0,title:"Asset bookings",toolbar:(0,j.jsx)(l,{}),children:a?(0,j.jsx)(Z.n,{assetId:e,locationId:n}):(0,j.jsx)(w,{assetId:e,locationId:n})})}},87160:function(t,e,n){n.d(e,{F:function(){return T}});var i,s=n(92809),o=n(83789),r=n(10219),a=n(30266),c=n(64687),l=n.n(c),u=n(67294),d=n(11163),p=n(26075),f=n(52209),m=(0,n(54397).Ps)(i||(i=(0,f.Z)(['\n  query GetEvents($where: Job_bool_exp) {\n    events: Job(where: $where) {\n      id\n      number\n      description\n      end: timingStart\n      scheduledAt\n      siteVisitStart\n      start: timingStart\n      status\n      title\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      supplierQuotes: SupplierQuotes(\n        where: {\n          siteVisitAt: { _is_null: false }\n          status: { _neq: "cancelled" }\n          type: { _eq: "quote" }\n        }\n      ) {\n        siteVisitAt\n        quoteNumber\n      }\n    }\n  }\n']))),g=n(80880),x=n(80284),h=n(78215),j=n(2356),b=n(92700),y=n(90358),v=n(1323),w=n(78586),Z=n(12517),S=n(55148),O=n(39129),k=n(34610),_=n(22796),I=n(18944),P=n(84550),D=n(24237),C=n(85893),V=function(t){var e=t.setTypes,n=t.setSiteVisit,i=t.types,s=function(t,n){e(n?[].concat((0,o.Z)(i),[t]):i.filter((function(e){return e!==t})))};return(0,C.jsxs)(h.Z,{children:[(0,C.jsxs)(q,{md:3,children:[(0,C.jsx)(k.Z,{onToggle:function(t){return s("reactive",t)},size:"sm",toggled:i.includes("reactive")}),(0,C.jsx)(_.Z,{marginLeft:"sm"}),(0,C.jsx)(I.Z,{size:"sm",children:"Reactive"})]}),(0,C.jsxs)(q,{md:3,children:[(0,C.jsx)(k.Z,{onToggle:function(t){return s("ppm",t)},size:"sm",toggled:i.includes("ppm")}),(0,C.jsx)(_.Z,{marginLeft:"sm"}),(0,C.jsx)(I.Z,{size:"sm",children:"PPM"})]}),(0,C.jsxs)(q,{md:3,children:[(0,C.jsx)(k.Z,{onToggle:function(t){return s("quote",t)},size:"sm",toggled:i.includes("quote")}),(0,C.jsx)(_.Z,{marginLeft:"sm"}),(0,C.jsx)(I.Z,{size:"sm",children:"Quote"})]}),(0,C.jsxs)(q,{md:3,children:[(0,C.jsx)(k.Z,{onToggle:function(t){return s("cppm",t)},size:"sm",toggled:i.includes("cppm")}),(0,C.jsx)(_.Z,{marginLeft:"sm"}),(0,C.jsx)(I.Z,{size:"sm",children:"Compliance"})]}),(0,C.jsxs)(_.Z,{marginLeft:"sm",children:[(0,C.jsx)(P.Z,{data:[{label:"Only show site visits",id:"siteVisit",value:"yes"}],name:"siteVisit",onClick:function(t){n(t.target.checked)}}),(0,C.jsx)(_.Z,{})]})]})},q=(0,D.ZP)(j.Z).withConfig({displayName:"filters__StyledColumn",componentId:"sc-3gjja8-0"})(["align-items:center;display:flex;"]),A=["supplierQuotes"];function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function z(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?E(Object(n),!0).forEach((function(e){(0,s.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var T=function(t){var e,n,i=t.defaultFilters,s=t.defaultView,c=t.locationId,f=t.showCompliance,k=t.showFilters,_=t.showSiteVisits,I=t.supplierId,P=(0,d.useRouter)().query,D=(0,u.useContext)(g.Z),q=(0,w.q)(),E=null===(e=q.admin.jobSetting)||void 0===e?void 0:e.jobNumberPrefix,T=null===(n=q.admin.jobSetting)||void 0===n?void 0:n.jobNumberSuffix,N=(0,v.x)().user,F=(0,p.x)(),B=!1,J=!1;switch(N.accountType){case"supplier":J=!0;break;case"customer":B=!0}var L=(0,u.useState)(P.type?["".concat(P.type)]:i),M=L[0],Q=L[1],G=(0,u.useState)(_),H=G[0],K=G[1],R="scheduled"===P.type?"PPM":"Bookings";(0,u.useEffect)((function(){return P.type?["".concat(P.type)]:Q(J?["ppm"]:i)}),[i]);var $=function(){var t=(0,a.Z)(l().mark((function t(e,n){var i,s,a,u,d;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i={type:{_in:M},_or:[{_and:[{timingStart:{_gte:e.start}},{timingStart:{_lte:e.end}}]},{_and:[{scheduledAt:{_gte:e.start}},{scheduledAt:{_lte:e.end}}]},{_and:[{siteVisitStart:{_gte:e.start}},{siteVisitStart:{_lte:e.end}}]}]},J&&(i.supplierId={_eq:N.accountId}),I&&(i.supplierId={_eq:I}),B&&(i.customerId={_eq:N.accountId}),c&&(i.locationId={_eq:c}),(f||c)&&(i.Compliances={complianceId:{_is_null:!1}}),H&&(i.siteVisitStart={_is_null:!1}),t.next=9,F.query({query:m,variables:{where:i}});case 9:s=t.sent,a=s.data,u=(a=void 0===a?{events:[]}:a).events,d=[],u.map((function(t){var e,n=t.supplierQuotes,i=(0,r.Z)(t,A),s=(null===i||void 0===i||null===(e=i.shortJobDesc[0])||void 0===e?void 0:e.taxonomy.name)||i.title;return d=[].concat((0,o.Z)(d),[z(z({},t),{},{title:s})]),n.length>0&&n.map((function(t){return d=[].concat((0,o.Z)(d),[z(z({},i),{},{start:t.siteVisitAt,end:t.siteVisitAt,title:"".concat(s," ").concat(t.quoteNumber),siteVisit:!0})])})),d})),n(d.map((function(t){var e=z({},t);return e.start=e.scheduledAt||e.start,e.end=e.scheduledAt||e.end||e.start,e.color=e.siteVisit?"rgb(182, 79, 200)":(0,y.t)(e.status),e})));case 16:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return(0,C.jsxs)(x.Z,{fitParentHeight:!0,open:!0,title:R,children:[k&&(0,C.jsx)(V,{setTypes:Q,setSiteVisit:K,types:M}),(0,C.jsx)(b.A,{eventClick:function(t){D.show({content:(0,C.jsx)(Z.g,{jobId:parseInt(t.event.id),toggleShow:D.close,numberPrefix:E,numberSuffix:T}),title:"Job details",submit:!1,width:"50%"})},events:$,initialView:"day"===P.show?"timeGridDay":s}),(0,C.jsx)(h.Z,{children:(0,C.jsx)(j.Z,{md:12,children:(0,C.jsx)(O.D,{status:S.yW})})})]})};T.defaultProps={dateClick:!1,defaultFilters:["reactive","ppm","quote","cppm"],showFilters:!0,showSiteVisits:!1}},39129:function(t,e,n){n.d(e,{D:function(){return o}});var i=n(24237),s=n(85893),o=function(t){var e=t.status;return(0,s.jsx)(r,{children:(0,s.jsx)("ul",{children:e.map((function(t,e){return(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{style:{backgroundColor:t.colour}}),t.text]},"legend".concat(e))}))})})},r=i.ZP.div.withConfig({displayName:"legend__StyledContainer",componentId:"sc-1gaw8i-0"})(["ul{list-style:none;float:left;padding-top:15px;}ul li{display:flex;flex-direction:row;align-items:center;float:left;width:120px;font-size:90%;list-style:none;}li span{display:block;float:left;height:12px;width:12px;margin-right:5px;}"])},30245:function(t,e,n){n.r(e);var i=n(78215),s=n(2356),o=n(15067),r=n(87160),a=n(85893);e.default=function(){return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(i.Z,{children:(0,a.jsxs)(s.Z,{sm:12,md:12,children:[(0,a.jsx)(r.F,{}),(0,a.jsx)(o.K,{})]})})})}}}]);