"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8039],{39759:function(e,t,n){var i=n(67294),r=n(45697),s=n(18944),a=function(e){var t=e.county,n=e.country,r=e.line1,a=e.line2,o=e.line3,l=e.postcode,c=e.town;return i.createElement("address",null,i.createElement(s.Z,null,r),a&&i.createElement(s.Z,null,a),o&&i.createElement(s.Z,null,o),i.createElement(s.Z,null,c),t&&i.createElement(s.Z,null,t),i.createElement(s.Z,null,l),i.createElement(s.Z,null,n))};a.displayName="Address",a.propTypes={county:r.string,country:r.string,line1:r.string.isRequired,line2:r.string,line3:r.string,postcode:r.string.isRequired,town:r.string},t.Z=a},93443:function(e,t,n){var i=n(67294),r=n(45697),s=n(22796),a=n(18944),o=function(e){var t=e.content,n=e.text;return i.createElement(i.Fragment,null,i.createElement(s.Z,{marginBottom:"sm"}),i.createElement(a.Z,{content:t,context:"dark",size:"sm"}),i.createElement(a.Z,null,n))};o.propTypes={content:r.string.isRequired,text:(0,r.oneOfType)([r.node,r.string]).isRequired},t.Z=o},62188:function(e,t,n){var i=n(67294),r=n(45697),s=n(55657),a=function(e){var t=e.icon,n=e.prefix;return i.createElement("span",{className:"fa-stack fa-1x",style:{pointerEvents:"none"}},i.createElement(s.Z,{className:"fa-stack-2x",color:"#eaf0f6",fixedWidth:!1,icon:"circle"}),i.createElement(s.Z,{className:"fa-stack-1x",color:"#506e91",fixedWidth:!1,icon:t,prefix:n}))};a.displayName="IconStacked",a.propTypes={icon:r.string.isRequired,prefix:r.string},a.defaultProps={prefix:"fas"},t.Z=a},47385:function(e,t,n){var i=n(67294);t.Z=function(e){var t=(0,i.useRef)();return(0,i.useEffect)((function(){t.current=e})),t.current}},63785:function(e,t,n){n.d(t,{Z:function(){return m}});var i=n(70885),r=n(67294),s=n(45697),a=n(71002),o=n(42982),l=n(15671),c=n(43144);function u(e){var t=this,n=[];if(Array.isArray(e)){var i=e.map((function(e){return t.locationBuilder(e)}));n.push.apply(n,(0,o.Z)(i))}return"string"!==typeof e&&"number"!==typeof e||n.push(e),"object"===(0,a.Z)(e)&&e.lat&&e.lng&&n.push("".concat(e.lat,",").concat(e.lng)),n.join("%7C")}function d(e,t,n){return function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=6371,s=Math.PI,a="",o=e*s/180,l=t*s/180,c=n/1e3/r,d=0;for(d=0;d<=360;d+=i){var p=d*s/180,h=Math.asin(Math.sin(o)*Math.cos(c)+Math.cos(o)*Math.sin(c)*Math.cos(p)),m=180*(l+Math.atan2(Math.sin(p)*Math.sin(c)*Math.cos(o),Math.cos(c)-Math.sin(o)*Math.sin(h)))/s;a+=u((h=180*h/s)+","+m)}return encodeURI(a)}(e,t,n)}var p=function(){function e(t){var n=t.apiKey,i=t.center,r=t.channel,s=t.client,a=t.format,o=void 0===a?"png":a,c=t.language,u=t.location,d=void 0===u?"":u,p=t.maptype,h=void 0===p?"roadmap":p,m=t.markers,f=void 0===m?[]:m,g=t.paths,v=void 0===g?[]:g,y=t.region,b=t.rootURL,x=void 0===b?"https://maps.googleapis.com/maps/api/staticmap":b,Z=t.scale,j=void 0===Z?1:Z,w=t.signature,k=t.size,C=void 0===k?"400x200":k,_=t.style,B=t.visible,E=t.zoom,P=void 0===E?15:E;(0,l.Z)(this,e),this.apiKey=n,this.channel=r,this.center=i,this.client=s,this.format=o,this.language=c,this.location=d,this.maptype=h,this.markers=f,this.paths=v,this.region=y,this.rootURL=x,this.scale=j,this.signature=w,this.size=C,this.style=_,this.visible=B,this.zoom=P}return(0,c.Z)(e,[{key:"urlBuilder",value:function(e,t,n){return t?"".concat(e).concat(n).concat(t):null}},{key:"renderBaseMap",value:function(){var e=[];e.push(this.urlBuilder("key",this.apiKey,"=")),e.push(this.urlBuilder("center",this.center,"=")),e.push(this.urlBuilder("channel",this.channel,"=")),e.push(this.urlBuilder("client",this.client,"=")),e.push(this.urlBuilder("format",this.format,"=")),e.push(this.urlBuilder("language",this.language,"=")),e.push(this.urlBuilder("maptype",this.maptype,"=")),e.push(this.urlBuilder("region",this.region,"=")),e.push(this.urlBuilder("scale",this.scale,"=")),e.push(this.urlBuilder("signature",this.signature,"=")),e.push(this.urlBuilder("size",this.size,"=")),e.push(this.urlBuilder("style",this.style,"=")),e.push(this.urlBuilder("visible",this.visible,"=")),e.push(this.urlBuilder("zoom",this.zoom,"="));var t=e.filter((function(e){return e})).join("&");return"".concat(this.rootURL,"?").concat(t)}},{key:"locationBuilder",value:function(e){var t=this,n=[];if(Array.isArray(e)){var i=e.map((function(e){return t.locationBuilder(e)}));n.push.apply(n,(0,o.Z)(i))}return"string"!==typeof e&&"number"!==typeof e||n.push(encodeURI(e)),"object"===(0,a.Z)(e)&&e.lat&&e.lng&&n.push("".concat(e.lat,",").concat(e.lng)),n.join("%7C")}},{key:"renderPath",value:function(e){var t=e.circle,n=e.color,i=e.fillcolor,r=e.geodesic,s=e.points,a=e.weight,o=[];if(t){var l=d(t.latitude,t.longitude,t.radius);o.push(this.urlBuilder("",this.locationBuilder("".concat(l)),""))}o.push(this.urlBuilder("color",n,":")),o.push(this.urlBuilder("weight",a,":")),o.push(this.urlBuilder("fillcolor",i,":")),o.push(this.urlBuilder("geodesic",r,":")),o.push(this.urlBuilder("",this.locationBuilder(s),""));var c=o.filter((function(e){return e})).join("%7C");return"path=".concat(c)}},{key:"renderParts",value:function(){var e=this;return this.paths.map((function(t){return e.renderPath(t)}))}},{key:"renderMarkers",value:function(){var e=this.markers,t=this.locationBuilder,n=this.location;return(e.length?e.map((function(e){var n="markers=";switch((0,a.Z)(e)){case"string":n+=t(e);break;case"object":var i=e.colour,r=e.label,s=e.location;n+=(i&&"color:".concat(i,"|"))+(r&&"label:".concat(r,"|"))+(s&&"".concat(t(s),"|"))}return n})):["markers=".concat(t(n))]).join("&")}},{key:"generateUrl",value:function(){var e=this.renderParts()||[],t=this.renderBaseMap(),n=this.renderMarkers();return"".concat(t,"&").concat(e,"&").concat(n)}}]),e}(),h=function(e){var t=e.apiKey,n=e.center,s=e.channel,a=e.className,o=e.client,l=e.container,c=void 0===l?"img":l,u=e.format,d=e.language,h=e.location,m=e.maptype,f=e.markers,g=e.paths,v=e.region,y=e.scale,b=e.signature,x=e.size,Z=e.style,j=e.styleMap,w=e.visible,k=e.zoom,C=x.split("x"),_=(0,i.Z)(C,2),B=_[0],E=_[1],P=(0,r.useState)(""),z=(0,i.Z)(P,2),M=z[0],I=z[1];return(0,r.useEffect)((function(){var e=new p({apiKey:t,center:n,channel:s,client:o,format:u,language:d,location:h,maptype:m,markers:f,paths:g,region:v,scale:y,signature:b,size:x,style:j,visible:w,zoom:k}).generateUrl();I(e)}),[]),r.createElement(c,{className:a,width:B,height:E,src:M,style:Z,alt:"map"})};h.displayName="StaticLocation",h.propTypes={apiKey:s.string.isRequired,center:s.string,channel:s.string,className:s.string,client:s.string,container:s.node,format:(0,s.oneOf)(["png","png8","png32","gif","jpg","jpg-baseline"]),language:s.string,location:s.string,maptype:(0,s.oneOf)(["roadmap","satellite","terrain","hybrid"]),markers:s.array,paths:s.array,region:s.string,scale:(0,s.oneOf)([1,2,4,"1","2","4"]),signature:s.string,size:s.string.isRequired,style:s.object,styleMap:s.string,visible:s.string,zoom:s.number},h.defaultProps={format:"png",maptype:"roadmap",scale:1,size:"400x200",zoom:15};var m=h},68794:function(e,t,n){var i,r=n(30168),s=n(67294),a=n(45697),o=n(5152),l=n(24237),c=n(4513),u=n(97721),d=(0,o.default)((function(){return Promise.all([n.e(4870),n.e(365)]).then(n.bind(n,60651))}),{ssr:!1,loading:function(){return s.createElement(u.Z,{indicator:s.createElement(c.Z,null)})}}),p=function(e){var t=e.businessHours,n=e.buttonIcons,i=e.dateClick,r=e.dayMaxEvents,a=e.editable,o=e.expandRows,l=e.eventClick,c=e.eventContent,u=e.events,p=(e.hasLoading,e.headerToolbar),m=e.height,f=e.initialDate,g=e.initialView,v=e.navLinks,y=e.nowIndicator,b=e.selectable,x=e.weekNumbers;return s.createElement(h,null,s.createElement(d,{businessHours:t,buttonIcons:n,dateClick:i,dayMaxEvents:r,editable:a,expandRows:o,eventClick:l,eventContent:c,events:u,height:m,headerToolbar:p,initialDate:f,initialView:g,navLinks:v,nowIndicator:y,selectable:b,weekNumbers:x}))};p.displayName="Calendar";var h=l.ZP.div(i||(i=(0,r.Z)(["\n  @media (max-width: 700px) {\n    .fc-header-toolbar {\n      flex-direction: column;\n    }\n  }\n"])));p.propTypes={businessHours:a.bool,buttonIcons:a.bool,dateClick:a.func,dayMaxEvents:a.bool,editable:a.bool,expandRows:a.bool,eventClick:a.func,eventContent:a.func,events:(0,a.oneOfType)([a.array,a.func]),hasLoading:a.bool,headerToolbar:a.object,height:(0,a.oneOfType)([a.number,a.string]),initialDate:a.string,initialView:a.string,navLinks:a.bool,nowIndicator:a.bool,selectable:a.bool,weekNumbers:a.bool},p.defaultProps={businessHours:!1,buttonIcons:!0,dayMaxEvents:!0,editable:!1,expandRows:!1,hasLoading:!0,headerToolbar:{center:"title",end:"listWeek,dayGridMonth,timeGridWeek,timeGridDay",start:"prevYear,prev,next,nextYear today"},height:"auto",initialView:"listWeek",navLinks:!0,nowIndicator:!0,selectable:!1,weekNumbers:!1},t.Z=p},75515:function(e,t){t.Z={camelize:function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,(function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()})).replace(/\s+/g,"")},decamelize:function(e){return e.split(/(?=[A-Z])/).join(" ")}}},80285:function(e,t){t.Z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GBP",n=new Intl.NumberFormat(["en-GB"],{currency:t,currencyDisplay:"symbol",style:"currency"});return n.format(e)}},87160:function(e,t,n){n.d(t,{F:function(){return T}});var i,r=n(92809),s=n(83789),a=n(10219),o=n(30266),l=n(64687),c=n.n(l),u=n(67294),d=n(11163),p=n(26075),h=n(52209),m=(0,n(54397).Ps)(i||(i=(0,h.Z)(['\n  query GetEvents($where: Job_bool_exp) {\n    events: Job(where: $where) {\n      id\n      number\n      description\n      end: timingStart\n      scheduledAt\n      siteVisitStart\n      start: timingStart\n      status\n      title\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      supplierQuotes: SupplierQuotes(\n        where: {\n          siteVisitAt: { _is_null: false }\n          status: { _neq: "cancelled" }\n          type: { _eq: "quote" }\n        }\n      ) {\n        siteVisitAt\n        quoteNumber\n      }\n    }\n  }\n']))),f=n(80880),g=n(80284),v=n(78215),y=n(2356),b=n(92700),x=n(90358),Z=n(1323),j=n(78586),w=n(12517),k=n(55148),C=n(39129),_=n(34610),B=n(22796),E=n(18944),P=n(84550),z=n(24237),M=n(85893),I=function(e){var t=e.setTypes,n=e.setSiteVisit,i=e.types,r=function(e,n){t(n?[].concat((0,s.Z)(i),[e]):i.filter((function(t){return t!==e})))};return(0,M.jsxs)(v.Z,{children:[(0,M.jsxs)(S,{md:3,children:[(0,M.jsx)(_.Z,{onToggle:function(e){return r("reactive",e)},size:"sm",toggled:i.includes("reactive")}),(0,M.jsx)(B.Z,{marginLeft:"sm"}),(0,M.jsx)(E.Z,{size:"sm",children:"Reactive"})]}),(0,M.jsxs)(S,{md:3,children:[(0,M.jsx)(_.Z,{onToggle:function(e){return r("ppm",e)},size:"sm",toggled:i.includes("ppm")}),(0,M.jsx)(B.Z,{marginLeft:"sm"}),(0,M.jsx)(E.Z,{size:"sm",children:"PPM"})]}),(0,M.jsxs)(S,{md:3,children:[(0,M.jsx)(_.Z,{onToggle:function(e){return r("quote",e)},size:"sm",toggled:i.includes("quote")}),(0,M.jsx)(B.Z,{marginLeft:"sm"}),(0,M.jsx)(E.Z,{size:"sm",children:"Quote"})]}),(0,M.jsxs)(S,{md:3,children:[(0,M.jsx)(_.Z,{onToggle:function(e){return r("cppm",e)},size:"sm",toggled:i.includes("cppm")}),(0,M.jsx)(B.Z,{marginLeft:"sm"}),(0,M.jsx)(E.Z,{size:"sm",children:"Compliance"})]}),(0,M.jsxs)(B.Z,{marginLeft:"sm",children:[(0,M.jsx)(P.Z,{data:[{label:"Only show site visits",id:"siteVisit",value:"yes"}],name:"siteVisit",onClick:function(e){n(e.target.checked)}}),(0,M.jsx)(B.Z,{})]})]})},S=(0,z.ZP)(y.Z).withConfig({displayName:"filters__StyledColumn",componentId:"sc-3gjja8-0"})(["align-items:center;display:flex;"]),q=["supplierQuotes"];function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var T=function(e){var t,n,i=e.defaultFilters,r=e.defaultView,l=e.locationId,h=e.showCompliance,_=e.showFilters,B=e.showSiteVisits,E=e.supplierId,P=(0,d.useRouter)().query,z=(0,u.useContext)(f.Z),S=(0,j.q)(),V=null===(t=S.admin.jobSetting)||void 0===t?void 0:t.jobNumberPrefix,T=null===(n=S.admin.jobSetting)||void 0===n?void 0:n.jobNumberSuffix,N=(0,Z.x)().user,L=(0,p.x)(),R=!1,A=!1;switch(N.accountType){case"supplier":A=!0;break;case"customer":R=!0}var D=(0,u.useState)(P.type?["".concat(P.type)]:i),G=D[0],W=D[1],F=(0,u.useState)(B),U=F[0],K=F[1],H="scheduled"===P.type?"PPM":"Bookings";(0,u.useEffect)((function(){return P.type?["".concat(P.type)]:W(A?["ppm"]:i)}),[i]);var J=function(){var e=(0,o.Z)(c().mark((function e(t,n){var i,r,o,u,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={type:{_in:G},_or:[{_and:[{timingStart:{_gte:t.start}},{timingStart:{_lte:t.end}}]},{_and:[{scheduledAt:{_gte:t.start}},{scheduledAt:{_lte:t.end}}]},{_and:[{siteVisitStart:{_gte:t.start}},{siteVisitStart:{_lte:t.end}}]}]},A&&(i.supplierId={_eq:N.accountId}),E&&(i.supplierId={_eq:E}),R&&(i.customerId={_eq:N.accountId}),l&&(i.locationId={_eq:l}),(h||l)&&(i.Compliances={complianceId:{_is_null:!1}}),U&&(i.siteVisitStart={_is_null:!1}),e.next=9,L.query({query:m,variables:{where:i}});case 9:r=e.sent,o=r.data,u=(o=void 0===o?{events:[]}:o).events,d=[],u.map((function(e){var t,n=e.supplierQuotes,i=(0,a.Z)(e,q),r=(null===i||void 0===i||null===(t=i.shortJobDesc[0])||void 0===t?void 0:t.taxonomy.name)||i.title;return d=[].concat((0,s.Z)(d),[O(O({},e),{},{title:r})]),n.length>0&&n.map((function(e){return d=[].concat((0,s.Z)(d),[O(O({},i),{},{start:e.siteVisitAt,end:e.siteVisitAt,title:"".concat(r," ").concat(e.quoteNumber),siteVisit:!0})])})),d})),n(d.map((function(e){var t=O({},e);return t.start=t.scheduledAt||t.start,t.end=t.scheduledAt||t.end||t.start,t.color=t.siteVisit?"rgb(182, 79, 200)":(0,x.t)(t.status),t})));case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return(0,M.jsxs)(g.Z,{fitParentHeight:!0,open:!0,title:H,children:[_&&(0,M.jsx)(I,{setTypes:W,setSiteVisit:K,types:G}),(0,M.jsx)(b.A,{eventClick:function(e){z.show({content:(0,M.jsx)(w.g,{jobId:parseInt(e.event.id),toggleShow:z.close,numberPrefix:V,numberSuffix:T}),title:"Job details",submit:!1,width:"50%"})},events:J,initialView:"day"===P.show?"timeGridDay":r}),(0,M.jsx)(v.Z,{children:(0,M.jsx)(y.Z,{md:12,children:(0,M.jsx)(C.D,{status:k.yW})})})]})};T.defaultProps={dateClick:!1,defaultFilters:["reactive","ppm","quote","cppm"],showFilters:!0,showSiteVisits:!1}},92700:function(e,t,n){n.d(t,{A:function(){return s}});var i=n(68794),r=n(85893),s=function(e){var t=e.dateClick,n=e.events,s=e.eventClick,a=e.eventContent,o=(e.hasLoading,e.height),l=e.initialView;return(0,r.jsx)(i.Z,{dateClick:t,eventClick:s,eventContent:a,events:n,hasLoading:!0,height:o,headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},initialView:l})};s.defaultProps={initialView:"listWeek",hasLoading:!0,height:550}},39129:function(e,t,n){n.d(t,{D:function(){return s}});var i=n(24237),r=n(85893),s=function(e){var t=e.status;return(0,r.jsx)(a,{children:(0,r.jsx)("ul",{children:t.map((function(e,t){return(0,r.jsxs)("li",{children:[(0,r.jsx)("span",{style:{backgroundColor:e.colour}}),e.text]},"legend".concat(t))}))})})},a=i.ZP.div.withConfig({displayName:"legend__StyledContainer",componentId:"sc-1gaw8i-0"})(["ul{list-style:none;float:left;padding-top:15px;}ul li{display:flex;flex-direction:row;align-items:center;float:left;width:120px;font-size:90%;list-style:none;}li span{display:block;float:left;height:12px;width:12px;margin-right:5px;}"])},73691:function(e,t,n){n.r(t);var i=n(78215),r=n(2356),s=n(87160),a=n(85893);t.default=function(){return(0,a.jsx)(i.Z,{children:(0,a.jsx)(r.Z,{sm:12,md:12,children:(0,a.jsx)(s.F,{})})})}}}]);