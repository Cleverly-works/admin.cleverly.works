"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6433],{17517:function(e,t,n){n.d(t,{u:function(){return r}});var r=function(e){var t=e.addresses;return null!==t&&void 0!==t&&t.address?{__html:"".concat(t.address.addressLine1,"<br />").concat(t.address.postCode)}:"Please add"}},23154:function(e,t,n){n.d(t,{E:function(){return i}});var r=n(30266),o=n(64687),a=n.n(o),c=n(27834),i=function(){var e=(0,r.Z)(a().mark((function e(t,n){var r,o,i,s=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]&&s[2],e.prev=1,e.next=4,t.query({query:c.WF,variables:{email:n}});case 4:if(o=e.sent,!((i=o.data.users)&&i.length>0)){e.next=8;break}return e.abrupt("return",!!r&&i[0]);case 8:return e.abrupt("return",!r||null);case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t,n){return e.apply(this,arguments)}}()},10076:function(e,t,n){n.d(t,{H:function(){return E}});var r=n(92809),o=n(83789),a=n(93633),c=n(42283),i=n(79665),s=n(84550),u=n(97202),l=n(65375),d=n(46482),p=n(71247),f=n(69128),v=n(34003),m=n(98315),h=n(19501),x=(0,h.Ry)().shape({nameFirst:(0,h.Z_)().required(),nameLast:(0,h.Z_)().required(),email:(0,h.Z_)().required().email(),phone:(0,h.Z_)().required(),status:(0,h.Z_)().when("$hasRole",(function(e){return e?(0,h.Z_)().oneOf(["active","inactive"]).required():void 0})),invoiceThreshold:(0,h.Rx)().nullable(!0).transform((function(e){return isNaN(e)?null:e})),quoteThreshold:(0,h.Rx)().nullable(!0).transform((function(e){return isNaN(e)?null:e})),role:(0,h.Z_)().when(["$hasRole","accountId"],(function(e,t){return e?t&&t.length>0&&(0,h.Z_)().required():void 0})),position:(0,h.Z_)().when("accountId",{is:function(e){return e&&e.length>0},then:(0,h.Z_)()}),isContact:(0,h.Z_)().when("accountId",{is:function(e){return e&&e.length>0},then:(0,h.Z_)().oneOf(["yes","no"]).required()}),location:(0,h.IX)().when("$hasLocation",(function(e){return e?(0,h.IX)().of((0,h.Rx)().integer().required()).required():void 0}))}),b=n(1323),j=n(56257),Z=n(27834),y=n(17517),g=n(81185),O=n(49705),w=n(85893);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var U=function(e,t){return"customer"!==e&&"supplier"!==e||t([].concat((0,o.Z)(j.td),(0,o.Z)(j.Sf),(0,o.Z)(j.n),(0,o.Z)(j.nx)))},C=["customer_user"],E=function(e){var t=e.accountType,n=e.defaultValues,r=e.meta,h=e.submit,I=(0,b.x)(),E=I.hasRole,_=I.user,D=(0,O.x)({filters:{}}),L=D.initialData,S=D.ref,k=(0,c.cI)({defaultValues:n&&P({},n),resolver:(0,i.S)(x),context:{hasRole:U(t,E),hasLocation:!C.includes(_.role)&&C.includes("".concat(t,"_").concat(null===n||void 0===n?void 0:n.role))}}),q=k.control,A=k.errors,F=k.handleSubmit,T=k.register,R=(0,k.watch)("role"),N=(0,a.a)(Z.ZA,{variables:P(P({},L),{},{accountId:n.accountId})}),W=N.data,H=(W=void 0===W?{location:[],meta:{aggregate:{totalCount:0}}}:W).location,Q=W.meta,V=N.loading,X=N.refetch,$=(0,o.Z)(m.I);switch(t){case"supplier":$.push({text:"Operative",value:"contractor"});break;case"admin":$.push({text:"Helpdesk",value:"helpdesk"})}var G={control:q,errors:A,register:T},M=[{hidden:!E([].concat((0,o.Z)(j.td),(0,o.Z)(j.Sf),(0,o.Z)(j.n))),formatter:function(e){var t=e.row;return(0,w.jsx)(s.Z,P(P({},G),{},{name:"location",data:[{value:t.id}]}))}},{text:"Name"},{text:"Address"}];return(0,w.jsxs)(u.Z,{id:"offCanvasForm",handleSubmit:F((function(e){h(e,r)})),children:[(0,w.jsx)(v.q,P({},G)),n.accountId&&(0,w.jsxs)(w.Fragment,{children:[U(t,E)&&(0,w.jsx)(l.Z,{label:"Role",children:(0,w.jsx)(d.Z,P(P({},G),{},{name:"role",options:$}))}),(0,w.jsx)(l.Z,{label:"Position / Job title",children:(0,w.jsx)(p.Z,P(P({},G),{},{name:"position"}))}),E(["admin_owner","admin_manager","customer_owner","customer_manger","supplier_owner","supplier_manager"])&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(l.Z,{label:"Threshold limit / Invoice",children:(0,w.jsx)(p.Z,P(P({},G),{},{name:"invoiceThreshold"}))}),(0,w.jsx)(l.Z,{label:"Threshold limit / Quote",children:(0,w.jsx)(p.Z,P(P({},G),{},{name:"quoteThreshold"}))})]}),(0,w.jsx)(f.Z,P(P({},G),{},{data:[{id:"yes",label:"Yes",value:"yes"},{id:"no",label:"No",value:"no"}],legend:"Contact User",name:"isContact",stacked:!0})),C.includes("".concat(t,"_").concat(R))&&(0,w.jsx)(l.Z,{label:"Locations",children:(0,w.jsx)(g.t,{columns:M,loading:V,meta:Q,ref:S,refetch:X,rows:function(){var e=H.map((function(e){return{id:e.accountLocations[0].id,name:e.name,address:(0,y.u)({addresses:e.addresses[0]})}}));return C.includes(_.role)?e.filter((function(e){var t;return null===n||void 0===n||null===(t=n.location)||void 0===t?void 0:t.includes("".concat(e.id))})):e}()})})]}),(null===n||void 0===n?void 0:n.id)&&(0,w.jsx)(p.Z,P(P({},G),{},{name:"id",type:"hidden"})),(null===n||void 0===n?void 0:n.accountId)&&(0,w.jsx)(p.Z,P(P({},G),{},{name:"accountId",type:"hidden"})),(null===n||void 0===n?void 0:n.accountUserId)&&(0,w.jsx)(p.Z,P(P({},G),{},{name:"accountUserId",type:"hidden"}))]})}},81167:function(e,t,n){n.d(t,{P:function(){return R}});var r=n(83789),o=n(92809),a=n(30266),c=n(80318),i=n(64687),s=n.n(i),u=n(67294),l=n(11163),d=n(26075),p=n(93633),f=n(75709),v=n(27834),m=n(80880),h=n(43566),x=n(29444),b=n(91126),j=n(18862),Z=n(58448),y=n(14347),g=n(80284),O=n(22796),w=n(11570),I=n(81185),P=n(50899),U=n(49705),C=n(10076);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var D=function(e,t,n){var r={};return e.id?(r.id=parseInt(e.id),r.changes={nameFirst:e.nameFirst,nameLast:e.nameLast,email:e.email,phone:e.phone,meta:_(_({},t),{},{threshold:{invoice:e.invoiceThreshold,quote:e.quoteThreshold}})},e.accountUserId?(r.updateAccountUser=!0,r.accountUserId=parseInt(e.accountUserId),r.accountUserChanges={role:e.role,position:e.position,isContact:"yes"===e.isContact,status:e.status}):(r.accountUserId=0,r.updateAccountUser=!1)):(r.role=e.role,r.position=e.position,r.isContact="yes"===e.isContact,r.status=e.status,r.accountId=e.accountId,n?r.userId=n.id:r.User={data:{nameFirst:e.nameFirst,nameLast:e.nameLast,email:e.email,phone:e.phone,status:e.status,meta:{sendDefaultWelcomeEmail:!0}}}),r},L=function(e){return{accountUserId:e.accountUserId,objects:e.location.map((function(t){return{accountUserId:e.accountUserId,accountLocationId:t}}))}},S=n(14651),k=n(23154),q=n(56257),A=n(85893);function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var R=function(e){var t=e.accountType,n=e.filters,o=(0,d.x)(),i=(0,U.x)({filters:n}),E=i.initialData,_=i.ref,F=(0,u.useContext)(m.Z),R=(0,u.useContext)(h.Z).user,N=null,W=(0,p.a)(v.fo,{variables:E}),H=W.data,Q=(H=void 0===H?{users:[],meta:{aggregate:{totalCount:0}}}:H).users,V=H.meta,X=W.loading,$=W.refetch,G=(0,f.D)(v.I4,{onCompleted:function(e){F.close(),$()}}),M=(0,c.Z)(G,2),Y=M[0],z=M[1].error,J=(0,f.D)(v.AX,{onCompleted:function(e){F.close(),$()}}),B=(0,c.Z)(J,2),K=B[0],ee=B[1].error,te=(0,f.D)(v.tW,{onCompleted:function(e){$()}}),ne=(0,c.Z)(te,2),re=ne[0],oe=ne[1].error;z&&z.graphQLErrors.forEach((function(e){var t;N="constraint-violation"===(null===(t=e.extensions)||void 0===t?void 0:t.code)?"Error: a user with this e-mail address already exists":"Error creating user"})),ee&&ee.graphQLErrors.forEach((function(e){var t;N="constraint-violation"===(null===(t=e.extensions)||void 0===t?void 0:t.code)?"Error, a user with this e-mail address already exists":"Error updating user"})),oe&&(N="Error getting user`s locations");var ae=function(){var e=(0,a.Z)(s().mark((function e(t,n){var r,a,c,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,k.E)(o,t.email,!0);case 2:if(r=e.sent,a=D(t,n,r),!t.id){e.next=9;break}K({variables:T({},a)}),t.location&&re({variables:T({},L(t))}),e.next=14;break;case 9:return e.next=11,Y({variables:{objects:a}});case 11:c=e.sent,i=c.data.insert_Account_User.returning,t.location&&re({variables:T({},L({location:t.location,accountUserId:i[0].id}))});case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ce=function(e,r){e.stopPropagation();var o=function(e){var t,n,r,o,a={id:(null===e||void 0===e?void 0:e.id)||null,accountId:null===e||void 0===e?void 0:e.accountId,nameFirst:(null===e||void 0===e?void 0:e.nameFirst)||"",nameLast:(null===e||void 0===e?void 0:e.nameLast)||"",email:(null===e||void 0===e?void 0:e.email)||"",phone:(null===e||void 0===e?void 0:e.phone)||"",invoiceThreshold:null===(t=e.meta)||void 0===t||null===(n=t.threshold)||void 0===n?void 0:n.invoice,quoteThreshold:null===(r=e.meta)||void 0===r||null===(o=r.threshold)||void 0===o?void 0:o.quote,role:"",position:"",isContact:"",status:"active",meta:null===e||void 0===e?void 0:e.meta};return null!==e&&void 0!==e&&e.accountUser&&(a.accountUserId=e.accountUser.id,a.accountId=e.accountUser.account.id,a.role=e.accountUser.role,a.position=e.accountUser.position,a.isContact=!0===e.accountUser.isContact?"yes":"no",a.status=e.accountUser.status,a.location=e.accountUser.userLocations.map((function(e){return"".concat(e.accountLocationId)}))),a}(T(T({},r),{},{accountId:n.accountId}));F.show({content:(0,A.jsx)(C.H,{accountType:t,defaultValues:o,meta:null===r||void 0===r?void 0:r.meta,submit:ae,submitError:N}),title:r?"Edit user":"Add user"})},ie=[{hidden:!0},{text:"Name"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:n.accountId,formatter:(0,x.Z)("","accountId","account","url"),text:"Account"},{text:"Email Address"},{text:"Contact User",formatter:function(e){var t=e.row;e.data;if(t.accountUser.isContact)return(0,A.jsx)(S.Z,{color:"error"})}},{text:"Phone"},{text:"Position"},{hidden:!0},{hidden:!n.accountId,text:"Role"},{text:"Status"},{text:"Date Added",sortable:!0,sortName:"createdAt"},{hidden:!0},{hidden:!0},{formatter:function(e){var n=e.row,o=e.data;return"supplier"!==t&&"customer"!==t||R.email!==n.email&&![].concat((0,r.Z)(q.td),(0,r.Z)(q.Sf),(0,r.Z)(q.n),(0,r.Z)(q.nx)).includes(R.role)?[].concat((0,r.Z)(q.td),(0,r.Z)(q.Sf),(0,r.Z)(q.n),(0,r.Z)(q.nx)).includes(R.role)?(0,A.jsx)(b.Z,{row:n,data:o}):void 0:(0,A.jsx)(b.Z,{row:n,data:o})},formatterData:[{context:"secondary",icon:["fas","edit"],onClick:ce,tooltip:"Edit"},{context:"info",icon:["fas","file-upload"],onClick:function(e,t){e.stopPropagation(),F.show({content:(0,A.jsx)(P.G,{category:"avatar",entity:"User",entityId:t.id,limit:1,type:"image"}),submit:!1,title:"Upload avatar"})},tooltip:"Avatar"}],text:"Actions"}],se=function(){return(0,A.jsx)(Z.Z,{children:(0,A.jsx)(y.Z,{context:"secondary",content:"Edit",onClick:ce,size:"sm",children:"Create User"})})};return(0,A.jsxs)(g.Z,{toolbar:n.accountId&&[].concat((0,r.Z)(q.td),(0,r.Z)(q.Sf),(0,r.Z)(q.n),(0,r.Z)(q.nx)).includes(R.role)&&(0,A.jsx)(se,{}),open:!0,title:"Users",children:[(0,A.jsx)(I.t,{columns:ie,loading:X,meta:V,ref:_,refetch:$,rowClick:function(e){l.default.push("".concat("/dashboard/users/","view?id=").concat(e.id))},rows:function(){var e=[];return Q.forEach((function(t){var r,o,a,c=null;c=n.accountId?t.accounts.find((function(e){var t;return(null===(t=e.account)||void 0===t?void 0:t.id)===parseInt(n.accountId)})):t.accounts.find((function(e){return null!==e.account}));var i={id:t.id,name:"".concat(t.nameFirst," ").concat(t.nameLast),nameFirst:t.nameFirst,nameLast:t.nameLast,accountId:c&&c.account.id,type:c&&c.account.type,email:t.email,account:c?"".concat(c.account.name," (").concat(c.account.type,")"):"-",phone:t.phone,position:null!==(r=c)&&void 0!==r&&r.position?c.position:"N/A",accountUser:c,role:null===(o=c)||void 0===o?void 0:o.role,status:c?c.status:t.status,createdAt:(0,j.Z)(t.createdAt),url:c&&!["admin","tenant"].includes(c.account.type.toLowerCase())?"/dashboard/".concat(null===(a=c)||void 0===a?void 0:a.account.type.toLowerCase(),"s/view"):"",meta:t.meta,actions:""};e.push(i)})),e}()}),N&&(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(O.Z,{}),(0,A.jsx)(w.Z,{content:N,context:"warning"})]})]})}},34003:function(e,t,n){n.d(t,{q:function(){return x}});var r=n(83789),o=n(92809),a=n(78215),c=n(2356),i=n(65375),s=n(71247),u=n(50710),l=n(46482),d=n(75838),p=n(1323),f=n(56257),v=n(85893);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=function(e){var t=e.errors,n=e.prefix,o=e.register,m=(0,p.x)().hasRole,x={errors:t,register:o};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(a.Z,{children:[(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(i.Z,{label:"First name",children:(0,v.jsx)(s.Z,h(h({},x),{},{name:"".concat(n,"nameFirst")}))})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(i.Z,{label:"Last name",children:(0,v.jsx)(s.Z,h(h({},x),{},{name:"".concat(n,"nameLast")}))})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsxs)(i.Z,{label:"Email",children:[(0,v.jsx)(s.Z,h(h({},x),{},{name:"".concat(n,"email"),type:"email"})),t["".concat(n,"email")]&&"duplicate"===t["".concat(n,"email")].type&&(0,v.jsx)(u.Z,{message:t["".concat(n,"email")].message})]})}),(0,v.jsx)(c.Z,{md:6,children:(0,v.jsx)(i.Z,{label:"Mobile",children:(0,v.jsx)(s.Z,h(h({},x),{},{name:"".concat(n,"phone")}))})})]}),m([].concat((0,r.Z)(f.td),(0,r.Z)(f.Sf),(0,r.Z)(f.n),(0,r.Z)(f.nx)))&&(0,v.jsx)(i.Z,{label:"Status",children:(0,v.jsx)(l.Z,h(h({},x),{},{name:"".concat(n,"status"),options:d.bg}))}),(0,v.jsx)(s.Z,h(h({},x),{},{name:"".concat(n,"userId"),type:"hidden"}))]})};x.defaultProps={prefix:""}},89331:function(e,t,n){n.d(t,{l:function(){return r},Y:function(){return o}});var r=[{text:"Account Type",value:""},{text:"Admin",value:"admin"},{text:"Customer",value:"customer"},{text:"Supplier",value:"supplier"},{text:"Tenant",value:"tenant"}],o=function(e){return[{icon:"edit",tooltip:"Edit",to:"/dashboard/".concat(e.type,"s/").concat("supplier"===e.type?"edit":"manage","?id=").concat(e.id)}]}},75838:function(e,t,n){n.d(t,{bg:function(){return r},WG:function(){return o}});var r=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}],o=[{text:"Status",value:""},{text:"Open",value:"open"},{text:"Resolved",value:"resolved"},{text:"Closed",value:"closed"}]},98315:function(e,t,n){n.d(t,{I:function(){return r}});var r=[{text:"Select Role",value:""},{text:"Owner",value:"owner"},{text:"Manager",value:"manager"},{text:"User",value:"user"}]}}]);