"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9431],{36732:function(n,e,t){t.d(e,{FD:function(){return l},YW:function(){return m},kU:function(){return y},tC:function(){return p},dG:function(){return g},Au:function(){return b}});var r,i,o,a,c,s,u=t(52209),d=t(54397),l=(0,d.Ps)(r||(r=(0,u.Z)(["\n  mutation AddComplianceEntity($objects: [Compliance_Entity_insert_input!]!) {\n    insert_Compliance_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),m=(0,d.Ps)(i||(i=(0,u.Z)(["\n  mutation UpdateComplianceEntity($id: Int!, $changes: Compliance_Entity_set_input) {\n    update_Compliance_Entity_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),y=(0,d.Ps)(o||(o=(0,u.Z)(['\n  query GetCompliancesForSelect($adminId: Int!, $type: String) {\n    compliances: Compliance(where: { adminId: { _eq: $adminId }, type: { _eq: $type } }) {\n      value: id\n      label: name\n      url\n      governingBody\n      regNumExample\n      expectCertificate\n      hasInsuranceAmount\n      type\n      questions: Taxonomies(where: { entity: { _eq: "Compliance" } }) {\n        id\n        name\n        meta\n      }\n      category: Category {\n        id\n        name\n      }\n    }\n  }\n']))),p=(0,d.Ps)(a||(a=(0,u.Z)(["\n  mutation DeleteComplianceEntity($id: Int!) {\n    delete_Compliance_Entity_by_pk(id: $id) {\n      id\n    }\n  }\n"]))),g=(0,d.Ps)(c||(c=(0,u.Z)(['\n  query getComplianceTiles(\n    $customerId: Int\n    $locationId: Int\n    $nowNew: timestamptz\n    $now: date\n    $nextMonth: date\n    $nextWeek: timestamptz\n  ) {\n    overdue: Compliance_Entity_aggregate(\n      where: {\n        expiryAt: { _lt: $now }\n        entity: { _eq: "Location" }\n        entityId: { _eq: $locationId }\n        Location: { Account_Locations: { accountId: { _eq: $customerId } } }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n    upComing: Compliance_Entity_aggregate(\n      where: {\n        _and: [{ expiryAt: { _gt: $now } }, { expiryAt: { _lt: $nextMonth } }]\n        entity: { _eq: "Location" }\n        entityId: { _eq: $locationId }\n        Location: { Account_Locations: { accountId: { _eq: $customerId } } }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n\n    jobs: Compliance_Entity(\n      where: {\n        entity: { _eq: "Job" }\n        Job: { locationId: { _eq: $locationId }, customerId: { _eq: $customerId } }\n      }\n      order_by: { Job: { timingStart: asc } }\n    ) {\n      entityId\n      job: Job {\n        amount\n        supplierId\n        scheduledAt\n        timingStart\n      }\n    }\n    openCPPM: Compliance_Entity_aggregate(\n      where: {\n        entity: { _eq: "Job" }\n        Job: {\n          locationId: { _eq: $locationId }\n          customerId: { _eq: $customerId }\n          status: { _neq: "closed" }\n        }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n    openCPPMToday: Compliance_Entity_aggregate(\n      where: {\n        entity: { _eq: "Job" }\n        Job: {\n          locationId: { _eq: $locationId }\n          customerId: { _eq: $customerId }\n          status: { _neq: "closed" }\n          _and: { timingStart: { _gte: $nowNew, _lte: $nowNew } }\n        }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n    openCPPMNextWeek: Compliance_Entity_aggregate(\n      where: {\n        entity: { _eq: "Job" }\n        Job: {\n          locationId: { _eq: $locationId }\n          customerId: { _eq: $customerId }\n          status: { _neq: "closed" }\n          _and: { timingStart: { _gte: $nowNew, _lte: $nextWeek } }\n        }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n    CPPMDocOutstanding: Compliance_Entity_aggregate(\n      where: {\n        entity: { _eq: "Job" }\n        Job: {\n          locationId: { _eq: $locationId }\n          customerId: { _eq: $customerId }\n          JobTimings: { status: { _in: ["complianceRequestedDocumentation"] } }\n        }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n    unsatisfactoryCPPM: Compliance_Entity_aggregate(\n      where: {\n        entity: { _eq: "Job" }\n        Job: {\n          locationId: { _eq: $locationId }\n          customerId: { _eq: $customerId }\n          JobTimings: { status: { _in: ["complianceRejected"] } }\n        }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n\n    waitingCustomerSingOff: Compliance_Entity_aggregate(\n      where: {\n        entity: { _eq: "Job" }\n        Media: { entity: { _eq: "Compliance_Entity" } }\n        Job: {\n          locationId: { _eq: $locationId }\n          customerId: { _eq: $customerId }\n          JobTimings: {\n            _and: [\n              { status: { _in: ["complianceRequestedDocumentation"] } }\n              { status: { _nin: ["complianceApproved", "complianceRejected"] } }\n            ]\n          }\n        }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n    CPPMSpendAmount: Job_aggregate(\n      where: {\n        Compliances: { entity: { _eq: "Job" } }\n        locationId: { _eq: $locationId }\n        customerId: { _eq: $customerId }\n      }\n    ) {\n      aggregate {\n        sum {\n          amount\n        }\n      }\n    }\n  }\n']))),b=(0,d.Ps)(s||(s=(0,u.Z)(['\n  query getCompliance_Entity($entity: String, $entityId: Int) {\n    compliances: Compliance_Entity(\n      where: { entity: { _eq: $entity }, entityId: { _eq: $entityId } }\n      order_by: { expiryAt: asc }\n    ) {\n      id\n      createdAt\n      entity\n      entityId\n      expiryAt\n      insuranceAmount\n      regNum\n      meta\n      compliance: Compliance {\n        id\n        type\n        name\n        status\n        hasInsuranceAmount\n        questions: Taxonomies(where: { entity: { _eq: "Compliance" } }) {\n          id\n          name\n          meta\n        }\n      }\n    }\n  }\n'])))},7304:function(n,e,t){t.d(e,{p:function(){return f}});var r=t(93633),i=t(36732),o=t(11640),a=t(63500),c=t(73303),s=t.n(c),u=t(7720),d=t(18862),l=t(80285),m=t(85893),y=new Date,p=(0,o.Z)(y,1),g=(0,a.Z)(y,1),b=(0,o.Z)(y,-12),f=function(n){var e,t=n.customerId,o=n.locationId,a=(0,r.a)(i.dG,{variables:{customerId:t,locationId:o,now:y,nowNew:y,nextMonth:p,nextWeek:g}}),c=a.loading,f=a.data,h=(f=void 0===f?{JobSchedule:[]}:f).CPPMDocOutstanding,v=f.CPPMSpendAmount,_=f.jobs,I=f.openCPPM,O=f.openCPPMNextWeek,j=f.openCPPMToday,x=f.overdue,$=f.unsatisfactoryCPPM,P=f.upComing,R=s()(null===_||void 0===_?void 0:_.filter((function(n){return new Date(n.job.timingStart)>b&&new Date(n.job.timingStart)<y})),(function(n){return Number(n.job.amount)})),w=null===_||void 0===_||null===(e=_.find((function(n){return new Date(null===n||void 0===n?void 0:n.job.timingStart)>y})))||void 0===e?void 0:e.job;return!c&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(u.Z,{content:(0,m.jsxs)(m.Fragment,{children:["Overdue: ",(0,m.jsx)("b",{children:null===x||void 0===x?void 0:x.aggregate.count})]}),context:"secondary",shape:"round",size:"sm"}),(0,m.jsx)(u.Z,{content:(0,m.jsxs)(m.Fragment,{children:["Upcoming: ",(0,m.jsx)("b",{children:null===P||void 0===P?void 0:P.aggregate.count})]}),context:"secondary",shape:"round",size:"sm"}),(0,m.jsx)(u.Z,{content:(0,m.jsxs)(m.Fragment,{children:["Unconfirmed: ",(0,m.jsx)("b",{children:_.filter((function(n){return!n.job.scheduledAt})).length})]}),context:"secondary",shape:"round",size:"sm"}),(0,m.jsx)(u.Z,{content:(0,m.jsxs)(m.Fragment,{children:["Next Visit: ",(0,m.jsx)("b",{children:w?(0,d.Z)(null===w||void 0===w?void 0:w.timingStart):"-"})]}),context:"secondary",shape:"round",size:"sm"}),(0,m.jsx)(u.Z,{content:(0,m.jsxs)(m.Fragment,{children:["Work Orders: ",(0,m.jsx)("b",{children:_.length})]}),context:"secondary",shape:"round",size:"sm"}),(0,m.jsx)(u.Z,{content:(0,m.jsxs)(m.Fragment,{children:["Compliance Spent (12M): ",(0,m.jsx)("b",{children:(0,l.Z)(R)})]}),context:"secondary",shape:"round",size:"sm"}),(0,m.jsx)(u.Z,{content:(0,m.jsxs)(m.Fragment,{children:["Open CPPMs: ",(0,m.jsx)("b",{children:null===I||void 0===I?void 0:I.aggregate.count})]}),context:"secondary",shape:"round",size:"sm"}),(0,m.jsx)(u.Z,{content:(0,m.jsxs)(m.Fragment,{children:["CPPMs due today: ",(0,m.jsx)("b",{children:null===j||void 0===j?void 0:j.aggregate.count})]}),context:"secondary",shape:"round",size:"sm"}),(0,m.jsx)(u.Z,{content:(0,m.jsxs)(m.Fragment,{children:["CPPMs due this week: ",(0,m.jsx)("b",{children:null===O||void 0===O?void 0:O.aggregate.count})]}),context:"secondary",shape:"round",size:"sm"}),(0,m.jsx)(u.Z,{content:(0,m.jsxs)(m.Fragment,{children:["CPPM Docs Outstanding: ",(0,m.jsx)("b",{children:null===h||void 0===h?void 0:h.aggregate.count})]}),context:"secondary",shape:"round",size:"sm"}),(0,m.jsx)(u.Z,{content:(0,m.jsxs)(m.Fragment,{children:["Unsatisfactory CPPM: ",(0,m.jsx)("b",{children:null===$||void 0===$?void 0:$.aggregate.count})]}),context:"secondary",shape:"round",size:"sm"}),(0,m.jsx)(u.Z,{content:(0,m.jsxs)(m.Fragment,{children:["CPPM Spend YDT: ",(0,m.jsx)("b",{children:(0,l.Z)(null===v||void 0===v?void 0:v.aggregate.sum.amount)})]}),context:"secondary",shape:"round",size:"sm"})]})}},37834:function(n,e,t){t.d(e,{r:function(){return i}});var r=t(94673),i=function(n){return(0,r.Z)(new Date(n),new Date)}},7917:function(n,e,t){t.d(e,{O:function(){return r}});var r=function(n){return n?new Date(n):new Date}},69399:function(n,e,t){t.d(e,{r:function(){return o}});var r=t(46482),i=t(85893),o=function(n){var e=n.errors,t=n.name,o=n.onChange,a=n.options,c=n.register;return(0,i.jsx)(r.Z,{errors:e,name:t,onChange:o,options:a,register:c})};o.defaultProps={name:"status"}},48213:function(n,e,t){t.d(e,{CV:function(){return d},iU:function(){return l},DT:function(){return m},JB:function(){return f},Bo:function(){return h},kW:function(){return v},FT:function(){return I}});var r=t(24237),i=t(18944),o=t(18862),a=t(7720),c=t(37834),s=t(7917),u=t(85893),d=function(n){var e=(0,s.O)(),t=n.filter((function(n){return(0,s.O)(n.expiryAt)>=e})).length;return parseInt(t/n.length*100)},l=function(n){if(!n||0===n.length)return null;var e=(0,s.O)(),t=n.filter((function(n){return(0,s.O)(n.expiryAt)>=e})).length;return parseInt(t/n.length*100)||null},m=function(n){var e=n.row.compliancesList;if(!e||0===e.length)return null;var t=d(e);return(0,u.jsxs)(g,{children:[(0,u.jsx)(p,{content:"".concat(e.length," : ").concat(t.toString(),"%"),context:v(t),size:"sm"}),y(e)]})},y=function(n){var e=n.find((function(n){(0,c.r)(n.expiryAt);return n}));return e&&(0,u.jsxs)(b,{children:[(0,u.jsx)(i.Z,{content:(0,o.Z)(e.expiryAt),context:_(e.expiryAt),size:"sm"}),(0,u.jsx)(i.Z,{content:e.compliance.name,size:"sm"})]})},p=(0,r.ZP)(a.Z).withConfig({displayName:"helper__StyledBadge",componentId:"sc-1rrgcna-0"})(["margin:0;"]),g=r.ZP.div.withConfig({displayName:"helper__Wrapper",componentId:"sc-1rrgcna-1"})(["align-items:center;display:flex;"]),b=r.ZP.div.withConfig({displayName:"helper__Next",componentId:"sc-1rrgcna-2"})(["flex-direction:column;margin-left:1rem;"]),f=function(n){return n.filter((function(n){return(0,c.r)(n.expiryAt)<0})).length},h=function(n){var e;if(!n||0===n.length||!n.nodes||n.nodes&&0===(null===(e=n.nodes)||void 0===e?void 0:e.length))return{content:"No locations",context:"secondary"};var t=[];(n.nodes||n).forEach((function(n){var e,r;(null!==(e=n.location)&&void 0!==e&&e.compliance||n.compliances)&&t.push(d((null===(r=n.location)||void 0===r?void 0:r.compliance)||n.compliances))}));var r=Math.round(t.reduce((function(n,e){return isNaN(e)&&(e=0),n+e}),0)/t.length);return{content:"Score: ".concat(r||0," %"),context:v(r)}},v=function(n){return n>79?"success":n>49?"info":"danger"},_=function(n){var e=(0,c.r)(n);return e>14?"success":e>=0?"info":"danger"},I=function(n){var e=n.row;if(e.expiryAt)return(0,u.jsx)(i.Z,{content:(0,o.Z)(e.expiryAt),context:_(e.expiryAt),size:"sm"})}},47400:function(n,e,t){t.d(e,{y:function(){return k}});var r,i,o=t(92809),a=t(67294),c=t(80880),s=t(91126),u=t(18862),d=t(58448),l=t(14347),m=t(80284),y=t(52002),p=t(30266),g=t(80318),b=t(64687),f=t.n(b),h=t(75709),v=t(52209),_=t(54397),I=(0,_.Ps)(r||(r=(0,v.Z)(["\n  mutation AddBankAccount($objects: [BankAccount_insert_input!]!) {\n    insert_BankAccount(objects: $objects) {\n      returning {\n        id\n        stripeId\n        accountNumber\n        routingNumber\n        bic\n        iban\n        status\n        createdAt\n      }\n    }\n  }\n"]))),O=(0,_.Ps)(i||(i=(0,v.Z)(["\n  mutation UpdateBankAccount($id: Int!, $changes: BankAccount_set_input) {\n    update_BankAccount_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),j=t(42283),x=t(79665),$=t(97202),P=t(65375),R=t(71247),w=t(84550),Z=t(19501),S=(0,Z.Ry)().shape({bank:(0,Z.Z_)().required(),accountNumber:(0,Z.Z_)().required(),bic:(0,Z.Z_)().required(),iban:(0,Z.Z_)().required(),routingNumber:(0,Z.Z_)().required()}),q=t(85893);function C(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function H(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?C(Object(t),!0).forEach((function(e){(0,o.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):C(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var A=function(n){var e=n.accountId,t=n.data,r=n.refetch,i=n.toggleShow,o=(0,j.cI)({defaultValues:t,resolver:(0,x.S)(S)}),a=o.errors,c=o.handleSubmit,s=o.register,u=(0,h.D)(I,{onCompleted:function(){r()}}),d=(0,g.Z)(u,1)[0],l=(0,h.D)(O,{onCompleted:function(){r()}}),m=(0,g.Z)(l,1)[0],y=function(){var n=(0,p.Z)(f().mark((function n(r){var o;return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((o=H({},r)).stripeId="ba_42g2s45sh46jl46h",o.accountId=e,o.status="active",o.countryId=1,o.currencyId=1,o.meta={showInInvoice:Boolean(o.showInInvoice)},delete o.showInInvoice,null===t||void 0===t||!t.id){n.next=12;break}m({variables:{id:t.id,changes:o}}),n.next=14;break;case 12:return n.next=14,d({variables:{objects:[o]}});case 14:i();case 15:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),b={errors:a,register:s};return(0,q.jsxs)($.Z,{id:"offCanvasForm",handleSubmit:c(y),children:[(0,q.jsx)(P.Z,{label:"Bank name",children:(0,q.jsx)(R.Z,H(H({},b),{},{name:"bank"}))}),(0,q.jsx)(P.Z,{label:"Account number",children:(0,q.jsx)(R.Z,H(H({},b),{},{name:"accountNumber"}))}),(0,q.jsx)(P.Z,{label:"Routing number",children:(0,q.jsx)(R.Z,H(H({},b),{},{name:"routingNumber"}))}),(0,q.jsx)(P.Z,{label:"BIC",children:(0,q.jsx)(R.Z,H(H({},b),{},{name:"bic"}))}),(0,q.jsx)(P.Z,{label:"IBAN",children:(0,q.jsx)(R.Z,H(H({},b),{},{name:"iban"}))}),(0,q.jsx)(w.Z,H(H({},b),{},{data:[{id:"1",label:"Show in invoice",value:"true"}],name:"showInInvoice"}))]})};function D(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function E(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?D(Object(t),!0).forEach((function(e){(0,o.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):D(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var k=function(n){var e=n.accountId,t=n.data,r=n.edit,i=n.refetch,o=(0,a.useContext)(c.Z),p=[{hidden:!0},{text:"Bank"},{text:"Account number"},{text:"Routing"},{text:"BIC"},{text:"IBAN"},{text:"Stripe ID",hidden:!0},{text:"Date Added"},{formatter:function(n){return!0===n.row.showInInvoice?"True":"False"},text:"Show In Invoice"},{formatter:s.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:function(n,e){return b(n,e)},tooltip:"Edit"}],text:"Actions"}],g=function(n){n.stopPropagation(),o.show({content:(0,q.jsx)(A,{accountId:e,refetch:i,toggleShow:o.close}),title:"Add Bank Account"})},b=function(n,t){n.stopPropagation(),o.show({content:(0,q.jsx)(A,{accountId:e,data:E({},t)||{},refetch:i,toggleShow:o.close}),title:"Add Bank Account"})},f=function(){return(0,q.jsx)(d.Z,{children:(0,q.jsx)(l.Z,{context:"secondary",content:"Add",onClick:g,size:"sm"})})};return(0,q.jsx)(m.Z,{open:!0,title:"Bank Accounts",toolbar:r&&(0,q.jsx)(f,{}),children:(0,q.jsx)(y.Z,{columns:p,rows:t.map((function(n){return function(n){var e,t;return{id:n.id,bank:null===n||void 0===n?void 0:n.bank,accountNumber:null===n||void 0===n?void 0:n.accountNumber,routingNumber:null===n||void 0===n?void 0:n.routingNumber,bic:null===n||void 0===n?void 0:n.bic,iban:null===n||void 0===n?void 0:n.iban,stripeId:n.stripeId,date:(0,u.Z)(n.createdAt),showInInvoice:!(null===(e=n.meta)||void 0===e||!e.showInInvoice)&&(null===(t=n.meta)||void 0===t?void 0:t.showInInvoice),actions:""}}(n)}))})})};k.defaultProps={data:[],edit:!0}},38094:function(n,e,t){t.d(e,{Dn:function(){return _},Vr:function(){return I},v8:function(){return O},tT:function(){return j},qD:function(){return x},zn:function(){return $},to:function(){return P},HR:function(){return R},DI:function(){return w}});var r,i,o,a,c,s,u,d,l,m,y,p,g,b,f,h=t(52209),v=t(54397),_=(0,v.Ps)(r||(r=(0,h.Z)(["\n  query GetFinance($accountId: Int!) {\n    financial: Account_by_pk(id: $accountId) {\n      name\n      website\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n          accounts: Account_Users {\n            id\n            role\n            position\n            isContact\n            status\n            account: Account {\n              id\n              name\n              type\n            }\n          }\n        }\n      }\n      bankAccounts: BankAccounts {\n        id\n        stripeId\n        bank\n        accountNumber\n        routingNumber\n        bic\n        iban\n        status\n        default\n        createdAt\n      }\n      cards: Cards {\n        id\n        stripeId\n        type\n        last4\n        expYear\n        expMonth\n        status\n        default\n        createdAt\n      }\n    }\n  }\n"]))),I=(0,v.Ps)(i||(i=(0,h.Z)(["\n  mutation AddPaymentReceipt($object: AccountEntry_insert_input!) {\n    insert_AccountEntry_one(object: $object) {\n      id\n    }\n  }\n"]))),O=((0,v.Ps)(o||(o=(0,h.Z)(["\n  mutation UpdateFinancial($id: Int!, $changes: Financial_set_input) {\n    update_Financial_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      approvalThreshold\n      arrangementFee\n      serviceRate\n      spendThreshold\n      stripeId\n    }\n  }\n"]))),(0,v.Ps)(a||(a=(0,h.Z)(["\n  mutation UpdateFinancial($id: Int!, $changes: Financial_set_input) {\n    update_Financial_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      creditLimit\n      creditRating\n    }\n  }\n"]))),(0,v.Ps)(c||(c=(0,h.Z)(["\n  query GetBalance($accountId: Int) {\n    lastEntry: AccountEntry(\n      where: { accountId: { _eq: $accountId } }\n      limit: 1\n      order_by: { createdAt: desc }\n    ) {\n      balance\n    }\n  }\n"]))),(0,v.Ps)(s||(s=(0,h.Z)(["\n  mutation UpdateFinancial($id: Int!, $changes: Financial_set_input) {\n    update_Financial_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      invoicing\n      defaultPaymentMethod\n    }\n  }\n"]))),(0,v.Ps)(u||(u=(0,h.Z)(["\n  query GetAccountEntries(\n    $accountId: Int!\n    $adminId: Int!\n    $from: timestamptz\n    $invoiceNumber: Int\n    $jobId: String\n    $limit: Int\n    $locationId: Int\n    $offset: Int\n    $outstandingLevel: Int\n    $to: timestamptz\n    $type: [String!]\n  ) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      args: {\n        accountId_param: $accountId\n        adminId: $adminId\n        endTime: $to\n        invoiceNumber_param: $invoiceNumber\n        jobNumber_param: $jobId\n        locationId_param: $locationId\n        outstanding_levels: $outstandingLevel\n        startTime: $from\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { createdAt: desc }\n      where: { paymentStatus: { _in: $type } }\n    ) {\n      id\n      outstandingAmount\n      type\n      entryId\n      entity\n      entityId\n      jobId\n      number: job_number\n      jobType: job_type\n      currencyId\n      createdAt\n      balance\n      debit\n      credit\n      accountId\n      updatedAt\n      status\n      meta\n      location\n      service\n      reference\n      invoice\n      paid\n      outstandingDays\n      paymentStatus\n      reconciledAmounts\n    }\n    meta: getDashboard_AccountEntry_calculatebalance_aggregate(\n      args: {\n        accountId_param: $accountId\n        adminId: $adminId\n        endTime: $to\n        invoiceNumber_param: $invoiceNumber\n        jobNumber_param: $jobId\n        locationId_param: $locationId\n        outstanding_levels: $outstandingLevel\n        startTime: $from\n      }\n      where: { paymentStatus: { _in: $type } }\n    ) {\n      aggregate {\n        debitTotal: sum {\n          debit\n        }\n        creditTotal: sum {\n          credit\n        }\n        reconciledAmounts: sum {\n          amount: reconciledAmounts\n        }\n        totalCount: count\n      }\n    }\n  }\n"]))),(0,v.Ps)(d||(d=(0,h.Z)(["\n  query GetAccountEntries(\n    $where: AccountEntry_bool_exp\n    $limit: Int\n    $offset: Int\n    $accountId: Int\n  ) {\n    accountEntries: AccountEntry(\n      limit: $limit\n      offset: $offset\n      order_by: { createdAt: desc }\n      where: $where\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      entryId\n      entity\n      entityId\n      jobId\n      currencyId\n      createdAt\n      balance\n      debit\n      credit\n      accountId\n      updatedAt\n      status\n      paymentStatus\n      meta\n      invoices: AccountEntry_Invoice {\n        invoiceId\n        Invoice {\n          Job {\n            id\n          }\n        }\n      }\n      invoice: Invoice {\n        id\n        items\n        status\n        createdAt\n        rebate\n        meta\n        totals\n        invoiceType\n        invoiceNumber\n        invoiceDate\n        expenses\n        entityId\n        entity\n        configs\n        amounts\n        addendum\n        addresses\n        adminId\n        reconciledAmounts: Reconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      job: Job {\n        id\n        paid\n        reference\n        type\n        meta\n        number\n        status\n        location: Location {\n          id\n          name\n        }\n        service: Service {\n          name\n          id\n        }\n      }\n    }\n\n    meta: AccountEntry_aggregate(where: $where) {\n      aggregate {\n        debitTotal: sum {\n          debit\n        }\n        creditTotal: sum {\n          credit\n        }\n        outstandingAmount: sum {\n          outstandingAmount\n        }\n        balance: sum {\n          balance\n        }\n        totalCount: count\n      }\n      nodes {\n        Invoice {\n          Reconciliations_aggregate {\n            aggregate {\n              sum {\n                amount\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n"])))),j=((0,v.Ps)(l||(l=(0,h.Z)(["\n  query GetJobMeta($id: Int!) {\n    job: Job(where: { id: { _eq: $id } }) {\n      id\n      meta\n    }\n  }\n"]))),(0,v.Ps)(m||(m=(0,h.Z)(["\n  mutation UpdateJob($changes: Job_set_input, $ids: [Int]) {\n    update_Job(where: { id: { _in: $ids } }, _set: $changes) {\n      affected_rows\n    }\n  }\n"])))),x=(0,v.Ps)(y||(y=(0,h.Z)(["\n  mutation UpdateJob(\n    $id: Int!\n    $changes: Job_set_input\n    $reconciliation: [Reconciliation_insert_input!]!\n    $timing: [JobTiming_insert_input!]!\n    $insertTiming: Boolean!\n  ) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    insert_JobTiming(objects: $timing) @include(if: $insertTiming) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n    insert_Reconciliation(objects: $reconciliation) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),$=(0,v.Ps)(p||(p=(0,h.Z)(['\n  mutation DeletePayment($jobIds: [Int!], $paymentId: Int!) {\n    update_Job(where: { id: { _in: $jobIds } }, _set: { status: "invoiceSent", paid: "false" }) {\n      returning {\n        id\n      }\n    }\n    delete_JobTiming(\n      where: { status: { _in: ["closed", "customerPaid"] }, jobId: { _in: $jobIds } }\n    ) {\n      returning {\n        id\n      }\n    }\n\n    delete_Reconciliation(\n      where: {\n        creditEntity: { _in: ["PaymentReceipt", "CreditNote"] }\n        creditEntityId: { _eq: $paymentId }\n      }\n    ) {\n      returning {\n        id\n      }\n    }\n\n    delete_AccountEntry(\n      where: { type: { _in: ["paymentReceipt", "creditNote"] }, id: { _eq: $paymentId } }\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n']))),P=(0,v.Ps)(g||(g=(0,h.Z)(['\n  query GetRelatedAccountEntries($invoiceIds: [Int!]!, $accountEntryId: Int!) {\n    reconciliations: Reconciliation(\n      where: {\n        creditEntityId: { _eq: $accountEntryId }\n        Invoice: { id: { _in: $invoiceIds } }\n        creditEntity: { _in: ["PaymentReceipt", "CreditNote"] }\n      }\n    ) {\n      id\n      amount\n      createdAt\n      amount\n      accountEntry: AccountEntry {\n        id\n        entity\n      }\n      invoice: Invoice {\n        id\n        job: Job {\n          id\n          number\n          type\n        }\n      }\n    }\n  }\n']))),R=(0,v.Ps)(b||(b=(0,h.Z)(['\n  query GetCalendarJobs($customerId: Int!) {\n    jobs: Job(\n      order_by: { timingStart: asc }\n      where: {\n        customerId: { _eq: $customerId }\n        jobScheduleId: { _is_null: false }\n        status: { _neq: "canceled" }\n      }\n    ) {\n      id\n      number\n      title\n      description\n      quoted\n      reference\n      timingStart\n      timingEnd\n      createdAt\n      status\n      jobScheduleId\n      supplierNotes\n      amount\n      supplierLabourAmount\n      rag\n      type\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n']))),w=(0,v.Ps)(f||(f=(0,h.Z)(["\n  mutation AddCreditNote($object: AccountEntry_insert_input!) {\n    insert_AccountEntry_one(object: $object) {\n      id\n    }\n  }\n"])))},35614:function(n,e,t){t.d(e,{n:function(){return D}});var r=t(80318),i=t(92809),o=t(67294),a=t(38460),c=t(85025),s=t(42283),u=t(79665),d=t(24237),l=t(97202),m=t(65375),y=t(46482),p=t(77417),g=t(14347),b=t(84550),f=t(93443),h=t(39759),v=t(71247),_=t(78215),I=t(2356),O=t(34868),j=t(55657),x=t(85893),$=[{label:"Normal (Hour)",name:"hourRate"},{label:"OOH (Hour)",name:"hourRateOOH"},{label:"Premium (Hour)",name:"hourRatePremium"},{icon:"clock",label:"Min Interval (Mins)",name:"minimumInterval"},{label:"Normal (Day)",name:"dayRate"},{label:"OOH (Day)",name:"dayRateOOH"},{label:"Premium (Day)",name:"dayRatePremium"},{icon:"clock",label:"Min Length (Mins)",name:"minimumLength"}],P=function(n){var e=n.errors,t=n.register;return(0,x.jsx)(_.Z,{children:$.map((function(n,r){var i=n.label,o=n.name,a=n.icon;return(0,x.jsx)(I.Z,{md:3,children:(0,x.jsx)(O.Z,{currencySymbol:a?(0,x.jsx)(j.Z,{icon:a}):"\xa3",errors:e,label:i,name:o,register:t,vat:a&&"clock"===a?"":"Ex VAT"})},"".concat(o,"-").concat(r))}))})},R=t(14439),w=[{label:"Normal (Hour)",name:"callOutHourRate"},{label:"OOH (Hour)",name:"callOutHourRateOOH"},{label:"Premium (Hour)",name:"callOutHourRatePremium"}],Z=function(n){var e=n.errors,t=n.register;return(0,x.jsx)(_.Z,{children:w.map((function(n,r){var i=n.label,o=n.name,a=n.icon;return(0,x.jsx)(I.Z,{md:4,children:(0,x.jsx)(O.Z,{currencySymbol:a?(0,x.jsx)(j.Z,{icon:a}):"\xa3",errors:e,label:i,name:o,register:t,vat:a&&"clock"===a?"":"Ex VAT"})},"".concat(o,"-").concat(r))}))})},S=t(95146),q=t(19501),C=t(75838);function H(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function A(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?H(Object(t),!0).forEach((function(e){(0,i.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):H(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var D=function(n){var e,t=n.defaultValues,i=(n.entity,n.hasCustomRates),d=n.onSubmit,_=n.type,I=(0,s.cI)({defaultValues:A(A({},t),{},{hasCallOutRate:(null===t||void 0===t?void 0:t.callOutHourRate)&&"true"}),resolver:(0,u.S)((0,q.Ry)().shape({service:(0,q.Ry)().required(),notes:(0,q.Z_)(),hourRate:(0,q.Rx)().required(),hourRateOOH:(0,q.Rx)().required(),hourRatePremium:(0,q.Rx)().required(),minimumInterval:(0,q.Rx)().required(),dayRate:(0,q.Rx)().required(),dayRateOOH:(0,q.Rx)().required(),dayRatePremium:(0,q.Rx)().required(),minimumLength:(0,q.Rx)().required(),status:(0,q.Z_)().oneOf(["active","inactive"]).required(),callOutHourRate:(0,q.Rx)().when("hasCallOutRate",{is:"true",then:(0,q.Rx)().required()}),callOutHourRateOOH:(0,q.Rx)().when("hasCallOutRate",{is:"true",then:(0,q.Rx)().required()}),callOutHourRatePremium:(0,q.Rx)().when("hasCallOutRate",{is:"true",then:(0,q.Rx)().required()})}))}),O=I.control,j=I.errors,$=I.handleSubmit,w=I.register,H=I.setValue,D=I.watch,k=(null===(e=t.service)||void 0===e?void 0:e.value)||t.serviceId,N=D("service"),F=!!k;(0,o.useEffect)((function(){!F&&L()}),[k]);var T=D("hasCallOutRate",(null===t||void 0===t?void 0:t.callOutHourRate)&&"true"),J=(0,a.t)(c.D,{variables:{id:(null===N||void 0===N?void 0:N.value)||k},onCompleted:function(n){var e=n.service;"customer"===_?(t.dayRate=e.customerDayRate,t.dayRateOOH=e.customerDayRateOOH,t.dayRatePremium=e.customerDayRatePremium,t.hourRate=e.customerHourRate,t.hourRateOOH=e.customerHourRateOOH,t.hourRatePremium=e.customerHourRatePremium,t.minimumInterval=e.minimumInterval,t.minimumLength=e.minimumLength,t.callOutHourRate=e.callOutHourRate,t.callOutHourRateOOH=e.callOutHourRateOOH,t.callOutHourRatePremium=e.callOutHourRatePremium):"supplier"===_?(t.dayRate=e.supplierDayRate,t.dayRateOOH=e.supplierDayRateOOH,t.dayRatePremium=e.supplierDayRatePremium,t.hourRate=e.supplierHourRate,t.hourRateOOH=e.supplierHourRateOOH,t.hourRatePremium=e.supplierHourRatePremium,t.minimumInterval=e.minimumInterval,t.minimumLength=e.minimumLength):"location"===_&&(t.dayRate=e.customerDayRate,t.dayRateOOH=e.customerDayRateOOH,t.dayRatePremium=e.customerDayRatePremium,t.hourRate=e.customerHourRate,t.hourRateOOH=e.customerHourRateOOH,t.hourRatePremium=e.customerHourRatePremium,t.minimumInterval=e.minimumInterval,t.minimumLength=e.minimumLength),Object.keys(t).forEach((function(n){return H(n,t[n])}))}}),L=(0,r.Z)(J,1)[0],B={control:O,errors:j,register:w},M=function(){L()};return(0,x.jsxs)(l.Z,{id:"offCanvasForm",handleSubmit:$(d),children:[(0,x.jsx)(S.P,A(A({},B),{},{errors:A({},j),label:"Service",name:"service",type:"service",isDisabled:F})),(0,x.jsx)(m.Z,{label:"Status",children:(0,x.jsx)(y.Z,A(A({},B),{},{name:"status",options:C.bg}))}),(0,x.jsx)(P,A({},B)),i&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(p.Z,{content:"Supplier rates"}),(0,x.jsx)(R.S,A({},B)),(0,x.jsx)(Z,A({},B))]}),(null===t||void 0===t?void 0:t.id)&&!T&&(0,x.jsx)(E,{children:(0,x.jsx)(g.Z,{context:"secondary",content:"System Rates",onClick:M,size:"sm"})}),(0,x.jsx)(b.Z,A(A({},B),{},{name:"hasCallOutRate",data:[{label:(0,x.jsxs)(x.Fragment,{children:["Call out charge ",(0,x.jsx)("br",{}),"Uses different first hour rate"]}),id:"siteVisitReq",value:!0}]})),T&&(0,x.jsx)(Z,A({},B)),(null===t||void 0===t?void 0:t.id)&&T&&(0,x.jsx)(E,{children:(0,x.jsx)(g.Z,{context:"secondary",content:"System Rates",onClick:M,size:"sm"})}),t.location&&t.location.addresses[0]&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(f.Z,{content:"Address"}),(0,x.jsx)(h.Z,{county:t.location.addresses[0].address.county,line1:t.location.addresses[0].address.addressLine1,line2:t.location.addresses[0].address.addressLine2,line3:t.location.addresses[0].address.addressLine3,postcode:t.location.addresses[0].address.postCode,town:t.location.addresses[0].address.city})]}),(null===t||void 0===t?void 0:t.id)&&(0,x.jsx)(v.Z,A(A({},B),{},{name:"id",type:"hidden"}))]})},E=d.ZP.div.withConfig({displayName:"form__StyledButtonRates",componentId:"sc-kacyle-0"})(["display:flex;justify-content:flex-end;"]);D.defaultProps={hasCustomRates:!1}},32763:function(n,e,t){t.d(e,{BY:function(){return u},tQ:function(){return d},WR:function(){return l},jW:function(){return m},dP:function(){return y}});var r=t(92809),i=t(83789),o=t(55657),a=t(85893);function c(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function s(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?c(Object(t),!0).forEach((function(e){(0,r.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var u=function(n){var e,t=n.service,r=t.customerHourRate,i=t.supplierHourRate,c=n.hourRate;return e="Supplier"===n.type?i:r,c===e?function(){return(0,a.jsx)(o.Z,{context:"success",icon:"check",size:"sm",title:"title"})}:function(){return(0,a.jsx)(o.Z,{context:c>e?"success":"danger",icon:c>e?"arrow-up":"arrow-down",size:"sm",title:"title"})}},d=function(n){var e=n.type,t=n.servicesSystem,r=[];return("customer"===e||"location"===e)&&t.map((function(n){return r.push({dayRate:n.customerDayRate,dayRateOOH:n.customerDayRateOOH,dayRatePremium:n.customerDayRatePremium,hourRate:n.customerHourRate,hourRateOOH:n.customerHourRateOOH,hourRatePremium:n.customerHourRatePremium,minimumInterval:n.minimumInterval,minimumLength:n.minimumLength,service:{id:n.id,name:n.name},serviceId:n.id,meta:null,notes:null,delivery:"-",status:n.status,type:"System"}),r})),r},l=function(n){var e=n.services,t=n.servicesCustomer,r=void 0===t?[]:t,o=n.allServicesSystem,a=n.type;return[].concat((0,i.Z)(m({services:e,type:a})),(0,i.Z)(m({services:r,type:"Customer"})),(0,i.Z)(m({services:o,type:"System"})))},m=function(n){var e=n.services,t=n.type;return null===e||void 0===e?void 0:e.map((function(n){return s(s({},n),{},{type:t})}))},y=function(n){var e=n.metaServices,t=n.metaServicesCustomer,r=n.metaServicesSystem,i=n.type,o=r.aggregate.totalCount||0,a=e.aggregate.totalCount||0,c=(null===t||void 0===t?void 0:t.aggregate.totalCount)||0;return"customer"===i||"location"===i?{aggregate:{totalCount:o+a+c}}:{aggregate:{totalCount:a}}}},90480:function(n,e,t){t.d(e,{Q5:function(){return y},oh:function(){return p},Dr:function(){return g},pP:function(){return b},kx:function(){return f}});var r,i,o,a,c,s,u,d,l=t(52209),m=t(54397),y=((0,m.Ps)(r||(r=(0,l.Z)(["\n  mutation InsertServiceEntity($objects: [Service_Entity_insert_input!]!) {\n    insert_Service_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),(0,m.Ps)(i||(i=(0,l.Z)(["\n  mutation InsertServiceEntity($objects: [Service_Entity_insert_input!]!) {\n    insert_Service_Entity(\n      objects: $objects\n      on_conflict: {\n        constraint: Service_Entity_entityId_serviceId_entity_key\n        update_columns: status\n      }\n    ) {\n      returning {\n        id\n        status\n      }\n    }\n  }\n"])))),p=(0,m.Ps)(o||(o=(0,l.Z)(["\n  mutation UpdateServiceEntity($id: Int!, $changes: Service_Entity_set_input) {\n    update_Service_Entity_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),g=(0,m.Ps)(a||(a=(0,l.Z)(['\n  mutation UpdateServiceEntity($ids: [Int!]) {\n    update_Service_Entity(where: { id: { _in: $ids } }, _set: { status: "inactive" }) {\n      returning {\n        id\n        status\n      }\n    }\n  }\n']))),b=((0,m.Ps)(c||(c=(0,l.Z)(["\n  mutation DeleteServiceEntity($ids: [Int!]) {\n    delete_Service_Entity(where: { id: { _in: $ids } }) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),(0,m.Ps)(s||(s=(0,l.Z)(['\n  query GetServiceEntities(\n    $entity: String\n    $entityId: Int\n    $entityIds: [Int!]\n    $countryId: Int\n    $customerId: Int\n    $hasCustomerId: Boolean!\n    $currencyId: Int\n    $limit: Int\n    $status: String\n    $offset: Int\n    $orderBy: Service_Entity_order_by!\n    $q: String\n  ) {\n    services: Service_Entity(\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        status: { _eq: $status }\n        Service: {\n          currencyId: { _eq: $currencyId }\n          countryId: { _eq: $countryId }\n          name: { _ilike: $q }\n          status: { _eq: $status }\n        }\n      }\n    ) {\n      service: Service {\n        id\n        name\n        customerHourRate\n        supplierHourRate\n      }\n      location: Location {\n        addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n          address: Address {\n            name\n            addressLine1\n            county\n            addressLine2\n            addressLine3\n            city\n            postCode\n          }\n        }\n      }\n      id\n      dayRate\n      dayRateOOH\n      dayRatePremium\n      hourRate\n      hourRateOOH\n      hourRatePremium\n      callOutHourRate\n      callOutHourRateOOH\n      callOutHourRatePremium\n      meta\n      minimumInterval\n      minimumLength\n      notes\n      delivery\n      createdAt\n      updatedAt\n      entity\n      entityId\n      serviceId\n      status\n    }\n    servicesCustomer: Service_Entity(\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n      where: {\n        entity: { _eq: "Account" }\n        entityId: { _eq: $customerId }\n        status: { _eq: $status }\n        Service: {\n          currencyId: { _eq: $currencyId }\n          countryId: { _eq: $countryId }\n          name: { _ilike: $q }\n          status: { _eq: $status }\n        }\n      }\n    ) @include(if: $hasCustomerId) {\n      service: Service {\n        id\n        name\n        customerHourRate\n      }\n      id\n      dayRate\n      dayRateOOH\n      dayRatePremium\n      hourRate\n      hourRateOOH\n      hourRatePremium\n      callOutHourRate\n      callOutHourRateOOH\n      callOutHourRatePremium\n      meta\n      minimumInterval\n      minimumLength\n      notes\n      delivery\n      createdAt\n      updatedAt\n      entity\n      entityId\n      serviceId\n      status\n    }\n    servicesSystem: Service(\n      limit: $limit\n      offset: $offset\n      where: {\n        countryId: { _eq: $countryId }\n        currencyId: { _eq: $currencyId }\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        _not: { Service_Entities: { entityId: { _in: $entityIds } } }\n      }\n      order_by: { name: asc }\n    ) {\n      id\n      name\n      customerDayRate\n      customerHourRate\n      supplierDayRate\n      supplierHourRate\n      status\n      createdAt\n      id\n      name\n      countryId\n      currencyId\n      customerDayRate\n      customerDayRateOOH\n      customerDayRatePremium\n      customerHourRate\n      customerHourRateOOH\n      customerHourRatePremium\n      supplierDayRate\n      supplierDayRateOOH\n      supplierDayRatePremium\n      supplierHourRate\n      supplierHourRateOOH\n      supplierHourRatePremium\n      minimumInterval\n      minimumLength\n    }\n    metaServices: Service_Entity_aggregate(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        status: { _eq: $status }\n        Service: {\n          currencyId: { _eq: $currencyId }\n          countryId: { _eq: $countryId }\n          name: { _ilike: $q }\n          status: { _eq: $status }\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n    metaServicesCustomer: Service_Entity_aggregate(\n      where: {\n        entity: { _eq: "Account" }\n        entityId: { _eq: $customerId }\n        status: { _eq: $status }\n        Service: {\n          currencyId: { _eq: $currencyId }\n          countryId: { _eq: $countryId }\n          name: { _ilike: $q }\n          status: { _eq: $status }\n        }\n      }\n    ) @include(if: $hasCustomerId) {\n      aggregate {\n        totalCount: count\n      }\n    }\n\n    metaServicesSystem: Service_aggregate(\n      where: {\n        countryId: { _eq: $countryId }\n        currencyId: { _eq: $currencyId }\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        _not: { Service_Entities: { entityId: { _in: $entityIds } } }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n'])))),f=((0,m.Ps)(u||(u=(0,l.Z)(["\n  query GetServiceEntity($id: Int!) {\n    service: Service_Entity_by_pk(id: $id) {\n      id\n      dayRate\n      dayRateOOH\n      dayRatePremium\n      hourRate\n      hourRateOOH\n      hourRatePremium\n      meta\n      minimumInterval\n      minimumLength\n      callOutHourRate\n      callOutHourRateOOH\n      callOutHourRatePremium\n      notes\n      delivery\n      createdAt\n      updatedAt\n      entity\n      entityId\n      serviceId\n    }\n  }\n"]))),(0,m.Ps)(d||(d=(0,l.Z)(["\n  query GetServicesForSelect($q: String) {\n    services: Service(where: { name: { _ilike: $q } }, order_by: { name: asc }) {\n      name\n      id\n      supplierDayRate\n      supplierDayRateOOH\n      supplierDayRatePremium\n      supplierHourRate\n      supplierHourRateOOH\n      supplierHourRatePremium\n      minimumInterval\n      minimumLength\n    }\n  }\n"]))))},64111:function(n,e,t){t.d(e,{E:function(){return z}});var r,i,o,a=t(92809),c=t(30266),s=t(80318),u=t(64687),d=t.n(u),l=t(67294),m=t(93633),y=t(75709),p=t(52209),g=t(54397),b=(0,g.Ps)(r||(r=(0,p.Z)(["\n  query GetNote($entityId: Int!) {\n    note: Note(where: { entityId: { _eq: $entityId } }, order_by: { createdAt: desc }) {\n      accountId\n      comments\n      createdAt\n      id\n      userId\n      user: User {\n        nameFirst\n        nameLast\n      }\n    }\n  }\n"]))),f=(0,g.Ps)(i||(i=(0,p.Z)(["\n  mutation AddNote(\n    $accountId: Int\n    $comments: String\n    $entity: String\n    $entityId: Int\n    $userId: Int\n  ) {\n    insert_Note(\n      objects: {\n        accountId: $accountId\n        comments: $comments\n        entity: $entity\n        entityId: $entityId\n        userId: $userId\n      }\n    ) {\n      returning {\n        id\n        comments\n      }\n    }\n  }\n"]))),h=(0,g.Ps)(o||(o=(0,p.Z)(["\n  mutation UpdateNote($id: Int!, $change: Note_set_input) {\n    update_Note_by_pk(pk_columns: { id: $id }, _set: $change) {\n      id\n      comments\n    }\n  }\n"]))),v=t(80880),_=t(58448),I=t(14347),O=t(80284),j=t(93443),x=t(42283),$=t(79665),P=t(97202),R=t(78215),w=t(2356),Z=t(65375),S=t(83528),q=t(71247),C=t(19501),H=(0,C.Ry)().shape({comments:(0,C.Z_)().required()}),A=t(85893);function D(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function E(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?D(Object(t),!0).forEach((function(e){(0,a.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):D(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var k=function(n){var e=n.defaultValues,t=n.onSubmit,r=(0,x.cI)({defaultValues:E({},e),resolver:(0,$.S)(H)}),i=r.control,o=r.errors,a=r.handleSubmit,c={control:i,errors:o,register:r.register};return(0,A.jsxs)(P.Z,{id:"offCanvasForm",handleSubmit:a(t),children:[(0,A.jsx)(R.Z,{children:(0,A.jsx)(w.Z,{md:12,children:(0,A.jsx)(Z.Z,{label:"Title",children:(0,A.jsx)(S.Z,E(E({},c),{},{name:"comments",rows:4}))})})}),e.id&&(0,A.jsx)(q.Z,E(E({},c),{},{name:"id",type:"hidden"}))]})},N=t(91126),F=t(18862),T=t(22796),J=t(52002),L=function(n){var e=n.note,t=n.loading,r=n.handleClick,i=n.userId,o=[{hidden:!0},{hidden:!0},{text:"Title"},{text:"By"},{text:"Created"},{formatter:N.Z,formatterData:function(n){return[{context:"secondary",disabled:i!==n.userId,icon:["fas","edit"],onClick:function(n,e){return r(n,e)},tooltip:"Edit"}]},text:"Actions"}];return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(T.Z,{marginBottom:"xs"}),(0,A.jsx)(J.Z,{columns:o,loading:t,rows:e.map((function(n){var e;return{id:n.id,userId:n.userId,comments:n.comments,user:"".concat(n.user.nameFirst," ").concat(null===(e=n.user)||void 0===e?void 0:e.nameLast),date:(0,F.Z)(n.createdAt),actions:""}}))})]})};L.defaultProps={note:[]};var B=t(1323);function M(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}var z=function(n){var e=n.entity,t=n.entityId,r=(n.open,n.title),i=n.single,o=(0,l.useContext)(v.Z),u=(0,B.x)().user,p=(0,m.a)(b,{variables:{entity:e,entityId:t}}),g=p.loading,x=p.data,$=(x=void 0===x?{note:[]}:x).note,P=p.refetch,R=(0,y.D)(f,{onCompleted:function(){o.close(),P()}}),w=(0,s.Z)(R,1)[0],Z=(0,y.D)(h,{onCompleted:function(){o.close(),P()}}),S=(0,s.Z)(Z,1)[0],q=function(){var n=(0,c.Z)(d().mark((function n(r){return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!r.id){n.next=5;break}return n.next=3,S({variables:{id:r.id,change:r}});case 3:n.next=11;break;case 5:return r.accountId=u.accountId,r.entity=e,r.entityId=t,r.userId=u.id,n.next=11,w({variables:r});case 11:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),C=function(n,e){n.preventDefault(),n.stopPropagation();var t=function(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?M(Object(t),!0).forEach((function(e){(0,a.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):M(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}({},e);o.show({content:(0,A.jsx)(k,{defaultValues:t,onCancel:H,onSubmit:q}),title:e?"Edit note":"Add note"})},H=function(){o.close()},D=function(){return(0,A.jsx)(_.Z,{children:i&&$.length?(0,A.jsx)(I.Z,{context:"secondary",content:"Edit",onClick:function(n){return C(n,$[0])},size:"sm"}):(0,A.jsx)(I.Z,{context:"secondary",content:"Add new",onClick:C,size:"sm"})})};return(0,A.jsxs)(O.Z,{fitParentHeight:!0,title:r,toolbar:(0,A.jsx)(D,{}),children:[i&&$.length>0&&(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(j.Z,{text:$[0].comments}),(0,A.jsx)(j.Z,{content:"By",text:"".concat($[0].user.nameFirst," ").concat($[0].user.nameLast)})]}),!i&&(0,A.jsx)(L,{entity:e,entityId:t,note:$,loading:g,refetch:P,handleClick:C,userId:u.id})]})};z.defaultProps={open:!0,single:!1,title:"Note"}},14439:function(n,e,t){t.d(e,{S:function(){return y}});var r=t(92809),i=t(78215),o=t(2356),a=t(34868),c=t(55657),s=t(85893);function u(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function d(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?u(Object(t),!0).forEach((function(e){(0,r.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):u(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var l=[{label:"Normal (Hour)",name:"supplierHourRate"},{label:"OOH (Hour)",name:"supplierHourRateOOH"},{label:"Premium (Hour)",name:"supplierHourRatePremium"}],m=[{label:"Normal (Day)",name:"supplierDayRate"},{label:"OOH (Day)",name:"supplierDayRateOOH"},{label:"Premium (Day)",name:"supplierDayRatePremium"}],y=function(n){n.editMode;var e={errors:n.errors,register:n.register};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{children:l.map((function(n,t){var r=n.icon,i=n.label,u=n.name;return(0,s.jsx)(o.Z,{md:4,children:(0,s.jsx)(a.Z,d(d({currencySymbol:r?(0,s.jsx)(c.Z,{icon:r}):"\xa3"},e),{},{label:i,name:u,vat:"Ex VAT"}))},"".concat(u,"-").concat(t))}))}),(0,s.jsx)(i.Z,{children:m.map((function(n,t){var r=n.icon,i=n.label,u=n.name;return(0,s.jsx)(o.Z,{md:4,children:(0,s.jsx)(a.Z,d(d({currencySymbol:r?(0,s.jsx)(c.Z,{icon:r}):"\xa3"},e),{},{label:i,name:u,vat:"Ex VAT"}))},"".concat(u,"-").concat(t))}))})]})}},85025:function(n,e,t){t.d(e,{D:function(){return o}});var r,i=t(52209),o=(0,t(54397).Ps)(r||(r=(0,i.Z)(['\n  query GetService($id: Int!) {\n    service: Service_by_pk(id: $id) {\n      id\n      name\n      countryId\n      currencyId\n      customerDayRate\n      customerDayRateOOH\n      customerDayRatePremium\n      customerHourRate\n      customerHourRateOOH\n      customerHourRatePremium\n      supplierDayRate\n      supplierDayRateOOH\n      supplierDayRatePremium\n      supplierHourRate\n      supplierHourRateOOH\n      supplierHourRatePremium\n      minimumInterval\n      minimumLength\n      status\n      callOutHourRate\n      callOutHourRateOOH\n      callOutHourRatePremium\n      accounts: Service_Entities(where: { entity: { _eq: "Account" } }) {\n        id\n        dayRate\n        hourRate\n        entity\n        entityId\n        account: Account {\n          id\n          type\n          name\n        }\n      }\n    }\n    taxonomy: Taxonomy(where: { status: { _eq: "active" }, type: { _eq: "jobTags" } }) {\n      id\n      name\n      status\n      meta\n    }\n  }\n'])))},70316:function(n,e,t){t.d(e,{J:function(){return w}});var r=t(92809),i=t(80318),o=t(10219),a=t(11163),c=t(67294),s=t(78215),u=t(2356),d=t(42283),l=t(97202),m=t(80284),y=t(65375),p=t(10973),g=t(14347),b=t(66805),f=t(69119),h=t(23855),v=t(83894);function _(n,e,t){var r=(0,c.useState)((function(){if(JSON.parse(window.sessionStorage.getItem(n))&&!Object.values(JSON.parse(window.sessionStorage[n])).includes(t))return e;try{var r=JSON.parse(window.sessionStorage.getItem(n));return r&&(r.startDate=r.startDate?(0,f.Z)((0,h.Z)(r.startDate)):null,r.endDate=r.endDate?(0,v.Z)((0,h.Z)(r.endDate)):null),r||e}catch(i){return console.log(i),e}})),i=r[0],o=r[1];return[i,function(e){try{var t=e instanceof Function?e(i):e;o(t),window.sessionStorage.setItem(n,JSON.stringify(t))}catch(r){console.log(r)}}]}var I=t(85893);function O(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function j(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?O(Object(t),!0).forEach((function(e){(0,r.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var x=function(n){var e=n.initialValues,t=n.renderFilters,r=n.setFilters,o=n.lastQuery,a=n.filters,f=e.filterType,h=_("form_data",e,f),v=(0,i.Z)(h,2),O=v[0],x=v[1],$=(0,d.cI)({defaultValues:O||e}),P=$.control,R=$.errors,w=$.handleSubmit,Z=$.register,S=$.reset,q=$.watch,C=$.setValue,H=j(j({},q()),{},{filterType:f});(0,c.useEffect)((function(){S(H)}),[S]),(0,c.useEffect)((function(){x(H)}),[a]);var A=function(n){var t=n.query;if(t!==o){var i={q:"%".concat(t,"%")||0},a=/^\d+$/.test(t);"id"in e&&(i.id=a?Number(t):null),"meta"in e&&(i.meta=a?{invoiceNumbers:[t]}:null),"jobNumber"in e&&(i.jobNumber=a?String(t):null,i.invoiceNumber=a?Number(t):null),(i.id||i.meta||i.jobNumber)&&(i.q=null),r((function(n){return j(j({},n),i)}))}};return(0,I.jsx)(l.Z,{handleSubmit:w(A),children:(0,I.jsxs)(m.Z,{title:"Filters",children:[(0,I.jsxs)(s.Z,{children:[(0,I.jsx)(u.Z,{sm:12,lg:12,children:(0,I.jsx)(y.Z,{label:"",children:(0,I.jsx)(p.Z,{errors:R,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:Z,type:"search"})})}),(0,I.jsx)(u.Z,{sm:12,lg:12,children:t({control:P,errors:R,initialValues:e,register:Z,setFilters:r,watch:q,setValue:C,reset:S})})]}),(0,I.jsx)(b.H,{content:"Search",context:"secondary",handleClick:A,type:"submit",children:(0,I.jsx)(g.Z,{content:"Clear",context:"danger",onClick:function(n){Object.keys(e).map((function(n){return C(n,null)})),r(e),S(e),A("")},size:"sm"})})]})})},$=["FiltersComp","initialFilters","TableComp"];function P(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function R(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?P(Object(t),!0).forEach((function(e){(0,r.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):P(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var w=function(n){var e=n.FiltersComp,t=n.initialFilters,r=n.TableComp,d=(0,o.Z)(n,$),l=_("filters",t,t.filterType),m=(0,i.Z)(l,2),y=m[0],p=m[1],g=(0,c.useState)(y||t),b=g[0],f=g[1],h=(0,a.useRouter)().query.show;return(0,c.useEffect)((function(){p(b)}),[b]),(0,I.jsx)(s.Z,{children:(0,I.jsxs)(u.Z,{sm:12,lg:12,children:[(0,I.jsx)(x,{initialValues:t,renderFilters:function(n){return(0,I.jsx)(e,R(R(R({},n),d),{},{show:h}))},setFilters:f,filters:b}),(0,I.jsx)(r,R({filters:b,initialFilters:t},d))]})})}}}]);