"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6589,6881],{56881:function(e,n,t){t.d(n,{n:function(){return b}});var i=t(30266),r=t(64687),o=t.n(r),a=t(67294),s=t(26075),d=t(40682),c=t(80880),l=t(92700),u=t(75201),m=t(25610),p=t(78416),f=t(85893),b=function(e){var n=e.assetId,t=e.assetName,r=e.dateClick,b=e.initialView,v=e.locationId,g=e.userId,y=(0,a.useContext)(c.Z),h=(0,s.x)(),_=function(){var e=(0,i.Z)(o().mark((function e(t,i){var r,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.query({query:d.M8,variables:{assetId:n,endDate:t.end,startDate:t.start,userId:g}});case 2:r=e.sent,a=r.data,s=(a=void 0===a?{assetBookings:[]}:a).assetBookings,i(s.map((function(e){return{allDay:e.allDay,backgroundColor:e.color,className:"eventClass",end:e.bookingEnd,extendedProps:{assetId:e.asset.id,assetName:e.asset.name,description:e.description,id:e.id,invitees:e.invitees},start:e.bookingStart,title:e.title}})));case 7:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),x=function(){y.close()};return(0,f.jsx)(l.A,{dateClick:r&&function(e){y.show({content:(0,f.jsx)(m.D,{assetId:n,assetName:t,date:e.date,locationId:v,onSuccess:x}),title:"Make a Booking",width:"40%"})},events:_,eventClick:function(e){y.show({content:(0,f.jsx)(u.e,{assetId:n,data:(0,p.lq)(e.event),locationId:v}),submit:!1,title:"View Booking",width:"40%"})},eventContent:function(e){var t=e.event;return(0,f.jsxs)(f.Fragment,{children:[!n&&(0,f.jsxs)(f.Fragment,{children:[t.extendedProps.assetName,(0,f.jsx)("br",{})]}),t.title]})},initialView:b})};b.defaultProps={dateClick:!0,initialView:"listWeek"}},75201:function(e,n,t){t.d(n,{e:function(){return _}});var i=t(80318),r=t(67294),o=t(75709),a=t(40682),s=t(24237),d=t(80880),c=t(7720),l=t(78215),u=t(2356),m=t(93443),p=t(18862),f=t(64509),b=t(58448),v=t(14347),g=t(11417),y=t(25610),h=t(85893),_=function(e){var n,t=e.assetId,s=e.data,g=e.locationId,_=(0,r.useContext)(d.Z),j=(0,o.D)(a.W$,{onCompleted:function(){_.close()}}),$=(0,i.Z)(j,1)[0],I=function(){_.close(),_.close()};return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(l.Z,{children:[(0,h.jsx)(x,{tag:"h2",content:s.assetSelected.label}),(0,h.jsx)(u.Z,{md:12,children:(0,h.jsx)(m.Z,{content:"Title",text:s.title})}),(0,h.jsx)(u.Z,{md:6,children:(0,h.jsx)(m.Z,{content:"Start",text:"".concat((0,p.Z)(s.bookingStart)," - ").concat((0,f.Z)(s.bookingStart))})}),(0,h.jsx)(u.Z,{md:6,children:(0,h.jsx)(m.Z,{content:"End",text:"".concat((0,p.Z)(s.bookingEnd)," - ").concat((0,f.Z)(s.bookingEnd))})}),(0,h.jsx)(u.Z,{md:12,children:(0,h.jsx)(m.Z,{content:"Invitees",text:(n=s.invitees,n&&n.split(",").map((function(e){return(0,h.jsx)(c.Z,{content:e,context:"dark",size:"sm"})})))})}),(0,h.jsx)(u.Z,{md:12,children:(0,h.jsx)(m.Z,{content:"Description",text:s.description})})]}),(0,h.jsxs)(b.Z,{align:"flex-end",children:[(0,h.jsx)(v.Z,{content:"Cancel booking",context:"danger",onClick:function(){$({variables:{id:s.id,changes:{status:"canceled"}}})},size:"sm"}),(0,h.jsx)(v.Z,{content:"Edit booking",context:"secondary",onClick:function(){_.show({content:(0,h.jsx)(y.D,{assetId:t,data:s,locationId:g,onSuccess:I}),title:"Edit Booking",width:"40%"})},size:"sm"})]})]})},x=(0,s.ZP)(g.Z).withConfig({displayName:"details__StyledHeading",componentId:"sc-svygug-0"})(["padding-left:1rem;"])},25610:function(e,n,t){t.d(n,{D:function(){return Z}});var i=t(80318),r=t(92809),o=t(67294),a=t(38460),s=t(75709),d=t(40682),c=t(42283),l=t(79665),u=t(43566),m=t(18862),p=t(97202),f=t(78215),b=t(2356),v=t(93443),g=t(26398),y=t(65375),h=t(71247),_=t(83528),x=t(76800),j=t(95146),$=t(78416),I=t(19501),S=(0,I.Ry)().shape({title:(0,I.Z_)().required(),description:(0,I.Z_)(),bookingStart:(0,I.hT)().required(),bookingEnd:(0,I.hT)().required(),invitees:(0,I.Z_)()}),k=t(85893);function w(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function q(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?w(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Z=function(e){var n,t=e.assetId,r=e.assetName,I=e.data,w=e.date,Z=e.locationId,D=e.onSuccess,O=(0,o.useContext)(u.Z).user,A=(0,c.cI)({defaultValues:q(q({},I),{},{bookingStart:I.bookingStart?new Date(I.bookingStart):(0,$.ry)(w),bookingEnd:I.bookingEnd?new Date(I.bookingEnd):""}),resolver:(0,l.S)(S)}),P=A.control,T=A.errors,C=A.handleSubmit,N=A.register,E=A.watch,R=A.setValue,L=E("bookingStart"),M=(null===(n=E("assetSelected"))||void 0===n?void 0:n.value)||t,B=(0,a.t)(d.M8,{variables:{assetId:M,startDate:(0,m.Z)(new Date)}}),U=(0,i.Z)(B,2),F=U[0],J=U[1].data,z=(J=void 0===J?{assetBookings:[]}:J).assetBookings;(0,o.useEffect)((function(){F(),K()}),[M]);var H=(0,s.D)(d.ev,{onCompleted:function(e){D&&D()}}),V=(0,i.Z)(H,1)[0],W=(0,s.D)(d.W$,{onCompleted:function(e){D&&D()}}),G=(0,i.Z)(W,1)[0],K=function(){R("bookingStart",I.bookingStart?new Date(I.bookingStart):(0,$.ry)(w)),R("bookingEnd",I.bookingEnd?new Date(I.bookingEnd):"")},Y=function(e){var n=e.time,t=e.endTime,i=void 0!==t&&t,r=i?new Date(L):new Date,o=new Date(n),a=z.filter((function(e){return e.id!==I.id})),s=a.map((function(e){return new Date(e.bookingStart).getTime()})),d=a.map((function(e){return new Date(e.bookingEnd).getTime()}));return o.getTime()>r.getTime()&&(0,$.CP)({selectedDate:o,assetBookingDateStarts:s,assetBookingDateEnds:d,endTime:i,minDate:i&&new Date(L)})},X={control:P,isClearable:!1,errors:T,register:N};return(0,k.jsxs)(p.Z,{id:"offCanvasForm",handleSubmit:C((function(e){(0,$.iW)({assetId:t,form:e,user:O}),null!==I&&void 0!==I&&I.id?G({variables:{id:I.id,changes:e}}):V({variables:{objects:[e]}})})),children:[t?(0,k.jsx)(f.Z,{children:(0,k.jsx)(b.Z,{md:12,children:(0,k.jsx)(v.Z,{content:"Asset",text:(0,k.jsx)(g.Z,{border:!1,passHref:!0,to:"/dashboard/assets/view?id=".concat(t),children:r})})})}):(0,k.jsx)(f.Z,{children:(0,k.jsx)(b.Z,{md:12,children:(0,k.jsx)(j.P,q(q({},X),{},{label:"Asset",locationId:Z,name:"assetSelected",type:"assetBookable"}))})}),(0,k.jsx)(f.Z,{children:(0,k.jsx)(b.Z,{md:12,children:(0,k.jsx)(y.Z,{label:"Title",children:(0,k.jsx)(h.Z,q(q({},X),{},{name:"title",placeholder:"Booking Title"}))})})}),(0,k.jsx)(y.Z,{label:"Start time"}),(0,k.jsx)(x.M,q(q({},X),{},{onChange:function(e){R("bookingStart",new Date(e)),R("bookingEnd",null)},dateFormat:"d MMM yyyy HH:mm",filterTime:function(e){return Y({time:e})},name:"bookingStart",showTimeSelect:!0,todayButton:!1})),(0,k.jsx)(y.Z,{label:"End time"}),(0,k.jsx)(x.M,q(q({},X),{},{dateFormat:"d MMM yyyy HH:mm",filterTime:function(e){return Y({time:e,endTime:!0})},minDate:new Date(L),name:"bookingEnd",showTimeSelect:!0,todayButton:!1})),(0,k.jsx)(f.Z,{children:(0,k.jsx)(b.Z,{md:12,children:(0,k.jsx)(y.Z,{label:"Invitees",children:(0,k.jsx)(h.Z,q(q({},X),{},{multiple:!0,name:"invitees",type:"email",placeholder:"List of invitees separated by comma"}))})})}),(0,k.jsx)(f.Z,{children:(0,k.jsx)(b.Z,{md:12,children:(0,k.jsx)(y.Z,{label:"Description",children:(0,k.jsx)(_.Z,q(q({},X),{},{name:"description",placeholder:"Booking Description",rows:2}))})})})]})};Z.defaultProps={data:{},assetName:""}},78416:function(e,n,t){t.d(n,{ry:function(){return o},lq:function(){return a},iW:function(){return s},CP:function(){return d}});var i=t(85817),r=t(92311),o=function(e){var n=(0,i.Z)(e),t=(0,i.Z)(new Date),o=n||t+1;return(0,r.Z)(e||new Date,{hours:o,minutes:0,seconds:0})},a=function(e){var n,t,i,r,o;return{allDay:e.allDay,assetSelected:{label:null===(n=e.extendedProps)||void 0===n?void 0:n.assetName,value:null===(t=e.extendedProps)||void 0===t?void 0:t.assetId},bookingEnd:e.end,bookingStart:e.start,color:e.backgroundColor,description:null===(i=e.extendedProps)||void 0===i?void 0:i.description,id:null===(r=e.extendedProps)||void 0===r?void 0:r.id,invitees:null===(o=e.extendedProps)||void 0===o?void 0:o.invitees,title:e.title}},s=function(e){var n=e.assetId,t=e.form,i=e.user;t.assetId=n,t.userId=i.id,t.color="green",t.status="active",n||(t.assetId=t.assetSelected.value,delete t.assetSelected),delete t.timing},d=function(){var e="",n="";return function(t){var i=t.selectedDate,r=t.assetBookingDateStarts,o=t.assetBookingDateEnds,a=t.endTime,s=t.minDate,d=r.find((function(e){return e===i.getTime()}));d&&(e=d);var c=o.find((function(e){return e===i.getTime()}));return c&&(n=c),!(i.getTime()>=e&&i.getTime()<=n)&&!(i.getTime()>=e&&i.getTime()<=e)&&!(a&&s<e&&i.getTime()>=e)}}()},40682:function(e,n,t){t.d(n,{M8:function(){return d},ev:function(){return c},W$:function(){return l}});var i,r,o,a=t(52209),s=t(54397),d=(0,s.Ps)(i||(i=(0,a.Z)(['\n  query GetAssetBookings(\n    $assetId: Int\n    $startDate: timestamptz\n    $endDate: timestamptz\n    $userId: Int\n    $limit: Int\n    $offset: Int\n    $orderBy: [AssetBooking_order_by!]\n  ) {\n    assetBookings: AssetBooking(\n      where: {\n        assetId: { _eq: $assetId }\n        userId: { _eq: $userId }\n        status: { _eq: "active" }\n        _and: [{ bookingStart: { _gte: $startDate } }, { bookingStart: { _lte: $endDate } }]\n      }\n      limit: $limit\n      offset: $offset\n      order_by: $orderBy\n    ) {\n      allDay\n      bookingEnd\n      bookingStart\n      color\n      description\n      id\n      invitees\n      meta\n      title\n      asset: Asset {\n        id\n        name\n      }\n      user: User {\n        email\n        fullName\n      }\n    }\n    meta: AssetBooking_aggregate(\n      where: {\n        assetId: { _eq: $assetId }\n        userId: { _eq: $userId }\n        status: { _eq: "active" }\n        _and: [{ bookingStart: { _gte: $startDate } }, { bookingStart: { _lte: $endDate } }]\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),c=(0,s.Ps)(r||(r=(0,a.Z)(["\n  mutation AddAssetBooking($adminId: Int, $objects: [AssetBookingInput!]!) {\n    createAssetBookings(adminId: $adminId, bookings: $objects) {\n      data\n      success\n    }\n  }\n"]))),l=(0,s.Ps)(o||(o=(0,a.Z)(["\n  mutation UpdateAssetBooking($id: Int!, $changes: AssetBooking_set_input) {\n    update_AssetBooking_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"])))},15067:function(e,n,t){t.d(n,{K:function(){return I}});var i=t(67294),r=t(14347),o=t(80284),a=t(92809),s=t(93633),d=t(40682),c=t(80880),l=t(91126),u=t(18862),m=t(64509),p=t(58448),f=t(25610),b=t(75201),v=t(81185),g=t(49705),y=t(85893);function h(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function _(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?h(Object(t),!0).forEach((function(n){(0,a.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var x={item:"bookingStart",order:"asc"},j=function(e){var n=e.assetId,t=e.locationId,o=e.userId,a=(0,g.x)({filters:{},initialSort:x}),h=a.initialData,j=a.ref,$=(0,i.useContext)(c.Z),I=(0,s.a)(d.M8,{variables:_(_({},h),{},{assetId:n,userId:o})}),S=I.loading,k=I.data,w=(k=void 0===k?{asset:null}:k).assetBookings,q=k.meta,Z=I.refetch,D=function(){$.close()},O=[{hidden:!0},{text:"Asset",hidden:n},{text:"Title"},{text:"Start"},{text:"End"},{text:"Description"},{text:"Name"},{text:"All Day"},{formatter:l.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:function(e,i){return function(e,i){e.stopPropagation(),$.show({content:(0,y.jsx)(f.D,{assetId:n,data:i.data,locationId:t,onSuccess:D}),title:"Edit Booking",width:"40%"})}(e,i)},tooltip:"Edit"}],text:"Actions"}];return(0,y.jsxs)(y.Fragment,{children:[w&&(0,y.jsx)(v.t,{columns:O,initialSort:x,loading:S,meta:q,ref:j,refetch:Z,rowClick:function(e){$.show({content:(0,y.jsx)(b.e,{assetId:n,data:e.data,locationId:t}),submit:!1,title:"View Booking",width:"40%"})},rows:w.map((function(e){return{data:_(_({},e),{assetSelected:{label:e.asset.name,value:e.asset.id}}),asset:e.asset.name,title:e.title,bookingStart:"".concat((0,u.Z)(e.bookingStart)," - ").concat((0,m.Z)(e.bookingStart)),bookingEnd:"".concat((0,u.Z)(e.bookingEnd)," - ").concat((0,m.Z)(e.bookingEnd)),description:e.description,name:e.user.fullName,allDay:e.allDay,actions:""}}))}),(0,y.jsx)(p.Z,{align:"flex-end",children:(0,y.jsx)(r.Z,{content:"Make a booking",context:"secondary",onClick:function(){$.show({content:(0,y.jsx)(f.D,{assetId:n,locationId:t}),title:"Make a Booking",width:"40%"})},size:"sm"})})]})},$=t(56881),I=function(e){var n=e.assetId,t=e.locationId,a=(0,i.useState)(!0),s=a[0],d=a[1],c=function(){return(0,y.jsx)(r.Z,{context:"info",onClick:function(e){return function(e){e.stopPropagation(),d(!s)}(e)},size:"sm",startIcon:s?"table":"calendar-alt",startIconProps:{size:"lg"}})};return(0,y.jsx)(o.Z,{fitParentHeight:!0,open:!0,title:"Asset bookings",toolbar:(0,y.jsx)(c,{}),children:s?(0,y.jsx)($.n,{assetId:n,locationId:t}):(0,y.jsx)(j,{assetId:n,locationId:t})})}},76589:function(e,n,t){t.d(n,{K:function(){return Me},Z:function(){return Be}});var i,r,o,a=t(67294),s=t(93633),d=t(64930),c=t(52209),l=t(54397),u=(0,l.Ps)(i||(i=(0,c.Z)(["\n  query GetAssetMeterByAssetId($assetId: Int!) {\n    meters: AssetMeter(where: { assetId: { _eq: $assetId } }, order_by: { id: desc }) {\n      id\n      name\n      unit\n      frequency\n      rangeLower\n      rangeUpper\n      status\n      meta\n      logs: AssetLogs(limit: 50, order_by: { id: desc }) {\n        id\n        status\n        eventTime\n        type\n        value\n      }\n    }\n  }\n"]))),m=(0,l.Ps)(r||(r=(0,c.Z)(["\n  mutation AddAssetMeter($objects: [AssetMeter_insert_input!]!) {\n    insert_AssetMeter(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),p=(0,l.Ps)(o||(o=(0,c.Z)(["\n  mutation UpdateAssetMeter($id: Int!, $changes: AssetMeter_set_input) {\n    update_AssetMeter_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),f=t(11163),b=t(11570),v=t(22796),g=t(78215),y=t(2356),h=t(97414),_=t(78566),x=t.n(_),j=t(24237),$=t(14347),I=t(80284),S=t(85893),k=function(e){var n=e.assetId,t=(0,S.jsx)($.Z,{content:"Download",context:"secondary",onClick:function(){var e=document.querySelector("#barcode-".concat(n," > svg")).outerHTML,t=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download="".concat(n,".svg"),document.body.appendChild(r),r.click(),document.body.removeChild(r)},size:"sm"});return(0,S.jsx)(I.Z,{fitParentHeight:!0,title:"Barcode",toolbar:t,children:(0,S.jsx)(w,{id:"barcode-".concat(n),children:(0,S.jsx)(x(),{value:"".concat(n)})})})},w=j.ZP.div.withConfig({displayName:"barCode__StyledBarcodeContainer",componentId:"sc-juw8cc-0"})(["text-align:center;"]),q=t(15067),Z=t(48080),D=t(80880),O=t(91126),A=t(52002),P=t(8163),T=t(92809),C=t(80318),N=t(75709),E=t(42283),R=t(79665),L=t(47385),M=t(97202),B=t(65375),U=t(71247),F=t(19501),J=(0,F.Ry)().shape({name:(0,F.Z_)().required()});function z(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function H(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?z(Object(t),!0).forEach((function(n){(0,T.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):z(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var V=function(e){var n=e.defaultValues,t=e.onSuccess,i=(0,E.cI)({defaultValues:n,resolver:(0,R.S)(J)}),r=i.control,o=i.errors,s=i.handleSubmit,c=i.register,l=i.setValue,u=(0,i.watch)("customerSelected",null===n||void 0===n?void 0:n.customerSelected),m=(0,L.Z)(u);(0,a.useEffect)((function(){u!==m&&m&&l("locationSelected",null)}),[u]);var p=(0,N.D)(d.RL,{onCompleted:function(e){var n=e.insert_Asset.returning[0].id;t&&t(n)}}),f=(0,C.Z)(p,1)[0],b=(0,N.D)(d.Wx,{onCompleted:function(e){var n=e.update_Asset_by_pk.id;t&&t(n)}}),v=(0,C.Z)(b,1)[0],g={control:r,isClearable:!1,errors:o,register:c};return(0,S.jsx)(M.Z,{id:"offCanvasForm",handleSubmit:s((function(e){e.accountId=e.customerSelected.value,e.locationId=e.locationSelected.value,delete e.customerSelected,delete e.locationSelected,n.id?v({variables:{id:n.id,changes:e}}):f({variables:{objects:[e]}})})),children:(0,S.jsx)(B.Z,{label:"Name",children:(0,S.jsx)(U.Z,H(H({},g),{},{name:"name"}))})})},W=function(e){var n=e.refetch,t=(0,a.useContext)(D.Z),i=function(){n(),t.close()};return(0,S.jsx)($.Z,{content:"Add Downtime",context:"secondary",onClick:function(e,n){e.stopPropagation(),t.show({content:(0,S.jsx)(V,{defaultValues:n||{},onSuccess:i}),title:"Downtime log"})},size:"sm"})},G=function(e){e.assetId;var n=e.refetch,t=[{hidden:!0},{text:"Status"},{text:"User"},{text:"Start"},{text:"End"},{text:"Total"},{formatter:O.Z,formatterData:(0,P.t)("/dashboard/assets/view"),text:"Actions"}],i=[];return(0,S.jsx)(I.Z,{fitParentHeight:!0,title:"Downtime Logging",toolbar:(0,S.jsx)(W,{refetch:n}),children:(0,S.jsx)(A.Z,{columns:t,rows:i.map((function(e){return{id:e.id,status:e.status,user:e.user,start:e.start,end:e.end,total:e.total,actions:""}}))})})},K=t(83789),Y=t(30266),X=t(64687),Q=t.n(X),ee=t(99628),ne=t(33462),te=t(93443),ie=t(66805),re=t(72197);function oe(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function ae(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?oe(Object(t),!0).forEach((function(n){(0,T.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):oe(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var se=function(e){var n=e.item,t=e.onChange,i=(0,E.cI)(),r=i.control,o=i.errors,a=i.handleSubmit,s=i.register,d="taxonomyId_ShortDesc",c={control:r,errors:o,register:s};return(0,S.jsx)(M.Z,{id:"offCanvasForm",handleSubmit:a((function(e){t(n,e[d])})),children:(0,S.jsx)(re.l,ae(ae({},c),{},{label:"",name:d,type:"jobTags"}))})};se.defaultProps={};var de=function(e){var n,t=e.item,i=e.onChange,r=e.onRemove,o=e.meta,a=null===o||void 0===o||null===(n=o.jobTemplates)||void 0===n?void 0:n.find((function(e){return e.slaId===t.id})),d=(0,s.a)(ne.RE,{variables:{id:null===a||void 0===a?void 0:a.sjdId},skip:!a}),c=d.loading,l=d.data,u=(l=void 0===l?{taxonomy:[]}:l).taxonomy;if(c)return null;if(a){var m,p,f,b,v,g,y,h,_,x,j=[{content:"Name",text:null===u||void 0===u?void 0:u.name},{content:"Status",text:null===u||void 0===u?void 0:u.status},{content:"Title",text:(null===u||void 0===u||null===(m=u.meta)||void 0===m||null===(p=m.template)||void 0===p?void 0:p.title)||"-"},{content:"Description",text:(null===u||void 0===u||null===(f=u.meta)||void 0===f||null===(b=f.template)||void 0===b?void 0:b.description)||"-"},{content:"Cost Category",text:(null===u||void 0===u||null===(v=u.meta)||void 0===v||null===(g=v.template)||void 0===g||null===(y=g.costCategorySelected)||void 0===y?void 0:y.label)||"-"},{content:"Service",text:(null===u||void 0===u||null===(h=u.meta)||void 0===h||null===(_=h.template)||void 0===_||null===(x=_.serviceSelected)||void 0===x?void 0:x.label)||"-"}];return(0,S.jsxs)(S.Fragment,{children:[j.map((function(e){return(0,S.jsx)(te.Z,{content:e.content,text:e.text},e.content)})),(0,S.jsx)(ie.H,{content:"Remove",context:"danger",disabled:c,handleClick:function(){return r(t)}})]})}return(0,S.jsx)(se,{item:t,onChange:i})};function ce(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function le(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ce(Object(t),!0).forEach((function(n){(0,T.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ce(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}de.defaultProps={};var ue=function(e){var n=e.asset,t=e.jobTemplates,i=e.refetch,r=(0,a.useContext)(D.Z),o=(0,s.a)(ee.uY,{variables:{entity:"Location",entityId:n.location.id,fetchParent:!1}}),c=o.data,l=(c=void 0===c?{slas:[]}:c).slas,u=o.loading,m=(0,N.D)(d.Wx),p=(0,C.Z)(m,1)[0],f=function(){var e=(0,Y.Z)(Q().mark((function e(o,a){var s;return Q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={meta:le(le({},null===n||void 0===n?void 0:n.meta),{},{jobTemplates:[].concat((0,K.Z)(t),[{sla:o.sla,slaId:o.id,sjd:a.label,sjdId:a.value}])})},e.next=3,p({variables:{id:n.id,changes:s}});case 3:return e.next=5,i();case 5:r.close(),r.close();case 7:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),b=function(){var e=(0,Y.Z)(Q().mark((function e(o){var a;return Q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.length){e.next=8;break}return a={meta:le(le({},null===n||void 0===n?void 0:n.meta),{},{jobTemplates:t.filter((function(e){return e.slaId!==o.id}))})},e.next=4,p({variables:{id:n.id,changes:a}});case 4:return e.next=6,i();case 6:r.close(),r.close();case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),v=[{context:"primary",icon:["fas","info-circle"],onClick:function(e,t){return function(e){r.show({content:(0,S.jsx)(de,{item:e,onChange:f,onRemove:b,meta:n.meta}),submit:"-"===e.jobTemplate,title:"".concat(null===e||void 0===e?void 0:e.sla," Job Template")})}(t)},tooltip:"Details"}],g=[{hidden:!0},{text:"SLA"},{text:"Job Template"},{formatter:O.Z,formatterData:v,text:"Actions"}];return(0,S.jsx)(A.Z,{columns:g,loading:u,rows:l.map((function(e){return function(e){var n=null===t||void 0===t?void 0:t.find((function(n){return n.slaId===e.id})),i="-";return n&&(i=n.sjd||n.sjdId),{id:e.id,sla:null===e||void 0===e?void 0:e.name,jobTemplate:i,actions:""}}(e)}))})},me=function(e){var n=e.asset,t=e.jobTemplates,i=e.refetch,r=(0,a.useContext)(D.Z),o=(0,S.jsx)($.Z,{content:"Manage",context:"secondary",onClick:function(e){!function(e){e.stopPropagation(),r.show({content:(0,S.jsx)(ue,{asset:n,jobTemplates:t,refetch:i}),submit:!1,title:"Job Templates"})}(e)},size:"sm"});return(0,S.jsx)(I.Z,{fitParentHeight:!0,open:!0,title:"Job Template",toolbar:o,children:(0,S.jsx)(A.Z,{columns:[{hidden:!0},{text:"SLA"},{text:"Job Template"}],rows:t.map((function(e){return function(e){return{id:e.id,sla:null===e||void 0===e?void 0:e.sla,jobTemplate:null===e||void 0===e?void 0:e.sjd}}(e)}))})})};me.defaultProps={jobTemplates:[]};var pe=t(8046),fe=t(73165),be=t(46482),ve=t(18944),ge=[{text:"Frequency",value:""},{text:"1 Minutes",value:"1min"},{text:"5 Minutes",value:"5min"},{text:"10 Minutes",value:"10min"}],ye=[{text:"Unit",value:""},{text:"Centigrade",value:"centigrade"},{text:"Percent",value:"percent"},{text:"ppm",value:"ppm"},{text:"ppb",value:"ppb"},{text:"mBar",value:"mBar"},{text:"Becquerels per cubic metre(Bq/m3)",value:"bq/m3"},{text:"Motion Detected",value:"motionDetected"},{text:"Boolean (Yes/No)",value:"bool"}],he=t(75838),_e=(0,F.Ry)().shape({name:(0,F.Z_)().required(),rangeLower:(0,F.Rx)(),rangeUpper:(0,F.Rx)(),mmo:(0,F.Rx)(),mmv:(0,F.Rx)(),unit:(0,F.Z_)().oneOf(ye.map((function(e,n){return 0!==n?e.value:"-"}))),frequency:(0,F.Z_)().oneOf(["1min","5min","10min"]).required(),status:(0,F.Z_)().when("id",{is:function(e){return e},then:(0,F.Z_)().oneOf(["active","inactive"]).required()})});function xe(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function je(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?xe(Object(t),!0).forEach((function(n){(0,T.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):xe(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var $e,Ie=function(e){var n=e.assetId,t=e.defaultValues,i=e.onSuccess,r=e.sensorType,o=(0,E.cI)({defaultValues:t,resolver:(0,R.S)(_e)}),a=o.errors,s=o.handleSubmit,d=o.register,c=(0,N.D)(m,{onCompleted:function(e){i&&i()}}),l=(0,C.Z)(c,1)[0],u=(0,N.D)(p,{onCompleted:function(e){i&&i()}}),f=(0,C.Z)(u,1)[0],b={errors:a,register:d};return(0,S.jsxs)(M.Z,{id:"offCanvasForm",handleSubmit:s((function(e){e.assetId=n;var i=(null===t||void 0===t?void 0:t.meta)||{};i.mmo=e.mmo,i.mmv=e.mmv,e.meta=i,delete e.mmo,delete e.mmv,null!==t&&void 0!==t&&t.id?f({variables:{id:t.id,changes:e}}):(e.status="active",l({variables:{objects:[e]}}))})),children:[(0,S.jsx)(B.Z,{label:"Name",children:(0,S.jsx)(U.Z,je(je({},b),{},{name:"name"}))}),(0,S.jsx)(B.Z,{label:"Unit",children:(0,S.jsx)(be.Z,je(je({},b),{},{name:"unit",options:ye}))}),(0,S.jsx)(B.Z,{label:"Frequency",children:(0,S.jsx)(be.Z,je(je({},b),{},{name:"frequency",options:ge}))}),"thermo"===r&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(ve.Z,{content:"Trigger outside range"}),(0,S.jsxs)(g.Z,{children:[(0,S.jsx)(y.Z,{md:6,children:(0,S.jsx)(B.Z,{label:"Lower",children:(0,S.jsx)(U.Z,je(je({},b),{},{name:"rangeLower"}))})}),(0,S.jsx)(y.Z,{md:6,children:(0,S.jsx)(B.Z,{label:"Upper",children:(0,S.jsx)(U.Z,je(je({},b),{},{name:"rangeUpper"}))})})]})]}),"occupancy"===r&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(B.Z,{label:"Minimum minutes occupied",children:(0,S.jsx)(U.Z,je(je({},b),{},{helperMessage:"Before the asset is considered occupied",name:"mmo"}))}),(0,S.jsx)(B.Z,{label:"Minimum minutes vacated",children:(0,S.jsx)(U.Z,je(je({},b),{},{helperMessage:"After which cleaners are sent",name:"mmv"}))})]}),(null===t||void 0===t?void 0:t.id)&&(0,S.jsx)(B.Z,{label:"Status",children:(0,S.jsx)(be.Z,je(je({},b),{},{name:"status",options:he.bg}))})]})},Se=function(e){var n=e.assetId,t=e.refetch,i=e.sensorType,r=(0,a.useContext)(D.Z),o=function(){t(),r.close()};return(0,S.jsx)($.Z,{content:"Add Meter",context:"secondary",onClick:function(e){e.stopPropagation(),r.show({content:(0,S.jsx)(Ie,{assetId:n,onSuccess:o,sensorType:i}),title:"Add Meter"})},size:"sm"})},ke=function(e){var n,t=e.assetId,i=e.meters,r=e.refetch,o=e.sensorType,s=e.setMaterIndex,d=(0,a.useContext)(D.Z),c=function(){r(),d.close()},l=[{hidden:!0},{text:"Name"},{formatter:function(e){var n,t=e.row;return null===(n=ye.find((function(e){return e.value===t.unit})))||void 0===n?void 0:n.text},text:"Unit"},{formatter:function(e){var n,t=e.row;return null===(n=ge.find((function(e){return e.value===t.frequency})))||void 0===n?void 0:n.text},text:"Frequency"},{hidden:"thermo"!==o,text:"Range lower"},{hidden:"thermo"!==o,text:"Range upper"},{formatter:function(e){var n=e.row;return(0,fe.Z)(n.status)},text:"Status"},{hidden:"occupancy"!==o,text:"Minimum minutes occupied"},{hidden:"occupancy"!==o,text:"Minimum minutes vacated"},{hidden:!0},{formatter:O.Z,formatterData:(n={editClick:function(e,n){return function(e,n){e.stopPropagation(),d.show({content:(0,S.jsx)(Ie,{assetId:t,defaultValues:n,onSuccess:c,sensorType:o}),title:"Edit Meter"})}(e,n)},chartClick:function(e,n){return u(e,n)}},[{context:"secondary",icon:["fas","edit"],onClick:n.editClick,tooltip:"Edit"},{context:"secondary",icon:["fas","chart-bar"],onClick:n.chartClick,tooltip:"chart"}]),text:"Actions"}],u=function(e,n){e.stopPropagation();var t=i.findIndex((function(e){return e.id===n.id}));s(t)};return(0,S.jsx)(I.Z,{fitParentHeight:!0,title:"Meters",toolbar:(0,S.jsx)(Se,{assetId:t,refetch:r,sensorType:o}),children:(0,S.jsx)(A.Z,{columns:l,rows:i.map((function(e){var n,t;return{id:e.id,name:e.name,unit:e.unit,frequency:e.frequency,rangeLower:e.rangeLower,rangeUpper:e.rangeUpper,status:e.status,mmo:null===(n=e.meta)||void 0===n?void 0:n.mmo,mmv:null===(t=e.meta)||void 0===t?void 0:t.mmv,meta:e.meta,actions:""}}))})})},we=t(2640),qe=t(50899),Ze=t(79859),De=t(85088),Oe=(0,l.Ps)($e||($e=(0,c.Z)(["\n  subscription GetAssetLogByAssetMeterId($meterId: Int! = 1) {\n    logs: AssetLog(\n      limit: 1000\n      order_by: { id: desc }\n      where: { assetMeterId: { _eq: $meterId } }\n    ) {\n      id\n      status\n      eventTime\n      type\n      value\n      assetId\n      assetMeterId\n    }\n  }\n"]))),Ae=t(96887),Pe=t(78840),Te=t.n(Pe),Ce=t(75708),Ne=t.n(Ce),Ee=t(20305),Re=(0,a.forwardRef)((function(e,n){var i,r,o=e.meterId,a=e.nameMeter,s=(0,De.m)(Oe,{variables:{meterId:o}}),d=s.loading,c=s.data,l=(c=void 0===c?{logs:[]}:c).logs;return t(18393)(Te()),(0,S.jsx)(Le,{children:(0,S.jsx)(I.Z,{title:a,open:!0,fitParentHeight:!0,children:l.length>0&&!d?(0,S.jsx)(Ne(),{callback:function(e){e.reflow()},constructorType:"chart",Highcharts:Te(),options:(i=l,r=a,{chart:{type:"line",zoomType:"x"},title:{text:null},series:[{data:i.reverse().map((function(e){return{name:(0,Ee.Z)(e.eventTime),y:"motionDetected"===e.type?Number("true"===e.value?1:0):Number(e.value)||0}})),name:r,showInLegend:!1}],xAxis:{type:"category",title:{text:"Time"}},yAxis:{title:{text:"Value"}}}),ref:n}):(0,S.jsx)(Ae.Z,{show:d})})})})),Le=j.ZP.div.withConfig({displayName:"chart__StyledWrapper",componentId:"sc-1pxntme-0"})(["min-height:300px;position:relative;"]),Me=function(e){var n,t,i,r,o,c,l=e.assetId,m=(0,f.useRouter)().query,p=(0,a.useState)(-1),_=p[0],x=p[1],j=(0,s.a)(u,{variables:{assetId:l||m.id}}).data,$=(j=void 0===j?{meters:[]}:j).meters,I=(0,s.a)(d.yC,{variables:{id:l||m.id}}),w=I.loading,D=I.data,O=(D=void 0===D?{asset:{}}:D).asset,A=I.refetch,P=function(){var e,n=(null===(e=$[0])||void 0===e?void 0:e.logs)[0],t=$[0].rangeLower,i=$[0].rangeUpper;return(0,S.jsxs)(S.Fragment,{children:[n.value<t&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(b.Z,{content:"Sensor out of lower bounds",context:"warning"}),(0,S.jsx)(v.Z,{})]}),n.value>i&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(b.Z,{content:"Sensor out of upper bounds",context:"warning"}),(0,S.jsx)(v.Z,{})]})]})};return!w&&(null===O||void 0===O?void 0:O.id)&&m&&(0,S.jsxs)(g.Z,{children:[(0,S.jsxs)(y.Z,{md:3,children:[(0,S.jsx)(Z.B,{asset:O,meters:$,refetch:A}),"sensor"!==O.category.name&&(0,S.jsx)(qe.G,{details:!0,entity:"Asset",entityId:parseInt(m.id)}),"sensor"!==O.category&&(0,S.jsx)(me,{asset:O,jobTemplates:null===(n=O.meta)||void 0===n?void 0:n.jobTemplates,refetch:A})]}),(0,S.jsxs)(y.Z,{md:6,children:["sensor"===O.category.name&&(0,S.jsx)(P,{}),"yes"===O.bookable&&(0,S.jsx)(q.K,{assetId:O.id,assetName:O.name,locationId:O.location.Id}),(0,S.jsx)(we.F,{filters:{assetId:"sensor"===O.category.name?null===(t=O.parentId)||void 0===t?void 0:t.value:O.id,locationId:O.location.id},isJobsAsset:!0,workorderVisibility:!0}),(0,S.jsx)(ke,{assetId:O.id,meters:$,refetch:A,sensorType:O.sensorType,setMaterIndex:x}),(null===(i=$[_])||void 0===i?void 0:i.logs.length)>0&&(0,S.jsx)(Re,{meterId:null===(r=$[_])||void 0===r?void 0:r.id,nameMeter:null===(o=$[_])||void 0===o?void 0:o.name}),"sensor"!==O.category&&(0,S.jsx)(G,{assetId:O.id,refetch:A}),(null===O||void 0===O||null===(c=O.customFields)||void 0===c?void 0:c.acquisitionCost)&&(0,S.jsx)(Ze.$,{initialData:null===O||void 0===O?void 0:O.customFields})]}),(0,S.jsxs)(y.Z,{md:3,children:[!O.category.sublocation&&(0,S.jsx)(pe.f,{asset:O,refetch:A}),(0,S.jsx)(h.Z,{assetId:parseInt(m.id,10),path:"https://admin.cleverly.works/dashboard/assets/view?id=".concat(m.id)}),(0,S.jsx)(k,{assetId:O.id})]})]})},Be=Me},92700:function(e,n,t){t.d(n,{A:function(){return o}});var i=t(68794),r=t(85893),o=function(e){var n=e.dateClick,t=e.events,o=e.eventClick,a=e.eventContent,s=(e.hasLoading,e.height),d=e.initialView;return(0,r.jsx)(i.Z,{dateClick:n,eventClick:o,eventContent:a,events:t,hasLoading:!0,height:s,headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},initialView:d})};o.defaultProps={initialView:"listWeek",hasLoading:!0,height:550}},79859:function(e,n,t){t.d(n,{$:function(){return y}});var i=t(67294),r=t(30266),o=t(64687),a=t.n(o),s=t(5597),d=function(e){var n=[];return e.map(function(){var e=(0,r.Z)(a().mark((function e(t){var i,r,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=(0,s.Z)(new Date(t.scheduledAt?t.scheduledAt:t.timingStart),"yyyy dd MMM"),(null===(i=t.meta)||void 0===i?void 0:i.customerVATInvoice)&&n.push({name:o,y:null===(r=t.meta)||void 0===r?void 0:r.customerVATInvoice.expensesInfo.expensesTotal});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),n},c=t(11640),l=t(26496),u=function(e){var n=e.acquisitionCost,t=e.datePutInService,i=e.maintenanceSpend,r=e.residualValue,o=e.usefulLife,a=parseInt(i)/12,d=(0,s.Z)(new Date(t),"MMMM yyyy"),u=new Array(parseInt(o)+1).fill({});return u=u.map((function(e,i){return 0===i?{name:d,y:(0,l.l)(parseInt(n),2)}:i+1===parseInt(o)+1?{name:(0,s.Z)((0,c.Z)(new Date(t),i),"MMMM yyyy"),y:(0,l.l)(i*a+parseInt(n)-parseInt(r),2)}:{name:(0,s.Z)((0,c.Z)(new Date(t),i),"MMMM yyyy"),y:(0,l.l)(i*a+parseInt(n),2)}}))},m=t(80284),p=t(78840),f=t.n(p),b=t(75708),v=t.n(b),g=t(85893),y=(0,i.forwardRef)((function(e,n){var i,r,o=e.initialData,a=e.jobs,s=void 0===a?[]:a;return t(18393)(f()),(0,g.jsx)(m.Z,{fitParentHeight:!0,title:"Total cost of ownership",children:(0,g.jsx)(v(),{callback:function(e){e.reflow()},constructorType:"chart",Highcharts:f(),options:(i=u(o),r=d(s),{chart:{type:"line",zoomType:"x"},title:{text:"TCO"},series:[{data:i,showInLegend:!1},{data:Object.keys(r).map((function(e){return{name:e,y:r[e]}})),name:"Total Costs ",showInLegend:!1,type:"column",visible:!1}],xAxis:{type:"category",title:null},yAxis:{title:{text:"\xa3"}}}),ref:n})})}))},8163:function(e,n,t){t.d(n,{t:function(){return i}});var i=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return[{context:"secondary",icon:["fas","edit"],onClick:n.onEditClick,to:"".concat(e,"manage"),tooltip:"Edit"}]}},1071:function(e,n,t){t.d(n,{fI:function(){return k},lR:function(){return q},Uu:function(){return w}});var i,r,o,a,s,d=t(80318),c=t(92809),l=t(52209),u=t(54397),m=t(38478),p=t(76585),f=t(88402),b=t(27834),v=(0,u.Ps)(i||(i=(0,l.Z)(['\n  query GetJobs(\n    $endDate: timestamptz\n    $number: String\n    $limit: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $q: String\n    $startDate: timestamptz\n    $status: [String!]\n    $type: String\n    $userId: Int\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n          { _or: [{ number: { _eq: $number } }, { Invoices: { invoiceNumber: { _eq: $number } } }] }\n        ]\n        status: { _in: $status }\n        type: { _eq: $type }\n        supplierUserId: { _eq: $userId }\n      }\n      order_by: [$orderBy]\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n      }\n      ...JobFields\n      ...JobSupplierFields\n      admin: Admin {\n        id\n        name\n      }\n      location: Location {\n        id\n        name\n      }\n      invoices: Invoices {\n        invoiceNumber\n      }\n      service: Service {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      sla: SLA {\n        id\n        name\n      }\n      supplierOffers: SupplierOffers {\n        id\n        status\n        rate\n        dayRate\n        notes\n        account: Supplier {\n          id\n          type\n          name\n        }\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n          { _or: [{ number: { _eq: $number } }, { Invoices: { invoiceNumber: { _eq: $number } } }] }\n        ]\n        status: { _in: $status }\n        type: { _eq: $type }\n        supplierUserId: { _eq: $userId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n  ","\n  ","\n"])),m.aL,m.H_,b.Px),g=(0,u.Ps)(r||(r=(0,l.Z)(['\n  query GetJobs(\n    $endDate: timestamptz\n    $number: String\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Job_order_by!\n    $startDate: timestamptz\n    $status: [String!]\n    $type: [String!]\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n          { _or: [{ number: { _eq: $number } }, { Invoices: { invoiceNumber: { _eq: $number } } }] }\n        ]\n        status: { _in: $status }\n        type: { _in: $type }\n      }\n      order_by: [$orderBy]\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n      }\n      ...JobFields\n      ...JobSupplierFields\n      admin: Admin {\n        id\n        name\n      }\n      location: Location {\n        id\n        name\n      }\n      invoices: Invoices {\n        invoiceNumber\n      }\n      service: Service {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      sla: SLA {\n        id\n        name\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n          { _or: [{ number: { _eq: $number } }, { Invoices: { invoiceNumber: { _eq: $number } } }] }\n        ]\n        status: { _in: $status }\n        type: { _in: $type }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n  ","\n  ","\n"])),m.aL,m.H_,b.Px),y=(0,u.Ps)(o||(o=(0,l.Z)(['\n  query GetJobs(\n    $assetId: Int\n    $customerId: Int\n    $endDate: timestamptz\n    $number: String\n    $meta: jsonb\n    $limit: Int\n    $locationId: Int\n    $managerId: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $paid: Boolean\n    $type: [String!]\n    $q: String\n    $startDate: timestamptz\n    $status: [String!]\n    $supplierId: Int\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n          {\n            _or: [\n              { number: { _eq: $number } }\n              { meta: { _contains: $meta } }\n              { Invoices: { invoiceNumber: { _eq: $number } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        assetId: { _eq: $assetId }\n        status: { _in: $status }\n        type: { _in: $type }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        paid: { _eq: $paid }\n        supplierId: { _eq: $supplierId }\n      }\n      order_by: [$orderBy]\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n      }\n      ...JobFields\n      ...JobAdminFields\n      invoices: Invoices {\n        invoiceNumber\n      }\n      admin: Admin {\n        id\n        name\n      }\n      customer: Customer {\n        ...AccountFields\n      }\n      location: Location {\n        id\n        name\n      }\n      manager: Manager {\n        ...UserFields\n      }\n      service: Service {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      sla: SLA {\n        id\n        name\n      }\n      supplier: Supplier {\n        ...AccountFields\n      }\n      supplierOffers: SupplierOffers {\n        status\n        rate\n        supplier: Supplier {\n          ...AccountFields\n        }\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n          {\n            _or: [\n              { number: { _eq: $number } }\n              { meta: { _contains: $meta } }\n              { Invoices: { invoiceNumber: { _eq: $number } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        assetId: { _eq: $assetId }\n        status: { _in: $status }\n        type: { _in: $type }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        supplierId: { _eq: $supplierId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n  ","\n  ","\n  ","\n  ","\n"])),p.z,f.WW,m.aL,m.wd,b.Px),h=(0,u.Ps)(a||(a=(0,l.Z)(['\n  query GetDashboardList(\n    $accountId: Int\n    $customerId: Int\n    $supplierId: Int\n    $locationId: Int\n    $managerId: Int\n    $adminId: Int\n    $startDate: timestamptz\n    $endDate: timestamptz\n    $asAt: timestamptz\n    $jobHoldReasonId: Int\n    $limit: Int\n    $monthStart: timestamptz\n    $offset: Int\n    $orderBy: dashboard_home_details_order_by!\n    $q: String\n    $tileName: String\n    $dayStart: timestamptz\n    $userId: Int\n    $yearStart: timestamptz\n    $number: String\n    $status: [String!]\n    $type: String\n  ) {\n    jobs: getDashboard_HomeTile_Details(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        number: { _eq: $number }\n        status: { _in: $status }\n        type: { _eq: $type }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        supplierId: { _eq: $supplierId }\n      }\n      order_by: [$orderBy]\n      limit: $limit\n      offset: $offset\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n        __typename\n      }\n      ...JobFields\n      ...JobAdminFields\n      admin: Admin {\n        id\n        name\n        __typename\n      }\n      customer: Customer {\n        ...AccountFields\n        __typename\n      }\n      location: Location {\n        id\n        name\n        __typename\n      }\n      job: Job {\n        status\n      }\n      manager: Manager {\n        ...UserFields\n        __typename\n      }\n      service: Service {\n        id\n        name\n        __typename\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n          __typename\n        }\n        __typename\n      }\n      sla: SLA {\n        id\n        name\n        __typename\n      }\n      supplier: Supplier {\n        ...AccountFields\n        __typename\n      }\n      supplierOffers: SupplierOffers {\n        status\n        rate\n        supplier: Supplier {\n          ...AccountFields\n          __typename\n        }\n        __typename\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n          __typename\n        }\n        __typename\n      }\n      id: jobId\n      number\n      # location\n      priority\n      scheduledAt\n      assignedTo\n      jobHoldReason\n      locationId\n      meta\n      managerId\n      description\n      customerName\n      customerId\n      reference\n      serviceName\n      status\n      supplierId\n      supplierName\n      timingStart\n      type\n      quoteNumber\n      quoteDue\n      createdAt\n    }\n    meta: getDashboard_HomeTile_Details_aggregate(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n        number: { _eq: $number }\n        status: { _in: $status }\n        type: { _eq: $type }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        supplierId: { _eq: $supplierId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n        __typename\n      }\n      __typename\n    }\n  }\n  ',"\n  ","\n  ","\n  ","\n  ","\n"])),p.z,f.WW,m.aL,m.wd,b.Px),_=(0,u.Ps)(s||(s=(0,l.Z)(['\n  query GetDashboardList(\n    $accountId: Int\n    $adminId: Int\n    $asAt: timestamptz\n    $jobHoldReasonId: Int\n    $limit: Int\n    $monthStart: timestamptz\n    $offset: Int\n    $orderBy: dashboard_home_details_order_by!\n    $q: String\n    $tileName: String\n    $dayStart: timestamptz\n    $userId: Int\n    $yearStart: timestamptz\n  ) {\n    jobs: getDashboard_HomeTile_Details(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n      }\n      order_by: [$orderBy]\n      limit: $limit\n      offset: $offset\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n        __typename\n      }\n      ...JobFields\n      ...JobAdminFields\n      admin: Admin {\n        id\n        name\n        __typename\n      }\n      customer: Customer {\n        ...AccountFields\n        __typename\n      }\n      location: Location {\n        id\n        name\n        __typename\n      }\n      manager: Manager {\n        ...UserFields\n        __typename\n      }\n      service: Service {\n        id\n        name\n        __typename\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n          __typename\n        }\n        __typename\n      }\n      sla: SLA {\n        id\n        name\n        __typename\n      }\n      supplier: Supplier {\n        ...AccountFields\n        __typename\n      }\n      supplierOffers: SupplierOffers {\n        status\n        rate\n        supplier: Supplier {\n          ...AccountFields\n          __typename\n        }\n        __typename\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n          __typename\n        }\n        __typename\n      }\n      id: jobId\n      number\n      # location\n      priority\n      scheduledAt\n      assignedTo\n      jobHoldReason\n      locationId\n      meta\n      managerId\n      description\n      customerName\n      customerId\n      reference\n      serviceName\n      status\n      supplierId\n      supplierName\n      timingStart\n      type\n      quoteNumber\n      quoteDue\n      createdAt\n    }\n    meta: getDashboard_HomeTile_Details_aggregate(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n      }\n    ) {\n      aggregate {\n        totalCount: count\n        __typename\n      }\n      __typename\n    }\n  }\n  ',"\n  ","\n  ","\n  ","\n  ","\n"])),p.z,f.WW,m.aL,m.wd,b.Px),x=t(83894),j=t(23855),$=t(55148);function I(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function S(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?I(Object(t),!0).forEach((function(n){(0,c.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):I(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var k=function(e,n,t,i,r){var o=t.hasOwnProperty("tileName");if(!e.isChangedStatusSelect)switch(t.show){case"offered":e.status=["offered"];break;case"current":e.status=["accepted","inProgress"];break;case"openJobs":e.status=["raised","pending"];break;case"raised":e.status=["raised"];break;case"pending":e.status=["pending"];break;case"past":e.status=["completed","inDispute","disputeResolved","reportSent","invoiceSent","customerPaid","supplierPaid","closed"];break;default:e.status=t.show}var a=e.limit,s=e.offset,d=e.orderBy,c=e.q,l=e.status,u=e.startDate,m=e.endDate,p=e.type,f=e.number,b=e.userId;if(o)return{query:r?h:_,variables:S({accountId:["supplier","customer"].includes(n.accountType)?n.accountId:null,userId:null,currentUserId:null===n||void 0===n?void 0:n.id,asAt:(0,x.Z)((0,j.Z)(i.asAt)),tileName:null===t||void 0===t?void 0:t.tileName,orderBy:d,monthStart:i.monthStart,dayStart:i.todayStart,yearStart:i.yearStart,adminId:null===n||void 0===n?void 0:n.adminId},e)};switch(n.accountType){case"supplier":return{query:v,variables:{limit:a,offset:s,orderBy:d,q:c,status:l,startDate:u,endDate:m,type:p,number:f,userId:b}};case"customer":return{query:g,variables:{limit:a,offset:s,orderBy:d,q:c,status:l,type:p,number:f,startDate:u,endDate:m}};case"tenant":return{query:g,variables:{limit:a,offset:s,orderBy:d,q:c,status:l,type:p,startDate:u,endDate:m}};default:return{query:y,variables:S({},e)}}},w=function(e){var n=["locationId","customerId","assetId"],t="";return e&&e.constructor===Object&&Object.keys(e).length>0&&(t="?",Object.entries(e).map((function(e){var i=(0,d.Z)(e,2),r=i[0],o=i[1];return o&&n.includes(r)&&(t+="".concat([r],"=").concat(o,"&")),0})),t=(t=t.substring(0,t.length-1)).replace("customerId","accountId")),t},q=function(e){var n=["completed","inDispute","disputeResolved","reportSent","invoiceSent","customerPaid","supplierPaid","closed"];switch(e){case"offered":return $.cj.filter((function(e){return"offered"===e.value}));case"current":return $.cj.filter((function(e){var n=e.value;return"accepted"===n||"inProgress"===n}));case"openJobs":return $.cj.filter((function(e){var n=e.value;return"raised"===n||"pending"===n}));case"raised":return $.cj.filter((function(e){return"raised"===e.value}));case"pending":return $.cj.filter((function(e){return"pending"===e.value}));case"past":return $.cj.filter((function(e){var t=e.value;return n.includes(t)}));default:return $.cj}}},2640:function(e,n,t){t.d(n,{F:function(){return C}});var i=t(80318),r=t(92809),o=t(67294),a=t(93633),s=t(38460),d=t(11163),c=t(57460),l=t.n(c),u=t(24237),m=t(18944),p=t(29444),f=t(26398),b=t(91126),v=t(80284),g=t(22796),y=t(14347),h=t(55657),_=t(81185),x=t(42772),j=t(1071),$=t(18862),I=function(e,n,t){return e.map((function(e){var i,r,o,a,s,d,c,l,u,m,p,f,b,v,g,y,h=e.manager?"".concat(e.manager.nameFirst," ").concat(e.manager.nameLast):"Unassigned",_=e.scheduledAt?(0,$.Z)(e.scheduledAt,!0):(0,$.Z)(e.timingStart,!0),x=n&&(null===e||void 0===e?void 0:e.supplierOffers.length)>0?null===e||void 0===e||null===(i=e.supplierOffers[0].supplier)||void 0===i?void 0:i.name:null===e||void 0===e?void 0:e.supplierOffers;return{id:e.id,type:e.type,number:e.number,invoiceNumber:null===(r=e.meta)||void 0===r||null===(o=r.invoiceNumbers)||void 0===o?void 0:o[0],creator:null===(a=e.timings)||void 0===a||null===(s=a[0])||void 0===s||null===(d=s.user)||void 0===d?void 0:d.fullName,propertyId:null===(c=e.location)||void 0===c?void 0:c.id,managerId:null===(l=e.manager)||void 0===l?void 0:l.id,customerId:null===(u=e.customer)||void 0===u?void 0:u.id,supplierId:e.supplier?e.supplier.id:"",priority:(null===(m=e.sla)||void 0===m?void 0:m.name)||"-",service:(null===(p=e.service)||void 0===p?void 0:p.name)||"-",description:(null===(f=e.shortJobDesc)||void 0===f||null===(b=f[0])||void 0===b?void 0:b.taxonomy.name)||"-",manager:h,location:(null===(v=e.location)||void 0===v?void 0:v.name)||"-",customer:(null===(g=e.customer)||void 0===g?void 0:g.name)||"-",supplier:e.supplier?e.supplier.name:"-",scheduleDate:_,date:(0,$.Z)(e.createdAt),status:null!==e&&void 0!==e&&e.job?null===(y=e.job)||void 0===y?void 0:y.status:e.status,offerTo:t?x:"",actions:""}}))},S=t(99362),k=t(68343),w=t(65570),q=t(1323),Z=t(78586),D=t(49705),O=t(85893);function A(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function P(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?A(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):A(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var T="/dashboard/issues/",C=function(e){var n,t,r,c=e.filters,u=e.isJobsAsset,$=e.initialFilters,A=e.jobType,C=e.workorderVisibility,E=(0,Z.q)(),R=(0,d.useRouter)().query,L=(0,o.useState)(!1),M=L[0],B=L[1],U=(0,q.x)(),F=U.hasRole,J=U.user,z=null===(n=E.admin.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,H=null===(t=E.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,V=(0,D.x)({filters:c}),W=V.initialData,G=V.ref,K=u?{limit:100}:{},Y=W.status||(null===$||void 0===$?void 0:$.status),X=new Date(R.asAt)||new Date,Q=(0,S.X)(X),ee=(0,o.useState)({monthStart:Q.monthStart,todayEnd:Q.todayEnd,todayStart:Q.todayStart,yearStart:Q.yearStart,asAt:R.asAt}),ne=ee[0],te=ee[1];(0,o.useEffect)((function(){var e=Q.monthStart,n=Q.todayEnd,t=Q.todayStart,i=Q.yearStart;te({monthStart:e,todayEnd:n,todayStart:t,yearStart:i,asAt:R.asAt})}),[null===c||void 0===c?void 0:c.asAt]);var ie=F("admin"),re=(0,j.fI)(P(P(P({assetId:null},W),K),{},{locationId:c.locationId||null,managerId:c.managerId?J.id:null,number:W.id?String(W.id):null,status:Y,type:A}),J,R,ne,ie),oe=re.query,ae=re.variables,se=(0,a.a)(oe,{variables:ae}),de=se.data,ce=(de=void 0===de?{jobs:[],meta:{aggregate:{totalCount:0}}}:de).jobs,le=de.meta,ue=se.loading,me=se.refetch,pe=(0,s.t)(oe,{variables:P(P({},ae),{},{limit:(null===le||void 0===le||null===(r=le.aggregate)||void 0===r?void 0:r.totalCount)||150}),onCompleted:function(e){var n=e.jobs;if(M){var t=l().unparse(I(n,!0,ie)),i="data:application/octet-stream,"+encodeURIComponent(t);(0,x.S)(i,"reactiveJobs.csv"),B(!1)}},skip:!0}),fe=(0,i.Z)(pe,2),be=fe[0],ve=fe[1].loading,ge=void 0===ve||ve,ye=[{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(e){var n=e.row;return(0,O.jsx)(w.D,{id:n.id,number:n.number,invoiceNumber:n.invoiceNumber,openCanvas:!0,type:n.type,numberPrefix:z,numberSuffix:H})},sortable:!0,sortName:"number",text:"Job ID"},{text:"Creator"},{hidden:!0},{hidden:!0},{hidden:!0},{sortable:!0,sortName:'{"SLA": {"name": "ORDER"}}',text:"Priority"},{formatter:function(e){var n=e.row;return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(m.Z,{size:"sm",children:n.service})})},sortable:!0,sortName:'{"Service": {"name": "ORDER"}}',text:"Service"},{formatter:function(e){var n=e.row;return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(m.Z,{size:"sm",children:n.type})})},text:"Type"},{formatter:function(e){var n=e.row;return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(m.Z,{size:"sm",children:n.description})})},text:"Description"},{hidden:!ie,formatter:(0,p.Z)("/dashboard/users/view","managerId","manager"),sortable:!0,sortName:'{"Manager": {"nameFirst": "ORDER"}}',text:"Assigned to"},{formatter:function(e){var n=e.row;return(0,O.jsxs)(O.Fragment,{children:[ie&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(f.Z,{to:"/dashboard/customers/view?id=".concat(n.customerId),children:n.customer}),(0,O.jsx)("br",{})]}),F("supplier")?n.location:(0,O.jsx)(f.Z,{to:"/dashboard/properties/view?id=".concat(n.propertyId),children:n.location})]})},sortable:!0,sortName:'{"Customer": {"name": "ORDER"}}',text:F(["customer","supplier"])?"Location":"Customer"},{hidden:!0},{hidden:!ie,formatter:(0,p.Z)("/dashboard/suppliers/view","supplierId","supplier"),sortable:!0,sortName:'{"Supplier": {"name": "ORDER"}}',text:"Supplier"},{text:"Scheduled"},{sortable:!0,sortName:"createdAt",text:"Created"},{sortable:!0,sortName:"status",formatter:function(e){var n,t=e.row;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(k.B,{value:t.status}),ie&&"offered"===t.status&&t.offerTo&&t.offerTo.length>0&&(0,O.jsx)(N,{onClick:function(e){var n;return function(e,n){e.stopPropagation(),d.default.push("/dashboard/suppliers/view?id=".concat(n))}(e,null===(n=t.offerTo[0].supplier)||void 0===n?void 0:n.id)},children:null===(n=t.offerTo[0].supplier)||void 0===n?void 0:n.name})]})},text:"Status"},{hidden:!0},{hidden:!ie,formatter:b.Z,formatterData:function(e){return[{context:"secondary",icon:["fas","edit"],onClick:function(n,t){return e(t)},tooltip:"Edit"},{context:"secondary",icon:["fas","receipt"],onClick:function(e,n){return d.default.push("/dashboard/issues/view?id=".concat(n.number))},tooltip:"info"}]}((function(e){d.default.push("".concat(T,"manage?id=").concat(e.number))})),text:"Actions"}];return(0,O.jsx)(v.Z,{fitParentHeight:!0,open:!0,title:"Work Orders",toolbar:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(g.Z,{marginRight:"xs",children:(0,O.jsx)(y.Z,{content:"Export to excel",context:"secondary",size:"sm",disabled:ge,onClick:function(e){e.stopPropagation(),be(),B(!0)},children:(0,O.jsx)(h.Z,{context:"white",icon:"file-csv",size:"lg"})})}),C&&"ppm"!==A&&(0,O.jsx)(y.Z,{content:"Create Work Order",context:"secondary",size:"sm",onClick:function(e){e.stopPropagation();var n=(0,j.Uu)(c);d.default.push("".concat(T,"manage").concat(n))}})]}),children:(0,O.jsx)(_.t,{columns:ye,isResetTable:null===R||void 0===R?void 0:R.show,loading:ue,meta:!u&&le,ref:G,refetch:me,rows:function(){var e=ce;return u&&(e=e.filter((function(e,n){var t;return(null===(t=e.Assets)||void 0===t?void 0:t.find((function(e){return e.assetId===(null===c||void 0===c?void 0:c.assetId)})))&&n<10}))),I(e,!1,ie)}()})})},N=u.ZP.button.withConfig({displayName:"table__LinkWrapper",componentId:"sc-1hyt731-0"})(["cursor:pointer;margin:2px 0px;padding:8px 5px;color:rgb(41,41,204);background-color:transparent;border:none;&:hover{background-color:#dddddd;border-radius:5px;}"]);C.defaultProps={filters:{assetId:null,managerId:null},isJobsAsset:!1}},99628:function(e,n,t){t.d(n,{uY:function(){return d},PL:function(){return c},DE:function(){return l}});var i,r,o,a=t(52209),s=t(54397),d=(0,s.Ps)(i||(i=(0,a.Z)(["\n  query GetAccountSLAs(\n    $entity: String!\n    $entityId: Int\n    $parentEntity: String\n    $parentEntityId: Int\n    $fetchParent: Boolean!\n    $q: String\n  ) {\n    slas: SLA(order_by: { id: asc }) {\n      status\n      id\n      name\n      notes\n      normalRate\n      oohRate\n      premiumRate\n      onSite\n      onSiteUnit\n      jobReport\n      jobReportUnit\n      completion\n      completionUnit\n      minimumInterval\n      minimumLength\n    }\n    entities: SLA_Entity(\n      where: { entity: { _eq: $entity }, entityId: { _eq: $entityId } }\n      order_by: { slaId: asc }\n    ) {\n      status\n      id\n      entity\n      entityId\n      onSite\n      onSiteUnit\n      jobReport\n      jobReportUnit\n      completion\n      completionUnit\n      notes\n      inUse\n      normalRate\n      oohRate\n      premiumRate\n      minimumInterval\n      minimumLength\n      slaId\n      sla: SLA {\n        status\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n    }\n    parentEntities: SLA_Entity(\n      where: { entity: { _eq: $parentEntity }, entityId: { _eq: $parentEntityId } }\n    ) @include(if: $fetchParent) {\n      id\n      entity\n      entityId\n      onSite\n      onSiteUnit\n      jobReport\n      jobReportUnit\n      completion\n      completionUnit\n      notes\n      inUse\n      normalRate\n      oohRate\n      premiumRate\n      minimumInterval\n      minimumLength\n      slaId\n      status\n      sla: SLA {\n        status\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n    }\n  }\n"]))),c=(0,s.Ps)(r||(r=(0,a.Z)(["\n  mutation addSla($objects: [SLA_Entity_insert_input!]!) {\n    insert_SLA_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),l=(0,s.Ps)(o||(o=(0,a.Z)(["\n  mutation UpdateSla($id: Int!, $changes: SLA_Entity_set_input) {\n    update_SLA_Entity_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"])))},42772:function(e,n,t){t.d(n,{S:function(){return i}});var i=function(e,n){var t=document.createElement("a");"string"===typeof t.download?(document.body.appendChild(t),t.download=n,t.href=e,t.click(),document.body.removeChild(t)):location.replace(e)}},99362:function(e,n,t){t.d(n,{X:function(){return s}});var i=t(43703),r=t(69119),o=t(83894),a=t(38148),s=function(e){var n=(0,i.Z)(e),t=(0,r.Z)(e);return{monthStart:n,todayEnd:(0,o.Z)(e),todayStart:t,yearStart:(0,a.Z)(e)}}}}]);