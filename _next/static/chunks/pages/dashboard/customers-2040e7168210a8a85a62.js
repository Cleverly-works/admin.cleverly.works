(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1525],{66805:function(n,e,t){"use strict";t.d(e,{H:function(){return d}});var r=t(92809),i=t(77417),a=t(58448),o=t(14347),s=t(85893);function c(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function u(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?c(Object(t),!0).forEach((function(e){(0,r.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var d=function(n){var e=n.children,t=n.content,r=n.context,c=n.data,d=n.disabled,l=n.handleClick,m=n.size,p=n.type;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{size:"sm"}),(0,s.jsxs)(a.Z,{align:"flex-end",children:[e,(0,s.jsx)(o.Z,u({content:t,context:r,disabled:d,onClick:l,size:m,type:p},c))]})]})};d.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},53197:function(n,e,t){"use strict";t.d(e,{kJ:function(){return m},UB:function(){return p},rM:function(){return f},Ve:function(){return g},Wn:function(){return b},bD:function(){return v},G5:function(){return y}});var r,i,a,o,s,c,u,d=t(52209),l=t(54397),m=(0,l.Ps)(r||(r=(0,d.Z)(['\n  query GetCustomers(\n    $assignedUser: Int\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Account_order_by!\n    $status: String\n  ) {\n    customers: Account(\n      limit: $limit\n      offset: $offset\n      where: {\n        type: { _eq: "customer" }\n        createdAt: { _eq: $date }\n        managerId: { _eq: $assignedUser }\n        name: { _ilike: $q }\n        status: { _eq: $status }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      createdAt\n      name\n      companyNumber\n      vatId\n      website\n      status\n      addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      locations: Account_Locations {\n        id\n      }\n      finance: Financial {\n        id\n        invoicing\n        serviceRate\n        stripeId\n        totalRevenue\n        unpaidInvoices\n        creditLimit\n        creditRating\n        createdAt\n        amountOutstanding\n        accountId\n        approvalThreshold\n        arrangementFee\n        spendThreshold\n        defaultPaymentMethod\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n      }\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        id\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n          accounts: Account_Users {\n            id\n            role\n            position\n            isContact\n            status\n            account: Account {\n              id\n              name\n              type\n            }\n          }\n        }\n      }\n    }\n    meta: Account_aggregate(\n      where: {\n        type: { _eq: "customer" }\n        createdAt: { _eq: $date }\n        managerId: { _eq: $assignedUser }\n        name: { _ilike: $q }\n        status: { _eq: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),p=(0,l.Ps)(i||(i=(0,d.Z)(['\n  query GetCustomer($id: Int!) {\n    customer: Account_by_pk(id: $id) {\n      id\n      name\n      clientType: ClientType {\n        id\n        name\n      }\n      structure\n      companyNumber\n      vatId\n      website\n      status\n      createdAt\n      updatedAt\n      status\n      type\n      meta\n      usersMeta: Account_Users_aggregate {\n        aggregate {\n          count\n        }\n      }\n      propertiesMeta: Account_Locations_aggregate {\n        aggregate {\n          count\n        }\n      }\n      jobsMeta: CustomerJobs_aggregate {\n        aggregate {\n          count\n        }\n      }\n      addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n        phone\n        email\n      }\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        id\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n          accounts: Account_Users {\n            id\n            role\n            position\n            isContact\n            status\n            account: Account {\n              id\n              name\n              type\n            }\n          }\n        }\n      }\n      bankAccounts: BankAccounts {\n        id\n        stripeId\n        accountNumber\n        routingNumber\n        bic\n        iban\n        status\n        default\n        createdAt\n      }\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      cards: Cards {\n        id\n        stripeId\n        type\n        last4\n        expYear\n        expMonth\n        status\n        default\n        createdAt\n      }\n      jobs: CustomerJobs {\n        id\n        title\n      }\n      finance: Financial {\n        id\n        invoicing\n        serviceRate\n        stripeId\n        totalRevenue\n        unpaidInvoices\n        creditLimit\n        creditRating\n        createdAt\n        amountOutstanding\n        accountId\n        approvalThreshold\n        arrangementFee\n        spendThreshold\n        defaultPaymentMethod\n      }\n      accountEntries: AccountEntries(order_by: { createdAt: asc }) {\n        id\n        outstandingAmount\n        type\n        entryId\n        currencyId\n        createdAt\n        balance\n        amount\n        accountId\n        updatedAt\n      }\n    }\n  }\n']))),f=(0,l.Ps)(a||(a=(0,d.Z)(["\n  query GetCustomerManage($id: Int!) {\n    customer: Account_by_pk(id: $id) {\n      id\n      name\n      website\n      companyNumber\n      vatId\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        id\n        isContact\n        userId\n        user: User {\n          id\n          email\n          fullName\n          meta\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n        }\n      }\n      clientType: ClientType {\n        id\n        label: name\n        value: id\n      }\n      status\n      managerSelected: Manager {\n        id\n        label: fullName\n        value: id\n      }\n    }\n  }\n"]))),g=(0,l.Ps)(o||(o=(0,d.Z)(["\n  mutation AddCustomer($objects: [Account_insert_input!]!) {\n    insert_Account(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),b=(0,l.Ps)(s||(s=(0,d.Z)(["\n  mutation UpdateCustomer(\n    $customerId: Int!\n    $customer: Account_set_input\n    $userId: Int!\n    $user: User_set_input\n    $hasUpdateUser: Boolean!\n  ) {\n    update_Account_by_pk(pk_columns: { id: $customerId }, _set: $customer) {\n      id\n    }\n    update_User_by_pk(pk_columns: { id: $userId }, _set: $user) @include(if: $hasUpdateUser) {\n      id\n    }\n  }\n"]))),v=(0,l.Ps)(c||(c=(0,d.Z)(["\n  mutation AddFinancial($objects: [Financial_insert_input!]!) {\n    insert_Financial(objects: $objects) {\n      returning {\n        id\n        accountId\n        locationId\n      }\n    }\n  }\n"]))),y=(0,l.Ps)(u||(u=(0,d.Z)(['\n  query GetFinancialJob(\n    $adminId: Int\n    $customerId: Int\n    $endDate: timestamptz\n    $startDate: timestamptz\n    $limit: Int\n    $number: String\n    $status: [String]\n    $managerId: Int\n    $locationId: Int\n    $offset: Int\n    $supplierId: Int\n    $q: String\n    $orderBy: job_financial_order_by!\n  ) {\n    jobs: getDashboard_Job_Financial(\n      limit: $limit\n      offset: $offset\n      args: {\n        adminId: $adminId\n        managerId: $managerId\n        customerId: $customerId\n        locationId: $locationId\n        supplierId: $supplierId\n        startTime: $startDate\n        endTime: $endDate\n      }\n      where: {\n        Job: {\n          type: { _eq: "reactive" }\n          _or: [\n            { description: { _ilike: $q } }\n            { reference: { _ilike: $q } }\n            { number: { _ilike: $q } }\n          ]\n          _and: [{ status: { _in: $status }, number: { _eq: $number } }]\n        }\n      }\n      order_by: [$orderBy]\n    ) {\n      customerName: customer_name\n      customerId: customer_id\n      expensesAmountCustomer: job_expenses_customer\n      expensesAmountSupplier: job_expenses_supplier\n      invoiceDate: job_date\n      invoiceNumber: job_invoicenumber\n      jobId: job_id\n      jobStatus: job_status\n      jobTotal: customer_amount\n      jobType: job_type\n      jobNumber: job_number\n      payDate: pay_date\n      priorityId: sla_id\n      revenue: job_revenue\n      service: service_name\n      serviceLine: service_name\n      serviceName: service_name\n      supplierAmount: supplier_amount\n      supplierId: supplier_id\n      supplierName: supplier_name\n      job: Job {\n        description\n        location: Location {\n          name\n        }\n        sla: SLA {\n          name\n        }\n        manager: Manager {\n          fullName\n          nameLast\n          nameFirst\n          id\n        }\n      }\n      scheduledat\n      timingStart\n      status\n      createdAt\n    }\n    meta: getDashboard_Job_Financial_aggregate(\n      args: {\n        adminId: $adminId\n        managerId: $managerId\n        customerId: $customerId\n        locationId: $locationId\n        supplierId: $supplierId\n        startTime: $startDate\n        endTime: $endDate\n      }\n      where: {\n        Job: {\n          type: { _eq: "reactive" }\n          _or: [\n            { description: { _ilike: $q } }\n            { reference: { _ilike: $q } }\n            { number: { _ilike: $q } }\n          ]\n          _and: [{ status: { _in: $status }, number: { _eq: $number } }]\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n'])))},48963:function(n,e,t){"use strict";t.d(e,{N:function(){return o}});var r=t(84550),i=t(85893),a=[{id:"assignedToMe",label:"Assigned to me",value:"assignedToMe"}],o=function(n){var e=n.data,t=n.errors,o=n.name,s=n.onChange,c=n.register;return(0,i.jsx)(r.Z,{errors:t,data:e||a,legend:"",name:o,onChange:s,register:c})};o.defaultProps={name:"assignedToMe"}},69399:function(n,e,t){"use strict";t.d(e,{r:function(){return a}});var r=t(46482),i=t(85893),a=function(n){var e=n.errors,t=n.name,a=n.onChange,o=n.options,s=n.register;return(0,i.jsx)(r.Z,{errors:e,name:t,onChange:a,options:o,register:s})};a.defaultProps={name:"status"}},8163:function(n,e,t){"use strict";t.d(e,{t:function(){return r}});var r=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return[{context:"secondary",icon:["fas","edit"],onClick:e.onEditClick,to:"".concat(n,"manage"),tooltip:"Edit"}]}},81185:function(n,e,t){"use strict";t.d(e,{t:function(){return c}});var r=t(67294),i=t(11163),a=t(30493),o=t(52002),s=t(85893),c=(0,r.forwardRef)((function(n,e){var t=n.columns,c=n.history,u=n.initialSort,d=n.isResetTable,l=n.loading,m=n.meta,p=n.paginationSize,f=n.refetch,g=n.rowClick,b=n.rows,v=(0,i.useRouter)(),y=v.query,j=void 0===y?{}:y,h=(0,r.useState)(parseInt(null===j||void 0===j?void 0:j.page,10)||1),O=h[0],_=h[1],I=(0,r.useState)(a.C1.paginationSize),w=I[0],$=I[1];u||(u={item:"createdAt",order:"desc"}),(0,r.useEffect)((function(){_(1)}),[d]);var P=(0,r.useState)({item:u.item,order:u.order}),C=P[0],x=P[1],S=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=v.query,t=void 0===e?{}:e;n>1?t.page=n:delete t.page;var r=Object.keys(t).length>0;if(r){var i=Object.keys(t).map((function(e){return"page"===e?"".concat(e,"=").concat(n):"".concat(e,"=").concat(t[e])})).join("&&");return"?".concat(i)}return{}};(0,r.useImperativeHandle)(e,(function(){return{currentPage:O,pageSize:w,sort:C,resetPagination:function(){!function(){x({item:u.item,order:u.order}),_(1);var n=S();v.push(n),$(a.C1.paginationSize)}()}}}));return(0,s.jsx)(o.Z,{columns:t,loading:l,paginationSize:p,pagination:m&&!0,paginationProps:m&&{currentPage:O,onPageChange:function(n){var e=S(n);c&&v.push(e),_(n),f&&f()},onPageSizeChange:function(n){n!==a.C1.paginationSize&&($(n),f&&f())},pageCount:Math.ceil(m.aggregate.totalCount/w),perPage:w},rowClick:g,rows:b,sort:C,setSort:function(n){var e=n.item,t=n.order;x({item:e,order:t}),f&&f()}})}));c.defaultProps={history:!0,loading:!0,paginationSize:!1}},49705:function(n,e,t){"use strict";t.d(e,{x:function(){return d}});var r=t(92809),i=t(67294),a=t(63867),o=t(30493),s=t(34770);function c(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function u(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?c(Object(t),!0).forEach((function(e){(0,r.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var d=function(n){var e,t,c,d,l,m,p,f,g,b,v,y=n.filters,j=n.initialSort,h=(0,i.useRef)();(0,i.useEffect)((function(){var n;(null===h||void 0===h||null===(n=h.current)||void 0===n?void 0:n.currentPage)>1&&(null===h||void 0===h||h.current.resetPagination(),(0,a.Z)("?page=1"))}),[y]);var O=j||{item:"createdAt",order:"desc"},_=(0,r.Z)({},(null===(e=h.current)||void 0===e?void 0:e.sort.item)||O.item,O.inneritem?(0,r.Z)({},O.inneritem,(null===(t=h.current)||void 0===t?void 0:t.sort.order)||O.order):(null===(c=h.current)||void 0===c?void 0:c.sort.order)||O.order);return{initialData:u(u({},y),{},{limit:"Infinity"===(null===(d=h.current)||void 0===d?void 0:d.pageSize)?null:parseInt(null===(l=h.current)||void 0===l?void 0:l.pageSize,10)||o.C1.paginationSize,offset:((null===(m=h.current)||void 0===m?void 0:m.currentPage)-1||0)*((null===(p=h.current)||void 0===p?void 0:p.pageSize)||o.C1.paginationSize),orderBy:(0,s.c)(null===(f=h.current)||void 0===f||null===(g=f.sort)||void 0===g||null===(b=g.item)||void 0===b?void 0:b.replace(/ORDER/i,null===(v=h.current)||void 0===v?void 0:v.sort.order))||_}),initialSort:j,ref:h}}},42772:function(n,e,t){"use strict";t.d(e,{S:function(){return r}});var r=function(n,e){var t=document.createElement("a");"string"===typeof t.download?(document.body.appendChild(t),t.download=e,t.href=n,t.click(),document.body.removeChild(t)):location.replace(n)}},34770:function(n,e,t){"use strict";t.d(e,{s:function(){return r},c:function(){return i}});var r=function(n){try{JSON.parse(n)}catch(e){return!1}return!0},i=function(n){try{return JSON.parse(n)}catch(e){return!1}}},75838:function(n,e,t){"use strict";t.d(e,{bg:function(){return r},WG:function(){return i}});var r=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}],i=[{text:"Status",value:""},{text:"Open",value:"open"},{text:"Resolved",value:"resolved"},{text:"Closed",value:"closed"}]},70316:function(n,e,t){"use strict";t.d(e,{J:function(){return x}});var r=t(92809),i=t(80318),a=t(10219),o=t(11163),s=t(67294),c=t(78215),u=t(2356),d=t(42283),l=t(97202),m=t(80284),p=t(65375),f=t(10973),g=t(14347),b=t(66805),v=t(69119),y=t(23855),j=t(83894);function h(n,e,t){var r=(0,s.useState)((function(){if(JSON.parse(window.sessionStorage.getItem(n))&&!Object.values(JSON.parse(window.sessionStorage[n])).includes(t))return e;try{var r=JSON.parse(window.sessionStorage.getItem(n));return r&&(r.startDate=r.startDate?(0,v.Z)((0,y.Z)(r.startDate)):null,r.endDate=r.endDate?(0,j.Z)((0,y.Z)(r.endDate)):null),r||e}catch(i){return console.log(i),e}})),i=r[0],a=r[1];return[i,function(e){try{var t=e instanceof Function?e(i):e;a(t),window.sessionStorage.setItem(n,JSON.stringify(t))}catch(r){console.log(r)}}]}var O=t(85893);function _(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function I(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?_(Object(t),!0).forEach((function(e){(0,r.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):_(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var w=function(n){var e=n.initialValues,t=n.renderFilters,r=n.setFilters,a=n.lastQuery,o=n.filters,v=e.filterType,y=h("form_data",e,v),j=(0,i.Z)(y,2),_=j[0],w=j[1],$=(0,d.cI)({defaultValues:_||e}),P=$.control,C=$.errors,x=$.handleSubmit,S=$.register,A=$.reset,Z=$.watch,D=$.setValue,k=I(I({},Z()),{},{filterType:v});(0,s.useEffect)((function(){A(k)}),[A]),(0,s.useEffect)((function(){w(k)}),[o]);var N=function(n){var t=n.query;if(t!==a){var i={q:"%".concat(t,"%")||0},o=/^\d+$/.test(t);"id"in e&&(i.id=o?Number(t):null),"meta"in e&&(i.meta=o?{invoiceNumbers:[t]}:null),"jobNumber"in e&&(i.jobNumber=o?String(t):null,i.invoiceNumber=o?Number(t):null),(i.id||i.meta||i.jobNumber)&&(i.q=null),r((function(n){return I(I({},n),i)}))}};return(0,O.jsx)(l.Z,{handleSubmit:x(N),children:(0,O.jsxs)(m.Z,{title:"Filters",children:[(0,O.jsxs)(c.Z,{children:[(0,O.jsx)(u.Z,{sm:12,lg:12,children:(0,O.jsx)(p.Z,{label:"",children:(0,O.jsx)(f.Z,{errors:C,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:S,type:"search"})})}),(0,O.jsx)(u.Z,{sm:12,lg:12,children:t({control:P,errors:C,initialValues:e,register:S,setFilters:r,watch:Z,setValue:D,reset:A})})]}),(0,O.jsx)(b.H,{content:"Search",context:"secondary",handleClick:N,type:"submit",children:(0,O.jsx)(g.Z,{content:"Clear",context:"danger",onClick:function(n){Object.keys(e).map((function(n){return D(n,null)})),r(e),A(e),N("")},size:"sm"})})]})})},$=["FiltersComp","initialFilters","TableComp"];function P(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function C(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?P(Object(t),!0).forEach((function(e){(0,r.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):P(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var x=function(n){var e=n.FiltersComp,t=n.initialFilters,r=n.TableComp,d=(0,a.Z)(n,$),l=h("filters",t,t.filterType),m=(0,i.Z)(l,2),p=m[0],f=m[1],g=(0,s.useState)(p||t),b=g[0],v=g[1],y=(0,o.useRouter)().query.show;return(0,s.useEffect)((function(){f(b)}),[b]),(0,O.jsx)(c.Z,{children:(0,O.jsxs)(u.Z,{sm:12,lg:12,children:[(0,O.jsx)(w,{initialValues:t,renderFilters:function(n){return(0,O.jsx)(e,C(C(C({},n),d),{},{show:y}))},setFilters:v,filters:b}),(0,O.jsx)(r,C({filters:b,initialFilters:t},d))]})})}},52733:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return R}});var r=t(66918),i=t(70316),a=t(92809),o=t(80318),s=t(67294),c=t(11163),u=t(93633),d=t(38460),l=t(53197),m=t(24237),p=t(57460),f=t.n(p),g=t(43566),b=t(29444),v=t(91126),y=t(18862),j=t(73165),h=t(14347),O=t(55657),_=t(80284),I=t(70448),w=t(8163),$=t(81185),P=t(49705),C=t(42772),x=t(85893);function S(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function A(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?S(Object(t),!0).forEach((function(e){(0,a.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):S(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var Z="/dashboard/customers/",D=function(n){var e=n.filters,t=(0,P.x)({filters:e}),r=t.initialData,i=t.ref,a=(0,s.useContext)(g.Z).user,m=(0,u.a)(l.kJ,{variables:A(A({},r),{},{assignedUser:e.assignedUser?a.id:null})}),p=m.data,S=(p=void 0===p?{customers:[],meta:{aggregate:{totalCount:0}}}:p).customers,D=p.meta,N=m.loading,q=m.refetch,U=(0,d.t)(l.kJ,{variables:{assignedUser:e.assignedUser?a.id:null,orderBy:r.orderBy,q:r.q,status:r.status},onCompleted:function(n){var e=f().unparse(z(n.customers)),t="data:application/octet-stream,"+encodeURIComponent(e);(0,C.S)(t,"customers.csv")}}),F=(0,o.Z)(U,1)[0],E=function(n){n.stopPropagation(),F()},T=[{hidden:!0},{hidden:!0},{sortable:!0,sortName:"name",text:"Name"},{formatter:(0,b.Z)("/dashboard/users/view","managerId","manager"),text:"Assigned to"},{formatter:(0,b.Z)("/dashboard/users/view","contactId","contactName"),text:"Contact"},{hidden:!0},{text:"City"},{text:"Properties"},{text:"Created",sortable:!0,sortName:"createdAt"},{text:"Status"},{formatter:v.Z,formatterData:(0,w.t)(Z),text:"Actions"}],z=function(n){return n.map((function(n){return{name:n.name,companyNumber:n.companyNumber,vatId:n.vatId,website:n.website,status:n.status,createdAt:(0,y.Z)(n.createdAt)}}))},L=function(){return(0,x.jsx)(k,{children:(0,x.jsx)(h.Z,{context:"white",onClick:E,title:"Export to CSV",children:(0,x.jsx)(O.Z,{context:"secondary",icon:"file-csv",size:"lg"})})})};return(0,x.jsx)(_.Z,{toolbar:(0,x.jsx)(L,{}),open:!0,title:"Customers",children:(0,x.jsx)($.t,{columns:T,loading:N,meta:D,ref:i,refetch:q,rowClick:function(n){c.default.push("".concat(Z,"view?id=").concat(n.id,"&tab=details"))},rows:S.map((function(n){var e,t,r,i,a=(0,I.WE)(n,"registered"),o=null===a||void 0===a||null===(e=a.address)||void 0===e?void 0:e.city;return{id:n.id,managerId:null===n||void 0===n||null===(t=n.manager)||void 0===t?void 0:t.id,name:n.name,manager:n.manager?"".concat(n.manager.nameFirst," ").concat(n.manager.nameLast," "):"Unassigned",contactName:null!==(r=n.contactUsers)&&void 0!==r&&r.length?"".concat(n.contactUsers[0].user.nameFirst," ").concat(n.contactUsers[0].user.nameLast):"Unassigned",contactId:(null===(i=n.contactUsers)||void 0===i?void 0:i.length)&&n.contactUsers[0].user.id,city:o||"",locations:n.locations.length||0,createdAt:(0,y.Z)(n.createdAt),status:(0,j.Z)(n.status),actions:""}}))})})},k=m.ZP.div.withConfig({displayName:"table__StyledToolbar",componentId:"sc-qn46oc-0"})(["display:inline-flex;float:right;"]),N=t(48963),q=t(69399),U=t(75838),F=t(78215),E=t(2356);function T(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function z(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?T(Object(t),!0).forEach((function(e){(0,a.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):T(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var L=function(n){var e=n.errors,t=n.register,r=n.setFilters,i={errors:e,register:t};return(0,x.jsxs)(F.Z,{children:[(0,x.jsx)(E.Z,{md:6,children:(0,x.jsx)(q.r,z(z({},i),{},{onChange:function(n){return r((function(e){return z(z({},e),{},{status:n.target.value||null})}))},options:U.bg}))}),(0,x.jsx)(E.Z,{md:6,children:(0,x.jsx)(N.N,z(z({},i),{},{name:"assignedUser",onChange:function(n){return r((function(e){return z(z({},e),{},{assignedUser:n.target.checked||null})}))}}))})]})},J={assignedUser:!1,q:null,status:"active",filterType:"customers_list"},M=function(){return(0,x.jsx)(i.J,{FiltersComp:L,initialFilters:J,TableComp:D})},R=function(){return(0,x.jsx)(r.Z,{pageHeading:{heading:"Customers"},View:(0,x.jsx)(M,{})})}},23245:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/customers",function(){return t(52733)}])}},function(n){n.O(0,[284,4195,5312,2002,3086,4712,7431,6599,9774,2888,179],(function(){return e=23245,n(n.s=e);var e}));var e=n.O();_N_E=e}]);