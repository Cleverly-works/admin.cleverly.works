(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[689],{66805:function(e,t,r){"use strict";r.d(t,{H:function(){return l}});var n=r(92809),o=r(77417),i=r(58448),a=r(14347),s=r(85893);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l=function(e){var t=e.children,r=e.content,n=e.context,c=e.data,l=e.disabled,d=e.handleClick,f=e.size,p=e.type;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{size:"sm"}),(0,s.jsxs)(i.Z,{align:"flex-end",children:[t,(0,s.jsx)(a.Z,u({content:r,context:n,disabled:l,onClick:d,size:f,type:p},c))]})]})};l.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},48963:function(e,t,r){"use strict";r.d(t,{N:function(){return a}});var n=r(84550),o=r(85893),i=[{id:"assignedToMe",label:"Assigned to me",value:"assignedToMe"}],a=function(e){var t=e.data,r=e.errors,a=e.name,s=e.onChange,c=e.register;return(0,o.jsx)(n.Z,{errors:r,data:t||i,legend:"",name:a,onChange:s,register:c})};a.defaultProps={name:"assignedToMe"}},69399:function(e,t,r){"use strict";r.d(t,{r:function(){return i}});var n=r(46482),o=r(85893),i=function(e){var t=e.errors,r=e.name,i=e.onChange,a=e.options,s=e.register;return(0,o.jsx)(n.Z,{errors:t,name:r,onChange:i,options:a,register:s})};i.defaultProps={name:"status"}},81185:function(e,t,r){"use strict";r.d(t,{t:function(){return c}});var n=r(67294),o=r(11163),i=r(30493),a=r(52002),s=r(85893),c=(0,n.forwardRef)((function(e,t){var r=e.columns,c=e.history,u=e.initialSort,l=e.isResetTable,d=e.loading,f=e.meta,p=e.paginationSize,v=e.refetch,g=e.rowClick,b=e.rows,m=(0,o.useRouter)(),j=m.query,h=void 0===j?{}:j,O=(0,n.useState)(parseInt(null===h||void 0===h?void 0:h.page,10)||1),y=O[0],x=O[1],w=(0,n.useState)(i.C1.paginationSize),P=w[0],S=w[1];u||(u={item:"createdAt",order:"desc"}),(0,n.useEffect)((function(){x(1)}),[l]);var Z=(0,n.useState)({item:u.item,order:u.order}),C=Z[0],D=Z[1],N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=m.query,r=void 0===t?{}:t;e>1?r.page=e:delete r.page;var n=Object.keys(r).length>0;if(n){var o=Object.keys(r).map((function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(r[t])})).join("&&");return"?".concat(o)}return{}};(0,n.useImperativeHandle)(t,(function(){return{currentPage:y,pageSize:P,sort:C,resetPagination:function(){!function(){D({item:u.item,order:u.order}),x(1);var e=N();m.push(e),S(i.C1.paginationSize)}()}}}));return(0,s.jsx)(a.Z,{columns:r,loading:d,paginationSize:p,pagination:f&&!0,paginationProps:f&&{currentPage:y,onPageChange:function(e){var t=N(e);c&&m.push(t),x(e),v&&v()},onPageSizeChange:function(e){e!==i.C1.paginationSize&&(S(e),v&&v())},pageCount:Math.ceil(f.aggregate.totalCount/P),perPage:P},rowClick:g,rows:b,sort:C,setSort:function(e){var t=e.item,r=e.order;D({item:t,order:r}),v&&v()}})}));c.defaultProps={history:!0,loading:!0,paginationSize:!1}},49705:function(e,t,r){"use strict";r.d(t,{x:function(){return l}});var n=r(92809),o=r(67294),i=r(63867),a=r(30493),s=r(34770);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l=function(e){var t,r,c,l,d,f,p,v,g,b,m,j=e.filters,h=e.initialSort,O=(0,o.useRef)();(0,o.useEffect)((function(){var e;(null===O||void 0===O||null===(e=O.current)||void 0===e?void 0:e.currentPage)>1&&(null===O||void 0===O||O.current.resetPagination(),(0,i.Z)("?page=1"))}),[j]);var y=h||{item:"createdAt",order:"desc"},x=(0,n.Z)({},(null===(t=O.current)||void 0===t?void 0:t.sort.item)||y.item,y.inneritem?(0,n.Z)({},y.inneritem,(null===(r=O.current)||void 0===r?void 0:r.sort.order)||y.order):(null===(c=O.current)||void 0===c?void 0:c.sort.order)||y.order);return{initialData:u(u({},j),{},{limit:"Infinity"===(null===(l=O.current)||void 0===l?void 0:l.pageSize)?null:parseInt(null===(d=O.current)||void 0===d?void 0:d.pageSize,10)||a.C1.paginationSize,offset:((null===(f=O.current)||void 0===f?void 0:f.currentPage)-1||0)*((null===(p=O.current)||void 0===p?void 0:p.pageSize)||a.C1.paginationSize),orderBy:(0,s.c)(null===(v=O.current)||void 0===v||null===(g=v.sort)||void 0===g||null===(b=g.item)||void 0===b?void 0:b.replace(/ORDER/i,null===(m=O.current)||void 0===m?void 0:m.sort.order))||x}),initialSort:h,ref:O}}},42772:function(e,t,r){"use strict";r.d(t,{S:function(){return n}});var n=function(e,t){var r=document.createElement("a");"string"===typeof r.download?(document.body.appendChild(r),r.download=t,r.href=e,r.click(),document.body.removeChild(r)):location.replace(e)}},34770:function(e,t,r){"use strict";r.d(t,{s:function(){return n},c:function(){return o}});var n=function(e){try{JSON.parse(e)}catch(t){return!1}return!0},o=function(e){try{return JSON.parse(e)}catch(t){return!1}}},75838:function(e,t,r){"use strict";r.d(t,{bg:function(){return n},WG:function(){return o}});var n=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}],o=[{text:"Status",value:""},{text:"Open",value:"open"},{text:"Resolved",value:"resolved"},{text:"Closed",value:"closed"}]},70316:function(e,t,r){"use strict";r.d(t,{J:function(){return D}});var n=r(92809),o=r(80318),i=r(10219),a=r(11163),s=r(67294),c=r(78215),u=r(2356),l=r(42283),d=r(97202),f=r(80284),p=r(65375),v=r(10973),g=r(14347),b=r(66805),m=r(69119),j=r(23855),h=r(83894);function O(e,t,r){var n=(0,s.useState)((function(){if(JSON.parse(window.sessionStorage.getItem(e))&&!Object.values(JSON.parse(window.sessionStorage[e])).includes(r))return t;try{var n=JSON.parse(window.sessionStorage.getItem(e));return n&&(n.startDate=n.startDate?(0,m.Z)((0,j.Z)(n.startDate)):null,n.endDate=n.endDate?(0,h.Z)((0,j.Z)(n.endDate)):null),n||t}catch(o){return console.log(o),t}})),o=n[0],i=n[1];return[o,function(t){try{var r=t instanceof Function?t(o):t;i(r),window.sessionStorage.setItem(e,JSON.stringify(r))}catch(n){console.log(n)}}]}var y=r(85893);function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var P=function(e){var t=e.initialValues,r=e.renderFilters,n=e.setFilters,i=e.lastQuery,a=e.filters,m=t.filterType,j=O("form_data",t,m),h=(0,o.Z)(j,2),x=h[0],P=h[1],S=(0,l.cI)({defaultValues:x||t}),Z=S.control,C=S.errors,D=S.handleSubmit,N=S.register,E=S.reset,I=S.watch,k=S.setValue,_=w(w({},I()),{},{filterType:m});(0,s.useEffect)((function(){E(_)}),[E]),(0,s.useEffect)((function(){P(_)}),[a]);var z=function(e){var r=e.query;if(r!==i){var o={q:"%".concat(r,"%")||0},a=/^\d+$/.test(r);"id"in t&&(o.id=a?Number(r):null),"meta"in t&&(o.meta=a?{invoiceNumbers:[r]}:null),"jobNumber"in t&&(o.jobNumber=a?String(r):null,o.invoiceNumber=a?Number(r):null),(o.id||o.meta||o.jobNumber)&&(o.q=null),n((function(e){return w(w({},e),o)}))}};return(0,y.jsx)(d.Z,{handleSubmit:D(z),children:(0,y.jsxs)(f.Z,{title:"Filters",children:[(0,y.jsxs)(c.Z,{children:[(0,y.jsx)(u.Z,{sm:12,lg:12,children:(0,y.jsx)(p.Z,{label:"",children:(0,y.jsx)(v.Z,{errors:C,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:N,type:"search"})})}),(0,y.jsx)(u.Z,{sm:12,lg:12,children:r({control:Z,errors:C,initialValues:t,register:N,setFilters:n,watch:I,setValue:k,reset:E})})]}),(0,y.jsx)(b.H,{content:"Search",context:"secondary",handleClick:z,type:"submit",children:(0,y.jsx)(g.Z,{content:"Clear",context:"danger",onClick:function(e){Object.keys(t).map((function(e){return k(e,null)})),n(t),E(t),z("")},size:"sm"})})]})})},S=["FiltersComp","initialFilters","TableComp"];function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var D=function(e){var t=e.FiltersComp,r=e.initialFilters,n=e.TableComp,l=(0,i.Z)(e,S),d=O("filters",r,r.filterType),f=(0,o.Z)(d,2),p=f[0],v=f[1],g=(0,s.useState)(p||r),b=g[0],m=g[1],j=(0,a.useRouter)().query.show;return(0,s.useEffect)((function(){v(b)}),[b]),(0,y.jsx)(c.Z,{children:(0,y.jsxs)(u.Z,{sm:12,lg:12,children:[(0,y.jsx)(P,{initialValues:r,renderFilters:function(e){return(0,y.jsx)(t,C(C(C({},e),l),{},{show:j}))},setFilters:m,filters:b}),(0,y.jsx)(n,C({filters:b,initialFilters:r},l))]})})}},75019:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return B}});var n=r(66918),o=r(70316),i=r(92809),a=r(80318),s=r(10219),c=r(67294),u=r(11163),l=r(93633),d=r(38460),f=r(2880),p=r(57460),v=r.n(p),g=r(43566),b=r(29444),m=r(91126),j=r(18862),h=r(73165),O=r(14347),y=r(55657),x=r(80284),w=r(24237),P=r(70448),S=r(81185),Z=r(49705),C=r(42772),D=r(85893),N=["assignedUser","coverageId","serviceId","status","q"];function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var k="/dashboard/suppliers/",_=function(e){var t=e.filters,r=(0,Z.x)({filters:t}),n=r.initialData,o=r.ref,i=(0,c.useContext)(g.Z).user,p=n.assignedUser,w=n.coverageId,E=n.serviceId,_=n.status,F=n.q,U=(0,s.Z)(n,N),A={type:{_eq:"supplier"}};p&&(A.managerId={_eq:i.id}),E&&(A.Services={Service:{id:{_eq:E}}}),w&&(A.PostcodeAreas={postcodeAreaId:{_eq:w}}),_&&(A.status={_eq:_}),F&&(A.name={_ilike:F});var q=(0,l.a)(f.ys,{variables:I({where:A},U)}),T=q.data,R=(T=void 0===T?{suppliers:[],meta:{aggregate:{totalCount:0}}}:T).suppliers,J=T.meta,V=q.loading,H=q.refetch,L=(0,d.t)(f.ys,{variables:{where:A,orderBy:{createdAt:"desc"}},onCompleted:function(e){var t=v().unparse(X(e.suppliers)),r="data:application/octet-stream,"+encodeURIComponent(t);(0,C.S)(r,"suppliers.csv")}}),M=(0,a.Z)(L,1)[0],B=function(e){e.stopPropagation(),M(e)},W=[{hidden:!0},{hidden:!0},{sortable:!0,sortName:"name",text:"Name"},{sortable:!0,sortName:'{"SupplierJobs_aggregate": {"count": "ORDER"}}',text:"Number of jobs"},{sortable:!0,sortName:'{"SupplierJobs_aggregate": {"max": {"scheduledAt": "ORDER"}}}',text:"Last job"},{formatter:(0,b.Z)("/dashboard/users/view","contactId","contactName"),text:"Contact"},{hidden:!0},{text:"City"},{text:"Created",sortable:!0,sortName:"createdAt"},{text:"Status"},{formatter:m.Z,formatterData:function(e){return[{context:"secondary",icon:["fas","edit"],to:"".concat(e,"edit"),tooltip:"Edit"}]}(k),text:"Actions"}],X=function(e){return e.map((function(e){var t,r,n,o,i,a,s,c,u,l,d,f,p;return{name:e.name,companyNumber:e.companyNumber,vatId:e.vatId,website:e.website,status:e.status,createdAt:(0,j.Z)(e.createdAt),jobsCount:null===(t=e.jobs)||void 0===t||null===(r=t.aggregate)||void 0===r?void 0:r.count,email:null!==(n=e.contactUsers)&&void 0!==n&&n.length?null===(o=e.contactUsers[0].user)||void 0===o?void 0:o.email:"",phoneNumber:null!==(i=e.contactUsers)&&void 0!==i&&i.length?null===(a=e.contactUsers[0].user)||void 0===a?void 0:a.phone:"",contactName:null!==(s=e.contactUsers)&&void 0!==s&&s.length?null===(c=e.contactUsers[0].user)||void 0===c?void 0:c.fullName:"",lastJob:null!==(u=e.jobList)&&void 0!==u&&u.length?e.jobList[0].id:"",earnings:null===(l=e.jobs)||void 0===l||null===(d=l.aggregate)||void 0===d||null===(f=d.sum)||void 0===f?void 0:f.amount,services:null===(p=e.services)||void 0===p?void 0:p.map((function(e){var t;return null===(t=e.service)||void 0===t?void 0:t.name})).join(", ")}}))},G=function(){return(0,D.jsxs)(z,{children:[(0,D.jsx)(O.Z,{context:"white",onClick:B,title:"Export to CSV",children:(0,D.jsx)(y.Z,{context:"secondary",icon:"file-csv",size:"lg"})}),(0,D.jsx)(O.Z,{context:"secondary",onClick:Q,children:"Create Supplier"})]})},Q=function(){u.default.push("".concat(k,"create"))};return(0,D.jsx)(x.Z,{toolbar:(0,D.jsx)(G,{}),open:!0,title:"Suppliers",children:(0,D.jsx)(S.t,{columns:W,loading:V,meta:J,ref:o,refetch:H,rowClick:function(e){u.default.push("".concat(k,"view?id=").concat(e.id))},rows:R.map((function(e){var t,r,n,o,i,a,s,c,u,l,d,f,p=(0,P.WE)(e,"registered"),v=null===p||void 0===p||null===(t=p.address)||void 0===t?void 0:t.city,g=(null===(r=e.jobs)||void 0===r||null===(n=r.aggregate)||void 0===n||null===(o=n.max)||void 0===o?void 0:o.scheduledAt)&&(0,j.Z)(null===(i=e.jobs)||void 0===i||null===(a=i.aggregate)||void 0===a||null===(s=a.max)||void 0===s?void 0:s.scheduledAt);return{id:e.id,managerId:null===e||void 0===e||null===(c=e.manager)||void 0===c?void 0:c.id,name:e.name,jobsCount:null===(u=e.jobs)||void 0===u||null===(l=u.aggregate)||void 0===l?void 0:l.count,lastJob:g,contactName:null!==(d=e.contactUsers)&&void 0!==d&&d.length?"".concat(e.contactUsers[0].user.nameFirst," ").concat(e.contactUsers[0].user.nameLast):"Unassigned",contactId:(null===(f=e.contactUsers)||void 0===f?void 0:f.length)&&e.contactUsers[0].user.id,city:v||"",createdAt:(0,j.Z)(e.createdAt),status:(0,h.Z)(e.status),actions:""}}))})})},z=w.ZP.div.withConfig({displayName:"table__StyledToolbar",componentId:"sc-i9jxik-0"})(["display:inline-flex;float:right;"]),F=r(78215),U=r(2356),A=r(48963),q=r(95146),T=r(69399),R=r(75838);function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var H=function(e){var t=e.control,r=e.errors,n=e.register,o=e.setFilters,i=e.watch,a={control:t,errors:r,register:n},s=i("coverageId"),u=i("serviceId");return(0,c.useEffect)((function(){o((function(e){return V(V({},e),{},{coverageId:(null===s||void 0===s?void 0:s.value)||null})}))}),[s]),(0,c.useEffect)((function(){o((function(e){return V(V({},e),{},{serviceId:(null===u||void 0===u?void 0:u.value)||null})}))}),[u]),(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(F.Z,{align:"baseline",children:[(0,D.jsx)(U.Z,{md:6,children:(0,D.jsx)(T.r,V(V({},a),{},{options:R.bg,onChange:function(e){return o((function(t){return V(V({},t),{},{status:e.target.value||null})}))}}))}),(0,D.jsx)(U.Z,{md:6,children:(0,D.jsx)(q.P,V(V({},a),{},{errors:V({},r),label:"",name:"serviceId",placeholder:"Service",type:"service"}))})]}),(0,D.jsxs)(F.Z,{children:[(0,D.jsx)(U.Z,{md:6,children:(0,D.jsx)(q.P,V(V({},a),{},{errors:V({},r),label:"",name:"coverageId",placeholder:"Coverage area",type:"coverage"}))}),(0,D.jsx)(U.Z,{md:6,children:(0,D.jsx)(A.N,V(V({},a),{},{name:"assignedUser",onChange:function(e){return o((function(t){return V(V({},t),{},{assignedUser:e.target.checked})}))}}))})]})]})},L={assignedUser:!1,coverageId:null,q:null,status:"active",serviceId:null,filterType:"suppliers_table"},M=function(){return(0,D.jsx)(o.J,{FiltersComp:H,initialFilters:L,TableComp:_})},B=function(){return(0,D.jsx)(n.Z,{pageHeading:{heading:"Suppliers"},View:(0,D.jsx)(M,{})})}},56971:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/suppliers",function(){return r(75019)}])}},function(e){e.O(0,[284,4195,5312,7287,2002,3086,9082,3515,4712,7431,2375,5146,2880,9774,2888,179],(function(){return t=56971,e(e.s=t);var t}));var t=e.O();_N_E=t}]);