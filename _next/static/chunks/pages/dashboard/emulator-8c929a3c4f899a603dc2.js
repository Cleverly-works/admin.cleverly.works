(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9154],{66805:function(e,t,r){"use strict";r.d(t,{H:function(){return l}});var n=r(92809),o=r(77417),i=r(58448),s=r(14347),a=r(85893);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l=function(e){var t=e.children,r=e.content,n=e.context,c=e.data,l=e.disabled,d=e.handleClick,p=e.size,f=e.type;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Z,{size:"sm"}),(0,a.jsxs)(i.Z,{align:"flex-end",children:[t,(0,a.jsx)(s.Z,u({content:r,context:n,disabled:l,onClick:d,size:p,type:f},c))]})]})};l.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},76800:function(e,t,r){"use strict";r.d(t,{M:function(){return p}});var n=r(92809),o=r(10219),i=r(42426),s=r(19716),a=r(22796),c=r(85893),u=["control","errors","name","space"];function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=function(e){var t=e.control,r=e.errors,n=e.name,l=e.space,p=(0,o.Z)(e,u);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.Z,d({control:t,errors:r,locale:i.Z,name:n},p)),l&&(0,c.jsx)(a.Z,{marginBottom:"sm"})]})};p.defaultProps={space:!0}},81185:function(e,t,r){"use strict";r.d(t,{t:function(){return c}});var n=r(67294),o=r(11163),i=r(30493),s=r(52002),a=r(85893),c=(0,n.forwardRef)((function(e,t){var r=e.columns,c=e.history,u=e.initialSort,l=e.isResetTable,d=e.loading,p=e.meta,f=e.paginationSize,g=e.refetch,m=e.rowClick,y=e.rows,v=(0,o.useRouter)(),b=v.query,j=void 0===b?{}:b,O=(0,n.useState)(parseInt(null===j||void 0===j?void 0:j.page,10)||1),h=O[0],P=O[1],w=(0,n.useState)(i.C1.paginationSize),x=w[0],S=w[1];u||(u={item:"createdAt",order:"desc"}),(0,n.useEffect)((function(){P(1)}),[l]);var Z=(0,n.useState)({item:u.item,order:u.order}),D=Z[0],I=Z[1],C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=v.query,r=void 0===t?{}:t;e>1?r.page=e:delete r.page;var n=Object.keys(r).length>0;if(n){var o=Object.keys(r).map((function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(r[t])})).join("&&");return"?".concat(o)}return{}};(0,n.useImperativeHandle)(t,(function(){return{currentPage:h,pageSize:x,sort:D,resetPagination:function(){!function(){I({item:u.item,order:u.order}),P(1);var e=C();v.push(e),S(i.C1.paginationSize)}()}}}));return(0,a.jsx)(s.Z,{columns:r,loading:d,paginationSize:f,pagination:p&&!0,paginationProps:p&&{currentPage:h,onPageChange:function(e){var t=C(e);c&&v.push(t),P(e),g&&g()},onPageSizeChange:function(e){e!==i.C1.paginationSize&&(S(e),g&&g())},pageCount:Math.ceil(p.aggregate.totalCount/x),perPage:x},rowClick:m,rows:y,sort:D,setSort:function(e){var t=e.item,r=e.order;I({item:t,order:r}),g&&g()}})}));c.defaultProps={history:!0,loading:!0,paginationSize:!1}},49705:function(e,t,r){"use strict";r.d(t,{x:function(){return l}});var n=r(92809),o=r(67294),i=r(63867),s=r(30493),a=r(34770);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l=function(e){var t,r,c,l,d,p,f,g,m,y,v,b=e.filters,j=e.initialSort,O=(0,o.useRef)();(0,o.useEffect)((function(){var e;(null===O||void 0===O||null===(e=O.current)||void 0===e?void 0:e.currentPage)>1&&(null===O||void 0===O||O.current.resetPagination(),(0,i.Z)("?page=1"))}),[b]);var h=j||{item:"createdAt",order:"desc"},P=(0,n.Z)({},(null===(t=O.current)||void 0===t?void 0:t.sort.item)||h.item,h.inneritem?(0,n.Z)({},h.inneritem,(null===(r=O.current)||void 0===r?void 0:r.sort.order)||h.order):(null===(c=O.current)||void 0===c?void 0:c.sort.order)||h.order);return{initialData:u(u({},b),{},{limit:"Infinity"===(null===(l=O.current)||void 0===l?void 0:l.pageSize)?null:parseInt(null===(d=O.current)||void 0===d?void 0:d.pageSize,10)||s.C1.paginationSize,offset:((null===(p=O.current)||void 0===p?void 0:p.currentPage)-1||0)*((null===(f=O.current)||void 0===f?void 0:f.pageSize)||s.C1.paginationSize),orderBy:(0,a.c)(null===(g=O.current)||void 0===g||null===(m=g.sort)||void 0===m||null===(y=m.item)||void 0===y?void 0:y.replace(/ORDER/i,null===(v=O.current)||void 0===v?void 0:v.sort.order))||P}),initialSort:j,ref:O}}},34770:function(e,t,r){"use strict";r.d(t,{s:function(){return n},c:function(){return o}});var n=function(e){try{JSON.parse(e)}catch(t){return!1}return!0},o=function(e){try{return JSON.parse(e)}catch(t){return!1}}},97999:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return R}});var n,o,i=r(66918),s=r(67294),a=r(93633),c=r(52209),u=r(54397),l=(0,u.Ps)(n||(n=(0,c.Z)(['\n  query GetSensors($limit: Int, $offset: Int, $orderBy: Asset_order_by!) {\n    sensors: Asset(\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n      where: { status: { _eq: "active" }, Category: { meta: { _has_key: "sensor" } } }\n    ) {\n      id\n      name\n      type: customFields(path: "Type")\n      status\n      meters: AssetMeters {\n        id\n        name\n      }\n      lastLog: AssetLogs(limit: 1, order_by: { id: desc }) {\n        id\n        eventTime\n        type\n        value\n      }\n    }\n  }\n']))),d=(0,u.Ps)(o||(o=(0,c.Z)(["\n  mutation AddAssetLog($objects: [AssetLog_insert_input!]!) {\n    insert_AssetLog(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),p=r(80880),f=r(18944),g=r(18862),m=r(64509),y=r(80284),v=r(81185),b=r(49705),j=r(80318),O=r(75709),h=r(11417),P=r(22796),w=r(92809),x=r(30266),S=r(64687),Z=r.n(S),D=r(42283),I=r(97202),C=r(65375),E=r(84550),_=r(66805),k=r(76800),T=r(85893);function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){(0,w.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var M=function(e){var t=e.addAssetLog,r=e.assetId,n=e.assetMeterId,o=(0,D.cI)({defaultValues:{eventTime:new Date}}),i=o.control,s=o.errors,a=o.handleSubmit,c={control:i,errors:s,register:o.register},u=function(){var e=(0,x.Z)(Z().mark((function e(o){return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.assetId=r,o.type="motionDetected",o.value=String("yes"===o.occupied),o.assetMeterId=n,delete o.occupied,e.next=7,t({variables:{objects:[o]}});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,T.jsxs)(I.Z,{handleSubmit:a(u),children:[(0,T.jsx)(C.Z,{label:"Event Time",children:(0,T.jsx)(k.M,z(z({},c),{},{dateFormat:"d MMM yyyy HH:mm",name:"eventTime",showTimeSelect:!0,todayButton:!1}))}),(0,T.jsx)(C.Z,{label:"",children:(0,T.jsx)(E.Z,z(z({},c),{},{name:"occupied",data:[{label:"occupied",key:"occupied",value:"yes"}]}))}),(0,T.jsx)(_.H,{content:"Update",type:"submit"})]})},A=r(71247);function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){(0,w.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var $=function(e){var t=e.addAssetLog,r=e.assetId,n=e.assetMeterId,o=(0,D.cI)({defaultValues:{eventTime:new Date}}),i=o.control,s=o.errors,a=o.handleSubmit,c={control:i,errors:s,register:o.register},u=function(){var e=(0,x.Z)(Z().mark((function e(o){return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.assetId=r,o.type="temperature",o.assetMeterId=n,e.next=5,t({variables:{objects:[o]}});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,T.jsxs)(I.Z,{handleSubmit:a(u),children:[(0,T.jsx)(C.Z,{label:"Event Time",children:(0,T.jsx)(k.M,N(N({},c),{},{dateFormat:"d MMM yyyy HH:mm",name:"eventTime",showTimeSelect:!0,todayButton:!1}))}),(0,T.jsx)(C.Z,{label:"Temperature",children:(0,T.jsx)(A.Z,N(N({},c),{},{name:"value",type:"number"}))}),(0,T.jsx)(_.H,{content:"Update",type:"submit"})]})},F=function(e){var t=e.offCanvas,r=e.row,n=(0,O.D)(d,{onCompleted:function(){t.close()}}),o=(0,j.Z)(n,1)[0];return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(h.Z,{tag:"h3",content:r.name,noMargin:!0}),(0,T.jsx)(f.Z,{children:r.type}),(0,T.jsx)(P.Z,{}),"occupancy"===r.type&&(0,T.jsx)(M,{addAssetLog:o,assetId:r.id,assetMeterId:r.meterId,type:r.type}),"thermo"===r.type&&(0,T.jsx)($,{addAssetLog:o,assetId:r.id,assetMeterId:r.meterId,type:r.type})]})},B=function(){var e=(0,b.x)({filters:{}}),t=e.initialData,r=e.ref,n=(0,s.useContext)(p.Z),o=(0,a.a)(l,{variables:t}).data,i=(o=void 0===o?{sensors:[],meta:{aggregate:{totalCount:0}}}:o).sensors,c=[{text:"AssetId"},{text:"Name"},{text:"Type"},{text:"State"},{formatter:function(e){var t=e.row;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(f.Z,{children:[" ",t.lastLog," "]}),t.lastLogTime&&(0,T.jsx)(f.Z,{size:"sm",children:"".concat((0,g.Z)(t.lastLogTime)," ").concat((0,m.Z)(t.lastLogTime))})]})},text:"Current Value"},{hidden:!0},{hidden:!0}];return(0,T.jsx)(y.Z,{fitParentHeight:!0,open:!0,title:"Sensors",children:(0,T.jsx)(v.t,{columns:c,loading:!1,pagination:!1,ref:r,rowClick:function(e){n.show({content:(0,T.jsx)(F,{offCanvas:n,row:e}),submit:!1,title:"Emulator"})},rows:i.map((function(e){return{id:e.id,name:e.name,type:e.type,status:e.status,lastLog:e.lastLog[0]&&e.lastLog[0].value,lastLogTime:e.lastLog[0]&&e.lastLog[0].eventTime,meterId:e.meters[0]&&e.meters[0].id}}))})})},R=function(){return(0,T.jsx)(i.Z,{pageHeading:{heading:"Emulator"},children:(0,T.jsx)(B,{})})}},73474:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/emulator",function(){return r(97999)}])}},function(e){e.O(0,[284,4195,5312,7287,2002,3086,1265,7627,9774,2888,179],(function(){return t=73474,e(e.s=t);var t}));var t=e.O();_N_E=t}]);