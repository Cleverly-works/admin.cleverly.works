(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1312],{34041:function(n,t,e){"use strict";e.d(t,{Z:function(){return A}});var i,o=e(45697),r=e(11163),a=e(80284),c=e(92743),u=e(67294),l=e(93633),d=e(52209),s=(0,e(54397).Ps)(i||(i=(0,d.Z)(["\n  query GetSupplierCompliance(\n    $adminId: Int\n    $entity: String\n    $gteNow: date\n    $ltNow: date\n    $limit: Int\n    $offset: Int!\n  ) {\n    complianceEntity: Compliance_Entity(\n      limit: $limit\n      offset: $offset\n      where: {\n        entity: { _eq: $entity }\n        _and: [{ expiryAt: { _gte: $gteNow } }, { expiryAt: { _lt: $ltNow } }]\n        Compliance: { adminId: { _eq: $adminId } }\n      }\n      order_by: { expiryAt: asc }\n    ) {\n      id\n      createdAt\n      entity\n      entityId\n      expiryAt\n      regNum\n      insuranceAmount\n      compliance: Compliance {\n        id\n        type\n        name\n        status\n        hasInsuranceAmount\n        regNumExample\n      }\n      account: Account {\n        id\n        name\n        status\n      }\n      location: Location {\n        id\n        name\n        status\n      }\n    }\n    meta: Compliance_Entity_aggregate(\n      where: {\n        entity: { _eq: $entity }\n        _and: [{ expiryAt: { _gte: $gteNow } }, { expiryAt: { _lt: $ltNow } }]\n        Compliance: { adminId: { _eq: $adminId } }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),m=e(80880),p=e(91126),f=e(81185),x=e(50899),g=e(48213),v=e(1323),y=e(49705),h=e(85893),_=new Date,w=function(n){var t=n.mode,e=n.entity,i=(0,u.useContext)(m.Z),o=(0,v.x)().user,r=null,a=null;"upcoming"===t?r=_:"expired"===t&&(a=_);var c,d={adminId:o.accountId,entity:e,gteNow:r,ltNow:a},w=(0,y.x)({filters:d,initialSort:{item:"expiryAt",order:"asc"}}),A=w.initialData,N=w.ref,C=(0,l.a)(s,{variables:A}),I=C.loading,Z=C.refetch,E=C.data,j=(E=void 0===E?{complianceEntity:[],meta:{aggregate:{totalCount:0}}}:E).complianceEntity,$=E.meta,b=[{hidden:!0},{hidden:!0},{text:"Name"},{text:"Account",hidden:"Account"!==e},{text:"Location",hidden:"Location"!==e},{text:"Registration number"},{formatter:g.FT,text:"Expiry date"},{text:"Status",hidden:"Account"!==e,sortable:!0,sortName:'{"Account": {"status": "ORDER"}}'},{text:"Status",hidden:"Location"!==e,sortable:!0,sortName:'{"Location": {"status": "ORDER"}}'},{formatter:p.Z,formatterData:(c={mediaClick:function(n,t){return function(n){i.show({content:(0,h.jsx)(x.G,{entity:"Compliance_Entity",entityId:null===n||void 0===n?void 0:n.id}),submit:!1,title:"Media"})}(t)}},[{context:"info",icon:["fas","file-upload"],onClick:c.mediaClick,tooltip:"Media"}]),text:"Actions"}];return(0,h.jsx)(f.t,{columns:b,loading:I,meta:$,ref:N,refetch:Z,rows:j.map((function(n){var t,e,i,o,r,a,c;return{id:n.id,complianceId:{label:null===(t=n.compliance)||void 0===t?void 0:t.name,value:null===(e=n.compliance)||void 0===e?void 0:e.id},name:null===(i=n.compliance)||void 0===i?void 0:i.name,account:null===(o=n.account)||void 0===o?void 0:o.name,location:null===(r=n.location)||void 0===r?void 0:r.name,regNum:n.regNum,expiryAt:n.expiryAt,statusAccount:null===(a=n.account)||void 0===a?void 0:a.status,statusLocation:null===(c=n.location)||void 0===c?void 0:c.status,actions:""}}))})};w.propTypes={entity:o.string};var A=function(n){var t=n.entity,e=(0,r.useRouter)().query;return(0,h.jsx)(a.Z,{fitParentHeight:!0,open:!0,title:"Compliances",children:(0,h.jsxs)(c.Z,{children:[(0,h.jsx)("div",{active:"expired"===e.tab||!e.tab,label:"Expired",children:(0,h.jsx)(w,{entity:t,mode:"expired"})}),(0,h.jsx)("div",{active:"upcoming"===e.tab,label:"Upcoming",children:(0,h.jsx)(w,{entity:t,mode:"upcoming"})})]})})}},37834:function(n,t,e){"use strict";e.d(t,{r:function(){return o}});var i=e(94673),o=function(n){return(0,i.Z)(new Date(n),new Date)}},7917:function(n,t,e){"use strict";e.d(t,{O:function(){return i}});var i=function(n){return n?new Date(n):new Date}},48213:function(n,t,e){"use strict";e.d(t,{CV:function(){return d},iU:function(){return s},DT:function(){return m},JB:function(){return v},Bo:function(){return y},kW:function(){return h},FT:function(){return w}});var i=e(24237),o=e(18944),r=e(18862),a=e(7720),c=e(37834),u=e(7917),l=e(85893),d=function(n){var t=(0,u.O)(),e=n.filter((function(n){return(0,u.O)(n.expiryAt)>=t})).length;return parseInt(e/n.length*100)},s=function(n){if(!n||0===n.length)return null;var t=(0,u.O)(),e=n.filter((function(n){return(0,u.O)(n.expiryAt)>=t})).length;return parseInt(e/n.length*100)||null},m=function(n){var t=n.row.compliancesList;if(!t||0===t.length)return null;var e=d(t);return(0,l.jsxs)(x,{children:[(0,l.jsx)(f,{content:"".concat(t.length," : ").concat(e.toString(),"%"),context:h(e),size:"sm"}),p(t)]})},p=function(n){var t=n.find((function(n){(0,c.r)(n.expiryAt);return n}));return t&&(0,l.jsxs)(g,{children:[(0,l.jsx)(o.Z,{content:(0,r.Z)(t.expiryAt),context:_(t.expiryAt),size:"sm"}),(0,l.jsx)(o.Z,{content:t.compliance.name,size:"sm"})]})},f=(0,i.ZP)(a.Z).withConfig({displayName:"helper__StyledBadge",componentId:"sc-1rrgcna-0"})(["margin:0;"]),x=i.ZP.div.withConfig({displayName:"helper__Wrapper",componentId:"sc-1rrgcna-1"})(["align-items:center;display:flex;"]),g=i.ZP.div.withConfig({displayName:"helper__Next",componentId:"sc-1rrgcna-2"})(["flex-direction:column;margin-left:1rem;"]),v=function(n){return n.filter((function(n){return(0,c.r)(n.expiryAt)<0})).length},y=function(n){var t;if(!n||0===n.length||!n.nodes||n.nodes&&0===(null===(t=n.nodes)||void 0===t?void 0:t.length))return{content:"No locations",context:"secondary"};var e=[];(n.nodes||n).forEach((function(n){var t,i;(null!==(t=n.location)&&void 0!==t&&t.compliance||n.compliances)&&e.push(d((null===(i=n.location)||void 0===i?void 0:i.compliance)||n.compliances))}));var i=Math.round(e.reduce((function(n,t){return isNaN(t)&&(t=0),n+t}),0)/e.length);return{content:"Score: ".concat(i||0," %"),context:h(i)}},h=function(n){return n>79?"success":n>49?"info":"danger"},_=function(n){var t=(0,c.r)(n);return t>14?"success":t>=0?"info":"danger"},w=function(n){var t=n.row;if(t.expiryAt)return(0,l.jsx)(o.Z,{content:(0,r.Z)(t.expiryAt),context:_(t.expiryAt),size:"sm"})}},71765:function(n,t,e){"use strict";e.r(t);var i=e(66918),o=e(34041),r=e(85893);t.default=function(){return(0,r.jsx)(i.Z,{pageHeading:{heading:"Location Compliance"},View:(0,r.jsx)(o.Z,{entity:"Location"})})}},33826:function(n,t,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/compliance/location",function(){return e(71765)}])}},function(n){n.O(0,[284,4195,5312,7287,2002,3086,7134,3486,4712,1265,6996,9666,8629,899,9774,2888,179],(function(){return t=33826,n(n.s=t);var t}));var t=n.O();_N_E=t}]);