(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8978],{61131:function(e,n,t){"use strict";t.d(n,{z:function(){return P}});var r=t(92809),i=t(30266),a=t(80318),o=t(64687),c=t.n(o),s=t(75709),u=t(33434),l=t(42283),d=t(79665),p=t(97202),m=t(65375),f=t(71247),g=t(83528),y=t(84550),b=t(46482),j=t(1323),h=t(75838),x=t(72197),v=t(19501),O=(0,v.Ry)().shape({name:(0,v.Z_)().required(),status:(0,v.Z_)().oneOf(["active","inactive"]).required(),complianceCategorySelected:(0,v.Ry)().required(),url:(0,v.Z_)().url()}),C=function(e){var n=e.form,t=e.id,r=e.user;return n.categoryId=n.complianceCategorySelected.value,delete n.complianceCategorySelected,t?{id:t,changes:n}:(n.adminId=r.accountId,{objects:[n]})},_=t(85893);function Z(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function w(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Z(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Z(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var P=function(e){var n=e.defaultValues,t=e.onSuccess,r=(0,j.x)().user,o=(0,l.cI)({defaultValues:n,resolver:(0,d.S)(O)}),v=o.control,Z=o.errors,P=o.handleSubmit,S=o.register,$=(0,s.D)(u.gO,{onCompleted:function(e){var n=e.insert_Compliance.returning[0].id;t&&t(n)}}),k=(0,a.Z)($,1)[0],D=(0,s.D)(u.Vd,{onCompleted:function(e){var n=e.update_Compliance_by_pk.id;t&&t(n)}}),E=(0,a.Z)(D,1)[0],q=function(){var e=(0,i.Z)(c().mark((function e(t){var i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=C({form:t,id:n.id,user:r}),!n.id){e.next=6;break}return e.next=4,E({variables:i});case 4:e.next=8;break;case 6:return e.next=8,k({variables:i});case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),I={control:v,errors:Z,register:S};return(0,_.jsxs)(p.Z,{id:"offCanvasForm",handleSubmit:P(q),children:[(0,_.jsx)(m.Z,{label:"Name",children:(0,_.jsx)(f.Z,w(w({},I),{},{name:"name"}))}),(0,_.jsx)(x.l,w(w({},I),{},{label:"Category",name:"complianceCategorySelected",type:"complianceCategory"})),(0,_.jsx)(m.Z,{label:"Description",children:(0,_.jsx)(g.Z,w(w({},I),{},{name:"description",rows:2}))}),(0,_.jsx)(m.Z,{label:"Governing Body",children:(0,_.jsx)(f.Z,w(w({},I),{},{name:"governingBody"}))}),(0,_.jsx)(m.Z,{label:"Registration number example",children:(0,_.jsx)(f.Z,w(w({},I),{},{name:"regNumExample"}))}),(0,_.jsx)(m.Z,{label:"URL",children:(0,_.jsx)(f.Z,w(w({},I),{},{name:"url"}))}),(0,_.jsx)(y.Z,w(w({},I),{},{data:[{id:"hasInsuranceAmount",label:"Has Insurance Amount Attached"}],name:"hasInsuranceAmount"})),(0,_.jsx)(y.Z,w(w({},I),{},{data:[{id:"expectCertificate",label:"Expect Certificate"}],name:"expectCertificate"})),(0,_.jsx)(m.Z,{label:"Status",children:(0,_.jsx)(b.Z,w(w({},I),{},{name:"status",options:h.bg}))})]})}},33434:function(e,n,t){"use strict";t.d(n,{$i:function(){return u},G1:function(){return l},gO:function(){return d},Vd:function(){return p}});var r,i,a,o,c=t(52209),s=t(54397),u=(0,s.Ps)(r||(r=(0,c.Z)(["\n  query GetCompliace($id: Int!) {\n    compliance: Compliance_by_pk(id: $id) {\n      id\n      name\n      url\n      regNumExample\n      status\n      type\n      governingBody\n      hasInsuranceAmount\n      description\n      createdAt\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      Compliance_Entities {\n        Location {\n          id\n          name\n          status\n        }\n        Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]))),l=(0,s.Ps)(i||(i=(0,c.Z)(['\n  query GetCompliances(\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Compliance_order_by!\n    $status: String\n    $type: String\n  ) {\n    compliance: Compliance(\n      limit: $limit\n      offset: $offset\n      where: { name: { _ilike: $q }, status: { _eq: $status }, type: { _eq: $type } }\n      order_by: [$orderBy]\n    ) {\n      id\n      name\n      description\n      status\n      regNumExample\n      hasInsuranceAmount\n      expectCertificate\n      url\n      governingBody\n      createdAt\n      category: Category {\n        id\n        name\n      }\n      questions: Taxonomies {\n        id\n      }\n      media: Media(where: { entity: { _eq: "Compliance" } }) {\n        mediaId\n      }\n    }\n    meta: Compliance_aggregate(\n      where: { name: { _ilike: $q }, status: { _eq: $status }, type: { _eq: $type } }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),d=(0,s.Ps)(a||(a=(0,c.Z)(["\n  mutation AddCompliance($objects: [Compliance_insert_input!]!) {\n    insert_Compliance(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),p=(0,s.Ps)(o||(o=(0,c.Z)(["\n  mutation UpdateCompliance($id: Int!, $changes: Compliance_set_input) {\n    update_Compliance_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"])))},57198:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return N}});var r=t(66918),i=t(70316),a=t(92809),o=t(67294),c=t(11163),s=t(93633),u=t(33434),l=t(80880),d=t(91126),p=t(18862),m=t(73165),f=t(58448),g=t(14347),y=t(80284),b=t(81185),j=t(61131),h=t(64152),x=t(49705),v=t(85893);function O(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}var C={item:"name",order:"asc"},_=function(e){var n=e.filters,t=(0,x.x)({filters:n,initialSort:C}),r=t.initialData,i=t.ref,_=(0,o.useContext)(l.Z),Z=(0,s.a)(u.G1,{variables:r}),w=Z.data,P=(w=void 0===w?{compliance:[],meta:{aggregate:{totalCount:0}}}:w).compliance,S=w.meta,$=Z.loading,k=Z.refetch,D=function(){k(),_.close()},E=function(e,n){e.stopPropagation();var t={};n?(t=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?O(Object(t),!0).forEach((function(n){(0,a.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},n.item)).complianceCategorySelected={label:n.item.category.name,value:n.item.category.id}:t.status="active",_.show({content:(0,v.jsx)(j.z,{defaultValues:t,onSuccess:D}),title:t.id?"Edit":"Add Compliance"})},q=[{context:"secondary",icon:["fas","edit"],onClick:function(e,n){return E(e,n)},tooltip:"Edit"},{context:"info",icon:["fas","question"],numberOverlay:"childCount",onClick:function(e,n){return function(e,n){_.show({content:(0,v.jsx)(h.R,{defaultValues:n,entity:"Compliance",entityId:n.id,groups:{},parentId:n.id,refetchCompliance:k,type:"complianceQuestions"}),submit:!1,title:"Questions"}),e.stopPropagation()}(e,n)},tooltip:"Manage Questions"}],I=[{hidden:!0},{sortable:!0,sortName:"name",text:"Name"},{text:"Category"},{hidden:!0},{text:"Date"},{text:"Status"},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:d.Z,formatterData:q,text:"Actions"}],A=function(){return(0,v.jsx)(f.Z,{children:(0,v.jsx)(g.Z,{context:"secondary",content:"Add New",onClick:E,size:"sm"})})};return(0,v.jsx)(y.Z,{open:!0,title:"Compliance",toolbar:(0,v.jsx)(A,{}),children:(0,v.jsx)(b.t,{columns:I,initialSort:C,loading:$,meta:S,ref:i,refetch:k,rowClick:function(e){c.default.push("".concat("/dashboard/compliance/","view?id=").concat(e.id))},rows:P.map((function(e){var n,t;return{id:e.id,name:e.name,categoryName:e.category.name,description:e.description,date:(0,p.Z)(e.createdAt),status:(0,m.Z)(e.status),mediaCount:(null===(n=e.media)||void 0===n?void 0:n.length)||null,childCount:(null===(t=e.questions)||void 0===t?void 0:t.length)||null,item:e,actions:""}}))})})},Z=t(78215),w=t(2356),P=t(46482),S=t(69399),$=[{text:"Type",value:""},{text:"Regulatory",value:"regulatory"},{text:"SSIP",value:"ssip"}],k=t(75838);function D(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function E(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?D(Object(t),!0).forEach((function(n){(0,a.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):D(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var q=function(e){var n=e.errors,t=e.register,r=e.setFilters,i={errors:n,register:t};return(0,v.jsxs)(Z.Z,{children:[(0,v.jsx)(w.Z,{md:6,children:(0,v.jsx)(P.Z,E(E({},i),{},{name:"type",onChange:function(e){return r((function(n){return E(E({},n),{},{type:e.target.value||null})}))},options:$}))}),(0,v.jsx)(w.Z,{md:6,children:(0,v.jsx)(S.r,E(E({},i),{},{onChange:function(e){return r((function(n){return E(E({},n),{},{status:e.target.value||null})}))},options:k.bg}))})]})},I={q:null,status:null,type:null,filterType:"compliance_table"},A=function(){return(0,v.jsx)(i.J,{FiltersComp:q,initialFilters:I,TableComp:_})},N=function(){return(0,v.jsx)(r.Z,{pageHeading:{heading:"Compliance"},View:(0,v.jsx)(A,{})})}},72995:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/compliance",function(){return t(57198)}])}},function(e){e.O(0,[284,4195,5312,7287,2002,3086,7134,3486,9082,3515,4712,7431,9662,2186,9774,2888,179],(function(){return n=72995,e(e.s=n);var n}));var n=e.O();_N_E=n}]);