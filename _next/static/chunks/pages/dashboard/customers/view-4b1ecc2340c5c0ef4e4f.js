(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8971,5146,6433],{93443:function(e,n,t){"use strict";var r=t(67294),o=t(45697),i=t(22796),a=t(18944),s=function(e){var n=e.content,t=e.text;return r.createElement(r.Fragment,null,r.createElement(i.Z,{marginBottom:"sm"}),r.createElement(a.Z,{content:n,context:"dark",size:"sm"}),r.createElement(a.Z,null,t))};s.propTypes={content:o.string.isRequired,text:(0,o.oneOfType)([o.node,o.string]).isRequired},n.Z=s},12757:function(e,n,t){"use strict";var r=t(67294),o=t(45697),i=t(71247),a=t(65375),s=t(44442),c=t(21269),u=function(e){var n=e.errors,t=e.label,o=e.name,u=e.register,d=e.show,l=e.symbol;return r.createElement(a.Z,{show:d,label:t},r.createElement(s.Z,null,r.createElement(i.Z,{errors:n,name:o,register:u,step:"any",type:"number"}),r.createElement(c.Z,{addonType:"append",text:!0},l)))};u.displayName="PercentInput",u.propTypes={errors:o.object.isRequired,label:o.string.isRequired,name:o.string.isRequired,register:o.func.isRequired,show:o.bool,symbol:(0,o.oneOfType)([o.object,o.string])},u.defaultProps={show:!0,symbol:"%"},n.Z=u},2350:function(e,n,t){"use strict";t.r(n);var r=t(87462),o=t(67294),i=t(24248),a=t(38485),s=function(e){return o.createElement(a.Z,(0,r.Z)({},e,{mainSize:24}),o.createElement("path",{d:"M5.57143 9.42857H3V3H9.42857V5.57143H5.57143V9.42857ZM3 14.5714H5.57143V18.4286H9.42857V21H3V14.5714ZM18.4285 18.4286H14.5714V21H21V14.5714H18.4285V18.4286ZM14.5714 5.57143V3H21V9.42857H18.4285V5.57143H14.5714Z"}))};s.displayName="FullScreenIcon",s.propTypes=i.Z,n.default=s},31689:function(e,n,t){"use strict";t.r(n);var r=t(87462),o=t(67294),i=t(24248),a=t(38485),s=function(e){return o.createElement(a.Z,(0,r.Z)({},e,{mainSize:20}),o.createElement("path",{d:"M10 0C4.47581 0 0 4.47581 0 10C0 15.5242 4.47581 20 10 20C15.5242 20 20 15.5242 20 10C20 4.47581 15.5242 0 10 0ZM14.6653 10.9677L7.56855 15.0403C6.93145 15.3952 6.12903 14.9395 6.12903 14.1935V5.80645C6.12903 5.06452 6.92742 4.60484 7.56855 4.95968L14.6653 9.27419C15.3266 9.64516 15.3266 10.6008 14.6653 10.9677Z"}))};s.displayName="PlayCircleIcon",s.propTypes=i.Z,n.default=s},14651:function(e,n,t){"use strict";var r=t(64836);n.Z=void 0;var o=r(t(64938)),i=t(85893),a=(0,o.default)((0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),"Brightness1");n.Z=a},13304:function(e,n,t){"use strict";var r=t(64836);n.Z=void 0;var o=r(t(64938)),i=t(85893),a=(0,o.default)((0,i.jsx)("path",{d:"M18 16v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-5 0h-2v-2h2v2zm0-4h-2V8h2v4zm-1 10c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2z"}),"NotificationImportant");n.Z=a},74385:function(e,n,t){"use strict";function r(e){return function(e,n){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var t in n=n||{})Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e}({},e)}t.d(n,{Z:function(){return r}})},49474:function(e,n,t){"use strict";t.d(n,{Z:function(){return i}});var r=t(19013),o=t(13882);function i(e,n){(0,o.Z)(2,arguments);var t=(0,r.Z)(e),i=(0,r.Z)(n),a=t.getTime()-i.getTime();return a<0?-1:a>0?1:a}},11699:function(e,n,t){"use strict";t.d(n,{Z:function(){return i}});var r=t(59910),o=t(13882);function i(e,n){(0,o.Z)(2,arguments);var t=(0,r.Z)(e,n)/1e3;return t>0?Math.floor(t):Math.ceil(t)}},43045:function(e,n,t){"use strict";t.d(n,{Z:function(){return h}});var r=t(49474),o=t(19013),i=t(13882);function a(e,n){(0,i.Z)(2,arguments);var t=(0,o.Z)(e),r=(0,o.Z)(n),a=t.getFullYear()-r.getFullYear(),s=t.getMonth()-r.getMonth();return 12*a+s}var s=t(83894),c=t(4135);function u(e){(0,i.Z)(1,arguments);var n=(0,o.Z)(e);return(0,s.Z)(n).getTime()===(0,c.Z)(n).getTime()}function d(e,n){(0,i.Z)(2,arguments);var t,s=(0,o.Z)(e),c=(0,o.Z)(n),d=(0,r.Z)(s,c),l=Math.abs(a(s,c));if(l<1)t=0;else{1===s.getMonth()&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-d*l);var m=(0,r.Z)(s,c)===-d;u((0,o.Z)(e))&&1===l&&1===(0,r.Z)(e,c)&&(m=!1),t=d*(l-Number(m))}return 0===t?0:t}var l=t(11699),m=t(21224),p=t(74385),f=t(24262),y=1440,v=43200;function b(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,i.Z)(2,arguments);var a=t.locale||m.Z;if(!a.formatDistance)throw new RangeError("locale must contain formatDistance property");var s=(0,r.Z)(e,n);if(isNaN(s))throw new RangeError("Invalid time value");var c,u,b=(0,p.Z)(t);b.addSuffix=Boolean(t.addSuffix),b.comparison=s,s>0?(c=(0,o.Z)(n),u=(0,o.Z)(e)):(c=(0,o.Z)(e),u=(0,o.Z)(n));var h,_=(0,l.Z)(u,c),g=((0,f.Z)(u)-(0,f.Z)(c))/1e3,I=Math.round((_-g)/60);if(I<2)return t.includeSeconds?_<5?a.formatDistance("lessThanXSeconds",5,b):_<10?a.formatDistance("lessThanXSeconds",10,b):_<20?a.formatDistance("lessThanXSeconds",20,b):_<40?a.formatDistance("halfAMinute",null,b):_<60?a.formatDistance("lessThanXMinutes",1,b):a.formatDistance("xMinutes",1,b):0===I?a.formatDistance("lessThanXMinutes",1,b):a.formatDistance("xMinutes",I,b);if(I<45)return a.formatDistance("xMinutes",I,b);if(I<90)return a.formatDistance("aboutXHours",1,b);if(I<y){var x=Math.round(I/60);return a.formatDistance("aboutXHours",x,b)}if(I<2520)return a.formatDistance("xDays",1,b);if(I<v){var $=Math.round(I/y);return a.formatDistance("xDays",$,b)}if(I<86400)return h=Math.round(I/v),a.formatDistance("aboutXMonths",h,b);if((h=d(u,c))<12){var j=Math.round(I/v);return a.formatDistance("xMonths",j,b)}var q=h%12,Z=Math.floor(h/12);return q<3?a.formatDistance("aboutXYears",Z,b):q<9?a.formatDistance("overXYears",Z,b):a.formatDistance("almostXYears",Z+1,b)}function h(e,n){return(0,i.Z)(1,arguments),b(e,Date.now(),n)}},69199:function(e,n,t){var r=t(89881),o=t(98612);e.exports=function(e,n){var t=-1,i=o(e)?Array(e.length):[];return r(e,(function(e,r,o){i[++t]=n(e,r,o)})),i}},82689:function(e,n,t){var r=t(29932),o=t(97786),i=t(67206),a=t(69199),s=t(71131),c=t(7518),u=t(85022),d=t(6557),l=t(1469);e.exports=function(e,n,t){n=n.length?r(n,(function(e){return l(e)?function(n){return o(n,1===e.length?e[0]:e)}:e})):[d];var m=-1;n=r(n,c(i));var p=a(e,(function(e,t,o){return{criteria:r(n,(function(n){return n(e)})),index:++m,value:e}}));return s(p,(function(e,n){return u(e,n,t)}))}},71131:function(e){e.exports=function(e,n){var t=e.length;for(e.sort(n);t--;)e[t]=e[t].value;return e}},26393:function(e,n,t){var r=t(33448);e.exports=function(e,n){if(e!==n){var t=void 0!==e,o=null===e,i=e===e,a=r(e),s=void 0!==n,c=null===n,u=n===n,d=r(n);if(!c&&!d&&!a&&e>n||a&&s&&u&&!c&&!d||o&&s&&u||!t&&u||!i)return 1;if(!o&&!a&&!d&&e<n||d&&t&&i&&!o&&!a||c&&t&&i||!s&&i||!u)return-1}return 0}},85022:function(e,n,t){var r=t(26393);e.exports=function(e,n,t){for(var o=-1,i=e.criteria,a=n.criteria,s=i.length,c=t.length;++o<s;){var u=r(i[o],a[o]);if(u)return o>=c?u:u*("desc"==t[o]?-1:1)}return e.index-n.index}},75472:function(e,n,t){var r=t(82689),o=t(1469);e.exports=function(e,n,t,i){return null==e?[]:(o(n)||(n=null==n?[]:[n]),o(t=i?void 0:t)||(t=null==t?[]:[t]),r(e,n,t))}},76585:function(e,n,t){"use strict";t.d(n,{z:function(){return i}});var r,o=t(52209),i=(0,t(54397).Ps)(r||(r=(0,o.Z)(["\n  fragment AccountFields on Account {\n    id\n    type\n    name\n    status\n    vatId\n  }\n"])))},48963:function(e,n,t){"use strict";t.d(n,{N:function(){return a}});var r=t(84550),o=t(85893),i=[{id:"assignedToMe",label:"Assigned to me",value:"assignedToMe"}],a=function(e){var n=e.data,t=e.errors,a=e.name,s=e.onChange,c=e.register;return(0,o.jsx)(r.Z,{errors:t,data:n||i,legend:"",name:a,onChange:s,register:c})};a.defaultProps={name:"assignedToMe"}},8163:function(e,n,t){"use strict";t.d(n,{t:function(){return r}});var r=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return[{context:"secondary",icon:["fas","edit"],onClick:n.onEditClick,to:"".concat(e,"manage"),tooltip:"Edit"}]}},24019:function(e,n,t){"use strict";t.d(n,{h:function(){return h}});var r=t(92809),o=t(67294),i=t(42593),a=t(78215),s=t(2356),c=t(65375),u=t(93515),d=t(83894),l=t(48963),m=t(76800),p=t(95146),f=t(1071),y=t(85893);function v(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function b(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?v(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var h=function(e){var n=e.initialValues,t=e.control,r=e.errors,v=e.register,h=e.setFilters,_=e.watch,g=e.setValue,I=e.show,x=e.reset,$=(0,o.useContext)(i.Z).hasRole,j={control:t,errors:r,register:v},q=_("customerId"),Z=_("locationId"),S=_("supplierId"),w=_("userId");return(0,o.useEffect)((function(){n.customerId||h((function(e){return b(b({},e),{},{customerId:"number"===typeof q?q:(null===q||void 0===q?void 0:q.value)||null})}))}),[q]),(0,o.useEffect)((function(){h((function(e){return b(b({},e),{},{locationId:"number"===typeof Z?Z:(null===Z||void 0===Z?void 0:Z.value)||null})}))}),[Z]),(0,o.useEffect)((function(){h((function(e){return b(b({},e),{},{supplierId:"number"===typeof S?S:(null===S||void 0===S?void 0:S.value)||null})}))}),[S]),(0,o.useEffect)((function(){h((function(e){return b(b({},e),{},{userId:"number"===typeof w?w:(null===w||void 0===w?void 0:w.value)||null})}))}),[w]),(0,o.useEffect)((function(){return function(){h(n),x(n)}}),[I]),(0,y.jsxs)(a.Z,{children:[(0,y.jsx)(s.Z,{md:6,children:(0,y.jsx)(c.Z,{label:null,children:(0,y.jsx)(u.Z,b(b({},j),{},{placeholder:"Select status",name:"status",isMulti:!0,onChange:function(e){var n=e.map((function(e){return e.value}));h((function(e){return b(b({},e),{},{status:n.length>0?n:null})})),h((function(e){return b(b({},e),{},{isChangedStatusSelect:!0})})),g("status",e),e.length||h((function(e){return b(b({},e),{},{isChangedStatusSelect:!1})}))},options:(0,f.lR)(I)}))})}),$("supplier")&&(0,y.jsx)(s.Z,{md:6,children:(0,y.jsx)(p.P,b(b({},j),{},{errors:b({},r),label:"",userId:n.userId,name:"userId",placeholder:"Select user",type:"user"}))}),!n.customerId&&$("admin")&&(0,y.jsx)(s.Z,{md:6,children:(0,y.jsx)(p.P,b(b({},j),{},{errors:b({},r),label:"",name:"customerId",placeholder:"Select customer",type:"customer"}))}),$("admin")&&(0,y.jsx)(s.Z,{md:6,children:(0,y.jsx)(p.P,b(b({},j),{},{errors:b({},r),label:"",accountId:n.customerId,name:"locationId",placeholder:"Select location",type:"property"}))}),$("admin")&&(0,y.jsx)(s.Z,{md:6,children:(0,y.jsx)(p.P,b(b({},j),{},{errors:b({},r),label:"",name:"supplierId",placeholder:"Select supplier",type:"supplier"}))}),(0,y.jsx)(s.Z,{md:12,children:(0,y.jsxs)(a.Z,{children:[(0,y.jsx)(s.Z,{md:6,children:(0,y.jsx)(m.M,b(b({},j),{},{name:"startDate",onChange:function(e){h((function(n){return b(b({},n),{},{startDate:e||null})})),g("startDate",e)},placeholder:"Start date"}))}),(0,y.jsx)(s.Z,{md:6,children:(0,y.jsx)(m.M,b(b({},j),{},{name:"endDate",onChange:function(e){var n=e?(0,d.Z)(e):e;h((function(e){return b(b({},e),{},{endDate:n})})),g("endDate",n)},placeholder:"End date"}))})]})}),!n.noAssignToMeFilter&&(0,y.jsx)(s.Z,{md:12,children:(0,y.jsx)(l.N,b(b({},j),{},{name:"managerId",onChange:function(e){return h((function(n){return b(b({},n),{},{managerId:e.target.checked})}))}}))})]})}},1071:function(e,n,t){"use strict";t.d(n,{fI:function(){return Z},lR:function(){return w},Uu:function(){return S}});var r,o,i,a,s,c=t(80318),u=t(92809),d=t(52209),l=t(54397),m=t(38478),p=t(76585),f=t(88402),y=t(27834),v=(0,l.Ps)(r||(r=(0,d.Z)(['\n  query GetJobs(\n    $endDate: timestamptz\n    $number: String\n    $limit: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $q: String\n    $startDate: timestamptz\n    $status: [String!]\n    $type: String\n    $userId: Int\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n          { _or: [{ number: { _eq: $number } }, { Invoices: { invoiceNumber: { _eq: $number } } }] }\n        ]\n        status: { _in: $status }\n        type: { _eq: $type }\n        supplierUserId: { _eq: $userId }\n      }\n      order_by: [$orderBy]\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n      }\n      ...JobFields\n      ...JobSupplierFields\n      admin: Admin {\n        id\n        name\n      }\n      location: Location {\n        id\n        name\n      }\n      invoices: Invoices {\n        invoiceNumber\n      }\n      service: Service {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      sla: SLA {\n        id\n        name\n      }\n      supplierOffers: SupplierOffers {\n        id\n        status\n        rate\n        dayRate\n        notes\n        account: Supplier {\n          id\n          type\n          name\n        }\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n          { _or: [{ number: { _eq: $number } }, { Invoices: { invoiceNumber: { _eq: $number } } }] }\n        ]\n        status: { _in: $status }\n        type: { _eq: $type }\n        supplierUserId: { _eq: $userId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n  ","\n  ","\n"])),m.aL,m.H_,y.Px),b=(0,l.Ps)(o||(o=(0,d.Z)(['\n  query GetJobs(\n    $endDate: timestamptz\n    $number: String\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Job_order_by!\n    $startDate: timestamptz\n    $status: [String!]\n    $type: [String!]\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n          { _or: [{ number: { _eq: $number } }, { Invoices: { invoiceNumber: { _eq: $number } } }] }\n        ]\n        status: { _in: $status }\n        type: { _in: $type }\n      }\n      order_by: [$orderBy]\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n      }\n      ...JobFields\n      ...JobSupplierFields\n      admin: Admin {\n        id\n        name\n      }\n      location: Location {\n        id\n        name\n      }\n      invoices: Invoices {\n        invoiceNumber\n      }\n      service: Service {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      sla: SLA {\n        id\n        name\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n          { _or: [{ number: { _eq: $number } }, { Invoices: { invoiceNumber: { _eq: $number } } }] }\n        ]\n        status: { _in: $status }\n        type: { _in: $type }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n  ","\n  ","\n"])),m.aL,m.H_,y.Px),h=(0,l.Ps)(i||(i=(0,d.Z)(['\n  query GetJobs(\n    $assetId: Int\n    $customerId: Int\n    $endDate: timestamptz\n    $number: String\n    $meta: jsonb\n    $limit: Int\n    $locationId: Int\n    $managerId: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $paid: Boolean\n    $type: [String!]\n    $q: String\n    $startDate: timestamptz\n    $status: [String!]\n    $supplierId: Int\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n          {\n            _or: [\n              { number: { _eq: $number } }\n              { meta: { _contains: $meta } }\n              { Invoices: { invoiceNumber: { _eq: $number } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        assetId: { _eq: $assetId }\n        status: { _in: $status }\n        type: { _in: $type }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        paid: { _eq: $paid }\n        supplierId: { _eq: $supplierId }\n      }\n      order_by: [$orderBy]\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n      }\n      ...JobFields\n      ...JobAdminFields\n      invoices: Invoices {\n        invoiceNumber\n      }\n      admin: Admin {\n        id\n        name\n      }\n      customer: Customer {\n        ...AccountFields\n      }\n      location: Location {\n        id\n        name\n      }\n      manager: Manager {\n        ...UserFields\n      }\n      service: Service {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      sla: SLA {\n        id\n        name\n      }\n      supplier: Supplier {\n        ...AccountFields\n      }\n      supplierOffers: SupplierOffers {\n        status\n        rate\n        supplier: Supplier {\n          ...AccountFields\n        }\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n          {\n            _or: [\n              { number: { _eq: $number } }\n              { meta: { _contains: $meta } }\n              { Invoices: { invoiceNumber: { _eq: $number } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        assetId: { _eq: $assetId }\n        status: { _in: $status }\n        type: { _in: $type }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        supplierId: { _eq: $supplierId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n  ","\n  ","\n  ","\n  ","\n"])),p.z,f.WW,m.aL,m.wd,y.Px),_=(0,l.Ps)(a||(a=(0,d.Z)(['\n  query GetDashboardList(\n    $accountId: Int\n    $customerId: Int\n    $supplierId: Int\n    $locationId: Int\n    $managerId: Int\n    $adminId: Int\n    $startDate: timestamptz\n    $endDate: timestamptz\n    $asAt: timestamptz\n    $jobHoldReasonId: Int\n    $limit: Int\n    $monthStart: timestamptz\n    $offset: Int\n    $orderBy: dashboard_home_details_order_by!\n    $q: String\n    $tileName: String\n    $dayStart: timestamptz\n    $userId: Int\n    $yearStart: timestamptz\n    $number: String\n    $status: [String!]\n    $type: String\n  ) {\n    jobs: getDashboard_HomeTile_Details(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        number: { _eq: $number }\n        status: { _in: $status }\n        type: { _eq: $type }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        supplierId: { _eq: $supplierId }\n      }\n      order_by: [$orderBy]\n      limit: $limit\n      offset: $offset\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n        __typename\n      }\n      ...JobFields\n      ...JobAdminFields\n      admin: Admin {\n        id\n        name\n        __typename\n      }\n      customer: Customer {\n        ...AccountFields\n        __typename\n      }\n      location: Location {\n        id\n        name\n        __typename\n      }\n      job: Job {\n        status\n      }\n      manager: Manager {\n        ...UserFields\n        __typename\n      }\n      service: Service {\n        id\n        name\n        __typename\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n          __typename\n        }\n        __typename\n      }\n      sla: SLA {\n        id\n        name\n        __typename\n      }\n      supplier: Supplier {\n        ...AccountFields\n        __typename\n      }\n      supplierOffers: SupplierOffers {\n        status\n        rate\n        supplier: Supplier {\n          ...AccountFields\n          __typename\n        }\n        __typename\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n          __typename\n        }\n        __typename\n      }\n      id: jobId\n      number\n      # location\n      priority\n      scheduledAt\n      assignedTo\n      jobHoldReason\n      locationId\n      meta\n      managerId\n      description\n      customerName\n      customerId\n      reference\n      serviceName\n      status\n      supplierId\n      supplierName\n      timingStart\n      type\n      quoteNumber\n      quoteDue\n      createdAt\n    }\n    meta: getDashboard_HomeTile_Details_aggregate(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n        number: { _eq: $number }\n        status: { _in: $status }\n        type: { _eq: $type }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        supplierId: { _eq: $supplierId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n        __typename\n      }\n      __typename\n    }\n  }\n  ',"\n  ","\n  ","\n  ","\n  ","\n"])),p.z,f.WW,m.aL,m.wd,y.Px),g=(0,l.Ps)(s||(s=(0,d.Z)(['\n  query GetDashboardList(\n    $accountId: Int\n    $adminId: Int\n    $asAt: timestamptz\n    $jobHoldReasonId: Int\n    $limit: Int\n    $monthStart: timestamptz\n    $offset: Int\n    $orderBy: dashboard_home_details_order_by!\n    $q: String\n    $tileName: String\n    $dayStart: timestamptz\n    $userId: Int\n    $yearStart: timestamptz\n  ) {\n    jobs: getDashboard_HomeTile_Details(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n      }\n      order_by: [$orderBy]\n      limit: $limit\n      offset: $offset\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n        __typename\n      }\n      ...JobFields\n      ...JobAdminFields\n      admin: Admin {\n        id\n        name\n        __typename\n      }\n      customer: Customer {\n        ...AccountFields\n        __typename\n      }\n      location: Location {\n        id\n        name\n        __typename\n      }\n      manager: Manager {\n        ...UserFields\n        __typename\n      }\n      service: Service {\n        id\n        name\n        __typename\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n          __typename\n        }\n        __typename\n      }\n      sla: SLA {\n        id\n        name\n        __typename\n      }\n      supplier: Supplier {\n        ...AccountFields\n        __typename\n      }\n      supplierOffers: SupplierOffers {\n        status\n        rate\n        supplier: Supplier {\n          ...AccountFields\n          __typename\n        }\n        __typename\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n          __typename\n        }\n        __typename\n      }\n      id: jobId\n      number\n      # location\n      priority\n      scheduledAt\n      assignedTo\n      jobHoldReason\n      locationId\n      meta\n      managerId\n      description\n      customerName\n      customerId\n      reference\n      serviceName\n      status\n      supplierId\n      supplierName\n      timingStart\n      type\n      quoteNumber\n      quoteDue\n      createdAt\n    }\n    meta: getDashboard_HomeTile_Details_aggregate(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n      }\n    ) {\n      aggregate {\n        totalCount: count\n        __typename\n      }\n      __typename\n    }\n  }\n  ',"\n  ","\n  ","\n  ","\n  ","\n"])),p.z,f.WW,m.aL,m.wd,y.Px),I=t(83894),x=t(23855),$=t(55148);function j(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function q(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?j(Object(t),!0).forEach((function(n){(0,u.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):j(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Z=function(e,n,t,r,o){var i=t.hasOwnProperty("tileName");if(!e.isChangedStatusSelect)switch(t.show){case"offered":e.status=["offered"];break;case"current":e.status=["accepted","inProgress"];break;case"openJobs":e.status=["raised","pending"];break;case"raised":e.status=["raised"];break;case"pending":e.status=["pending"];break;case"past":e.status=["completed","inDispute","disputeResolved","reportSent","invoiceSent","customerPaid","supplierPaid","closed"];break;default:e.status=t.show}var a=e.limit,s=e.offset,c=e.orderBy,u=e.q,d=e.status,l=e.startDate,m=e.endDate,p=e.type,f=e.number,y=e.userId;if(i)return{query:o?_:g,variables:q({accountId:["supplier","customer"].includes(n.accountType)?n.accountId:null,userId:null,currentUserId:null===n||void 0===n?void 0:n.id,asAt:(0,I.Z)((0,x.Z)(r.asAt)),tileName:null===t||void 0===t?void 0:t.tileName,orderBy:c,monthStart:r.monthStart,dayStart:r.todayStart,yearStart:r.yearStart,adminId:null===n||void 0===n?void 0:n.adminId},e)};switch(n.accountType){case"supplier":return{query:v,variables:{limit:a,offset:s,orderBy:c,q:u,status:d,startDate:l,endDate:m,type:p,number:f,userId:y}};case"customer":return{query:b,variables:{limit:a,offset:s,orderBy:c,q:u,status:d,type:p,number:f,startDate:l,endDate:m}};case"tenant":return{query:b,variables:{limit:a,offset:s,orderBy:c,q:u,status:d,type:p,startDate:l,endDate:m}};default:return{query:h,variables:q({},e)}}},S=function(e){var n=["locationId","customerId","assetId"],t="";return e&&e.constructor===Object&&Object.keys(e).length>0&&(t="?",Object.entries(e).map((function(e){var r=(0,c.Z)(e,2),o=r[0],i=r[1];return i&&n.includes(o)&&(t+="".concat([o],"=").concat(i,"&")),0})),t=(t=t.substring(0,t.length-1)).replace("customerId","accountId")),t},w=function(e){var n=["completed","inDispute","disputeResolved","reportSent","invoiceSent","customerPaid","supplierPaid","closed"];switch(e){case"offered":return $.cj.filter((function(e){return"offered"===e.value}));case"current":return $.cj.filter((function(e){var n=e.value;return"accepted"===n||"inProgress"===n}));case"openJobs":return $.cj.filter((function(e){var n=e.value;return"raised"===n||"pending"===n}));case"raised":return $.cj.filter((function(e){return"raised"===e.value}));case"pending":return $.cj.filter((function(e){return"pending"===e.value}));case"past":return $.cj.filter((function(e){var t=e.value;return n.includes(t)}));default:return $.cj}}},81550:function(e,n,t){"use strict";t.d(n,{x:function(){return l}});var r=t(92809),o=t(67294),i=t(95146),a=t(78215),s=t(2356),c=t(85893);function u(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function d(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?u(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):u(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var l=function(e){var n=e.control,t=e.errors,r=e.initialValues,u=e.setFilters,l=(0,e.watch)("accountId");return(0,o.useEffect)((function(){!r.accountId&&u((function(e){return d(d({},e),{},{accountId:"number"===typeof l?l:(null===l||void 0===l?void 0:l.value)||null})}))}),[l]),!r.accountId&&(0,c.jsx)(a.Z,{children:(0,c.jsx)(s.Z,{md:6,children:(0,c.jsx)(i.P,{control:n,errors:d({},t),label:"",name:"accountId",placeholder:"Select customer",type:"customer"})})})}},78424:function(e,n,t){"use strict";t.d(n,{V:function(){return L}});var r,o=t(92809),i=t(80318),a=t(67294),s=t(11163),c=t(93633),u=t(38460),d=t(52209),l=(0,t(54397).Ps)(r||(r=(0,d.Z)(['\n  query GetProperties(\n    $accountId: Int\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Location_order_by!\n  ) {\n    properties: Location(\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      id\n      access\n      contactUserId\n      createdAt\n      name\n      status\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n      customer: Account_Locations {\n        id\n        account: Account {\n          id\n          name\n        }\n      }\n      compliances: Compliances(\n        where: { entity: { _eq: "Location" } }\n        order_by: { expiryAt: asc }\n      ) {\n        id\n        expiryAt\n        compliance: Compliance {\n          id\n          name\n        }\n      }\n      bookings: Jobs {\n        id\n        amount\n      }\n      user: User {\n        id\n        fullName\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),m=t(57460),p=t.n(m),f=t(80880),y=t(29444),v=t(91126),b=t(80285),h=t(18862),_=t(14347),g=t(55657),I=t(80284),x=t(7720),$=t(24237),j=t(81185),q=t(50899),Z=t(26),S=t(17517),w=t(49705),A=t(48213),O=t(42772),k=t(85893);function C(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function P(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?C(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):C(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var D="/dashboard/properties/",T=function(e){return null===e||void 0===e?void 0:e.reduce((function(e,n){var t=n.amount;return t?e+=t:e}),0)},L=function(e){var n=e.accountId,t=e.accountName,r=e.filters,o=e.hiddenColumns,d=e.showAddButton,m=e.showMediaButton,$=e.showOverallRating,C=(e.sortOrder,(0,w.x)({filters:r})),L=C.initialData,U=C.ref,E=(0,a.useContext)(f.Z),R=(0,c.a)(l,{variables:L}),F=R.data,M=(F=void 0===F?{properties:[],meta:{aggregate:{totalCount:0}}}:F).properties,J=F.meta,B=R.loading,H=R.refetch,z=(0,u.t)(l,{variables:{accountId:L.accountId,q:L.q,orderBy:L.orderBy},onCompleted:function(e){var n=p().unparse(Y(e.properties)),t="data:application/octet-stream,"+encodeURIComponent(n);(0,O.S)(t,"locations.csv")}}),G=(0,i.Z)(z,1)[0],V=function(e){e.stopPropagation(),G()},W=function(e,r){e.stopPropagation(),E.show({content:(0,k.jsx)(Z.V,{accountId:n,accountName:t,data:null===r||void 0===r?void 0:r.data,entity:"Location",refetch:H}),title:null!==r&&void 0!==r&&r.data?"Edit location":"Create location"})},X=[{hidden:!0},{text:"Name"},{hidden:o.includes("Address"),text:"Address"},{hidden:o.includes("Customer"),formatter:(0,y.Z)("/dashboard/customers/view","customerId","customer"),text:"Customer"},{hidden:!0},{text:"Work orders"},{text:"Total Spent"},{hidden:o.includes("Compliances"),formatter:A.DT,text:"Compliance"},{text:"Created"},{text:"Status",hidden:!0},{formatter:v.Z,formatterData:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=[{context:"secondary",icon:["fas","edit"],onClick:W,tooltip:"Edit property"}];return m&&t.push({context:"info",icon:["fas","file-upload"],onClick:n.mediaClick,tooltip:"Media"}),t}(D,{mediaClick:function(e,n){e.stopPropagation(),function(e,n){e.stopPropagation(),E.show({content:(0,k.jsx)(q.G,{entity:"Compliance",entityId:n.data.id}),submit:!1,title:"Media"})}(e,n)}}),text:"Actions"}],Y=function(e){return e.map((function(e){var n,t,r=null===e||void 0===e||null===(n=e.addresses[0])||void 0===n?void 0:n.address;return{location:e.name||"Not Specified",customer:e.customer[0].account.name,address:r?"".concat(r.addressLine1," - ").concat(r.postCode):"",bookings:null===(t=e.bookings)||void 0===t?void 0:t.length,totalSpent:(0,b.Z)(T(e.bookings)),createdAt:(0,h.Z)(e.createdAt)}}))},Q=function(){return(0,k.jsxs)(N,{children:[(0,k.jsx)(_.Z,{context:"white",onClick:V,title:"Export to CSV",children:(0,k.jsx)(g.Z,{context:"secondary",icon:"file-csv",size:"lg"})}),(0,k.jsx)(_.Z,{context:"secondary",content:"Create location",onClick:W})]})};return(0,k.jsxs)(I.Z,{toolbar:d&&(0,k.jsx)(Q,{}),open:!0,title:"Locations",children:[M&&$&&(0,k.jsx)(x.Z,P({},(0,A.Bo)(M))),(0,k.jsx)(j.t,{columns:X,loading:B,meta:J,ref:U,refetch:H,rowClick:function(e){s.default.push("".concat(D,"view?id=").concat(e.data.id,"&tab=details"))},rows:M.map((function(e){var n;return{data:e,location:e.name||"Not Specified",address:(0,S.u)({addresses:e.addresses[0]}),customer:e.customer[0].account.name,customerId:e.customer[0].account.id,bookings:null===(n=e.bookings)||void 0===n?void 0:n.length,totalSpent:(0,b.Z)(T(e.bookings)),compliancesList:e.compliances,createdAt:(0,h.Z)(e.createdAt),status:e.status,actions:""}}))})]})},N=$.ZP.div.withConfig({displayName:"table__StyledToolbar",componentId:"sc-1kizpl0-0"})(["display:inline-flex;float:right;"]);L.defaultProps={hiddenColumns:[],showAddButton:!1,showOverallRating:!1,showMediaButton:!1}},99628:function(e,n,t){"use strict";t.d(n,{uY:function(){return c},PL:function(){return u},DE:function(){return d}});var r,o,i,a=t(52209),s=t(54397),c=(0,s.Ps)(r||(r=(0,a.Z)(["\n  query GetAccountSLAs(\n    $entity: String!\n    $entityId: Int\n    $parentEntity: String\n    $parentEntityId: Int\n    $fetchParent: Boolean!\n    $q: String\n  ) {\n    slas: SLA(order_by: { id: asc }) {\n      status\n      id\n      name\n      notes\n      normalRate\n      oohRate\n      premiumRate\n      onSite\n      onSiteUnit\n      jobReport\n      jobReportUnit\n      completion\n      completionUnit\n      minimumInterval\n      minimumLength\n    }\n    entities: SLA_Entity(\n      where: { entity: { _eq: $entity }, entityId: { _eq: $entityId } }\n      order_by: { slaId: asc }\n    ) {\n      status\n      id\n      entity\n      entityId\n      onSite\n      onSiteUnit\n      jobReport\n      jobReportUnit\n      completion\n      completionUnit\n      notes\n      inUse\n      normalRate\n      oohRate\n      premiumRate\n      minimumInterval\n      minimumLength\n      slaId\n      sla: SLA {\n        status\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n    }\n    parentEntities: SLA_Entity(\n      where: { entity: { _eq: $parentEntity }, entityId: { _eq: $parentEntityId } }\n    ) @include(if: $fetchParent) {\n      id\n      entity\n      entityId\n      onSite\n      onSiteUnit\n      jobReport\n      jobReportUnit\n      completion\n      completionUnit\n      notes\n      inUse\n      normalRate\n      oohRate\n      premiumRate\n      minimumInterval\n      minimumLength\n      slaId\n      status\n      sla: SLA {\n        status\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n    }\n  }\n"]))),u=(0,s.Ps)(o||(o=(0,a.Z)(["\n  mutation addSla($objects: [SLA_Entity_insert_input!]!) {\n    insert_SLA_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),d=(0,s.Ps)(i||(i=(0,a.Z)(["\n  mutation UpdateSla($id: Int!, $changes: SLA_Entity_set_input) {\n    update_SLA_Entity_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"])))},14399:function(e,n,t){"use strict";t.d(n,{cz:function(){return $},qd:function(){return j},nD:function(){return q},UH:function(){return Z},SW:function(){return S},Qn:function(){return w},he:function(){return A},j$:function(){return O},_d:function(){return k},kx:function(){return C},t1:function(){return P},by:function(){return D},yR:function(){return T},RJ:function(){return L},Cj:function(){return N},Ve:function(){return U},kU:function(){return E},kB:function(){return R}});var r,o,i,a,s,c,u,d,l,m,p,f,y,v,b,h,_,g,I=t(52209),x=t(54397),$=(0,x.Ps)(r||(r=(0,I.Z)(["\n  query GetAddressForSelect($q: String, $entity: String!, $entityId: Int!) {\n    items: Address(\n      where: {\n        Address_Entities: { entity: { _eq: $entity }, entityId: { _eq: $entityId } }\n        _or: [\n          { addressLine1: { _eq: $q } }\n          { addressLine2: { _eq: $q } }\n          { addressLine3: { _eq: $q } }\n          { county: { _eq: $q } }\n          { postCode: { _eq: $q } }\n          { city: { _eq: $q } }\n        ]\n      }\n    ) {\n      label: addressLine1\n      value: id\n      id\n      name\n      addressLine1\n      addressLine2\n      addressLine3\n      postCode\n      county\n      country: Country {\n        name\n      }\n      city\n      Address_Entities {\n        invoice\n      }\n    }\n  }\n"]))),j=(0,x.Ps)(o||(o=(0,I.Z)(["\n  query GetAccountsForSelect($q: String) {\n    items: Account(where: { name: { _ilike: $q } }, order_by: { name: asc }) {\n      label: name\n      value: id\n    }\n  }\n"]))),q=(0,x.Ps)(i||(i=(0,I.Z)(['\n  query GetTaxonomy($q: String, $id: Int) {\n    items: Taxonomy(\n      where: { type: { _eq: "assetCategory" }, status: { _eq: "active" } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      options: Taxonomies(\n        where: {\n          type: { _eq: "assetCategory" }\n          name: { _ilike: $q }\n          id: { _eq: $id }\n          status: { _eq: "active" }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']))),Z=(0,x.Ps)(a||(a=(0,I.Z)(["\n  query GetAssetsForSelect($locationId: Int, $q: String, $categoryId: Int, $bookable: String) {\n    items: Asset(\n      where: {\n        categoryId: { _eq: $categoryId }\n        locationId: { _eq: $locationId }\n        name: { _ilike: $q }\n        bookable: { _eq: $bookable }\n      }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n      parent: ParentAsset {\n        id\n        name\n      }\n      media: Media {\n        id\n        item: Medium {\n          id\n          name\n          filename\n          meta\n          category\n          type\n        }\n      }\n    }\n  }\n"]))),S=(0,x.Ps)(s||(s=(0,I.Z)(['\n  query GetCustomersForSelect($q: String) {\n    items: Account(\n      where: { name: { _ilike: $q }, type: { _eq: "customer" } }\n      order_by: { name: asc }\n    ) {\n      admin: Admins {\n        id: adminId\n      }\n      label: name\n      spendThreshold: meta(path: "$.finance.spendThreshold")\n      serviceRateLabour: meta(path: "$.finance.serviceRateLabour")\n      serviceRateExpenses: meta(path: "$.finance.serviceRateExpenses")\n      value: id\n    }\n  }\n']))),w=(0,x.Ps)(c||(c=(0,I.Z)(["\n  query GetJobsForSelect($_q: Int, $locationId: Int) {\n    items: Job(\n      where: {\n        Location: { id: { _eq: $locationId } }\n        _or: [{ id: { _eq: $_q } }, { Invoices: { id: { _eq: $_q } } }]\n      }\n      order_by: { title: asc }\n    ) {\n      label: label\n      value: id\n      number\n      createdAt\n      description\n      status\n      timingStart\n      title\n      type\n      Location {\n        name\n      }\n      Taxonomy {\n        Taxonomy {\n          shortJobDescription: name\n        }\n      }\n    }\n  }\n"]))),A=(0,x.Ps)(u||(u=(0,I.Z)(['\n  query GetManagersForSelect($accountId: Int!, $q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          role: { _in: ["owner", "manager"] }\n          status: { _eq: "active" }\n          Account: { id: { _eq: $accountId } }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n']))),O=(0,x.Ps)(d||(d=(0,I.Z)(["\n  query GetPostCodeAreaForSelect($countryId: Int, $q: String) {\n    items: PostcodeArea(\n      where: { name: { _ilike: $q }, countryId: { _eq: $countryId } }\n      order_by: { name: asc }\n    ) {\n      area\n      label: name\n      value: id\n    }\n  }\n"]))),k=(0,x.Ps)(l||(l=(0,I.Z)(["\n  query GetPropertiesForSelect($where: Location_bool_exp) {\n    items: Location(where: $where, order_by: { name: asc }) {\n      label: name\n      value: id\n      access\n      registeredAddress: Addresses(where: { registered: { _eq: true } }) {\n        address: Address {\n          id\n          addressLine1\n          addressLine2\n          addressLine3\n          county\n          country: Country {\n            name\n          }\n          postCode\n          city\n        }\n      }\n    }\n  }\n"]))),C=(0,x.Ps)(m||(m=(0,I.Z)(['\n  query GetServicesForSelect($q: String) {\n    items: Service(\n      where: { name: { _ilike: $q }, status: { _eq: "active" } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']))),P=(0,x.Ps)(p||(p=(0,I.Z)(["\n  query GetSlasForSelect($q: String, $adminId: Int, $type: String) {\n    items: SLA(\n      where: { name: { _ilike: $q }, type: { _eq: $type }, adminId: { _eq: $adminId } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]))),D=(0,x.Ps)(f||(f=(0,I.Z)(["\n  query GetSuppliersForSelect($where: Account_bool_exp) {\n    items: Account(where: $where, order_by: { name: asc }) {\n      label: name\n      value: id\n    }\n  }\n"]))),T=(0,x.Ps)(y||(y=(0,I.Z)(['\n  query GetUsersForSelect($accountId: Int, $q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          accountId: { _eq: $accountId }\n          isContact: { _eq: true }\n          status: { _eq: "active" }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n      email\n      phone\n    }\n  }\n']))),L=(0,x.Ps)(v||(v=(0,I.Z)(['\n  query GetUsersForSelect($q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n      email\n      phone\n    }\n  }\n']))),N=(0,x.Ps)(b||(b=(0,I.Z)(["\n  query GetTaxonomyGroupForSelect($q: String, $type: String!) {\n    items: Taxonomy(\n      where: { isGroup: { _eq: true }, name: { _ilike: $q }, type: { _eq: $type } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]))),U=(0,x.Ps)(h||(h=(0,I.Z)(['\n  query GetTaxonomy($q: String) {\n    items: Taxonomy(where: { type: { _eq: "expenseCategoryGroup" } }, order_by: { name: asc }) {\n      label: name\n      options: Taxonomies(\n        where: { type: { _eq: "expenseCategory" }, name: { _ilike: $q } }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']))),E=(0,x.Ps)(_||(_=(0,I.Z)(['\n  query GetCompliancesForSelect($q: String, $locationId: Int) {\n    items: Taxonomy(where: { type: { _eq: "complianceCategory" } }, order_by: { name: asc }) {\n      label: name\n      options: Compliances(\n        where: {\n          name: { _ilike: $q }\n          Compliance_Entities: { Location: { id: { _eq: $locationId } } }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']))),R=(0,x.Ps)(g||(g=(0,I.Z)(["\n  query GetUserRole($userId: Int!, $accountId: Int!) {\n    accountUsers: Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n    ) {\n      role\n    }\n  }\n"])))},95146:function(e,n,t){"use strict";t.d(n,{P:function(){return q}});var r=t(92809),o=t(30266),i=t(10219),a=t(64687),s=t.n(a),c=t(67294),u=t(24237),d=t(26075),l=t(14399),m=t(80880),p=t(42593),f=t(65375),y=t(78215),v=t(2356),b=t(93515),h=t(14347),_=t(85893),g=["AddForm","accountId","area","assetCategoryId","control","entity","entityId","errors","id","isClearable","isDisabled","label","locationId","name","serviceId","taxonomyGroupType","customerId","customerRole","type","userId"];function I(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function x(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?I(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):I(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var $=function(e,n){var t,r,o=!0;return(null===(t=e.errors[e.name])||void 0===t?void 0:t.message)!==(null===(r=n.errors[n.name])||void 0===r?void 0:r.message)&&(o=!1),["accountId","assetCategoryId","entity","entityId","locationId","serviceId","type","value","customerId","customerRole"].forEach((function(t){e[t]!==n[t]&&(o=!1)})),o},j=function(e){var n=e.accountId,t=e.area,r=e.assetCategoryId,o=e.entity,i=e.entityId,a=(e.hasRole,e.id),s=e.locationId,c=e.serviceId,u=e.taxonomyGroupType,d=e.customerId,m=e.customerRole,p=e.type,f=e.userId,y=p;switch(m&&(y="".concat(p,"_").concat(m)),y){case"address":return{query:l.cz,variables:{entity:o,entityId:i}};case"asset":return{query:l.UH,variables:{categoryId:r,locationId:s}};case"assetBookable":return{query:l.UH,variables:{categoryId:r,locationId:s,bookable:"yes"}};case"assetCategory":return{query:l.nD,variables:{id:a}};case"compliance":return{query:l.kU,variables:{locationId:s}};case"coverage":return{query:l.j$};case"customer":return{query:l.SW};case"job":return{query:l.Qn,variables:{locationId:s}};case"manager":return{query:l.he,variables:{accountId:n}};case"product":return{query:l.UH,variables:{category:"product",locationId:s}};case"property":return{query:l._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:n}}}}};case"property_user":return{query:l._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:n},Account:{type:{_eq:"customer"},Account_Users:{role:{_eq:"user"},userId:{_eq:d}}},User_Account_Locations:{Account_User:{userId:{_eq:d},accountId:{_eq:n}}}}}}};case"sensor":return{query:l.UH,variables:{category:"sensor",locationId:s}};case"service":return{query:l.kx};case"sla":return{query:l.t1,variables:{type:"priority",adminId:n}};case"sublocation":return{query:l.UH,variables:{category:"sublocation",adminId:n,locationId:s}};case"supplier":var v={type:{_eq:"supplier"}};return t&&(v.PostcodeAreas={PostcodeArea:{area:{_eq:t}},status:{_eq:"active"}}),c&&(v.Services={serviceId:{_eq:c},status:{_eq:"active"}}),{query:l.by,variables:{where:v}};case"user":return{query:l.yR,variables:{accountId:n}};case"usersForBookings":return{query:l.yR,variables:{accountId:f}};case"tenant":return{query:l.RJ};case"taxonomyGroup":return{query:l.Cj,variables:{type:u}};case"expenseCategory":return{query:l.Ve};default:return{query:l.qd}}},q=(0,c.memo)((function(e){var n=e.AddForm,t=e.accountId,r=e.area,a=e.assetCategoryId,u=e.control,l=e.entity,I=e.entityId,$=e.errors,q=e.id,S=e.isClearable,w=e.isDisabled,A=e.label,O=e.locationId,k=e.name,C=e.serviceId,P=e.taxonomyGroupType,D=e.customerId,T=e.customerRole,L=e.type,N=e.userId,U=(0,i.Z)(e,g),E=(0,d.x)(),R=(0,c.useState)(!1),F=R[0],M=R[1],J=(0,c.useState)(),B=J[0],H=J[1],z=(0,c.useState)(!1),G=z[0],V=z[1],W=(0,c.useContext)(m.Z),X=(0,c.useContext)(p.Z).hasRole,Y=(0,c.useState)(!1),Q=Y[0],K=Y[1];(0,c.useEffect)((function(){return K(!1),V(!1),function(){}}),[t,a,l,I,O,C,L,D,T,N]);var ee=function(){var e=(0,o.Z)(s().mark((function e(){var n,o,i,c,u,d,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!G){e.next=3;break}return K(!0),e.abrupt("return",null);case 3:return M(!0),n=j({accountId:t,area:r,assetCategoryId:a,entity:l,entityId:I,hasRole:X,id:q,locationId:O,serviceId:C,taxonomyGroupType:P,customerId:D,customerRole:T,type:L,userId:N}),o=n.query,i=n.variables,c=void 0===i?{}:i,e.next=7,E.query({query:o,variables:x({},c)});case 7:u=e.sent,d=u.data,m=(d=void 0===d?{items:[]}:d).items,H(m),M(!1),V(!0),K(!0);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,_.jsx)(f.Z,{id:k,label:A,children:(0,_.jsxs)(y.Z,{children:[(0,_.jsx)(v.Z,{md:n?11:12,children:(0,_.jsx)(b.Z,x({autoload:!1,blurInputOnSelect:!0,cacheOptions:!0,control:u,errors:$,isDisabled:w,isClearable:S,isLoading:F,menuIsOpen:Q,options:B,onFocus:ee,onBlur:function(){K(!1)},name:k,searchable:!0},U),U.defaultValue)}),n&&(0,_.jsx)(v.Z,{md:1,children:(0,_.jsx)(Z,{children:(0,_.jsx)(h.Z,{content:null,startIcon:"plus",size:"sm",onClick:function(){W.show({content:(0,_.jsx)("div",{children:(0,_.jsx)(n,{})}),title:"Add form"})}})})})]})})}),$),Z=u.ZP.div.withConfig({displayName:"select__ButtonWrapper",componentId:"sc-v7qj9m-0"})(["position:relative;right:25px;top:2px;"]);q.defaultProps={isClearable:!0,label:"Account",name:"account",type:"account"}},17517:function(e,n,t){"use strict";t.d(n,{u:function(){return r}});var r=function(e){var n=e.addresses;return null!==n&&void 0!==n&&n.address?{__html:"".concat(n.address.addressLine1,"<br />").concat(n.address.postCode)}:"Please add"}},23154:function(e,n,t){"use strict";t.d(n,{E:function(){return s}});var r=t(30266),o=t(64687),i=t.n(o),a=t(27834),s=function(){var e=(0,r.Z)(i().mark((function e(n,t){var r,o,s,c=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>2&&void 0!==c[2]&&c[2],e.prev=1,e.next=4,n.query({query:a.WF,variables:{email:t}});case 4:if(o=e.sent,!((s=o.data.users)&&s.length>0)){e.next=8;break}return e.abrupt("return",!!r&&s[0]);case 8:return e.abrupt("return",!r||null);case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(n,t){return e.apply(this,arguments)}}()},10076:function(e,n,t){"use strict";t.d(n,{H:function(){return A}});var r=t(92809),o=t(83789),i=t(93633),a=t(42283),s=t(79665),c=t(84550),u=t(97202),d=t(65375),l=t(46482),m=t(71247),p=t(69128),f=t(34003),y=t(98315),v=t(19501),b=(0,v.Ry)().shape({nameFirst:(0,v.Z_)().required(),nameLast:(0,v.Z_)().required(),email:(0,v.Z_)().required().email(),phone:(0,v.Z_)().required(),status:(0,v.Z_)().when("$hasRole",(function(e){return e?(0,v.Z_)().oneOf(["active","inactive"]).required():void 0})),invoiceThreshold:(0,v.Rx)().nullable(!0).transform((function(e){return isNaN(e)?null:e})),quoteThreshold:(0,v.Rx)().nullable(!0).transform((function(e){return isNaN(e)?null:e})),role:(0,v.Z_)().when(["$hasRole","accountId"],(function(e,n){return e?n&&n.length>0&&(0,v.Z_)().required():void 0})),position:(0,v.Z_)().when("accountId",{is:function(e){return e&&e.length>0},then:(0,v.Z_)()}),isContact:(0,v.Z_)().when("accountId",{is:function(e){return e&&e.length>0},then:(0,v.Z_)().oneOf(["yes","no"]).required()}),location:(0,v.IX)().when("$hasLocation",(function(e){return e?(0,v.IX)().of((0,v.Rx)().integer().required()).required():void 0}))}),h=t(1323),_=t(56257),g=t(27834),I=t(17517),x=t(81185),$=t(49705),j=t(85893);function q(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function Z(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?q(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var S=function(e,n){return"customer"!==e&&"supplier"!==e||n([].concat((0,o.Z)(_.td),(0,o.Z)(_.Sf),(0,o.Z)(_.n),(0,o.Z)(_.nx)))},w=["customer_user"],A=function(e){var n=e.accountType,t=e.defaultValues,r=e.meta,v=e.submit,q=(0,h.x)(),A=q.hasRole,O=q.user,k=(0,$.x)({filters:{}}),C=k.initialData,P=k.ref,D=(0,a.cI)({defaultValues:t&&Z({},t),resolver:(0,s.S)(b),context:{hasRole:S(n,A),hasLocation:!w.includes(O.role)&&w.includes("".concat(n,"_").concat(null===t||void 0===t?void 0:t.role))}}),T=D.control,L=D.errors,N=D.handleSubmit,U=D.register,E=(0,D.watch)("role"),R=(0,i.a)(g.ZA,{variables:Z(Z({},C),{},{accountId:t.accountId})}),F=R.data,M=(F=void 0===F?{location:[],meta:{aggregate:{totalCount:0}}}:F).location,J=F.meta,B=R.loading,H=R.refetch,z=(0,o.Z)(y.I);switch(n){case"supplier":z.push({text:"Operative",value:"contractor"});break;case"admin":z.push({text:"Helpdesk",value:"helpdesk"})}var G={control:T,errors:L,register:U},V=[{hidden:!A([].concat((0,o.Z)(_.td),(0,o.Z)(_.Sf),(0,o.Z)(_.n))),formatter:function(e){var n=e.row;return(0,j.jsx)(c.Z,Z(Z({},G),{},{name:"location",data:[{value:n.id}]}))}},{text:"Name"},{text:"Address"}];return(0,j.jsxs)(u.Z,{id:"offCanvasForm",handleSubmit:N((function(e){v(e,r)})),children:[(0,j.jsx)(f.q,Z({},G)),t.accountId&&(0,j.jsxs)(j.Fragment,{children:[S(n,A)&&(0,j.jsx)(d.Z,{label:"Role",children:(0,j.jsx)(l.Z,Z(Z({},G),{},{name:"role",options:z}))}),(0,j.jsx)(d.Z,{label:"Position / Job title",children:(0,j.jsx)(m.Z,Z(Z({},G),{},{name:"position"}))}),A(["admin_owner","admin_manager","customer_owner","customer_manger","supplier_owner","supplier_manager"])&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(d.Z,{label:"Threshold limit / Invoice",children:(0,j.jsx)(m.Z,Z(Z({},G),{},{name:"invoiceThreshold"}))}),(0,j.jsx)(d.Z,{label:"Threshold limit / Quote",children:(0,j.jsx)(m.Z,Z(Z({},G),{},{name:"quoteThreshold"}))})]}),(0,j.jsx)(p.Z,Z(Z({},G),{},{data:[{id:"yes",label:"Yes",value:"yes"},{id:"no",label:"No",value:"no"}],legend:"Contact User",name:"isContact",stacked:!0})),w.includes("".concat(n,"_").concat(E))&&(0,j.jsx)(d.Z,{label:"Locations",children:(0,j.jsx)(x.t,{columns:V,loading:B,meta:J,ref:P,refetch:H,rows:function(){var e=M.map((function(e){return{id:e.accountLocations[0].id,name:e.name,address:(0,I.u)({addresses:e.addresses[0]})}}));return w.includes(O.role)?e.filter((function(e){var n;return null===t||void 0===t||null===(n=t.location)||void 0===n?void 0:n.includes("".concat(e.id))})):e}()})})]}),(null===t||void 0===t?void 0:t.id)&&(0,j.jsx)(m.Z,Z(Z({},G),{},{name:"id",type:"hidden"})),(null===t||void 0===t?void 0:t.accountId)&&(0,j.jsx)(m.Z,Z(Z({},G),{},{name:"accountId",type:"hidden"})),(null===t||void 0===t?void 0:t.accountUserId)&&(0,j.jsx)(m.Z,Z(Z({},G),{},{name:"accountUserId",type:"hidden"}))]})}},81167:function(e,n,t){"use strict";t.d(n,{P:function(){return E}});var r=t(83789),o=t(92809),i=t(30266),a=t(80318),s=t(64687),c=t.n(s),u=t(67294),d=t(11163),l=t(26075),m=t(93633),p=t(75709),f=t(27834),y=t(80880),v=t(43566),b=t(29444),h=t(91126),_=t(18862),g=t(58448),I=t(14347),x=t(80284),$=t(22796),j=t(11570),q=t(81185),Z=t(50899),S=t(49705),w=t(10076);function A(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function O(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?A(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):A(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var k=function(e,n,t){var r={};return e.id?(r.id=parseInt(e.id),r.changes={nameFirst:e.nameFirst,nameLast:e.nameLast,email:e.email,phone:e.phone,meta:O(O({},n),{},{threshold:{invoice:e.invoiceThreshold,quote:e.quoteThreshold}})},e.accountUserId?(r.updateAccountUser=!0,r.accountUserId=parseInt(e.accountUserId),r.accountUserChanges={role:e.role,position:e.position,isContact:"yes"===e.isContact,status:e.status}):(r.accountUserId=0,r.updateAccountUser=!1)):(r.role=e.role,r.position=e.position,r.isContact="yes"===e.isContact,r.status=e.status,r.accountId=e.accountId,t?r.userId=t.id:r.User={data:{nameFirst:e.nameFirst,nameLast:e.nameLast,email:e.email,phone:e.phone,status:e.status,meta:{sendDefaultWelcomeEmail:!0}}}),r},C=function(e){return{accountUserId:e.accountUserId,objects:e.location.map((function(n){return{accountUserId:e.accountUserId,accountLocationId:n}}))}},P=t(14651),D=t(23154),T=t(56257),L=t(85893);function N(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function U(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?N(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):N(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var E=function(e){var n=e.accountType,t=e.filters,o=(0,l.x)(),s=(0,S.x)({filters:t}),A=s.initialData,O=s.ref,N=(0,u.useContext)(y.Z),E=(0,u.useContext)(v.Z).user,R=null,F=(0,m.a)(f.fo,{variables:A}),M=F.data,J=(M=void 0===M?{users:[],meta:{aggregate:{totalCount:0}}}:M).users,B=M.meta,H=F.loading,z=F.refetch,G=(0,p.D)(f.I4,{onCompleted:function(e){N.close(),z()}}),V=(0,a.Z)(G,2),W=V[0],X=V[1].error,Y=(0,p.D)(f.AX,{onCompleted:function(e){N.close(),z()}}),Q=(0,a.Z)(Y,2),K=Q[0],ee=Q[1].error,ne=(0,p.D)(f.tW,{onCompleted:function(e){z()}}),te=(0,a.Z)(ne,2),re=te[0],oe=te[1].error;X&&X.graphQLErrors.forEach((function(e){var n;R="constraint-violation"===(null===(n=e.extensions)||void 0===n?void 0:n.code)?"Error: a user with this e-mail address already exists":"Error creating user"})),ee&&ee.graphQLErrors.forEach((function(e){var n;R="constraint-violation"===(null===(n=e.extensions)||void 0===n?void 0:n.code)?"Error, a user with this e-mail address already exists":"Error updating user"})),oe&&(R="Error getting user`s locations");var ie=function(){var e=(0,i.Z)(c().mark((function e(n,t){var r,i,a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,D.E)(o,n.email,!0);case 2:if(r=e.sent,i=k(n,t,r),!n.id){e.next=9;break}K({variables:U({},i)}),n.location&&re({variables:U({},C(n))}),e.next=14;break;case 9:return e.next=11,W({variables:{objects:i}});case 11:a=e.sent,s=a.data.insert_Account_User.returning,n.location&&re({variables:U({},C({location:n.location,accountUserId:s[0].id}))});case 14:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),ae=function(e,r){e.stopPropagation();var o=function(e){var n,t,r,o,i={id:(null===e||void 0===e?void 0:e.id)||null,accountId:null===e||void 0===e?void 0:e.accountId,nameFirst:(null===e||void 0===e?void 0:e.nameFirst)||"",nameLast:(null===e||void 0===e?void 0:e.nameLast)||"",email:(null===e||void 0===e?void 0:e.email)||"",phone:(null===e||void 0===e?void 0:e.phone)||"",invoiceThreshold:null===(n=e.meta)||void 0===n||null===(t=n.threshold)||void 0===t?void 0:t.invoice,quoteThreshold:null===(r=e.meta)||void 0===r||null===(o=r.threshold)||void 0===o?void 0:o.quote,role:"",position:"",isContact:"",status:"active",meta:null===e||void 0===e?void 0:e.meta};return null!==e&&void 0!==e&&e.accountUser&&(i.accountUserId=e.accountUser.id,i.accountId=e.accountUser.account.id,i.role=e.accountUser.role,i.position=e.accountUser.position,i.isContact=!0===e.accountUser.isContact?"yes":"no",i.status=e.accountUser.status,i.location=e.accountUser.userLocations.map((function(e){return"".concat(e.accountLocationId)}))),i}(U(U({},r),{},{accountId:t.accountId}));N.show({content:(0,L.jsx)(w.H,{accountType:n,defaultValues:o,meta:null===r||void 0===r?void 0:r.meta,submit:ie,submitError:R}),title:r?"Edit user":"Add user"})},se=[{hidden:!0},{text:"Name"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:t.accountId,formatter:(0,b.Z)("","accountId","account","url"),text:"Account"},{text:"Email Address"},{text:"Contact User",formatter:function(e){var n=e.row;e.data;if(n.accountUser.isContact)return(0,L.jsx)(P.Z,{color:"error"})}},{text:"Phone"},{text:"Position"},{hidden:!0},{hidden:!t.accountId,text:"Role"},{text:"Status"},{text:"Date Added",sortable:!0,sortName:"createdAt"},{hidden:!0},{hidden:!0},{formatter:function(e){var t=e.row,o=e.data;return"supplier"!==n&&"customer"!==n||E.email!==t.email&&![].concat((0,r.Z)(T.td),(0,r.Z)(T.Sf),(0,r.Z)(T.n),(0,r.Z)(T.nx)).includes(E.role)?[].concat((0,r.Z)(T.td),(0,r.Z)(T.Sf),(0,r.Z)(T.n),(0,r.Z)(T.nx)).includes(E.role)?(0,L.jsx)(h.Z,{row:t,data:o}):void 0:(0,L.jsx)(h.Z,{row:t,data:o})},formatterData:[{context:"secondary",icon:["fas","edit"],onClick:ae,tooltip:"Edit"},{context:"info",icon:["fas","file-upload"],onClick:function(e,n){e.stopPropagation(),N.show({content:(0,L.jsx)(Z.G,{category:"avatar",entity:"User",entityId:n.id,limit:1,type:"image"}),submit:!1,title:"Upload avatar"})},tooltip:"Avatar"}],text:"Actions"}],ce=function(){return(0,L.jsx)(g.Z,{children:(0,L.jsx)(I.Z,{context:"secondary",content:"Edit",onClick:ae,size:"sm",children:"Create User"})})};return(0,L.jsxs)(x.Z,{toolbar:t.accountId&&[].concat((0,r.Z)(T.td),(0,r.Z)(T.Sf),(0,r.Z)(T.n),(0,r.Z)(T.nx)).includes(E.role)&&(0,L.jsx)(ce,{}),open:!0,title:"Users",children:[(0,L.jsx)(q.t,{columns:se,loading:H,meta:B,ref:O,refetch:z,rowClick:function(e){d.default.push("".concat("/dashboard/users/","view?id=").concat(e.id))},rows:function(){var e=[];return J.forEach((function(n){var r,o,i,a=null;a=t.accountId?n.accounts.find((function(e){var n;return(null===(n=e.account)||void 0===n?void 0:n.id)===parseInt(t.accountId)})):n.accounts.find((function(e){return null!==e.account}));var s={id:n.id,name:"".concat(n.nameFirst," ").concat(n.nameLast),nameFirst:n.nameFirst,nameLast:n.nameLast,accountId:a&&a.account.id,type:a&&a.account.type,email:n.email,account:a?"".concat(a.account.name," (").concat(a.account.type,")"):"-",phone:n.phone,position:null!==(r=a)&&void 0!==r&&r.position?a.position:"N/A",accountUser:a,role:null===(o=a)||void 0===o?void 0:o.role,status:a?a.status:n.status,createdAt:(0,_.Z)(n.createdAt),url:a&&!["admin","tenant"].includes(a.account.type.toLowerCase())?"/dashboard/".concat(null===(i=a)||void 0===i?void 0:i.account.type.toLowerCase(),"s/view"):"",meta:n.meta,actions:""};e.push(s)})),e}()}),R&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)($.Z,{}),(0,L.jsx)(j.Z,{content:R,context:"warning"})]})]})}},34003:function(e,n,t){"use strict";t.d(n,{q:function(){return b}});var r=t(83789),o=t(92809),i=t(78215),a=t(2356),s=t(65375),c=t(71247),u=t(50710),d=t(46482),l=t(75838),m=t(1323),p=t(56257),f=t(85893);function y(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function v(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?y(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var b=function(e){var n=e.errors,t=e.prefix,o=e.register,y=(0,m.x)().hasRole,b={errors:n,register:o};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(i.Z,{children:[(0,f.jsx)(a.Z,{md:6,children:(0,f.jsx)(s.Z,{label:"First name",children:(0,f.jsx)(c.Z,v(v({},b),{},{name:"".concat(t,"nameFirst")}))})}),(0,f.jsx)(a.Z,{md:6,children:(0,f.jsx)(s.Z,{label:"Last name",children:(0,f.jsx)(c.Z,v(v({},b),{},{name:"".concat(t,"nameLast")}))})}),(0,f.jsx)(a.Z,{md:6,children:(0,f.jsxs)(s.Z,{label:"Email",children:[(0,f.jsx)(c.Z,v(v({},b),{},{name:"".concat(t,"email"),type:"email"})),n["".concat(t,"email")]&&"duplicate"===n["".concat(t,"email")].type&&(0,f.jsx)(u.Z,{message:n["".concat(t,"email")].message})]})}),(0,f.jsx)(a.Z,{md:6,children:(0,f.jsx)(s.Z,{label:"Mobile",children:(0,f.jsx)(c.Z,v(v({},b),{},{name:"".concat(t,"phone")}))})})]}),y([].concat((0,r.Z)(p.td),(0,r.Z)(p.Sf),(0,r.Z)(p.n),(0,r.Z)(p.nx)))&&(0,f.jsx)(s.Z,{label:"Status",children:(0,f.jsx)(d.Z,v(v({},b),{},{name:"".concat(t,"status"),options:l.bg}))}),(0,f.jsx)(c.Z,v(v({},b),{},{name:"".concat(t,"userId"),type:"hidden"}))]})};b.defaultProps={prefix:""}},42772:function(e,n,t){"use strict";t.d(n,{S:function(){return r}});var r=function(e,n){var t=document.createElement("a");"string"===typeof t.download?(document.body.appendChild(t),t.download=n,t.href=e,t.click(),document.body.removeChild(t)):location.replace(e)}},99362:function(e,n,t){"use strict";t.d(n,{X:function(){return s}});var r=t(43703),o=t(69119),i=t(83894),a=t(38148),s=function(e){var n=(0,r.Z)(e),t=(0,o.Z)(e);return{monthStart:n,todayEnd:(0,i.Z)(e),todayStart:t,yearStart:(0,a.Z)(e)}}},26496:function(e,n,t){"use strict";t.d(n,{l:function(){return r}});var r=function(e,n){var t=Math.pow(10,n);return Math.round(e*t)/t}},89331:function(e,n,t){"use strict";t.d(n,{l:function(){return r},Y:function(){return o}});var r=[{text:"Account Type",value:""},{text:"Admin",value:"admin"},{text:"Customer",value:"customer"},{text:"Supplier",value:"supplier"},{text:"Tenant",value:"tenant"}],o=function(e){return[{icon:"edit",tooltip:"Edit",to:"/dashboard/".concat(e.type,"s/").concat("supplier"===e.type?"edit":"manage","?id=").concat(e.id)}]}},75838:function(e,n,t){"use strict";t.d(n,{bg:function(){return r},WG:function(){return o}});var r=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}],o=[{text:"Status",value:""},{text:"Open",value:"open"},{text:"Resolved",value:"resolved"},{text:"Closed",value:"closed"}]},98315:function(e,n,t){"use strict";t.d(n,{I:function(){return r}});var r=[{text:"Select Role",value:""},{text:"Owner",value:"owner"},{text:"Manager",value:"manager"},{text:"User",value:"user"}]},86814:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Ve}});var r,o=t(66918),i=t(78215),a=t(2356),s=t(67294),c=t(11163),u=t(93633),d=t(53197),l=t(92743),m=t(70316),p=t(92809),f=t(52209),y=t(54397),v=(0,y.Ps)(r||(r=(0,f.Z)(['\n  query GetPropertiesCompliance(\n    $accountId: Int\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Location_order_by!\n    $now: date\n    $nextMonth: date\n  ) {\n    properties: Location(\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      id\n      access\n      contactUserId\n      createdAt\n      name\n\n      jobs: Jobs(where: { Compliances: { id: { _is_null: false }, entity: { _eq: "Job" } } }) {\n        id\n        number\n        amount\n        timingStart\n        scheduledAt\n      }\n      upComing: Compliances_aggregate(\n        where: {\n          entity: { _eq: "Location" }\n          _and: [{ expiryAt: { _gt: $now } }, { expiryAt: { _lt: $nextMonth } }]\n        }\n      ) {\n        aggregate {\n          count\n        }\n      }\n      overdue: Compliances_aggregate(\n        where: { expiryAt: { _lt: $now }, entity: { _eq: "Location" } }\n      ) {\n        aggregate {\n          count\n        }\n      }\n\n      compliances: Compliances(\n        where: { entity: { _eq: "Location" } }\n        order_by: { expiryAt: asc }\n      ) {\n        id\n        expiryAt\n        compliance: Compliance {\n          id\n          name\n        }\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),b=t(11640),h=t(24237),_=t(80285),g=t(18862),I=t(80284),x=t(81185),$=t(7304),j=t(18944),q=t(7720),Z=t(37834),S=t(7917),w=t(85893),A=function(e){var n=(0,S.O)(),t=e.filter((function(e){return(0,S.O)(e.expiryAt)>=n})).length;return parseInt(t/e.length*100)},O=function(e){var n=e.row.compliancesList;if(!n||0===n.length)return null;var t=A(n);return(0,w.jsxs)(P,{children:[(0,w.jsx)(C,{content:"".concat(n.length," : ").concat(t.toString(),"%"),context:T(t),size:"sm"}),k(n)]})},k=function(e){var n=e.find((function(e){(0,Z.r)(e.expiryAt);return e}));return n&&(0,w.jsxs)(D,{children:[(0,w.jsx)(j.Z,{content:(0,g.Z)(n.expiryAt),context:L(n.expiryAt),size:"sm"}),(0,w.jsx)(j.Z,{content:n.compliance.name,size:"sm"})]})},C=(0,h.ZP)(q.Z).withConfig({displayName:"helper__StyledBadge",componentId:"sc-1pr776d-0"})(["margin:0;"]),P=h.ZP.div.withConfig({displayName:"helper__Wrapper",componentId:"sc-1pr776d-1"})(["align-items:center;display:flex;"]),D=h.ZP.div.withConfig({displayName:"helper__Next",componentId:"sc-1pr776d-2"})(["flex-direction:column;margin-left:1rem;"]),T=function(e){return e>79?"success":e>49?"info":"danger"},L=function(e){var n=(0,Z.r)(e);return n>14?"success":n>=0?"info":"danger"},N=t(49705),U=t(73303),E=t.n(U);function R(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function F(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?R(Object(t),!0).forEach((function(n){(0,p.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):R(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var M="/dashboard/properties/",J=new Date,B=(0,b.Z)(J,1),H=(0,b.Z)(J,-12),z=function(e){var n=e.accountId,t=(e.accountName,e.filters),r=(e.showAddButton,(0,N.x)({filters:t})),o=r.initialData,i=r.ref,a=(0,u.a)(v,{variables:F({accountId:n,now:J,nextMonth:B},o)}),s=a.data,d=(s=void 0===s?{properties:[],meta:{aggregate:{totalCount:0}}}:s).properties,l=s.meta,m=a.loading,p=a.refetch,f=function(e){return E()(null===e||void 0===e?void 0:e.filter((function(e){return new Date(e.timingStart)>H&&new Date(e.timingStart)<J})),(function(e){return Number(e.amount)}))},y=function(e){return null===e||void 0===e?void 0:e.find((function(e){return new Date(null===e||void 0===e?void 0:e.timingStart)>J}))},b=function(e,n){return(0,w.jsx)(G,{onClick:function(t){return function(e){var n=e.e,t=e.id,r=e.item;n.stopPropagation(),c.default.push("".concat(M,"view?id=").concat(t,"&tab=compliance&").concat(r,"=1"))}({e:t,id:e.data.id,item:n})},children:e[n]})},h=[{hidden:!0},{hidden:!0},{text:"Name"},{text:"Overdue",formatter:function(e){var n=e.row;return b(n,"overdue")}},{text:"Upcoming",formatter:function(e){var n=e.row;return b(n,"upcoming")}},{text:"Unconfirmed"},{text:"Next Visit"},{text:"Work orders"},{text:"Total Spent",formatter:function(e){var n=e.row;return(0,_.Z)(f(n.data.jobs))}},{formatter:O,text:"Compliance"},{text:"Created"}];return(0,w.jsxs)(I.Z,{fitParentHeight:!0,open:!0,title:"Locations Compliance",children:[(0,w.jsx)($.p,{customerId:n}),(0,w.jsx)(x.t,{columns:h,loading:m,meta:l,ref:i,refetch:p,rowClick:function(e){c.default.push("".concat(M,"view?id=").concat(e.data.id,"&tab=compliance"))},rows:d.map((function(e){var n,t,r,o,i,a;return{data:e,locationId:e.id,location:e.name||"Not Specified",overdue:null===(n=e.overdue)||void 0===n?void 0:n.aggregate.count,upcoming:null===(t=e.upComing)||void 0===t?void 0:t.aggregate.count,unconfirmed:e.jobs.filter((function(e){return!e.scheduledAt})).length,nextVisit:null!==(r=y(null===(o=e.data)||void 0===o?void 0:o.jobs))&&void 0!==r&&r.timingStart?(0,g.Z)(null===(i=y(e.data.jobs))||void 0===i?void 0:i.timingStart):"-",jobs:null===(a=e.jobs)||void 0===a?void 0:a.length,totalSpent:(0,_.Z)(f),compliancesList:e.compliances,createdAt:(0,g.Z)(e.createdAt)}}))})]})},G=h.ZP.a.withConfig({displayName:"table__StyledLink",componentId:"sc-gee8ln-0"})(["display:block;cursor:pointer;color:",";&:hover{background:rgb(221,221,221);}"],(function(e){return e.theme.COLOUR.secondary}));z.defaultProps={hiddenColumns:[],isCompliance:!1,showAddButton:!1,showMediaButton:!1,showOverallRating:!1};var V,W=t(52002),X=t(66639),Y=t(28323),Q=(0,y.Ps)(V||(V=(0,f.Z)(["\n  query GetComplianceRating($accountId: Int!) {\n    properties: Account_Location_aggregate(where: { accountId: { _eq: $accountId } }) {\n      nodes {\n        location: Location {\n          compliances: Compliances_aggregate {\n            aggregate {\n              count\n            }\n          }\n          compliance: Compliances {\n            id\n            expiryAt\n          }\n        }\n      }\n    }\n  }\n"]))),K=t(48213);function ee(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function ne(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ee(Object(t),!0).forEach((function(n){(0,p.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ee(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var te=function(e){var n=e.customerId,t=(0,u.a)(Q,{variables:{accountId:n}}).data,r=(t=void 0===t?{properties:[]}:t).properties;return(0,w.jsx)(I.Z,{open:!0,title:"Compliance Score",children:(0,w.jsx)(re,{onClick:function(){c.default.push("/dashboard/customers/view?id=".concat(n,"&tab=compliance"))},children:(0,w.jsx)(j.Z,ne({},(0,K.Bo)(r)))})})},re=h.ZP.a.withConfig({displayName:"rating__Link",componentId:"sc-1w2kx3z-0"})(["cursor:pointer;text-decoration:none;"]),oe=t(80880),ie=t(87883),ae=t(30381),se=t.n(ae),ce=t(7755),ue=t(70448),de=function(e,n,t){var r=function(e,n,t){var r,o,i,a,s,u,d,l,m,p,f,y,v=(0,ue.WE)(e,"registered"),b=(0,ue.WE)(e,"trading"),h=(0,ue.WE)(e,"invoice"),_=function(e){e&&t()};return[{id:1,label:"Create account",date:e.createdAt},{id:2,label:"Complete profile",info:"",date:(null===v||void 0===v?void 0:v.createdAt)||null,actions:[{id:1,active:!0,content:"Registered address",context:"secondary",handleClick:function(){var t;n.show({content:(0,w.jsx)(ce.H,{addressId:(null===v||void 0===v||null===(t=v.address)||void 0===t?void 0:t.id)||null,entity:"Account",entityId:e.id,id:(null===v||void 0===v?void 0:v.id)||null,onSubmit:_,type:"registered"}),submit:!1,title:"Manage addresses"})},type:"button"},{id:2,active:!0,content:"Trading address",context:"secondary",handleClick:function(){var t;n.show({content:(0,w.jsx)(ce.H,{addressId:(null===b||void 0===b||null===(t=b.address)||void 0===t?void 0:t.id)||null,entity:"Account",entityId:e.id,id:(null===b||void 0===b?void 0:b.id)||null,onSubmit:_,type:"trading"}),submit:!1,title:"Manage addresses"})},type:"button"},{id:3,active:!0,content:"Invoice address",context:"secondary",handleClick:function(){var t;n.show({content:(0,w.jsx)(ce.H,{addressId:(null===h||void 0===h||null===(t=h.address)||void 0===t?void 0:t.id)||null,entity:"Account",entityId:e.id,id:(null===h||void 0===h?void 0:h.id)||null,onSubmit:_,type:"invoice"}),submit:!1,title:"Manage addresses",width:"50%"})},type:"button"}]},{id:3,label:"Add location",info:"",date:null!==(r=e.propertiesMeta)&&void 0!==r&&null!==(o=r.aggregate)&&void 0!==o&&o.count?e.createdAt:null,content:[{id:1,active:(null===(i=e.propertiesMeta)||void 0===i||null===(a=i.aggregate)||void 0===a?void 0:a.count)>0,data:"".concat(null===(s=e.propertiesMeta)||void 0===s||null===(u=s.aggregate)||void 0===u?void 0:u.count," properties added")}],actions:[{id:1,active:!0,content:"Submit location",context:"secondary",handleClick:function(){c.default.push("".concat("/dashboard/customers/","view?id=").concat(e.id,"&tab=locations"))},type:"button"}]},{id:6,label:"Start issuing work orders",info:"submit work orders",date:null!==(d=e.jobsMeta)&&void 0!==d&&null!==(l=d.aggregate)&&void 0!==l&&l.count?e.createdAt:null,content:[{id:1,active:(null===(m=e.jobsMeta)||void 0===m||null===(p=m.aggregate)||void 0===p?void 0:p.count)>0,data:"".concat(null===(f=e.jobsMeta)||void 0===f||null===(y=f.aggregate)||void 0===y?void 0:y.count," jobs created")}]}]}(e,n,t);return r.forEach((function(e){e.date&&(e.date=se()(e.date).format("D MMM YYYY HH:mm"))})),r},le=function(e){return[{label:"Account manager: ",value:e.manager?"".concat(e.manager.nameFirst," ").concat(e.manager.nameLast," "):"Unassigned"},{label:"Users: ",value:e.usersMeta?e.usersMeta.aggregate.count:0},{label:"Status: ",value:e.status||""}]},me=function(e){var n=e.customer,t=e.refetch,r=(0,s.useContext)(oe.Z);return(0,w.jsx)(I.Z,{open:!0,title:"Profile",children:(0,w.jsx)(ie.Z,{items:de(n,r,t),summary:le(n)},"stepper-".concat(n.id))})},pe=t(50899),fe=t(64111),ye=t(77567),ve=t(89331),be=function(e){var n=e.customer,t=e.hasRole,r=e.refetch,o=(0,ue.WE)(n,"registered"),s=(0,ue.WE)(n,"trading"),c=[{key:"Company Number",value:n.companyNumber},{key:"VAT",value:n.vatId}];n.clientType&&c.push({key:"Customer Type",value:n.clientType.name});return(0,w.jsx)(w.Fragment,{children:(0,w.jsxs)(i.Z,{children:[(0,w.jsxs)(a.Z,{md:4,children:[(0,w.jsx)(ye.g,{avatar:(0,Y.Q)(n.media),editable:t("admin"),entity:n,entityName:"Account",icons:t("admin")?(0,ve.Y)(n):[]}),n.contactUsers&&(0,w.jsx)(I.Z,{title:"Contact",children:n.contactUsers.map((function(e){return(0,w.jsxs)("div",{children:[(0,w.jsx)(W.Z,{rows:(n=e,[{key:"Name",value:"".concat(n.user.nameFirst," ").concat(n.user.nameLast)},{key:"Phone",value:n.user.phone},{key:"Email",value:n.user.email}])}),(0,w.jsx)("br",{})]},e.userId);var n}))}),(0,w.jsx)(I.Z,{title:"Company",children:(0,w.jsx)(W.Z,{rows:c})}),o&&(0,w.jsx)(X.f,{address:o.address,entity:"Account",entityId:n.id,id:o.id,refetch:r,title:"Registered Address",type:"registered"}),s&&(0,w.jsx)(X.f,{address:s.address,entity:"Account",entityId:n.id,id:s.id,refetch:r,title:"Trading Address",type:"trading"}),t("admin")&&(0,w.jsx)(fe.E,{entity:"Account",entityId:n.id,open:!0,title:"Notes"})]}),(0,w.jsx)(a.Z,{md:4,children:(0,w.jsx)(me,{refetch:r,customer:n})}),(0,w.jsxs)(a.Z,{md:4,children:[(0,w.jsx)(pe.G,{details:!0,entity:"Account",entityId:n.id}),(0,w.jsx)(te,{customerId:n.id})]})]})})},he=t(47763),_e=t(24019),ge=t(80318),Ie=t(38460),xe=t(57460),$e=t.n(xe),je=t(14347),qe=t(55657),Ze=t(29444),Se=t(91126),we=t(42772),Ae=t(8163),Oe=t(1071),ke=t(68343),Ce=t(65570),Pe=t(1323),De=t(78586);function Te(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function Le(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Te(Object(t),!0).forEach((function(n){(0,p.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Te(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Ne=function(e){var n,t,r=e.filters,o=e.workorderVisibility,i=(0,Pe.x)(),a=i.hasRole,s=i.user,l=(0,De.q)(),m=null===(n=l.admin.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,p=null===(t=l.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,f=(0,N.x)({filters:r}),y=f.initialData,v=f.ref,b=(0,u.a)(d.G5,{variables:Le(Le({},y),{},{number:y.id?String(y.id):null,startDate:y.startDate,endDate:y.endDate,adminId:s.adminId})}),h=b.data,$=(h=void 0===h?{jobs:[],meta:{aggregate:{totalCount:0}}}:h).jobs,q=h.meta,Z=b.loading,S=b.refetch,A=[{hidden:!0},{hidden:!0},{hidden:!0},{text:"ID",formatter:function(e){var n=e.row;return(0,w.jsx)(Ce.D,{id:n.id,invoiceNumber:n.invoiceNumber,number:n.number,numberPrefix:m,numberSuffix:p,openCanvas:!0,type:n.type})}},{text:"Reference"},{text:"Description"},{sortable:!0,sortName:'{"Job": { "Service": {"name": "ORDER"} }}',text:"Service"},{sortable:!0,sortName:'{"Job": { "SLA": {"name": "ORDER"} }}',text:"Priority"},{formatter:(0,Ze.Z)("/dashboard/properties/view","propertyId","location"),sortable:!0,sortName:'{"Job":{"Location": {"name": "ORDER"}}}',text:"Location"},{text:"Total \xa3",formatter:function(e){var n,t,r=e.row;return n=r.jobTotal,t=r.expensesAmountCustomer,(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(j.Z,{size:"xs",children:["Job total ",(0,_.Z)(n)]}),(0,w.jsxs)(j.Z,{size:"xs",children:["Expense customer ",(0,_.Z)(t)]})]})}},{hidden:!0},{hidden:!a("admin"),text:"Supplier \xa3",formatter:function(e){var n,t,r=e.row;return n=r.supplierAmount,t=r.expensesAmountSupplier,(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(j.Z,{size:"xs",children:["Amount ",(0,_.Z)(n)]}),(0,w.jsxs)(j.Z,{size:"xs",children:["Expense amount ",(0,_.Z)(t)]})]})}},{hidden:!0},{hidden:!a("admin"),text:"Revenue",formatter:function(e){var n=e.row;return(0,_.Z)(n.revenue)}},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{text:"Scheduled"},{sortable:!0,sortName:"createdAt",text:"Created"},{sortable:!0,sortName:"status",formatter:function(e){var n=e.row;return(0,ke.B)({value:n.status})},text:"Status"},{hidden:!a("admin"),formatter:Se.Z,formatterData:(0,Ae.t)("/dashboard/issues/"),text:"Actions"}];return(0,w.jsx)(I.Z,{fitParentHeight:!0,open:!0,title:"Work Orders",toolbar:(0,w.jsxs)(w.Fragment,{children:[o?(0,w.jsx)(je.Z,{content:"Create Work Order",context:"secondary",size:"sm",onClick:function(e){e.stopPropagation();var n=(0,Oe.Uu)(r);c.default.push("/dashboard/issues/manage".concat(n))}}):(0,w.jsx)(w.Fragment,{}),function(){var e=(0,Pe.x)().user,n=y.customerId,t=y.endDate,r=y.locationId,o=y.orderBy,i=y.startDate,a=y.status,s=y.supplierId,c=(0,Ie.t)(d.G5,{variables:{adminId:e.adminId,customerId:n,endDate:t,locationId:r,orderBy:o,startDate:i,status:a,supplierId:s},onCompleted:function(n){var t,r=function(e,n,t){var r=t.numberPrefix,o=void 0===r?"":r,i=t.numberSuffix,a=void 0===i?"":i,s="customer"===n;return e.map((function(e){var n,t,r,i,c,u,d,l,m=e.manager?"".concat(e.manager.nameFirst," ").concat(e.manager.nameLast):"Unassigned",p=e.scheduledAt?(0,g.Z)(e.scheduledAt,!0):(0,g.Z)(e.timingStart,!0);return s?{id:"".concat(o," ").concat(e.jobNumber," ").concat(a),type:e.jobType,invoiceNumber:e.invoiceNumber,ref:e.reference,jobTotal:(0,_.Z)(e.jobTotal)||0,expensesAmountCustomer:(0,_.Z)(e.expensesAmountCustomer)||0,priority:(null===(n=e.job.sla)||void 0===n?void 0:n.name)||"-",service:e.serviceName||"-",description:(null===(t=e.job)||void 0===t?void 0:t.description)||"-",manager:m,location:(null===(r=e.job)||void 0===r||null===(i=r.location)||void 0===i?void 0:i.name)||"-",supplier:e.supplierName||"-",scheduleDate:p,created:(0,g.Z)(e.createdAt),status:e.status}:{id:"".concat(o," ").concat(e.jobNumber," ").concat(a),type:e.jobType,invoiceNumber:e.invoiceNumber,ref:e.reference,jobTotal:(0,_.Z)(e.jobTotal)||0,expensesAmountCustomer:(0,_.Z)(e.expensesAmountCustomer)||0,supplierAmount:(0,_.Z)(e.supplierAmount)||0,expensesAmountSupplier:(0,_.Z)(e.expensesAmountSupplier)||0,revenue:(0,_.Z)(e.revenue)||0,priority:(null===(c=e.job.sla)||void 0===c?void 0:c.name)||"-",service:e.serviceName||"-",description:(null===(u=e.job)||void 0===u?void 0:u.description)||"-",manager:m,location:(null===(d=e.job)||void 0===d||null===(l=d.location)||void 0===l?void 0:l.name)||"-",supplier:e.supplierName||"-",scheduleDate:p,created:(0,g.Z)(e.createdAt),status:e.status}}))}(n.jobs,e.accountType,{numberPrefix:m,numberSuffix:p}),o=(null===(t=n.jobs[0])||void 0===t?void 0:t.customerName)||"Customer",i=$e().unparse(r),a="data:application/octet-stream,"+encodeURIComponent(i);(0,we.S)(a,"".concat(o,"-BookingData.csv"))}}),u=(0,ge.Z)(c,1)[0];return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(je.Z,{context:"light",onClick:function(e){e.stopPropagation(),u()},title:"Export to CSV",size:"md",children:(0,w.jsx)(qe.Z,{context:"secondary",icon:"file-csv",size:"lg"})})})}()]}),children:(0,w.jsx)(x.t,{columns:A,loading:Z,meta:q,ref:v,refetch:S,rows:null===$||void 0===$?void 0:$.map((function(e){var n,t,r,o,i,a=e.scheduledAt?(0,g.Z)(e.scheduledAt,!0):(0,g.Z)(e.timingStart,!0);return{id:e.jobId,type:e.jobType,number:e.jobNumber,invoiceNumber:e.invoiceNumber,ref:e.reference||"-",description:(null===(n=e.job)||void 0===n?void 0:n.description)||"-",service:e.serviceName||"-",priority:(null===(t=e.job.sla)||void 0===t?void 0:t.name)||"-",location:(null===(r=e.job)||void 0===r||null===(o=r.location)||void 0===o?void 0:o.name)||"-",jobTotal:e.jobTotal||0,expensesAmountCustomer:e.expensesAmountCustomer||0,supplierAmount:e.supplierAmount||0,expensesAmountSupplier:e.expensesAmountSupplier||0,revenue:e.revenue||0,propertyId:e.priorityId,managerId:null===(i=e.job.manager)||void 0===i?void 0:i.id,customerId:e.customerId,supplierId:e.supplierId||"",scheduleDate:a,date:(0,g.Z)(e.createdAt),status:e.status,actions:""}}))})})};Ne.defaultProps={filters:{assetId:null,managerId:null}};var Ue=t(78424),Ee=t(81550),Re=t(35450),Fe=t(37415),Me=t(63306),Je=t(41482),Be=t(30083),He=t(81167),ze=function(){var e,n,t,r=(0,Pe.x)(),o=r.hasRole,i=r.user,a=(0,De.q)(),p=(0,c.useRouter)().query,f=(0,s.useMemo)((function(){return p.tab||"details"}),[p.tab]),y=(null===a||void 0===a||null===(e=a.admin)||void 0===e||null===(n=e.modules)||void 0===n?void 0:n.sageIntegration)||!1,v="customer"===i.accountType?i.accountId:p.id,b=(0,u.a)(d.UB,{variables:{id:v}}),h=b.loading,_=b.data,g=(_=void 0===_?{customer:{}}:_).customer,I=b.error,x=b.refetch;if(I)return"Error! ".concat(I);var $={accountId:g.id,q:null,filterType:"customer_locations_tab"};return!h&&(0,w.jsxs)(l.Z,{children:[(0,w.jsx)("div",{active:"details"===f||!f,label:"Details",children:(0,w.jsx)(be,{customer:g,hasRole:o,refetch:x})}),(0,w.jsx)("div",{active:"finance"===f,label:"Finance",children:(0,w.jsx)(he.b,{accountId:g.id,accountName:g.name,accountRefetch:x,meta:g.meta,hasSageIntegration:y})}),(0,w.jsx)("div",{active:"users"===f,label:"Users",children:(0,w.jsx)(He.P,{accountType:"customer",filters:{accountId:g.id}})}),(0,w.jsx)("div",{active:"locations"===f,label:"Locations",children:(0,w.jsx)(m.J,{accountId:g.id,accountName:g.name,FiltersComp:Ee.x,hiddenColumns:["Compliances","Customer","Next Due"],initialFilters:$,showAddButton:!0,TableComp:Ue.V})}),(0,w.jsxs)("div",{active:"compliance"===f,label:"Compliance",children:[(0,w.jsx)(z,{accountId:g.id,filters:{accountId:g.id},hiddenColumns:["Address","Customer"],initialFilters:{accountId:g.id,filterType:"customer_compliance_tab"},showMediaButton:!0,showOverallRating:!0,sortOrder:{item:"expiryAt",order:"desc"}}),(0,w.jsx)("div",{active:"bookings"===f,label:"Quotes",children:(0,w.jsx)(m.J,{FiltersComp:_e.h,initialFilters:{customerId:g.id,startDate:null,endDate:null,status:null,locationId:null,supplierId:null,noAssignToMeFilter:!0,id:null,filterType:"customer_bookings_quotes_tab"},TableComp:Ne,workorderVisibility:!0})})]}),(0,w.jsx)("div",{active:"bookings"===f,label:"Bookings",children:(0,w.jsx)(m.J,{FiltersComp:_e.h,initialFilters:{customerId:g.id,startDate:null,endDate:null,status:null,locationId:null,supplierId:null,noAssignToMeFilter:!0,id:null,filterType:"customer_bookings_tab"},TableComp:Ne,workorderVisibility:!0})}),(0,w.jsx)("div",{active:"slas"===f,label:"SLAs",children:(0,w.jsx)(Be.C,{entity:"Account",entityId:g.id})}),(0,w.jsx)("div",{active:"services"===f,label:"Services",children:(0,w.jsx)(m.J,{edit:o("admin"),entity:"Account",entityId:g.id,FiltersComp:Je.l,hasCustomRates:Boolean(null===(t=g.meta)||void 0===t?void 0:t.hasCustomRates),initialFilters:{entity:"Account",entityId:g.id,countryId:null,currencyId:null,filterType:"customer_services_tab"},TableComp:Me.o,type:"customer"})}),(0,w.jsx)("div",{active:"quotes"===f,label:"Quotes",children:(0,w.jsx)(m.J,{FiltersComp:Re.r,initialFilters:{customerId:g.id,supplierId:null,status:null,id:null,filterType:"customer_quote_tab"},TableComp:Fe.v})})]},f)},Ge=function(){return(0,w.jsx)(i.Z,{children:(0,w.jsx)(a.Z,{md:12,children:(0,w.jsx)(ze,{})})})},Ve=function(){return(0,w.jsx)(o.Z,{View:(0,w.jsx)(Ge,{})})}},18888:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/customers/view",function(){return t(86814)}])}},function(e){e.O(0,[367,9809,284,4195,5312,7287,2002,3086,7134,3486,9082,3515,4712,1265,6996,9666,4177,7431,5597,8158,7615,2148,999,7622,899,3016,1110,8606,9431,1670,9774,2888,179],(function(){return n=18888,e(e.s=n);var n}));var n=e.O();_N_E=n}]);