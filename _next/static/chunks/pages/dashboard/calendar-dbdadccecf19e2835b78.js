(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3259],{87160:function(e,t,n){"use strict";n.d(t,{F:function(){return z}});var i,s=n(92809),r=n(83789),o=n(10219),a=n(30266),c=n(64687),l=n.n(c),u=n(67294),d=n(11163),p=n(26075),f=n(52209),m=(0,n(54397).Ps)(i||(i=(0,f.Z)(['\n  query GetEvents($where: Job_bool_exp) {\n    events: Job(where: $where) {\n      id\n      number\n      description\n      end: timingStart\n      scheduledAt\n      siteVisitStart\n      start: timingStart\n      status\n      title\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      supplierQuotes: SupplierQuotes(\n        where: {\n          siteVisitAt: { _is_null: false }\n          status: { _neq: "cancelled" }\n          type: { _eq: "quote" }\n        }\n      ) {\n        siteVisitAt\n        quoteNumber\n      }\n    }\n  }\n']))),h=n(80880),g=n(80284),x=n(78215),y=n(2356),v=n(92700),j=n(90358),b=n(1323),w=n(78586),_=n(12517),Z=n(55148),S=n(39129),P=n(34610),k=n(22796),C=n(18944),V=n(84550),q=n(24237),O=n(85893),I=function(e){var t=e.setTypes,n=e.setSiteVisit,i=e.types,s=function(e,n){t(n?[].concat((0,r.Z)(i),[e]):i.filter((function(t){return t!==e})))};return(0,O.jsxs)(x.Z,{children:[(0,O.jsxs)(T,{md:3,children:[(0,O.jsx)(P.Z,{onToggle:function(e){return s("reactive",e)},size:"sm",toggled:i.includes("reactive")}),(0,O.jsx)(k.Z,{marginLeft:"sm"}),(0,O.jsx)(C.Z,{size:"sm",children:"Reactive"})]}),(0,O.jsxs)(T,{md:3,children:[(0,O.jsx)(P.Z,{onToggle:function(e){return s("ppm",e)},size:"sm",toggled:i.includes("ppm")}),(0,O.jsx)(k.Z,{marginLeft:"sm"}),(0,O.jsx)(C.Z,{size:"sm",children:"PPM"})]}),(0,O.jsxs)(T,{md:3,children:[(0,O.jsx)(P.Z,{onToggle:function(e){return s("quote",e)},size:"sm",toggled:i.includes("quote")}),(0,O.jsx)(k.Z,{marginLeft:"sm"}),(0,O.jsx)(C.Z,{size:"sm",children:"Quote"})]}),(0,O.jsxs)(T,{md:3,children:[(0,O.jsx)(P.Z,{onToggle:function(e){return s("cppm",e)},size:"sm",toggled:i.includes("cppm")}),(0,O.jsx)(k.Z,{marginLeft:"sm"}),(0,O.jsx)(C.Z,{size:"sm",children:"Compliance"})]}),(0,O.jsxs)(k.Z,{marginLeft:"sm",children:[(0,O.jsx)(V.Z,{data:[{label:"Only show site visits",id:"siteVisit",value:"yes"}],name:"siteVisit",onClick:function(e){n(e.target.checked)}}),(0,O.jsx)(k.Z,{})]})]})},T=(0,q.ZP)(y.Z).withConfig({displayName:"filters__StyledColumn",componentId:"sc-3gjja8-0"})(["align-items:center;display:flex;"]),A=["supplierQuotes"];function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var z=function(e){var t,n,i=e.defaultFilters,s=e.defaultView,c=e.locationId,f=e.showCompliance,P=e.showFilters,k=e.showSiteVisits,C=e.supplierId,V=(0,d.useRouter)().query,q=(0,u.useContext)(h.Z),T=(0,w.q)(),N=null===(t=T.admin.jobSetting)||void 0===t?void 0:t.jobNumberPrefix,z=null===(n=T.admin.jobSetting)||void 0===n?void 0:n.jobNumberSuffix,E=(0,b.x)().user,L=(0,p.x)(),F=!1,G=!1;switch(E.accountType){case"supplier":G=!0;break;case"customer":F=!0}var J=(0,u.useState)(V.type?["".concat(V.type)]:i),Q=J[0],W=J[1],M=(0,u.useState)(k),R=M[0],H=M[1],X="scheduled"===V.type?"PPM":"Bookings";(0,u.useEffect)((function(){return V.type?["".concat(V.type)]:W(G?["ppm"]:i)}),[i]);var $=function(){var e=(0,a.Z)(l().mark((function e(t,n){var i,s,a,u,d;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={type:{_in:Q},_or:[{_and:[{timingStart:{_gte:t.start}},{timingStart:{_lte:t.end}}]},{_and:[{scheduledAt:{_gte:t.start}},{scheduledAt:{_lte:t.end}}]},{_and:[{siteVisitStart:{_gte:t.start}},{siteVisitStart:{_lte:t.end}}]}]},G&&(i.supplierId={_eq:E.accountId}),C&&(i.supplierId={_eq:C}),F&&(i.customerId={_eq:E.accountId}),c&&(i.locationId={_eq:c}),(f||c)&&(i.Compliances={complianceId:{_is_null:!1}}),R&&(i.siteVisitStart={_is_null:!1}),e.next=9,L.query({query:m,variables:{where:i}});case 9:s=e.sent,a=s.data,u=(a=void 0===a?{events:[]}:a).events,d=[],u.map((function(e){var t,n=e.supplierQuotes,i=(0,o.Z)(e,A),s=(null===i||void 0===i||null===(t=i.shortJobDesc[0])||void 0===t?void 0:t.taxonomy.name)||i.title;return d=[].concat((0,r.Z)(d),[D(D({},e),{},{title:s})]),n.length>0&&n.map((function(e){return d=[].concat((0,r.Z)(d),[D(D({},i),{},{start:e.siteVisitAt,end:e.siteVisitAt,title:"".concat(s," ").concat(e.quoteNumber),siteVisit:!0})])})),d})),n(d.map((function(e){var t=D({},e);return t.start=t.scheduledAt||t.start,t.end=t.scheduledAt||t.end||t.start,t.color=t.siteVisit?"rgb(182, 79, 200)":(0,j.t)(t.status),t})));case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return(0,O.jsxs)(g.Z,{fitParentHeight:!0,open:!0,title:X,children:[P&&(0,O.jsx)(I,{setTypes:W,setSiteVisit:H,types:Q}),(0,O.jsx)(v.A,{eventClick:function(e){q.show({content:(0,O.jsx)(_.g,{jobId:parseInt(e.event.id),toggleShow:q.close,numberPrefix:N,numberSuffix:z}),title:"Job details",submit:!1,width:"50%"})},events:$,initialView:"day"===V.show?"timeGridDay":s}),(0,O.jsx)(x.Z,{children:(0,O.jsx)(y.Z,{md:12,children:(0,O.jsx)(S.D,{status:Z.yW})})})]})};z.defaultProps={dateClick:!1,defaultFilters:["reactive","ppm","quote","cppm"],showFilters:!0,showSiteVisits:!1}},92700:function(e,t,n){"use strict";n.d(t,{A:function(){return r}});var i=n(68794),s=n(85893),r=function(e){var t=e.dateClick,n=e.events,r=e.eventClick,o=e.eventContent,a=(e.hasLoading,e.height),c=e.initialView;return(0,s.jsx)(i.Z,{dateClick:t,eventClick:r,eventContent:o,events:n,hasLoading:!0,height:a,headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},initialView:c})};r.defaultProps={initialView:"listWeek",hasLoading:!0,height:550}},39129:function(e,t,n){"use strict";n.d(t,{D:function(){return r}});var i=n(24237),s=n(85893),r=function(e){var t=e.status;return(0,s.jsx)(o,{children:(0,s.jsx)("ul",{children:t.map((function(e,t){return(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{style:{backgroundColor:e.colour}}),e.text]},"legend".concat(t))}))})})},o=i.ZP.div.withConfig({displayName:"legend__StyledContainer",componentId:"sc-1gaw8i-0"})(["ul{list-style:none;float:left;padding-top:15px;}ul li{display:flex;flex-direction:row;align-items:center;float:left;width:120px;font-size:90%;list-style:none;}li span{display:block;float:left;height:12px;width:12px;margin-right:5px;}"])},37047:function(e,t,n){"use strict";n.r(t);var i=n(11163),s=n(66918),r=n(87160),o=n(85893);t.default=function(){var e=(0,i.useRouter)().query,t=e.type?["".concat(e.type)]:["reactive","quote","cppm"];return(0,o.jsx)(s.Z,{pageHeading:{heading:"Calendar"},children:(0,o.jsx)(r.F,{defaultFilters:t})})}},88884:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/calendar",function(){return n(37047)}])}},function(e){e.O(0,[367,284,4195,5312,7287,2002,3086,7134,3486,9082,3515,4712,1265,6996,9666,4177,5540,5146,899,3016,9774,2888,179],(function(){return t=88884,e(e.s=t);var t}));var t=e.O();_N_E=t}]);