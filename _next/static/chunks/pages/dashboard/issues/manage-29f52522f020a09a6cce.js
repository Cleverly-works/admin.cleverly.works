(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5503],{34112:function(e,t,r){"use strict";r.d(t,{E:function(){return n}});var n=function(e,t){var r;if(Array.isArray(t)){var n=null;return t.forEach((function(t){var r,o=null===e||void 0===e||null===(r=e.timings)||void 0===r?void 0:r.find((function(e){return e.status===t}));n=(null===o||void 0===o?void 0:o.createdAt)||n})),n}var o=null===e||void 0===e||null===(r=e.timings)||void 0===r?void 0:r.find((function(e){return e.status===t}));return(null===o||void 0===o?void 0:o.createdAt)||null}},49313:function(e,t,r){"use strict";r.d(t,{n:function(){return v}});var n=r(92809),o=r(80284),i=r(69128),a=r(34868),c=r(11570),l=r(78215),s=r(2356),u=r(7863),d=r(85893);function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var v=function(e){var t=e.errors,r=e.register,n=e.pricingWatch,m=e.hasServiceRate,v={register:r,errors:t};return(0,d.jsxs)(o.Z,{dataSet:{"data-cy":"pricing"},open:!0,title:"Pricing",children:[(0,d.jsx)(i.Z,p(p({},v),{},{data:u.Hu,legend:"Pricing",name:"pricing"})),"time-materials"===n&&(0,d.jsx)(a.Z,p(p({},v),{},{label:"Spend Threshold",name:"customerSpendThreshold",vat:"Ex VAT"})),"fixed"===n&&(0,d.jsxs)(d.Fragment,{children:[m?(0,d.jsx)(c.Z,{content:"This Customer has the service rate, The customer cost is calculated with it",context:"info"}):(0,d.jsx)(a.Z,p(p({},v),{},{label:"Customer",name:"amount",vat:"Ex VAT"})),(0,d.jsxs)(l.Z,{children:[(0,d.jsx)(s.Z,{sm:12,md:6,children:(0,d.jsx)(a.Z,p(p({},v),{},{label:"Supplier labour amount",name:"supplierLabourAmount",vat:"Ex VAT"}))}),(0,d.jsx)(s.Z,{sm:12,md:6,children:(0,d.jsx)(a.Z,p(p({},v),{},{label:"Supplier materials amount",name:"supplierMaterialsAmount",vat:"Ex VAT"}))})]})]}),(0,d.jsx)(i.Z,p(p({},v),{},{data:u.ck,legend:"Payment Method",name:"paymentMethod"}))]})}},3391:function(e,t,r){"use strict";r.d(t,{t:function(){return u}});var n=r(92809),o=r(80284),i=r(95146),a=r(72197),c=r(85893);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u=function(e){var t=e.control,r=e.errors,n={control:t,errors:r,register:e.register};return(0,c.jsxs)(o.Z,{dataSet:{"data-cy":"taxonomy"},open:!0,title:"Service",children:[(0,c.jsx)(a.l,s(s({},n),{},{label:"Cost category",name:"costCategorySelected",type:"costCategory"})),(0,c.jsx)(i.P,s(s({},n),{},{errors:s({},r),name:"serviceSelected",label:"Service",type:"service"}))]})}},7566:function(e,t,r){"use strict";r.d(t,{X:function(){return P}});var n=r(92809),o=r(67294),i=r(80284),a=r(65375),c=r(46482),l=r(69128),s=r(78215),u=r(2356),d=r(84550),m=r(76800),p=r(7863),v=[{text:"Select...",value:""},{text:"Today",value:"today"},{text:"This week",value:"thisWeek"},{text:"This month",value:"thisMonth"},{text:"Next Three month",value:"nextThreeMonth"}],f=r(4135),b=r(43703),y=r(11640),j=r(83894),h=r(69119),g=r(67090),O=r(85893);function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var S=p.KB,P=function(e){var t=e.control,r=e.errors,n=e.hasRole,x=e.query,P=e.register,Z=e.setValue,D=e.timingWatch,q=e.watch,I={control:t,errors:r,register:P},E=n("customer")&&!n("admin"),T=q("pricing"),k=q("timingStart"),A=q("timingEnd"),C=q("multipleDays"),M=q("timeSpan"),V=q("timing");(0,o.useEffect)((function(){E&&(S=p.KB.filter((function(e){return"at"!==e.value})),Z("timing","between")),M&&W({time:M,setValue:Z})}),[M]),(0,o.useEffect)((function(){"at"===V&&Z("timeSpan","")}),[V]);var W=function(e){var t,r,n=e.time,o=e.setValue,i=function(){var e=(0,f.Z)(new Date),t=(0,b.Z)(new Date);return{monthEnd:e,nextThreeEnd:(0,f.Z)((0,y.Z)(new Date(t),2)),todayEnd:(0,j.Z)(new Date),todayStart:(0,h.Z)(new Date),weekEnd:(0,g.Z)(new Date)}}(),a=i.monthEnd,c=i.todayStart,l=i.weekEnd,s=i.todayEnd,u=i.nextThreeEnd;switch(n){case"today":t=c,r=s;break;case"thisWeek":t=c,r=l;break;case"thisMonth":t=c,r=a;break;case"nextThreeMonth":t=c,r=u}o("timing","between"),o("timingStart",t),o("timingEnd",r)},R=function(e){var t=k?new Date(k):new Date,r=new Date(e);return t.getTime()<r.getTime()};return(0,O.jsxs)(i.Z,{dataSet:{"data-cy":"timing"},open:!0,title:"Timing",children:[!(null!==x&&void 0!==x&&x.id)&&Z&&(0,O.jsx)(a.Z,{label:"Select Time span",children:(0,O.jsx)(c.Z,w(w({},I),{},{name:"timeSpan",options:v}))}),(0,O.jsx)(l.Z,w(w({},I),{},{data:S,legend:"Timing",name:"timing"})),(0,O.jsxs)(s.Z,{children:[(0,O.jsxs)(u.Z,{md:12,children:[(0,O.jsx)(a.Z,{label:"Start time"}),(0,O.jsx)(m.M,w(w({},I),{},{dateFormat:"d MMM yyyy HH:mm",maxDate:A?new Date(A):null,minDate:new Date,filterTime:function(e){var t=new Date,r=new Date(e);return t.getTime()<r.getTime()},name:"timingStart",placeholder:"Click to select Start time",showTimeSelect:!0,todayButton:!1}))]}),"at"!==D&&(0,O.jsxs)(u.Z,{md:12,children:[(0,O.jsx)(a.Z,{label:"End time"}),(0,O.jsx)(m.M,w(w({},I),{},{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!1,minDate:k?new Date(k):new Date,filterTime:R,name:"timingEnd",showTimeSelect:!0,todayButton:!1}))]})]}),k instanceof Date&&"fixed"===T&&(0,O.jsx)(d.Z,w(w({},I),{},{data:[{id:"multipleDays",label:"Multiple days"}],name:"multipleDays"})),C&&(0,O.jsx)(a.Z,{label:"End Date",children:(0,O.jsx)(m.M,w(w({},I),{},{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!0,filterTime:R,minDate:k?new Date(k):new Date,name:"endDate",showTimeSelect:!0,todayButton:!1}))}),n("admin")&&(0,O.jsx)(d.Z,w(w({},I),{},{data:[{id:"allowTimingNormalHours",label:"Allow premium rates to be used",value:"allowTimingNormalHours"}],name:"allowTimingNormalHours"}))]})}},39821:function(e,t,r){"use strict";r.d(t,{C:function(){return o},G:function(){return i}});var n=r(19501),o=function(e,t){return(0,n.Ry)().shape({managerSelected:t("admin")&&(0,n.Ry)().required(),customerSelected:(0,n.Ry)().nullable().required(),customerUserSelected:(0,n.Ry)().required(),source:t("admin")&&(0,n.Z_)().oneOf(["call","email","portal","other"]).required(),slaId:!e.quoted&&(0,n.Rx)().required(),description:(0,n.Z_)().required(),taxonomyId_ShortDesc:(0,n.Ry)().required(),reference:(0,n.Z_)(),locationSelected:(0,n.Ry)().required(),access:(0,n.Z_)().required(),pricing:!e.quoted&&(0,n.Z_)().oneOf(["time-materials","fixed"]),customerSpendThreshold:!e.quoted&&(0,n.Rx)().transform((function(e){return isNaN(e)?null:e})).nullable(),amount:!e.quoted&&(0,n.Rx)().transform((function(e){return isNaN(e)?null:e})).nullable(),supplierLabourAmount:!e.quoted&&(0,n.Rx)().transform((function(e){return isNaN(e)?null:e})).nullable(),supplierMaterialsAmount:!e.quoted&&(0,n.Rx)().transform((function(e){return isNaN(e)?null:e})).nullable(),paymentMethod:!e.quoted&&(0,n.Z_)().oneOf(["card","invoice","N/A"]),quoteNumber:e.quoted&&(0,n.Z_)().required(),quoteDue:e.quoted&&(0,n.hT)().required(),siteVisitStart:e.quoted&&(0,n.hT)().when("siteVisitReq",{is:"true",then:(0,n.hT)().required()}),siteVisitEnd:e.quoted&&(0,n.hT)().when("siteVisitReq",{is:"true",then:(0,n.hT)().required()}),siteVisitWeekends:e.quoted&&(0,n.Z_)(),costCategorySelected:t(["admin","customer"])&&!e.quoted&&(0,n.Ry)().required(),serviceSelected:t(["admin","customer"])&&!e.quoted&&(0,n.Ry)().required(),timing:!e.quoted&&(0,n.Z_)().required().oneOf(["at","between"]),timingStart:!e.quoted&&(0,n.hT)().required(),timingEnd:!e.quoted&&(0,n.hT)().when("timing",{is:"between",then:(0,n.hT)().required()}),allowTimingNormalHours:!e.quoted&&(0,n.Z_)(),complianceSelected:(0,n.Ry)().when("compliance",{is:"true",then:(0,n.Ry)().required()})})},i=(0,n.Ry)().shape({title:(0,n.Z_)().required(),description:(0,n.Z_)().required(),access:(0,n.Z_)(),serviceSelected:(0,n.Ry)().required(),timingEnd:(0,n.hT)().required(),timingStart:(0,n.hT)().required()})},7863:function(e,t,r){"use strict";r.d(t,{ck:function(){return n},Hu:function(){return o},KB:function(){return i},sT:function(){return a},M2:function(){return c}});var n=[{id:"invoice",label:"Invoice",value:"invoice"},{id:"card",label:"Card",value:"card"},{id:"N/A",label:"N/A",value:"N/A"}],o=[{id:"time-materials",label:"Time & Materials",value:"time-materials"},{id:"fixed",label:"Fixed",value:"fixed"}],i=[{id:"at",label:"At",value:"at"},{id:"between",label:"Between",value:"between"}],a=function(e){return[{icon:"file-alt",tooltip:"Create follow up"},{icon:"edit",tooltip:"Edit issue",to:"quote"===e.type?"/dashboard/issues/manage?id=".concat(e.number,"&quoted=1"):"/dashboard/issues/manage?id=".concat(e.number)}]},c=[{id:"complete",label:"Job complete",value:"complete"},{id:"completeCertificate",label:"Job complete, certificate to follow",value:"completeCertificate"},{id:"returnVisit",label:"Return visit required",value:"returnVisit"},{id:"returnVisitByAnother",label:"Visit required by another supplier",value:"returnVisitByAnother"},{id:"couldNotDo",label:"Could not do",value:"couldNotDo"}]},75838:function(e,t,r){"use strict";r.d(t,{bg:function(){return n},WG:function(){return o}});var n=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}],o=[{text:"Status",value:""},{text:"Open",value:"open"},{text:"Resolved",value:"resolved"},{text:"Closed",value:"closed"}]},25472:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Me}});var n=r(92809),o=r(11163),i=r(66918),a=r(30266),c=r(80318),l=r(64687),s=r.n(l),u=r(67294),d=r(38460),m=r(75709),p=r(84774),v=r(53825),f=r(34112),b=r(42283),y=r(79665),j=r(47385),h=r(97202),g=r(78215),O=r(2356),x=r(14347),w=r(93633),S=r(38478),P=r(83863),Z=r(54559),D=r(80880),q=r(18862),I=r(80284),E=r(81185),T=r(12517),k=r(49705),A=r(78586),C=r(85893);function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var W=(0,P.Z)((0,Z.Z)(new Date,12)),R=(0,u.memo)((function(e){var t,r,n=e.jobId,o=e.locationId,i=e.serviceId,a=(0,k.x)({filters:{}}),c=a.initialData,l=a.ref,s=(0,u.useContext)(D.Z),d=(0,A.q)(),m=null===(t=d.admin.jobSetting)||void 0===t?void 0:t.jobNumberPrefix,p=null===(r=d.admin.jobSetting)||void 0===r?void 0:r.jobNumberSuffix,v=(0,w.a)(S.sW,{variables:V(V({jobId:n,locationId:o},c),{},{serviceId:i,startDate:W})}),f=v.data,b=(f=void 0===f?{jobs:[],meta:{aggregate:{totalCount:0}}}:f).jobs,y=f.meta,j=v.loading,h=v.refetch;return(0,C.jsx)(I.Z,{title:"Job History",children:(0,C.jsx)(E.t,{columns:[{hidden:!0,text:"Id"},{text:"Title"},{text:"Service"},{text:"Date"}],history:!1,loading:j,meta:y,ref:l,refetch:h,rowClick:function(e){s.show({content:(0,C.jsx)(T.g,{jobId:e.id,toggleShow:s.close,numberPrefix:m,numberSuffix:p}),submit:!1,title:"Job details",width:"50%"})},rows:b.map((function(e){var t;return{id:e.id,title:e.title,service:null===(t=e.service)||void 0===t?void 0:t.name,createdDate:(0,q.Z)(e.createdAt)}}))})})}),(function(e,t){var r=!0;return t.locationId===e.locationId&&t.serviceId===e.serviceId||(r=!1),r})),_=r(83789),N=r(65375),H=r(46482),B=r(95146),F=r(57626),J=r(56257);function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var L=(0,u.memo)((function(e){var t=e.control,r=e.customerSelectedWatch,n=e.errors,o=e.hasRole,i={control:t,errors:n,register:e.register};return(0,C.jsxs)(I.Z,{dataSet:{"data-cy":"customer"},open:!0,title:"Customer",children:[(0,C.jsx)(B.P,Q(Q({},i),{},{errors:Q({},n),label:"Customer",name:"customerSelected",type:"customer"})),r&&(0,C.jsx)(B.P,Q(Q({},i),{},{isDisabled:!o([].concat((0,_.Z)(J.td),(0,_.Z)(J.Sf),(0,_.Z)(J.n))),accountId:(null===r||void 0===r?void 0:r.value)||null,errors:Q({},n),label:"Contact User",name:"customerUserSelected",type:"user"})),o("admin")&&(0,C.jsx)(N.Z,{label:"Source",children:(0,C.jsx)(H.Z,Q(Q({},i),{},{name:"source",options:F.Y}))})]})}),(function(e,t){var r,n;return e.customerSelectedWatch===t.customerSelectedWatch&&!(null!==(r=t.errors.customerSelected)&&void 0!==r&&r.message)&&!(null!==(n=t.errors.customerUserSelected)&&void 0!==n&&n.message)})),X=r(22796),G=r(83528),K=r(69128),Y=r(11570),z=r(71247),$=r(84550),ee=r(5e3),te=r(72197),re=r(92549),ne=r(45935);function oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ae=function(e){var t,r=e.complianceWatch,n=e.control,o=e.currentAnswers,i=e.customerSelectedWatch,a=e.errors,l=e.hasRole,s=e.isQuote,m=e.jobId,v=e.locationSelectedWatch,f=e.prevTaxonomy,b=e.register,y=e.taxonomyWatch,j=e.watch,h=(0,u.useContext)(D.Z),g=(0,u.useState)(o),O=g[0],x=g[1],w=(0,d.t)(p.Ab,{variables:{customerId:null===i||void 0===i?void 0:i.value,locationId:null===v||void 0===v?void 0:v.value}}),S=(0,c.Z)(w,2),P=S[0],Z=S[1].data,q=j("slaId");(0,u.useEffect)((function(){var e;null!==Z&&void 0!==Z&&null!==(e=Z.slas)&&void 0!==e&&e.length||P()}),[]),(0,u.useEffect)((function(){y!==f&&y&&M(null===y||void 0===y?void 0:y.childs)}),[y]);var E=(0,ne.G2)(Z),T=null===E||void 0===E||null===(t=E.find((function(e){return e.id===Number(q)})))||void 0===t?void 0:t.notes,k={errors:a,register:b,control:n},A=function(e){x(e),h.close()},M=function(e){e&&e.length>0?h.show({content:(0,C.jsx)(re.D,{onSuccess:A,entity:"Job",entityId:m,questions:e}),title:"Please answer the following questions"}):x([])};return(0,C.jsxs)(I.Z,{dataSet:{"data-cy":"details"},open:!0,title:"Description",children:[(0,C.jsx)(te.l,ie(ie({},k),{},{label:s?"Quote Headline":"Short job description",name:"taxonomyId_ShortDesc",type:"jobTags"})),(0,C.jsx)(ee.y,{answers:O,onEdit:M}),(0,C.jsx)(X.Z,{}),(0,C.jsx)(N.Z,{label:"Work Description",children:(0,C.jsx)(G.Z,ie(ie({},k),{},{name:"description",rows:3}))}),!s&&!!E.length&&(0,C.jsx)(K.Z,ie(ie({},k),{},{data:E,legend:"Priority",name:"slaId"})),!s&&q&&(0,C.jsx)(Y.Z,{content:T||"-",context:"light"}),(0,C.jsx)(N.Z,{label:"".concat(l("customer")?"Your reference":"Customer reference"),children:(0,C.jsx)(z.Z,ie(ie({},k),{},{name:"reference"}))}),(0,C.jsx)(z.Z,ie(ie({},k),{},{name:"questions",type:"hidden",defaultValue:JSON.stringify(O)})),(0,C.jsx)($.Z,ie(ie({},k),{},{data:[{id:"compliance",label:"Compliance",value:!!r}],name:"compliance"})),r&&(0,C.jsx)(B.P,ie(ie({},k),{},{errors:ie({},a),label:"",locationId:null===v||void 0===v?void 0:v.value,name:"complianceSelected",type:"compliance"}))]})};ae.defaultProps={isQuote:!1};var ce=r(26),le=r(14399);function se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?se(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var de=function(e){var t=e.assetCategoryWatch,r=e.control,n=e.customerSelectedWatch,o=e.customerUserSelectedWatch,i=e.errors,a=e.locationSelectedWatch,l=e.register,s=e.setValue,u=["manager","owner"],d={control:r,errors:i,register:l},m=function(e){var t=(0,c.Z)(e,1)[0];s("locationSelected",{value:t.id,label:t.name})},p=(0,w.a)(le.kB,{variables:{accountId:null===n||void 0===n?void 0:n.value,userId:null===o||void 0===o?void 0:o.value}}).data,v=(p=void 0===p?{accountUsers:[]}:p).accountUsers;return(0,C.jsxs)(I.Z,{dataSet:{"data-cy":"location"},open:!0,title:"Location",children:[(0,C.jsx)(B.P,ue(ue({},d),{},{accountId:null===n||void 0===n?void 0:n.value,errors:ue({},i),name:"locationSelected",label:"Property",type:"property",customerRole:v.some((function(e){return u.includes(e.role)}))?null:"user",customerId:null===o||void 0===o?void 0:o.value,AddForm:function(){return(0,C.jsx)(ce.V,{initialValues:{propertyOwner:ue({},n)},isPropsComponent:!0,entity:"Location",onAddressCreated:m})}})),a&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(N.Z,{label:"Access information",children:(0,C.jsx)(G.Z,ue(ue({},d),{},{name:"access",rows:2}))}),(0,C.jsx)(B.P,ue(ue({},d),{},{isClearable:!1,label:"Asset Category",locationId:a.value,name:"assetCategorySelected",type:"assetCategory"})),t&&(0,C.jsx)(B.P,ue(ue({},d),{},{label:"Assets",locationId:a.value,assetCategoryId:(null===t||void 0===t?void 0:t.value)||null,name:"assetSelected",type:"asset",isMulti:!0}))]})]})};function me(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?me(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):me(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ve=(0,u.memo)((function(e){var t=e.control,r=e.errors,n=e.user;return(0,C.jsx)(I.Z,{dataSet:{"data-cy":"manager"},open:!0,title:"Admin User",children:(0,C.jsx)(B.P,{control:t,accountId:n.accountId,errors:pe({},r),isClearable:!1,label:"Assigned to",name:"managerSelected",type:"user"})})}),(function(e,t){return!0}));function fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ye=["1w","1m","3m","6m","12m"].map((function(e){return{id:e,label:e,value:e}})),je=[1,2,3,4].map((function(e){return{id:"week"+e,label:e,value:"week"+e}})),he=function(e){var t=e.control,r=e.errors,n=(e.locationId,{control:t,errors:r,register:e.register});return(0,C.jsxs)(I.Z,{dataSet:{"data-cy":"ppm"},open:!0,title:"PPM",children:[(0,C.jsx)($.Z,be(be({},n),{},{data:ye,legend:"Frequency",name:"frequency",stacked:!1})),(0,C.jsx)(N.Z,{label:"Frequency Description",children:(0,C.jsx)(G.Z,be(be({},n),{},{name:"frequencyDesc",rows:2}))}),(0,C.jsx)($.Z,be(be({},n),{},{data:je,legend:"Week",name:"week",stacked:!1}))]})},ge=r(49313),Oe=r(76800);function xe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function we(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Se=function(e){var t=e.control,r=e.errors,n=e.register,o=e.siteVisitWatch,i=e.watch,a={control:t,errors:r,register:n},c=i("siteVisitStart"),l=i("siteVisitEnd"),s=i("siteVisitWeekends"),u=function(e){var t=e.getDay();return 0!==t&&6!==t};return(0,C.jsxs)(I.Z,{dataSet:{"data-cy":"quote"},open:!0,title:"Quote information",children:[(0,C.jsx)(N.Z,{label:"Number of Quotes",children:(0,C.jsx)(H.Z,we(we({},a),{},{name:"quoteNumber",placeholder:"Select number of quotes",range:[4,1]}))}),(0,C.jsx)(N.Z,{label:"Quote due date",children:(0,C.jsx)(Oe.M,we(we({},a),{},{name:"quoteDue",placeholder:"Click to select Quote Due Date"}))}),(0,C.jsx)($.Z,we(we({},a),{},{data:[{id:"siteVisitReq",label:"Site visit required",value:!0}],name:"siteVisitReq"})),o&&(0,C.jsxs)(g.Z,{children:[(0,C.jsx)(O.Z,{md:12,children:(0,C.jsx)($.Z,we(we({},a),{},{data:[{id:"siteVisitWeekends",label:"Include Weekends",value:!0}],name:"siteVisitWeekends"}))}),(0,C.jsxs)(O.Z,{md:12,children:[(0,C.jsx)(N.Z,{label:"Start time"}),(0,C.jsx)(Oe.M,we(we({},a),{},{dateFormat:"d MMM yyyy HH:mm",minDate:new Date,maxDate:l?new Date(l):null,filterTime:function(e){var t=new Date,r=new Date(e);return r.getHours()>=8&&r.getHours()<17&&t.getTime()<r.getTime()},filterDate:!s&&u,name:"siteVisitStart",showTimeSelect:!0,todayButton:!1}))]}),c&&(0,C.jsxs)(O.Z,{md:12,children:[(0,C.jsx)(N.Z,{label:"End time"}),(0,C.jsx)(Oe.M,we(we({},a),{},{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!1,minDate:c?new Date(c):new Date,filterTime:function(e){var t=c?new Date(c):new Date,r=new Date(e);return r.getHours()>=8&&r.getHours()<17&&t.getTime()<r.getTime()},filterDate:!s&&u,name:"siteVisitEnd",showTimeSelect:!0,todayButton:!1}))]})]})]})},Pe=r(39821),Ze=r(3391),De=r(7566),qe=r(1323);function Ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ie(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Te=function(e){var t=e.defaultValues,r=e.job,n=e.onSubmit,o=e.query,i=(0,qe.x)(),a=i.hasRole,c=i.user,l=(0,b.cI)({defaultValues:t,resolver:(0,y.S)((0,Pe.C)(o,a))}),s=l.control,d=l.errors,m=l.formState,p=l.handleSubmit,v=l.register,f=l.setValue,w=l.watch,S=w("customerSelected",t.customerSelected),P=w("customerUserSelected",t.customerUserSelected),Z=w("locationSelected",t.locationSelected),D=w("pricing",t.pricing),q=w("serviceSelected",t.serviceSelected),I=w("timing",t.timing),E=w("siteVisitReq",t.siteVisitReq),T=w("taxonomyId_ShortDesc"),k=w("compliance",t.compliance),A=w("assetCategorySelected",null===t||void 0===t?void 0:t.assetCategory),M=(0,j.Z)(S),V=(0,j.Z)(P),W=(0,j.Z)(Z),_=(0,j.Z)(T),N=(0,j.Z)(A);(0,u.useEffect)((function(){if(void 0!==W&&Z!==W)[{name:"access",value:(null===Z||void 0===Z?void 0:Z.access)||""},{name:"assetSelected",value:null},{name:"coordinates",value:null}].forEach((function(e){var t=e.name,r=e.value;return f(t,r)}));else if(S!==M&&M){[{name:"assetSelected",value:null},{name:"coordinates",value:null},{name:"customerUserSelected",value:null},{name:"locationSelected",value:null}].forEach((function(e){var t=e.name,r=e.value;return f(t,r)}))}else if(D&&!o.parentId&&!o.id){var e,t,r,n,i,a;[{name:"customerSpendThreshold",value:null===S||void 0===S?void 0:S.spendThreshold},{name:"amount",value:null===T||void 0===T||null===(e=T.meta)||void 0===e||null===(t=e.template)||void 0===t?void 0:t.amount},{name:"supplierLabourAmount",value:null===T||void 0===T||null===(r=T.meta)||void 0===r||null===(n=r.template)||void 0===n?void 0:n.supplierLabourAmount},{name:"supplierMaterialsAmount",value:null===T||void 0===T||null===(i=T.meta)||void 0===i||null===(a=i.template)||void 0===a?void 0:a.supplierMaterialsAmount}].forEach((function(e){var t=e.name,r=e.value;return f(t,r)}))}if(T!==_&&!o.id&&!o.parentId){var c,l,s,u,d,m,p,v,b,y,j;[{name:"title",value:null===T||void 0===T||null===(c=T.meta)||void 0===c||null===(l=c.template)||void 0===l?void 0:l.title},{name:"description",value:null===T||void 0===T||null===(s=T.meta)||void 0===s||null===(u=s.template)||void 0===u?void 0:u.description},{name:"slaId",value:null===T||void 0===T||null===(d=T.meta)||void 0===d||null===(m=d.template)||void 0===m?void 0:m.slaId},{name:"costCategorySelected",value:null===T||void 0===T||null===(p=T.meta)||void 0===p||null===(v=p.template)||void 0===v?void 0:v.costCategorySelected},{name:"serviceSelected",value:null===T||void 0===T||null===(b=T.meta)||void 0===b||null===(y=b.template)||void 0===y?void 0:y.serviceSelected}].forEach((function(e){var t=e.name,r=e.value;return f(t,r)}));var h=null===T||void 0===T||null===(j=T.meta)||void 0===j?void 0:j.template;null!==h&&void 0!==h&&h.amount||null!==h&&void 0!==h&&h.supplierLabourAmount||null!==h&&void 0!==h&&h.supplierMaterialsAmount?f("pricing","fixed"):f("pricing",null)}A!==N&&N&&f("assetSelected",null),V&&(null===P||void 0===P?void 0:P.value)!==(null===V||void 0===V?void 0:V.value)&&f("locationSelected",null)}),[A,S,P,Z,D,T]);var H={control:s,errors:d,register:v};return(0,C.jsxs)(h.Z,{handleSubmit:p(n),children:[(0,C.jsxs)(g.Z,{children:[(0,C.jsxs)(O.Z,{md:6,children:[a("admin")&&(0,C.jsx)(ve,Ee(Ee({},H),{},{user:c})),(0,C.jsx)(L,Ee(Ee({},H),{},{customerSelectedWatch:S,user:c,hasRole:a})),Z&&a(["admin","customer","tenant"])&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(ae,Ee(Ee({},H),{},{complianceWatch:k,currentAnswers:t.questions,customerSelectedWatch:S,hasRole:a,jobId:null===r||void 0===r?void 0:r.id,locationSelectedWatch:Z,taxonomyWatch:T,prevTaxonomy:_,watch:w,isQuote:o.quoted})),!o.quoted&&a(["admin","customer"])&&(0,C.jsx)(Ze.t,Ee({},H)),!o.quoted&&a("admin")&&(0,C.jsx)(ge.n,Ee(Ee({},H),{},{pricingWatch:D,hasServiceRate:!(null===S||void 0===S||!S.serviceRateLabour)||!(null===S||void 0===S||!S.serviceRateExpenses),serviceSelectedWatch:q})),!o.quoted&&(0,C.jsx)(De.X,Ee(Ee({},H),{},{hasRole:a,query:o,setValue:f,timingWatch:I,watch:w}))]})]}),(0,C.jsxs)(O.Z,{md:6,children:[S&&(0,C.jsx)(de,Ee(Ee({},H),{},{setValue:f,assetCategoryWatch:A,customerSelectedWatch:S,customerUserSelectedWatch:P,locationSelectedWatch:Z})),Z&&(0,C.jsxs)(C.Fragment,{children:[o.quoted&&(0,C.jsx)(Se,Ee(Ee({},H),{},{siteVisitWatch:E,watch:w})),o.ppm&&(0,C.jsx)(he,Ee(Ee({},H),{},{locationId:Z.value})),!r&&(0,C.jsx)(R,{locationId:Z.value,serviceId:(null===q||void 0===q?void 0:q.value)||null})]})]})]}),(0,C.jsx)(x.Z,{content:"Submit",disabled:m.isSubmitting,size:"lg",type:"submit"})]})},ke=function(e){var t=(0,qe.x)(),r=t.hasRole,n=t.user,i=(0,u.useState)(!0),l=i[0],b=i[1],y="/dashboard/issues/",j=e.accountId||0,h=e.locationId||0,g=e.parentId||0,O=e.assetId||0,x=e.recall||null;r("customer")&&(j=n.accountId);var w=(0,d.t)(p.E6,{skip:!e.id,variables:{adminId:n.adminId,number:"".concat(e.id)}}),S=(0,c.Z)(w,2),P=S[0],Z=S[1],D=Z.loading,q=Z.data,I=(q=void 0===q?{job:null}:q).job,E=I&&I[0],T=(0,d.t)(p.TY,{variables:{accountId:j,locationId:h,parentId:g,assetId:O,includeAccount:!!j,includeLocation:!!h,includeParentJob:!!g,includeAsset:!!O}}),k=(0,c.Z)(T,2),A=k[0],M=k[1],V=M.loading,W=M.data,R=(0,m.D)(v.xM),_=(0,c.Z)(R,1)[0],N=(0,m.D)(v.tv),H=(0,c.Z)(N,1)[0],B=(0,m.D)(p.mJ),F=(0,c.Z)(B,1)[0],J=(0,m.D)(p.r2),U=(0,c.Z)(J,1)[0],Q=(0,m.D)(p.uA,{onCompleted:function(e){var t=e.update_Job_by_pk.number;o.default.push("".concat(y,"view?id=").concat(t))}}),L=(0,c.Z)(Q,1)[0];(0,u.useEffect)((function(){e.id?P():j||h||g?A():b(!1)}),[]),(0,u.useEffect)((function(){(!D&&E||!V&&W)&&b(!1)}),[D,V]);var X=function(){var t=(0,a.Z)(s().mark((function t(i){var c,l,u,d,m,p,v;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=(0,ne.eD)(i,null===E||void 0===E?void 0:E.id),t.next=3,(0,ne.lV)(e,i,r,n);case 3:if(l=t.sent,e.id&&!e.parentId){t.next=10;break}return u=(0,ne.OU)(i),t.next=8,F({variables:{adminId:n.adminId,objects:[u]}}).then(function(){var t=(0,a.Z)(s().mark((function t(r){var i,c,l,u,d,m,p;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=r.data,c=i.createJob.data.insert_Job.returning[0],l=c.id,u=c.number,g&&"true"===x&&(d={notes:"Marked as dispute because of creating a recall job",status:"inDispute",jobId:e.parentId,userId:n.id},U({variables:{objects:[d]}}),m=e.report,p={caption:"report for recall job",expiryAt:null,extension:null===m||void 0===m?void 0:m.split(".").pop(),userId:n.id,filename:m,type:"document"},_({variables:{objects:p}}).then(function(){var e=(0,a.Z)(s().mark((function e(t){var r,n,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.data,n=r.insert_Media.returning,o={mediaId:n[0].id,entity:"Job",entityId:l},e.next=5,H({variables:{objects:o}});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),o.default.push("".concat(y,"view?id=").concat(u));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 8:t.next=14;break;case 10:return d=(0,ne.v8)({data:i,defaultAssets:G.assetSelected,entity:"Job",entityId:E.id}),m=d.deletedAssetIds,p=d.addedAssets,v=(0,ne.xv)({form:i,jobId:E.id}),t.next=14,L({variables:{jobId:E.id,changes:l,compliances:v,deletedAssetIds:m,assets:p,questions:c,hasQuestions:(null===c||void 0===c?void 0:c.length)>0}});case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();if(E&&((0,f.E)(E,"accepted")&&!r("admin")||(0,f.E)(E,"inProgress")))return(0,C.jsx)("p",{children:"Work order can't be edited after started by supplier"});var G={};return l||(G=e.id?E?(0,ne.I2)(E):null:(0,ne.$z)(W,r,n,x)),!l&&G&&(0,C.jsx)(Te,{defaultValues:G,job:e.id?E:null,onSubmit:X,query:e})};function Ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ce(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Me=function(){var e=(0,o.useRouter)().query,t=e.id?"Edit":"Create",r="Work Order";return r=e.quoted?"Quote":r,r=e.ppm?"PPM":r,(0,C.jsx)(i.Z,{pageHeading:{heading:"".concat(t," ").concat(r)},View:(0,C.jsx)(ke,Ce({},e))})}},86989:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/issues/manage",function(){return r(25472)}])}},function(e){e.O(0,[367,284,4195,5312,7287,2002,3086,7134,3486,9082,3515,4712,1265,6996,9666,4177,1234,5146,899,3016,26,9774,2888,179],(function(){return t=86989,e(e.s=t);var t}));var t=e.O();_N_E=t}]);