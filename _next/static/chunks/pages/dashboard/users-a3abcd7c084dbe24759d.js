(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{26075:function(n,e,t){"use strict";t.d(e,{x:function(){return s}});var r=t(67294),i=t(47591),o=t(24273);function s(){var n=r.useContext((0,o.K)()).client;return __DEV__?(0,i.kG)(n,"No Apollo Client instance can be found. Please ensure that you have called `ApolloProvider` higher up in your tree."):(0,i.kG)(n,36),n}},21269:function(n,e,t){"use strict";var r,i,o,s,a,c=t(30168),u=t(67294),d=t(45697),l=t(24237),p=t(37815),f=t(82373),m=function(n){var e=n.addonType,t=(n.className,n.children),r=n.context,i=n.error,o=n.size,s=n.text,a=n.theme;return u.createElement(g,{addonType:e,className:e,children:t,context:r,error:i,size:o,text:s,theme:a})};m.displayName="InputGroupAddon";var g=l.ZP.div(r||(r=(0,c.Z)(["\n  align-items: center;\n  display: flex;\n\n  & > * {\n    height: 100%;\n  }\n\n  ","\n  ","\n\n  &,\n  button {\n    ","\n\n    ","\n  }\n"])),(function(n){var e=n.theme,t=e.COLOUR,r=e.FORM_ELEMENTS_STYLES,o=n.error;return n.text&&(0,l.iv)(i||(i=(0,c.Z)(["\n      background-color: ",";\n      border: 1px solid ",";\n      border-radius: ",";\n      color: ",";\n      display: flex;\n      font-size: 0.75rem;\n      font-weight: 400;\n      line-height: 1;\n      margin-bottom: 0;\n      padding: 0.375rem 1rem;\n      text-align: center;\n      transition: background-color 0.15s linear;\n      white-space: nowrap;\n    "])),o?t.danger:t.light,o?t.danger:t.dark,r.inputBorderRadius,o?t.light:t.dark)}),(function(n){return n.size===f.Z.SM&&(0,l.iv)(o||(o=(0,c.Z)(["\n      font-size: 0.625rem;\n      padding: 0 0.75rem;\n    "])))}),(function(n){return"prepend"===n.addonType&&(0,l.iv)(s||(s=(0,c.Z)(["\n        border-top-right-radius: 0;\n        border-bottom-right-radius: 0;\n        margin-right: -1px;\n      "])))}),(function(n){return"append"===n.addonType&&(0,l.iv)(a||(a=(0,c.Z)(["\n        border-top-left-radius: 0;\n        border-bottom-left-radius: 0;\n        margin-left: -1px;\n      "])))}));m.propTypes={addonType:(0,d.oneOf)(["prepend","append"]),className:d.any,children:d.node,context:(0,d.oneOf)(Object.values(p.Z)),text:d.bool},m.defaultProps={addonType:"append",context:"light"},e.Z=m},44442:function(n,e,t){"use strict";var r,i,o=t(30168),s=t(67294),a=t(45697),c=t(24237),u=function(n){var e=n.children,t=n.error,r=n.fullWidth,i=n.size,o=n.theme;return s.createElement(d,{children:e,error:t,fullWidth:r,size:i,theme:o})};u.displayName="InputGroup";var d=c.ZP.div(r||(r=(0,o.Z)(["\n  align-items: stretch;\n  display: flex;\n  flex-wrap: wrap;\n  position: relative;\n  width: 100%;\n\n  input {\n    ","\n    min-width: 0;\n    margin-bottom: 0;\n    position: relative;\n\n    :not(:first-child) {\n      border-top-left-radius: 0;\n      border-bottom-left-radius: 0;\n    }\n\n    :first-child {\n      border-top-right-radius: 0;\n      border-bottom-right-radius: 0;\n    }\n\n    :not(:last-child) {\n      border-top-right-radius: 0;\n      border-bottom-right-radius: 0;\n    }\n  }\n  ","\n"])),(function(n){return n.fullWidth?"flex: 1 1 0%;":"width: auto;"}),(function(n){var e=n.error,t=n.theme;return e&&t&&(0,c.iv)(i||(i=(0,o.Z)(["\n      &:hover {\n        .prepend,\n        .append {\n          background: ",";\n          border-color: ",";\n        }\n      }\n    "])),t.COLOUR.danger,t.COLOUR.danger)}));u.propTypes={fullWidth:a.bool,size:a.string},u.defaultProps={fullWidth:!0,size:"md"},e.Z=u},69128:function(n,e,t){"use strict";t.d(e,{Z:function(){return U}});var r,i=t(30168),o=t(87462),s=t(45987),a=t(67294),c=t(45697),u=t(24237),d=t(42778),l=["disabled"],p=(0,a.forwardRef)((function(n,e){var t=n.disabled,r=(0,s.Z)(n,l);return a.createElement(f,(0,o.Z)({disabled:t,type:"radio",ref:e},r))})),f=u.ZP.input(r||(r=(0,i.Z)(["\n  cursor: pointer;\n  margin-right: 0.5rem;\n"])));p.propTypes={disabled:c.bool},p.defaultProps={stacked:!1};var m,g,b,h,_,y,v=p,$=t(88280),Z=["data","errors","legend","stacked"],O=["disabled","label"],j=function(n){var e=n.data,t=n.errors,r=n.legend,i=n.stacked,c=(0,s.Z)(n,Z);return a.createElement(w,{error:t[c.name]},r&&a.createElement(P,{error:t[c.name]},r),e.map((function(n){var e=n.disabled,r=n.label,u=(0,s.Z)(n,O);return a.createElement(I,{htmlFor:u.id,key:u.id,stacked:i},a.createElement(d.Z,(0,o.Z)({component:v,disabled:e,errors:t[c.name],showError:!1},u,c)),r)})))};j.displayName="RadioField";var w=u.ZP.fieldset(m||(m=(0,i.Z)(["\n  border-radius: 0.25rem;\n  color: ",";\n  ","\n"])),(function(n){return n.theme.COLOUR.dark}),(function(n){return n.error&&(0,u.iv)(g||(g=(0,i.Z)(["\n      ","\n      padding: 0.5rem;\n    "])),(function(n){return(0,$.Z)(n)}))})),P=u.ZP.legend(b||(b=(0,i.Z)(["\n  ","\n"])),(function(n){return n.error&&(0,u.iv)(h||(h=(0,i.Z)(["\n      padding: 0 0.5rem;\n    "])))})),I=u.ZP.label(_||(_=(0,i.Z)(["\n  cursor: pointer;\n  margin-right: 1.25rem;\n  position: relative;\n  ","\n"])),(function(n){return n.stacked&&(0,u.iv)(y||(y=(0,i.Z)(["\n      display: block;\n      margin: 0.5rem 0;\n    "])))}));j.propTypes={data:c.array.isRequired,legend:c.string,stacked:c.bool},j.defaultProps={data:[],stacked:!1};var U=j},14651:function(n,e,t){"use strict";var r=t(64836);e.Z=void 0;var i=r(t(64938)),o=t(85893),s=(0,i.default)((0,o.jsx)("circle",{cx:"12",cy:"12",r:"10"}),"Brightness1");e.Z=s},69399:function(n,e,t){"use strict";t.d(e,{r:function(){return o}});var r=t(46482),i=t(85893),o=function(n){var e=n.errors,t=n.name,o=n.onChange,s=n.options,a=n.register;return(0,i.jsx)(r.Z,{errors:e,name:t,onChange:o,options:s,register:a})};o.defaultProps={name:"status"}},27834:function(n,e,t){"use strict";t.d(e,{I4:function(){return $},AX:function(){return Z},fo:function(){return O},JA:function(){return j},WF:function(){return w},Px:function(){return P},a8:function(){return I},r1:function(){return U},MT:function(){return x},nE:function(){return k},nh:function(){return A},$E:function(){return S},uz:function(){return q},ge:function(){return C},ZA:function(){return E},tW:function(){return L}});var r,i,o,s,a,c,u,d,l,p,f,m,g,b,h,_,y=t(52209),v=t(54397),$=(0,v.Ps)(r||(r=(0,y.Z)(["\n  mutation InsertAccountUser($objects: [Account_User_insert_input!]!) {\n    insert_Account_User(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),Z=(0,v.Ps)(i||(i=(0,y.Z)(["\n  mutation UpdateUser(\n    $id: Int!\n    $accountUserId: Int!\n    $accountUserChanges: Account_User_set_input\n    $changes: User_set_input\n    $updateAccountUser: Boolean!\n  ) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _set: $accountUserChanges)\n      @include(if: $updateAccountUser) {\n      id\n    }\n    update_User_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),O=(0,v.Ps)(o||(o=(0,y.Z)(["\n  query GetUsers(\n    $accountId: Int\n    $accountType: String\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: User_order_by!\n    $status: String\n  ) {\n    users: User(\n      limit: $limit\n      offset: $offset\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [\n          { email: { _ilike: $q } }\n          { nameFirst: { _ilike: $q } }\n          { nameLast: { _ilike: $q } }\n        ]\n        status: { _eq: $status }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n        userLocations: User_Account_Locations {\n          accountLocationId\n        }\n      }\n    }\n    meta: User_aggregate(\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        status: { _eq: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),j=(0,v.Ps)(s||(s=(0,y.Z)(["\n  query GetUser($id: Int!) {\n    user: User_by_pk(id: $id) {\n      id\n      fullName\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]))),w=(0,v.Ps)(a||(a=(0,y.Z)(["\n  query CheckDuplicateEmail($email: String!) {\n    users: User_public(where: { email: { _eq: $email } }) {\n      id\n      nameFirst\n      nameLast\n      email\n      phone\n    }\n  }\n"]))),P=(0,v.Ps)(c||(c=(0,y.Z)(["\n  fragment UserFields on User {\n    id\n    email\n    nameFirst\n    nameLast\n    fullName\n    phone\n    status\n  }\n"]))),I=(0,v.Ps)(u||(u=(0,y.Z)(["\n  mutation SendGoogleAuthCode($code: String!, $id: Int!, $type: String!) {\n    createGoogleToken(code: $code, id: $id, type: $type) {\n      success\n      tokens\n      error\n    }\n  }\n"]))),U=(0,v.Ps)(d||(d=(0,y.Z)(["\n  mutation GenerateMSURL($type: String!, $id: Int!) {\n    genenrateMSURL(id: $id, type: $type) {\n      url\n    }\n  }\n"]))),x=(0,v.Ps)(l||(l=(0,y.Z)(["\n  mutation signoutMS($id: Int!, $type: String!, $email: String!) {\n    signoutMS(id: $id, type: $type, email: $email) {\n      error\n      msId\n      success\n    }\n  }\n"]))),k=(0,v.Ps)(p||(p=(0,y.Z)(["\n  query getAccountMeta($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      meta\n    }\n  }\n"]))),A=(0,v.Ps)(f||(f=(0,y.Z)(["\n  query user($id: Int!) {\n    user: User_by_pk(id: $id) {\n      meta\n    }\n  }\n"]))),S=(0,v.Ps)(m||(m=(0,y.Z)(["\n  mutation updateAccount($accountId: Int!, $set: Account_set_input!) {\n    update_Account_by_pk(pk_columns: { id: $accountId }, _set: $set) {\n      id\n    }\n  }\n"]))),q=(0,v.Ps)(g||(g=(0,y.Z)(["\n  mutation updateUserMeta($userId: Int!, $meta: jsonb!) {\n    update_User_by_pk(pk_columns: { id: $userId }, _set: { meta: $meta }) {\n      id\n      meta\n    }\n  }\n"]))),C=(0,v.Ps)(b||(b=(0,y.Z)(['\n  query userDevices($accountId: Int!) {\n    users: User(\n      where: {\n        Account_Users: { accountId: { _eq: $accountId }, status: { _eq: "active" } }\n        UserDevices: { status: { _eq: "active" } }\n        status: { _eq: "active" }\n      }\n    ) {\n      id\n      fullName\n      devices: UserDevices(\n        order_by: { updatedAt: desc_nulls_last }\n        where: { status: { _eq: "active" } }\n        limit: 1\n      ) {\n        id\n        playerId\n      }\n    }\n  }\n']))),E=(0,v.Ps)(h||(h=(0,y.Z)(['\n  query GetAccountLocations($accountId: Int, $limit: Int, $offset: Int) {\n    location: Location(\n      offset: $offset\n      limit: $limit\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      id\n      name\n      accountLocations: Account_Locations {\n        id\n      }\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']))),L=(0,v.Ps)(_||(_=(0,y.Z)(["\n  mutation InsertUserAccountLocations(\n    $accountUserId: Int!\n    $objects: [User_Account_Location_insert_input!]!\n  ) {\n    delete_User_Account_Location(where: { accountUserId: { _eq: $accountUserId } }) {\n      affected_rows\n    }\n    insert_User_Account_Location(objects: $objects) {\n      affected_rows\n      returning {\n        id\n      }\n    }\n  }\n"])))},70316:function(n,e,t){"use strict";t.d(e,{J:function(){return U}});var r=t(92809),i=t(80318),o=t(10219),s=t(11163),a=t(67294),c=t(78215),u=t(2356),d=t(42283),l=t(97202),p=t(80284),f=t(65375),m=t(10973),g=t(14347),b=t(66805),h=t(69119),_=t(23855),y=t(83894);function v(n,e,t){var r=(0,a.useState)((function(){if(JSON.parse(window.sessionStorage.getItem(n))&&!Object.values(JSON.parse(window.sessionStorage[n])).includes(t))return e;try{var r=JSON.parse(window.sessionStorage.getItem(n));return r&&(r.startDate=r.startDate?(0,h.Z)((0,_.Z)(r.startDate)):null,r.endDate=r.endDate?(0,y.Z)((0,_.Z)(r.endDate)):null),r||e}catch(i){return console.log(i),e}})),i=r[0],o=r[1];return[i,function(e){try{var t=e instanceof Function?e(i):e;o(t),window.sessionStorage.setItem(n,JSON.stringify(t))}catch(r){console.log(r)}}]}var $=t(85893);function Z(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function O(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?Z(Object(t),!0).forEach((function(e){(0,r.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Z(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var j=function(n){var e=n.initialValues,t=n.renderFilters,r=n.setFilters,o=n.lastQuery,s=n.filters,h=e.filterType,_=v("form_data",e,h),y=(0,i.Z)(_,2),Z=y[0],j=y[1],w=(0,d.cI)({defaultValues:Z||e}),P=w.control,I=w.errors,U=w.handleSubmit,x=w.register,k=w.reset,A=w.watch,S=w.setValue,q=O(O({},A()),{},{filterType:h});(0,a.useEffect)((function(){k(q)}),[k]),(0,a.useEffect)((function(){j(q)}),[s]);var C=function(n){var t=n.query;if(t!==o){var i={q:"%".concat(t,"%")||0},s=/^\d+$/.test(t);"id"in e&&(i.id=s?Number(t):null),"meta"in e&&(i.meta=s?{invoiceNumbers:[t]}:null),"jobNumber"in e&&(i.jobNumber=s?String(t):null,i.invoiceNumber=s?Number(t):null),(i.id||i.meta||i.jobNumber)&&(i.q=null),r((function(n){return O(O({},n),i)}))}};return(0,$.jsx)(l.Z,{handleSubmit:U(C),children:(0,$.jsxs)(p.Z,{title:"Filters",children:[(0,$.jsxs)(c.Z,{children:[(0,$.jsx)(u.Z,{sm:12,lg:12,children:(0,$.jsx)(f.Z,{label:"",children:(0,$.jsx)(m.Z,{errors:I,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:x,type:"search"})})}),(0,$.jsx)(u.Z,{sm:12,lg:12,children:t({control:P,errors:I,initialValues:e,register:x,setFilters:r,watch:A,setValue:S,reset:k})})]}),(0,$.jsx)(b.H,{content:"Search",context:"secondary",handleClick:C,type:"submit",children:(0,$.jsx)(g.Z,{content:"Clear",context:"danger",onClick:function(n){Object.keys(e).map((function(n){return S(n,null)})),r(e),k(e),C("")},size:"sm"})})]})})},w=["FiltersComp","initialFilters","TableComp"];function P(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function I(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?P(Object(t),!0).forEach((function(e){(0,r.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):P(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var U=function(n){var e=n.FiltersComp,t=n.initialFilters,r=n.TableComp,d=(0,o.Z)(n,w),l=v("filters",t,t.filterType),p=(0,i.Z)(l,2),f=p[0],m=p[1],g=(0,a.useState)(f||t),b=g[0],h=g[1],_=(0,s.useRouter)().query.show;return(0,a.useEffect)((function(){m(b)}),[b]),(0,$.jsx)(c.Z,{children:(0,$.jsxs)(u.Z,{sm:12,lg:12,children:[(0,$.jsx)(j,{initialValues:t,renderFilters:function(n){return(0,$.jsx)(e,I(I(I({},n),d),{},{show:_}))},setFilters:h,filters:b}),(0,$.jsx)(r,I({filters:b,initialFilters:t},d))]})})}},89433:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return _}});var r=t(66918),i=t(70316),o=t(81167),s=t(92809),a=t(78215),c=t(2356),u=t(69399),d=t(89331),l=t(75838),p=t(85893);function f(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function m(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?f(Object(t),!0).forEach((function(e){(0,s.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):f(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var g=function(n){var e=n.errors,t=n.register,r=n.setFilters,i={errors:e,register:t};return(0,p.jsxs)(a.Z,{children:[(0,p.jsx)(c.Z,{md:6,children:(0,p.jsx)(u.r,m(m({},i),{},{onChange:function(n){return r((function(e){return m(m({},e),{},{status:n.target.value||null})}))},options:l.bg}))}),(0,p.jsx)(c.Z,{md:6,children:(0,p.jsx)(u.r,m(m({},i),{},{name:"accountType",onChange:function(n){return r((function(e){return m(m({},e),{},{accountType:n.target.value||null})}))},options:d.l}))})]})},b={accountType:null,q:null,status:"active",filterType:"users_table"},h=function(){return(0,p.jsx)(i.J,{FiltersComp:g,initialFilters:b,TableComp:o.P})},_=function(){return(0,p.jsx)(r.Z,{pageHeading:{heading:"Users"},View:(0,p.jsx)(h,{})})}},84464:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/users",function(){return t(89433)}])}},function(n){n.O(0,[284,4195,5312,7287,2002,3086,7134,3486,9082,4712,1265,6996,9666,7431,8158,899,6433,9774,2888,179],(function(){return e=84464,n(n.s=e);var e}));var e=n.O();_N_E=e}]);