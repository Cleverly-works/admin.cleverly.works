(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3241],{71742:function(e,n,t){"use strict";t.d(n,{Un:function(){return u},A1:function(){return m},$A:function(){return y},zg:function(){return g},yf:function(){return f}});var r,o,i,s,a,c,l,d=t(52209),p=t(54397),u=((0,p.Ps)(r||(r=(0,d.Z)(["\n  query GetProperty($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      contactUserId\n      name\n      access\n      contactUser: User {\n        id\n        nameFirst\n        nameLast\n      }\n      propertyOwner: Account_Locations {\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]))),(0,p.Ps)(o||(o=(0,d.Z)(['\n  query GetMapProperties {\n    properties: Location {\n      id\n      access\n      createdAt\n      name\n      contactUserId\n      addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      bookings: Jobs {\n        id\n        title\n        createdAt\n        customerId\n        amount\n        locationId\n        managerId\n        quoteNumber\n        reference\n        status\n        serviceId\n        meta\n        customer: Customer {\n          id\n          name\n        }\n        location: Location {\n          id\n          name\n          addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n            id\n            registered\n            operating\n            trading\n            invoice\n            status\n            createdAt\n            address: Address {\n              id\n              name\n              addressLine1\n              addressLine2\n              addressLine3\n              city\n              county\n              geo\n              postCode\n              country: Country {\n                id\n                name\n              }\n            }\n          }\n        }\n        manager: Manager {\n          id\n          nameFirst\n          nameLast\n        }\n        sla: SLA {\n          id\n          name\n          notes\n        }\n        supplier: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n        supplierOffers: SupplierOffers {\n          status\n          rate\n          supplier: Supplier {\n            id\n            companyNumber\n            createdAt\n            name\n            status\n            type\n            updatedAt\n            website\n            clientType\n            managerId\n            vatId\n            meta\n            media: Media {\n              id\n              medium: Medium {\n                id\n                category\n                filename\n                meta\n                type\n              }\n            }\n            manager: Manager {\n              id\n              fullName\n            }\n          }\n        }\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n'])))),m=(0,p.Ps)(i||(i=(0,d.Z)(["\n  mutation AddLocation($objects: [Location_insert_input!]!) {\n    insert_Location(objects: $objects) {\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]))),y=(0,p.Ps)(s||(s=(0,d.Z)(["\n  mutation UpdateAccountLocation(\n    $location: Location_set_input\n    $locationId: Int!\n    $accountId: Int!\n    $newAccountId: Int!\n    $hasChanged: Boolean!\n  ) {\n    update_Account_Location(\n      where: { Account: { id: { _eq: $accountId } }, id: { _eq: $locationId } }\n      _set: { accountId: $newAccountId }\n    ) @include(if: $hasChanged) {\n      returning {\n        id\n      }\n    }\n    update_Location_by_pk(pk_columns: { id: $locationId }, _set: $location) {\n      id\n    }\n  }\n"]))),g=(0,p.Ps)(a||(a=(0,d.Z)(["\n  mutation UpdateLocation($id: Int!, $changes: Location_set_input) {\n    update_Location_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]))),f=((0,p.Ps)(c||(c=(0,d.Z)(["\n  query GetAccountName($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      id\n      name\n      type\n    }\n  }\n"]))),(0,p.Ps)(l||(l=(0,d.Z)(["\n  query GetPropertiesJob($id: Int!) {\n    property: Location_by_pk(id: $id) {\n      id\n      jobs: Jobs {\n        id\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n"]))))},87086:function(e,n,t){"use strict";t.d(n,{U:function(){return r}});var r=[{elementType:"geometry",stylers:[{color:"#75cccf"}]},{elementType:"labels.text.fill",stylers:[{color:"#523735"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f1e6"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#004e49"}]},{featureType:"administrative.land_parcel",elementType:"geometry.stroke",stylers:[{color:"#75cccf"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#ae9e90"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#F6F6F4"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#ECEEED"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#a8e3e6"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#ECEEED"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#FFFFFF"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#E8EDEB"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#CAD2D3"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.stroke",stylers:[{color:"#"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#"}]},{featureType:"transit.line",elementType:"labels.text.fill",stylers:[{color:"#"}]},{featureType:"transit.line",elementType:"labels.text.stroke",stylers:[{color:"#"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#CAD2D3"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#"}]}]},4543:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return E}});var r=t(93633),o=t(71742),i=t(66918),s=t(80284),a=t(92809),c=t(67294),l=t(24237),d=t(42283),p=t(30493),u=t(87086),m=t(24794),y=t(80880),g=t(4337),f=t(70962),h=t(70448),b=t(12517),x=t(74516),T=t(85893),_=function(e){var n=e.address,t=e.children,r=e.onClick,o=n.bookings.length>0?"pink":"blue";return(0,T.jsx)(x.Z,{icon:"http://maps.google.com/mapfiles/ms/icons/".concat(o,"-dot.png"),onClick:r,position:n,children:t})},j=t(11163),k=t(80285),v=t(73165),w=t(93193),C=t(55657),A=function(e){var n=e.address,t=e.onCloseClick,r=n.addressLine1,o=n.bookings,i=n.city,s=n.id,a=n.postCode,c=(0,k.Z)(o.reduce((function(e,n){return e+=n.amount}),0));return(0,T.jsx)(w.Z,{onCloseClick:t,children:(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(I,{children:[(0,T.jsx)(C.Z,{context:"female",size:"lg",icon:"map-marker-alt"}),(0,T.jsxs)(L,{onClick:function(){j.default.push("/dashboard/properties/view?id=".concat(s,"&tab=details"))},link:!0,children:[r,","," "+i,(0,T.jsx)("br",{}),a]})]}),(0,T.jsx)("br",{}),(0,T.jsxs)(I,{children:[(0,T.jsx)(C.Z,{context:"female",size:"lg",icon:"calendar-alt"}),(0,T.jsxs)(L,{children:["Bookings: ",o.length,(0,T.jsx)("ul",{style:{margin:0,paddingLeft:"20px"},children:o.map((function(e,n){return(0,T.jsxs)("li",{children:["No: ",e.id," - ",(t=e.status,(0,v.Z)(t.replace(/([A-Z]+)/g," $1").replace(/([A-Z][a-z])/g," $1")))]},n);var t}))})]})]}),(0,T.jsx)("br",{}),(0,T.jsxs)(I,{children:[(0,T.jsx)(C.Z,{context:"female",size:"lg",icon:"shopping-cart"}),(0,T.jsxs)(L,{children:["Spend: ",c]})]})]})})},I=l.ZP.div.withConfig({displayName:"markerTooltip__TooltipRow",componentId:"sc-7xxcu5-0"})(["align-items:center;display:flex;"]),L=l.ZP.div.withConfig({displayName:"markerTooltip__TooltipColumn",componentId:"sc-7xxcu5-1"})(["cursor:",";font-size:0.9rem;margin-left:5px;text-decoration:",";"],(function(e){return e.link?"pointer":"auto"}),(function(e){return e.link?"underline":"none currentcolor solid"}));function Z(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function $(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Z(Object(t),!0).forEach((function(n){(0,a.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Z(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var O=(0,c.memo)((function(e){var n=e.addresses;n=n.map((function(e){var n=(0,h.WE)(e,"registered"),t=(null===n||void 0===n?void 0:n.address)||null,r=(0,h.Of)(t);return $($($({},t),e),r)})).filter((function(e){return e.lat&&e.lng}));var t=(0,m.Z)(n),r=n.reduce((function(e,n){var t=n.id;return e[t]=!!e[t],e}),{}),o=(0,d.cI)(r),i=o.change,s=o.form,a=function(e,n){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Object.keys(s).forEach((function(e){e===n&&(s[e]=t)}));var r=t;i({target:{id:n,value:r}})},l=(0,c.useContext)(y.Z);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("p",{children:["Number of properties: ",n.length," properties"]}),(0,T.jsx)(g.Z,{apiKey:p.ie.map,defaultCenter:t,containerHeight:"600px",zoom:11,defaultOptions:{styles:u.U},children:(0,T.jsx)(f.Z,{averageCenter:!0,enableRetinaIcons:!0,gridSize:60,children:n.length>0&&n.forEach((function(e,n){var t=e.addressLine1,r=e.bookings,o=e.city,i=e.id,c=e.lat,d=e.lng,p=e.postCode;if(c&&d){var u=r.length;return(0,T.jsx)(_,{address:{bookings:r,lat:c,lng:d},onClick:function(e){return u>0?function(e){if(e.length>0){var n=e.length-1;l.show({title:"Job details",content:(0,T.jsx)(b.g,{jobId:e[n].id,toggleShow:l.close}),submit:!1,width:"50%"})}}(r):a(e,i)},children:s[i]&&(0,T.jsx)(A,{address:{addressLine1:t,bookings:r,city:o,id:i,postCode:p},onCloseClick:function(e){return a(e,i,!1)}})},n)}}))})}),(0,T.jsxs)(P,{children:[(0,T.jsxs)("span",{children:[(0,T.jsx)("img",{src:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"}),"Uploaded Address"]}),(0,T.jsxs)("span",{children:[(0,T.jsx)("img",{src:"http://maps.google.com/mapfiles/ms/icons/pink-dot.png"}),"Job Booked"]})]})]})}),(function(e,n){if(e.addresses.length===n.addresses.length)return!0})),P=l.ZP.div.withConfig({displayName:"map__Description",componentId:"sc-1g48jil-0"})(["padding:10px;margin:30px 10px 10px 10px;text-align:center;img{max-width:24px;}img:last-child{margin-left:20px;}"]),E=function(){var e=(0,r.a)(o.Un).data,n=(e=void 0===e?{properties:[]}:e).properties;return(0,T.jsx)(i.Z,{pageHeading:{heading:"Map"},children:(0,T.jsx)(s.Z,{open:!0,title:"Map",children:(0,T.jsx)(O,{addresses:n})})})}},25879:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/properties/map",function(){return t(4543)}])}},function(e){e.O(0,[367,284,4195,5312,7287,2002,3086,7134,3486,9082,3515,4712,1265,6996,9666,4177,6561,9516,5146,899,3016,9774,2888,179],(function(){return n=25879,e(e.s=n);var n}));var n=e.O();_N_E=n}]);