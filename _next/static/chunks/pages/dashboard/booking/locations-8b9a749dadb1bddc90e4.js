(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[262],{66805:function(e,n,t){"use strict";t.d(n,{H:function(){return l}});var r=t(92809),o=t(77417),i=t(58448),a=t(14347),s=t(85893);function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function u(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var l=function(e){var n=e.children,t=e.content,r=e.context,c=e.data,l=e.disabled,d=e.handleClick,p=e.size,y=e.type;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{size:"sm"}),(0,s.jsxs)(i.Z,{align:"flex-end",children:[n,(0,s.jsx)(a.Z,u({content:t,context:r,disabled:l,onClick:d,size:p,type:y},c))]})]})};l.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},33462:function(e,n,t){"use strict";t.d(n,{Im:function(){return p},RE:function(){return y},mW:function(){return f},ze:function(){return m},RQ:function(){return b},fC:function(){return g},uY:function(){return j}});var r,o,i,a,s,c,u,l=t(52209),d=t(54397),p=(0,d.Ps)(r||(r=(0,l.Z)(['\n  query GetTaxonomys(\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Taxonomy_order_by!\n    $status: String = "active"\n    $type: String\n    $typeGroup: String\n    $parentId: Int\n    $fetchGroup: Boolean! = true\n    $id: Int\n    $isGroup: Boolean = false\n  ) {\n    taxonomy: Taxonomy(\n      limit: $limit\n      offset: $offset\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n        parentId: { _eq: $parentId }\n        id: { _eq: $id }\n        isGroup: { _eq: $isGroup }\n      }\n      order_by: [$orderBy]\n    ) {\n      options: Taxonomies(\n        where: {\n          type: { _eq: $type }\n          name: { _ilike: $q }\n          id: { _eq: $id }\n          status: { _eq: "active" }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n\n        childs: Taxonomies(order_by: { id: asc }, where: { status: { _eq: "active" } }) {\n          taxonomyId: id\n          name\n          type\n          meta\n          status\n        }\n      }\n      id\n      name\n      type\n      status\n      parentId\n      createdAt\n      meta\n      parent: Parent {\n        id\n        name\n        type\n      }\n      childs: Taxonomies(order_by: { id: asc }, where: { status: { _eq: "active" } }) {\n        taxonomyId: id\n        name\n        type\n        meta\n        status\n      }\n      jobs: Taxonomy_Entities_aggregate(\n        where: { Taxonomy: { type: { _eq: "jobTags" } }, entity: { _eq: "Job" } }\n      ) {\n        aggregate {\n          count\n        }\n      }\n    }\n    meta: Taxonomy_aggregate(\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n        parentId: { _eq: $parentId }\n        id: { _eq: $id }\n        isGroup: { _eq: $isGroup }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n    taxonomyGroup: Taxonomy(where: { isGroup: { _eq: true }, type: { _eq: $typeGroup } })\n      @include(if: $fetchGroup) {\n      value: id\n      text: name\n    }\n  }\n']))),y=(0,d.Ps)(o||(o=(0,l.Z)(["\n  query GetTaxonomy($id: Int!) {\n    taxonomy: Taxonomy_by_pk(id: $id) {\n      id\n      name\n      type\n      status\n      parentId\n      createdAt\n      meta\n    }\n  }\n"]))),f=(0,d.Ps)(i||(i=(0,l.Z)(["\n  mutation AddTaxonomy($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        type\n      }\n    }\n  }\n"]))),m=(0,d.Ps)(a||(a=(0,l.Z)(["\n  mutation UpdateTaxonomy($id: Int!, $changes: Taxonomy_set_input) {\n    update_Taxonomy_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      type\n    }\n  }\n"]))),b=(0,d.Ps)(s||(s=(0,l.Z)(["\n  query GeTaxonomyWithEntities($type: String!, $entity: String!, $entityId: Int!) {\n    questions: Taxonomy(where: { type: { _eq: $type } }) {\n      id\n      meta\n      name\n      status\n      taxonomy_entity: Taxonomy_Entities(\n        where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }\n      ) {\n        comments\n      }\n    }\n  }\n"]))),g=(0,d.Ps)(c||(c=(0,l.Z)(["\n  mutation InsertTaxonomyEntity(\n    $entity: String!\n    $entityId: Int!\n    $questions: [Taxonomy_Entity_insert_input!]!\n    $objectStatusLog: [StatusLog_insert_input!]!\n    $hasStatusLog: Boolean!\n  ) {\n    delete_Taxonomy_Entity(where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }) {\n      returning {\n        id\n      }\n    }\n    insert_Taxonomy_Entity(objects: $questions) {\n      returning {\n        id\n      }\n    }\n\n    insert_StatusLog(objects: $objectStatusLog) @include(if: $hasStatusLog) {\n      returning {\n        id\n      }\n    }\n  }\n"]))),j=(0,d.Ps)(u||(u=(0,l.Z)(["\n  query GetSLAsForJobManage {\n    slas: SLA(order_by: { name: asc }) {\n      id\n      label: name\n      notes\n    }\n  }\n"])))},72197:function(e,n,t){"use strict";t.d(n,{l:function(){return m}});var r=t(92809),o=t(10219),i=t(67294),a=t(93633),s=t(33462),c=t(65375),u=t(93515),l=t(85893),d=["control","errors","label","name","register","type","filters"];function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function y(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var f=function(e,n){var t,r,o=!0;return(null===(t=e.errors[e.name])||void 0===t?void 0:t.message)!==(null===(r=n.errors[n.name])||void 0===r?void 0:r.message)&&(o=!1),["name","type"].forEach((function(t){e[t]!==n[t]&&(o=!1)})),o},m=(0,i.memo)((function(e){var n=e.control,t=e.errors,r=e.label,i=e.name,p=e.register,f=e.type,m=e.filters,b=(0,o.Z)(e,d),g={control:n,errors:t,register:p},j=function(e){var n=(0,a.a)(s.Im,{variables:y(y({isGroup:"assetCategory"===e},m),{},{orderBy:{name:"asc"},type:e})}).data,t=(n=void 0===n?{taxonomy:[]}:n).taxonomy;return"assetCategory"===e?t.map((function(e){return{label:e.name,options:e.options,childs:e.childs,meta:e.meta}})):t.map((function(e){return{label:e.name,value:e.id,childs:e.childs,meta:e.meta}}))}(f);return(0,l.jsx)(c.Z,{id:i,label:r,children:(0,l.jsx)(u.Z,y(y({},g),{},{cacheOptions:!0,isClearable:!0,options:j,name:i},b))})}),f);m.defaultProps={filters:{}}},70316:function(e,n,t){"use strict";t.d(n,{J:function(){return S}});var r=t(92809),o=t(80318),i=t(10219),a=t(11163),s=t(67294),c=t(78215),u=t(2356),l=t(42283),d=t(97202),p=t(80284),y=t(65375),f=t(10973),m=t(14347),b=t(66805),g=t(69119),j=t(23855),h=t(83894);function O(e,n,t){var r=(0,s.useState)((function(){if(JSON.parse(window.sessionStorage.getItem(e))&&!Object.values(JSON.parse(window.sessionStorage[e])).includes(t))return n;try{var r=JSON.parse(window.sessionStorage.getItem(e));return r&&(r.startDate=r.startDate?(0,g.Z)((0,j.Z)(r.startDate)):null,r.endDate=r.endDate?(0,h.Z)((0,j.Z)(r.endDate)):null),r||n}catch(o){return console.log(o),n}})),o=r[0],i=r[1];return[o,function(n){try{var t=n instanceof Function?n(o):n;i(t),window.sessionStorage.setItem(e,JSON.stringify(t))}catch(r){console.log(r)}}]}var _=t(85893);function v(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function x(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?v(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var w=function(e){var n=e.initialValues,t=e.renderFilters,r=e.setFilters,i=e.lastQuery,a=e.filters,g=n.filterType,j=O("form_data",n,g),h=(0,o.Z)(j,2),v=h[0],w=h[1],$=(0,l.cI)({defaultValues:v||n}),P=$.control,q=$.errors,S=$.handleSubmit,Z=$.register,I=$.reset,T=$.watch,k=$.setValue,D=x(x({},T()),{},{filterType:g});(0,s.useEffect)((function(){I(D)}),[I]),(0,s.useEffect)((function(){w(D)}),[a]);var E=function(e){var t=e.query;if(t!==i){var o={q:"%".concat(t,"%")||0},a=/^\d+$/.test(t);"id"in n&&(o.id=a?Number(t):null),"meta"in n&&(o.meta=a?{invoiceNumbers:[t]}:null),"jobNumber"in n&&(o.jobNumber=a?String(t):null,o.invoiceNumber=a?Number(t):null),(o.id||o.meta||o.jobNumber)&&(o.q=null),r((function(e){return x(x({},e),o)}))}};return(0,_.jsx)(d.Z,{handleSubmit:S(E),children:(0,_.jsxs)(p.Z,{title:"Filters",children:[(0,_.jsxs)(c.Z,{children:[(0,_.jsx)(u.Z,{sm:12,lg:12,children:(0,_.jsx)(y.Z,{label:"",children:(0,_.jsx)(f.Z,{errors:q,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:Z,type:"search"})})}),(0,_.jsx)(u.Z,{sm:12,lg:12,children:t({control:P,errors:q,initialValues:n,register:Z,setFilters:r,watch:T,setValue:k,reset:I})})]}),(0,_.jsx)(b.H,{content:"Search",context:"secondary",handleClick:E,type:"submit",children:(0,_.jsx)(m.Z,{content:"Clear",context:"danger",onClick:function(e){Object.keys(n).map((function(e){return k(e,null)})),r(n),I(n),E("")},size:"sm"})})]})})},$=["FiltersComp","initialFilters","TableComp"];function P(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function q(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?P(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):P(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var S=function(e){var n=e.FiltersComp,t=e.initialFilters,r=e.TableComp,l=(0,i.Z)(e,$),d=O("filters",t,t.filterType),p=(0,o.Z)(d,2),y=p[0],f=p[1],m=(0,s.useState)(y||t),b=m[0],g=m[1],j=(0,a.useRouter)().query.show;return(0,s.useEffect)((function(){f(b)}),[b]),(0,_.jsx)(c.Z,{children:(0,_.jsxs)(u.Z,{sm:12,lg:12,children:[(0,_.jsx)(w,{initialValues:t,renderFilters:function(e){return(0,_.jsx)(n,q(q(q({},e),l),{},{show:j}))},setFilters:g,filters:b}),(0,_.jsx)(r,q({filters:b,initialFilters:t},l))]})})}},19692:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return x}});var r,o=t(66918),i=t(70316),a=t(11163),s=t(93633),c=t(52209),u=(0,t(54397).Ps)(r||(r=(0,c.Z)(['\n  query GetProperties($accountId: Int, $q: String) {\n    properties: Location(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      id\n      createdAt\n      name\n      sublocation: Assets_aggregate(\n        where: { Category: { meta: { _contains: { sublocation: true } } } }\n      ) {\n        aggregate {\n          count\n        }\n      }\n\n      media: Media(where: { entity: { _eq: "Location" } }) {\n        id\n        item: Medium {\n          id\n          caption\n          name\n          filename\n          category\n          type\n        }\n      }\n    }\n  }\n']))),l=t(78215),d=t(2356),p=t(84184),y=t(85893),f=function(e){var n=e.filters,t=(0,s.a)(u,{variables:n}),r=t.data,o=(r=void 0===r?{properties:[],meta:{aggregate:{totalCount:0}}}:r).properties,i=t.loading;return!i&&(0,y.jsx)(l.Z,{children:o&&o.map((function(e,n){var t,r;return(0,y.jsx)(d.Z,{md:3,children:(0,y.jsx)("div",{onClick:function(n){return function(e,n){e.stopPropagation(),a.default.push("".concat("/dashboard/booking/locations/","view?id=").concat(n))}(n,e.id)},children:(0,y.jsx)(p.Z,{alt:"Desk 1",body:"Sublocation : ".concat(e.sublocation.aggregate.count," "),header:e.name,image:"".concat("https://d1hk88326p7ilp.cloudfront.net","/").concat(null===(t=e.media[0])||void 0===t||null===(r=t.item)||void 0===r?void 0:r.filename)})})},n)}))})},m=t(92809),b=t(95146),g=t(72197);function j(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function h(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?j(Object(t),!0).forEach((function(n){(0,m.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):j(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var O=function(e){var n=e.control,t=e.errors,r=e.register,o=e.setFilters,i={control:n,errors:t,register:r};return(0,y.jsxs)(l.Z,{children:[(0,y.jsx)(d.Z,{md:6,children:(0,y.jsx)(b.P,h(h({},i),{},{errors:h({},t),label:"",name:"locationId",onChange:function(e){return o((function(n){return h(h({},n),{},{locationId:(null===e||void 0===e?void 0:e.value)||null})}))},placeholder:"Select Location",type:"property"}))}),(0,y.jsx)(d.Z,{md:6,children:(0,y.jsx)(g.l,h(h({},i),{},{label:"",name:"categoryId",onChange:function(e){return o((function(n){return h(h({},n),{},{categoryId:(null===e||void 0===e?void 0:e.value)||null})}))},type:"assetCategory"}))})]})},_={categoryId:null,locationId:null,q:null,filterType:"booking_table"},v=function(){return(0,y.jsx)(i.J,{FiltersComp:O,initialFilters:_,TableComp:f})},x=function(){return(0,y.jsx)(o.Z,{pageHeading:{heading:"View locations"},View:(0,y.jsx)(v,{})})}},40854:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/booking/locations",function(){return t(19692)}])}},function(e){e.O(0,[284,4195,7287,9082,3515,7431,2952,5146,9774,2888,179],(function(){return n=40854,e(e.s=n);var n}));var n=e.O();_N_E=n}]);