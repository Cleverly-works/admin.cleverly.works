(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9857],{39759:function(e,t,n){"use strict";var r=n(67294),i=n(45697),s=n(18944),a=function(e){var t=e.county,n=e.country,i=e.line1,a=e.line2,o=e.line3,c=e.postcode,u=e.town;return r.createElement("address",null,r.createElement(s.Z,null,i),a&&r.createElement(s.Z,null,a),o&&r.createElement(s.Z,null,o),r.createElement(s.Z,null,u),t&&r.createElement(s.Z,null,t),r.createElement(s.Z,null,c),r.createElement(s.Z,null,n))};a.displayName="Address",a.propTypes={county:i.string,country:i.string,line1:i.string.isRequired,line2:i.string,line3:i.string,postcode:i.string.isRequired,town:i.string},t.Z=a},93443:function(e,t,n){"use strict";var r=n(67294),i=n(45697),s=n(22796),a=n(18944),o=function(e){var t=e.content,n=e.text;return r.createElement(r.Fragment,null,r.createElement(s.Z,{marginBottom:"sm"}),r.createElement(a.Z,{content:t,context:"dark",size:"sm"}),r.createElement(a.Z,null,n))};o.propTypes={content:i.string.isRequired,text:(0,i.oneOfType)([i.node,i.string]).isRequired},t.Z=o},62188:function(e,t,n){"use strict";var r=n(67294),i=n(45697),s=n(55657),a=function(e){var t=e.icon,n=e.prefix;return r.createElement("span",{className:"fa-stack fa-1x",style:{pointerEvents:"none"}},r.createElement(s.Z,{className:"fa-stack-2x",color:"#eaf0f6",fixedWidth:!1,icon:"circle"}),r.createElement(s.Z,{className:"fa-stack-1x",color:"#506e91",fixedWidth:!1,icon:t,prefix:n}))};a.displayName="IconStacked",a.propTypes={icon:i.string.isRequired,prefix:i.string},a.defaultProps={prefix:"fas"},t.Z=a},47385:function(e,t,n){"use strict";var r=n(67294);t.Z=function(e){var t=(0,r.useRef)();return(0,r.useEffect)((function(){t.current=e})),t.current}},63785:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(70885),i=n(67294),s=n(45697),a=n(71002),o=n(42982),c=n(15671),u=n(43144);function l(e){var t=this,n=[];if(Array.isArray(e)){var r=e.map((function(e){return t.locationBuilder(e)}));n.push.apply(n,(0,o.Z)(r))}return"string"!==typeof e&&"number"!==typeof e||n.push(e),"object"===(0,a.Z)(e)&&e.lat&&e.lng&&n.push("".concat(e.lat,",").concat(e.lng)),n.join("%7C")}function p(e,t,n){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,i=6371,s=Math.PI,a="",o=e*s/180,c=t*s/180,u=n/1e3/i,p=0;for(p=0;p<=360;p+=r){var f=p*s/180,h=Math.asin(Math.sin(o)*Math.cos(u)+Math.cos(o)*Math.sin(u)*Math.cos(f)),d=180*(c+Math.atan2(Math.sin(f)*Math.sin(u)*Math.cos(o),Math.cos(u)-Math.sin(o)*Math.sin(h)))/s;a+=l((h=180*h/s)+","+d)}return encodeURI(a)}(e,t,n)}var f=function(){function e(t){var n=t.apiKey,r=t.center,i=t.channel,s=t.client,a=t.format,o=void 0===a?"png":a,u=t.language,l=t.location,p=void 0===l?"":l,f=t.maptype,h=void 0===f?"roadmap":f,d=t.markers,m=void 0===d?[]:d,g=t.paths,y=void 0===g?[]:g,b=t.region,v=t.rootURL,j=void 0===v?"https://maps.googleapis.com/maps/api/staticmap":v,O=t.scale,Z=void 0===O?1:O,w=t.signature,x=t.size,k=void 0===x?"400x200":x,P=t.style,B=t.visible,E=t.zoom,N=void 0===E?15:E;(0,c.Z)(this,e),this.apiKey=n,this.channel=i,this.center=r,this.client=s,this.format=o,this.language=u,this.location=p,this.maptype=h,this.markers=m,this.paths=y,this.region=b,this.rootURL=j,this.scale=Z,this.signature=w,this.size=k,this.style=P,this.visible=B,this.zoom=N}return(0,u.Z)(e,[{key:"urlBuilder",value:function(e,t,n){return t?"".concat(e).concat(n).concat(t):null}},{key:"renderBaseMap",value:function(){var e=[];e.push(this.urlBuilder("key",this.apiKey,"=")),e.push(this.urlBuilder("center",this.center,"=")),e.push(this.urlBuilder("channel",this.channel,"=")),e.push(this.urlBuilder("client",this.client,"=")),e.push(this.urlBuilder("format",this.format,"=")),e.push(this.urlBuilder("language",this.language,"=")),e.push(this.urlBuilder("maptype",this.maptype,"=")),e.push(this.urlBuilder("region",this.region,"=")),e.push(this.urlBuilder("scale",this.scale,"=")),e.push(this.urlBuilder("signature",this.signature,"=")),e.push(this.urlBuilder("size",this.size,"=")),e.push(this.urlBuilder("style",this.style,"=")),e.push(this.urlBuilder("visible",this.visible,"=")),e.push(this.urlBuilder("zoom",this.zoom,"="));var t=e.filter((function(e){return e})).join("&");return"".concat(this.rootURL,"?").concat(t)}},{key:"locationBuilder",value:function(e){var t=this,n=[];if(Array.isArray(e)){var r=e.map((function(e){return t.locationBuilder(e)}));n.push.apply(n,(0,o.Z)(r))}return"string"!==typeof e&&"number"!==typeof e||n.push(encodeURI(e)),"object"===(0,a.Z)(e)&&e.lat&&e.lng&&n.push("".concat(e.lat,",").concat(e.lng)),n.join("%7C")}},{key:"renderPath",value:function(e){var t=e.circle,n=e.color,r=e.fillcolor,i=e.geodesic,s=e.points,a=e.weight,o=[];if(t){var c=p(t.latitude,t.longitude,t.radius);o.push(this.urlBuilder("",this.locationBuilder("".concat(c)),""))}o.push(this.urlBuilder("color",n,":")),o.push(this.urlBuilder("weight",a,":")),o.push(this.urlBuilder("fillcolor",r,":")),o.push(this.urlBuilder("geodesic",i,":")),o.push(this.urlBuilder("",this.locationBuilder(s),""));var u=o.filter((function(e){return e})).join("%7C");return"path=".concat(u)}},{key:"renderParts",value:function(){var e=this;return this.paths.map((function(t){return e.renderPath(t)}))}},{key:"renderMarkers",value:function(){var e=this.markers,t=this.locationBuilder,n=this.location;return(e.length?e.map((function(e){var n="markers=";switch((0,a.Z)(e)){case"string":n+=t(e);break;case"object":var r=e.colour,i=e.label,s=e.location;n+=(r&&"color:".concat(r,"|"))+(i&&"label:".concat(i,"|"))+(s&&"".concat(t(s),"|"))}return n})):["markers=".concat(t(n))]).join("&")}},{key:"generateUrl",value:function(){var e=this.renderParts()||[],t=this.renderBaseMap(),n=this.renderMarkers();return"".concat(t,"&").concat(e,"&").concat(n)}}]),e}(),h=function(e){var t=e.apiKey,n=e.center,s=e.channel,a=e.className,o=e.client,c=e.container,u=void 0===c?"img":c,l=e.format,p=e.language,h=e.location,d=e.maptype,m=e.markers,g=e.paths,y=e.region,b=e.scale,v=e.signature,j=e.size,O=e.style,Z=e.styleMap,w=e.visible,x=e.zoom,k=j.split("x"),P=(0,r.Z)(k,2),B=P[0],E=P[1],N=(0,i.useState)(""),S=(0,r.Z)(N,2),I=S[0],C=S[1];return(0,i.useEffect)((function(){var e=new f({apiKey:t,center:n,channel:s,client:o,format:l,language:p,location:h,maptype:d,markers:m,paths:g,region:y,scale:b,signature:v,size:j,style:Z,visible:w,zoom:x}).generateUrl();C(e)}),[]),i.createElement(u,{className:a,width:B,height:E,src:I,style:O,alt:"map"})};h.displayName="StaticLocation",h.propTypes={apiKey:s.string.isRequired,center:s.string,channel:s.string,className:s.string,client:s.string,container:s.node,format:(0,s.oneOf)(["png","png8","png32","gif","jpg","jpg-baseline"]),language:s.string,location:s.string,maptype:(0,s.oneOf)(["roadmap","satellite","terrain","hybrid"]),markers:s.array,paths:s.array,region:s.string,scale:(0,s.oneOf)([1,2,4,"1","2","4"]),signature:s.string,size:s.string.isRequired,style:s.object,styleMap:s.string,visible:s.string,zoom:s.number},h.defaultProps={format:"png",maptype:"roadmap",scale:1,size:"400x200",zoom:15};var d=h},75515:function(e,t){"use strict";t.Z={camelize:function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,(function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()})).replace(/\s+/g,"")},decamelize:function(e){return e.split(/(?=[A-Z])/).join(" ")}}},80285:function(e,t){"use strict";t.Z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GBP",n=new Intl.NumberFormat(["en-GB"],{currency:t,currencyDisplay:"symbol",style:"currency"});return n.format(e)}},70316:function(e,t,n){"use strict";n.d(t,{J:function(){return E}});var r=n(92809),i=n(80318),s=n(10219),a=n(11163),o=n(67294),c=n(78215),u=n(2356),l=n(42283),p=n(97202),f=n(80284),h=n(65375),d=n(10973),m=n(14347),g=n(66805),y=n(69119),b=n(23855),v=n(83894);function j(e,t,n){var r=(0,o.useState)((function(){if(JSON.parse(window.sessionStorage.getItem(e))&&!Object.values(JSON.parse(window.sessionStorage[e])).includes(n))return t;try{var r=JSON.parse(window.sessionStorage.getItem(e));return r&&(r.startDate=r.startDate?(0,y.Z)((0,b.Z)(r.startDate)):null,r.endDate=r.endDate?(0,v.Z)((0,b.Z)(r.endDate)):null),r||t}catch(i){return console.log(i),t}})),i=r[0],s=r[1];return[i,function(t){try{var n=t instanceof Function?t(i):t;s(n),window.sessionStorage.setItem(e,JSON.stringify(n))}catch(r){console.log(r)}}]}var O=n(85893);function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=function(e){var t=e.initialValues,n=e.renderFilters,r=e.setFilters,s=e.lastQuery,a=e.filters,y=t.filterType,b=j("form_data",t,y),v=(0,i.Z)(b,2),Z=v[0],x=v[1],k=(0,l.cI)({defaultValues:Z||t}),P=k.control,B=k.errors,E=k.handleSubmit,N=k.register,S=k.reset,I=k.watch,C=k.setValue,D=w(w({},I()),{},{filterType:y});(0,o.useEffect)((function(){S(D)}),[S]),(0,o.useEffect)((function(){x(D)}),[a]);var _=function(e){var n=e.query;if(n!==s){var i={q:"%".concat(n,"%")||0},a=/^\d+$/.test(n);"id"in t&&(i.id=a?Number(n):null),"meta"in t&&(i.meta=a?{invoiceNumbers:[n]}:null),"jobNumber"in t&&(i.jobNumber=a?String(n):null,i.invoiceNumber=a?Number(n):null),(i.id||i.meta||i.jobNumber)&&(i.q=null),r((function(e){return w(w({},e),i)}))}};return(0,O.jsx)(p.Z,{handleSubmit:E(_),children:(0,O.jsxs)(f.Z,{title:"Filters",children:[(0,O.jsxs)(c.Z,{children:[(0,O.jsx)(u.Z,{sm:12,lg:12,children:(0,O.jsx)(h.Z,{label:"",children:(0,O.jsx)(d.Z,{errors:B,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:N,type:"search"})})}),(0,O.jsx)(u.Z,{sm:12,lg:12,children:n({control:P,errors:B,initialValues:t,register:N,setFilters:r,watch:I,setValue:C,reset:S})})]}),(0,O.jsx)(g.H,{content:"Search",context:"secondary",handleClick:_,type:"submit",children:(0,O.jsx)(m.Z,{content:"Clear",context:"danger",onClick:function(e){Object.keys(t).map((function(e){return C(e,null)})),r(t),S(t),_("")},size:"sm"})})]})})},k=["FiltersComp","initialFilters","TableComp"];function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E=function(e){var t=e.FiltersComp,n=e.initialFilters,r=e.TableComp,l=(0,s.Z)(e,k),p=j("filters",n,n.filterType),f=(0,i.Z)(p,2),h=f[0],d=f[1],m=(0,o.useState)(h||n),g=m[0],y=m[1],b=(0,a.useRouter)().query.show;return(0,o.useEffect)((function(){d(g)}),[g]),(0,O.jsx)(c.Z,{children:(0,O.jsxs)(u.Z,{sm:12,lg:12,children:[(0,O.jsx)(x,{initialValues:n,renderFilters:function(e){return(0,O.jsx)(t,B(B(B({},e),l),{},{show:b}))},setFilters:y,filters:g}),(0,O.jsx)(r,B({filters:g,initialFilters:n},l))]})})}},12642:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return N}});var r,i=n(66918),s=n(70316),a=n(80318),o=n(92809),c=n(67294),u=n(93633),l=n(75709),p=n(52209),f=(0,n(54397).Ps)(r||(r=(0,p.Z)(["\n  query GetNotifications(\n    $limit: Int\n    $offset: Int\n    $orderBy: Notification_order_by!\n    $q: String\n    $type: String\n    $userId: Int!\n  ) {\n    notifications: Notification(\n      limit: $limit\n      offset: $offset\n      where: { Communication: { content: { _ilike: $q } }, userId: { _eq: $userId } }\n      order_by: [$orderBy]\n    ) {\n      id\n      status\n      statusLog\n      createdAt\n      userId\n      communication: Communication {\n        id\n        content\n        type\n        meta\n        accountId\n        jobId\n        locationId\n        job: Job {\n          id\n        }\n        account: Account {\n          id\n          name\n        }\n      }\n    }\n    meta: Notification_aggregate(\n      where: { Communication: { content: { _ilike: $q } }, userId: { _eq: $userId } }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),h=n(55025),d=n(43566),m=n(80880),g=n(18862),y=n(80284),b=n(81185),v=n(12517),j=n(49705),O=n(7145),Z=n(85893);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=function(e){var t=e.filters,n=(0,j.x)({filters:t}),r=n.initialData,i=n.ref,s=(0,c.useContext)(d.Z).user,o=(0,c.useContext)(m.Z),p=x(x({},r),{},{userId:s.id}),w=(0,u.a)(f,{variables:x({},p)}),k=w.loading,P=w.data,B=(P=void 0===P?{notifications:[],meta:{aggregate:{totalCount:0}}}:P).notifications,E=P.meta,N=w.refetch,S=(0,l.D)(h.G,{onCompleted:function(e){N()}}),I=(0,a.Z)(S,1)[0],C=[{hidden:!0},{formatter:function(e){var t=e.row;return"unread"===t.status?(0,Z.jsx)("strong",{children:t.message}):(0,Z.jsx)("span",{children:t.message})},text:"Message"},{text:"Date",sortable:!0,sortName:"createdAt"},{hidden:!0},{hidden:!0}];return(0,Z.jsx)(y.Z,{open:!0,summary:"Notifications",children:(0,Z.jsx)(b.t,{columns:C,loading:k,meta:E,ref:i,refetch:N,rowClick:function(e){var t="read",n={createdAt:(0,O.v)(),status:t,userId:e.userId};I({variables:{id:e.id,changes:{status:t,statusLog:n}}}),e.communication&&e.communication.jobId&&o.show({title:"Job details",content:(0,Z.jsx)(v.g,{jobId:e.communication.jobId,toggleShow:o.close}),submit:!1,width:"50%"})},rows:B.map((function(e){var t,n,r=e.communication,i=r.content;return null!==(t=r.meta)&&void 0!==t&&null!==(n=t.content)&&void 0!==n&&n.toast&&(i=r.meta.content.toast),{id:e.id,message:i,date:(0,g.Z)(e.createdAt,!0),status:e.status,communication:r}}))})})},P=function(){return""},B={q:null,filterType:"notifications_table"},E=function(){return(0,Z.jsx)(s.J,{FiltersComp:P,initialFilters:B,TableComp:k})},N=function(){return(0,Z.jsx)(i.Z,{pageHeading:{heading:"Notifications"},View:(0,Z.jsx)(E,{})})}},77870:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/notifications",function(){return n(12642)}])}},function(e){e.O(0,[367,284,4195,5312,7287,2002,3086,7134,3486,9082,3515,4712,1265,6996,9666,4177,7431,5146,899,3016,9774,2888,179],(function(){return t=77870,e(e.s=t);var t}));var t=e.O();_N_E=t}]);