(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5700],{42772:function(e,t,n){"use strict";n.d(t,{S:function(){return r}});var r=function(e,t){var n=document.createElement("a");"string"===typeof n.download?(document.body.appendChild(n),n.download=t,n.href=e,n.click(),document.body.removeChild(n)):location.replace(e)}},86809:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return E}});var r,o=n(66918),a=n(92809),i=n(80318),u=n(67294),s=n(93633),c=n(38460),d=n(52209),p=(0,n(54397).Ps)(r||(r=(0,d.Z)(["\n  query GetFinancialJob(\n    $endDate: timestamptz\n    $limit: Int\n    $offset: Int\n    $startDate: timestamptz\n    $adminId: Int\n  ) {\n    vatReporting: getDashboard_Job_Financial(\n      limit: $limit\n      offset: $offset\n      where: { _and: [{ pay_date: { _gte: $startDate } }, { pay_date: { _lte: $endDate } }] }\n      args: { adminId: $adminId }\n    ) {\n      invoiceNumber: job_invoicenumber\n      account: customer_name\n      serviceLine: service_name\n      jobId: job_id\n      jobNumber: job_number\n      scheduleAt: job_date\n      jobTotal: customer_amount\n      supplierAmount: supplier_amount\n      serviceName: service_name\n      expensesAmountSupplier: job_expenses_supplier\n      expensesAmount: job_expenses_customer\n      payDate: pay_date\n    }\n    meta: getDashboard_Job_Financial_aggregate(\n      limit: $limit\n      offset: $offset\n      where: { _and: [{ pay_date: { _gte: $startDate } }, { pay_date: { _lte: $endDate } }] }\n      args: { adminId: $adminId }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]))),m=n(42283),l=n(57460),b=n.n(l),f=n(43703),v=n(4135),j=n(24237),x=n(43566),g=n(18862),_=n(80285),h=n(14347),D=n(55657),y=n(80284),w=n(81185),A=n(76800),S=n(42772),I=n(65570),N=n(49705),P=n(78586),Z=n(85893);function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $=j.ZP.div.withConfig({displayName:"list__StyledToolbar",componentId:"sc-4kgook-0"})(["float:right;"]),C=function(){var e,t,n=(0,N.x)({filters:{}}),r=n.initialData,o=n.ref,a=(0,u.useContext)(x.Z).user,d=(0,P.q)(),l=null===(e=d.admin.jobSetting)||void 0===e?void 0:e.jobNumberPrefix,j=null===(t=d.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,O="admin"===(null===a||void 0===a?void 0:a.accountType)?a.accountId:null,C=(0,u.useState)((0,f.Z)(new Date)),E=C[0],k=C[1],R=(0,u.useState)((0,v.Z)(new Date)),L=R[0],F=R[1],J=(0,m.cI)(),z=J.control,V=J.errors,q=J.register,X=(0,s.a)(p,{variables:T(T({adminId:O,endDate:L},r),{},{startDate:E})}),G=X.data,H=(G=void 0===G?{vatReporting:[],meta:{aggregate:{totalCount:0}}}:G).vatReporting,M=G.meta,U=X.loading,W=X.refetch,B=[{hidden:!0},{hidden:!0},{hidden:!0},{text:"Job ID",formatter:function(e){var t=e.row;return(0,Z.jsx)(I.D,{id:t.jobId,invoiceNumber:t.invoiceNumber,number:t.jobNumber,numberPrefix:l,numberSuffix:j,openCanvas:!0,type:t.jobType})}},{text:"Account"},{text:"Service Line"},{text:"Date Paid",formatter:function(e){var t=e.row;return(0,g.Z)(t.payDate)}},{text:"Date of Works",formatter:function(e){var t=e.row;return(0,g.Z)(t.scheduleAt)}},{text:"Job Total",formatter:function(e){var t=e.row;return(0,_.Z)(t.jobTotal)}},{text:"Supplier Amount",formatter:function(e){var t=e.row;return(0,_.Z)(t.supplierAmount)}},{text:"Expenses Amount Supplier",formatter:function(e){var t=e.row;return(0,_.Z)(t.expensesAmountSupplier)}},{text:"Expenses Amount",formatter:function(e){var t=e.row;return(0,_.Z)(t.expensesAmount)}}],K=function(e){var t=e.adminId,n=e.endDate,r=e.startDate,o=e.numberPrefix,a=e.numberSuffix,u=(0,c.t)(p,{variables:{adminId:t,endDate:n,startDate:r},onCompleted:function(e){var t=b().unparse(function(e,t){var n=t.numberPrefix,r=void 0===n?"":n,o=t.numberSuffix,a=void 0===o?"":o;return e.map((function(e){return{invoiceNumber:e.invoiceNumber,jobType:e.jobType,jobId:"".concat(r).concat(e.jobNumber).concat(a),account:e.account,serviceLine:e.serviceLine,datePaid:(0,g.Z)(e.payDate),jobDate:(0,g.Z)(e.scheduleAt),jobTotal:e.jobTotal,supplierAmount:e.supplierAmount,expensesAmountSupplier:e.expensesAmountSupplier,expensesAmount:e.expensesAmount}}))}(e.vatReporting,{numberPrefix:o,numberSuffix:a})),n="data:application/octet-stream,"+encodeURIComponent(t);(0,S.S)(n,"vat-report.csv")}}),s=(0,i.Z)(u,1)[0];return(0,Z.jsx)($,{children:(0,Z.jsx)(h.Z,{context:"white",onClick:function(e){e.stopPropagation(),s()},title:"Export to CSV",size:"md",children:(0,Z.jsx)(D.Z,{context:"secondary",icon:"file-csv",size:"lg"})})})},Q={control:z,errors:V,register:q};return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(y.Z,{title:"Filters",children:(0,Z.jsx)(A.M,T(T({},Q),{},{endDate:L,inline:!0,name:"startDate",onChange:function(e){k(e[0]),F(e[1])},placeholder:"Start date",selectsRange:!0,startDate:E}))}),(0,Z.jsx)(y.Z,{open:!0,title:"VAT Reporting",toolbar:(0,Z.jsx)(K,{adminId:O,endDate:L,numberPrefix:l,numberSuffix:j,startDate:E}),children:(0,Z.jsx)(w.t,{columns:B,loading:U,meta:M,ref:o,refetch:W,rows:H.map((function(e){return{invoiceNumber:e.invoiceNumber,jobType:e.jobType,jobNumber:e.jobNumber,jobId:e.jobId,account:e.account,serviceLine:e.serviceLine,payDate:e.payDate,scheduleAt:e.scheduleAt,jobTotal:e.jobTotal,supplierAmount:e.supplierAmount,expensesAmountSupplier:e.expensesAmountSupplier,expensesAmount:e.expensesAmount}}))})})]})},E=function(){return(0,Z.jsx)(o.Z,{pageHeading:{heading:"VAT Reporting"},View:(0,Z.jsx)(C,{})})}},69518:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/data/vat",function(){return n(86809)}])}},function(e){e.O(0,[367,284,4195,5312,7287,2002,3086,7134,3486,9082,3515,4712,1265,6996,9666,4177,9959,5146,899,3016,9774,2888,179],(function(){return t=69518,e(e.s=t);var t}));var t=e.O();_N_E=t}]);