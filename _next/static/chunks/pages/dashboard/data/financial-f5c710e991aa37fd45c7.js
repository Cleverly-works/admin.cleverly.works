(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7908],{73704:function(e,t,n){"use strict";n.d(t,{C:function(){return j}});var r=n(92809),o=n(10219),a=n(42426),i=n(78215),s=n(2356),c=n(19716),d=n(22796),u=n(85893),l=["control","errors","nameEnd","nameStart","placeholderEnd","placeholderStart","space"];function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var j=function(e){var t=e.control,n=e.errors,r=e.nameEnd,m=e.nameStart,j=e.placeholderEnd,x=e.placeholderStart,b=e.space,v=(0,o.Z)(e,l);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(i.Z,{children:[(0,u.jsx)(s.Z,{md:6,children:(0,u.jsx)(c.Z,p({control:t,errors:n,locale:a.Z,name:m,placeholder:x},v))}),(0,u.jsx)(s.Z,{md:6,children:(0,u.jsx)(c.Z,p({control:t,errors:n,locale:a.Z,name:r,placeholder:j},v))})]}),b&&(0,u.jsx)(d.Z,{marginBottom:"sm"})]})};j.defaultProps={placeholderStart:"Start date",placeholderEnd:"End date",space:!0}},22384:function(e,t,n){"use strict";n.d(t,{r:function(){return r}});var r=[{text:"All outstanding invoices",value:""},{text:"1 - 30",value:"1-30"},{text:"31 - 60",value:"31-60"},{text:"61 - 90",value:"61-90"},{text:"> 90",value:"90-"}]},42772:function(e,t,n){"use strict";n.d(t,{S:function(){return r}});var r=function(e,t){var n=document.createElement("a");"string"===typeof n.download?(document.body.appendChild(n),n.download=t,n.href=e,n.click(),document.body.removeChild(n)):location.replace(e)}},7119:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return re}});var r,o,a=n(66918),i=n(92809),s=n(10219),c=n(80318),d=n(67294),u=n(26075),l=n(93633),m=n(38460),p=n(52209),j=n(54397),x=(0,j.Ps)(r||(r=(0,p.Z)(["\n  query getFinancialList(\n    $adminId: Int!\n    $customerId: Int\n    $invoiceNumber: jsonb\n    $jobId: String\n    $durationStatus: String\n    $durationEndDate: timestamptz\n    $durationStartDate: timestamptz\n    $limit: Int\n    $managerId: Int\n    $locationId: Int\n    $offset: Int\n    $supplierId: Int\n  ) {\n    getFinancialList(\n      adminId: $adminId\n      customerId: $customerId\n      invoiceNumber: $invoiceNumber\n      jobId: $jobId\n      durationStatus: $durationStatus\n      durationEndDate: $durationEndDate\n      durationStartDate: $durationStartDate\n      limit: $limit\n      managerId: $managerId\n      locationId: $locationId\n      offset: $offset\n      supplierId: $supplierId\n    ) {\n      jobFinancial\n      meta\n      __typename\n    }\n  }\n"]))),b=((0,j.Ps)(o||(o=(0,p.Z)(["\n  query getFinancialTotal(\n    $adminId: Int!\n    $customerId: Int\n    $invoiceNumber: jsonb\n    $jobId: String\n    $jobEndDate: timestamptz\n    $jobStartDate: timestamptz\n    $limit: Int\n    $managerId: Int\n    $locationId: Int\n    $offset: Int\n    $paymentStartDate: timestamptz\n    $paymentEndDate: timestamptz\n    $supplierId: Int\n  ) {\n    getFinancialTotal(\n      adminId: $adminId\n      customerId: $customerId\n      invoiceNumber: $invoiceNumber\n      jobId: $jobId\n      jobEndDate: $jobEndDate\n      jobStartDate: $jobStartDate\n      limit: $limit\n      managerId: $managerId\n      locationId: $locationId\n      offset: $offset\n      paymentStartDate: $paymentStartDate\n      paymentEndDate: $paymentEndDate\n      supplierId: $supplierId\n    ) {\n      sum\n      avg\n      __typename\n    }\n  }\n"]))),n(84774)),v=n(42283),f=n(57460),g=n.n(f),h=n(43703),I=n(4135),Z=n(69119),y=n(83894),D=n(24237),S=n(14347),$=n(55657),_=n(18862),w=n(80285),E=n(91126),O=n(80284),P=n(97202),C=n(78215),N=n(2356),F=n(46482),A=n(22796),z=n(71247),T=n(7720),L=n(81185),k=n(73704),V=n(42772),q=n(78606),B=n(68343),J=n(22384),R=n(65570),X=n(95146),H=n(1323),U=n(49705),G=n(78586),K=n(85893),M=["jobId"];function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Y=[{text:"Job date",value:"job"},{text:"Payment date",value:"payment"},{text:"Completed date",value:"completed"},{text:"Invoiced date",value:"invoiceSent"},{text:"Closed date",value:"closed"}],ee={endDate:(0,I.Z)(new Date),startDate:(0,h.Z)(new Date)},te=D.ZP.div.withConfig({displayName:"list__StyledToolbar",componentId:"sc-s7sqjl-0"})(["float:right;"]),ne=function(){var e,t,n=(0,H.x)().user,r=(0,u.x)(),o=(0,G.q)(),a=null===(e=o.admin.jobSetting)||void 0===e?void 0:e.jobNumberPrefix,i=null===(t=o.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,p=(0,d.useState)(),j=p[0],f=p[1],h=(0,d.useState)(ee),I=h[0],D=h[1],Q=(0,U.x)({filters:I}),ne=Q.initialData,re=Q.ref,oe=(0,v.cI)({defaultValues:I}),ae=oe.control,ie=oe.errors,se=oe.handleSubmit,ce=oe.register,de=(0,l.a)(x,{variables:W({adminId:n.accountId},ne)}),ue=de.data,le=(ue=void 0===ue?{getFinancialList:{jobFinancial:[],meta:{aggregate:{avg:{customer_amount:0,supplier_amount:0,job_expenses_customer:0,job_expenses_supplier:0},sum:{customer_amount:0,supplier_amount:0,job_expenses_customer:0,job_expenses_supplier:0},totalCount:0}}}}:ue).getFinancialList,me=le.jobFinancial,pe=le.meta,je=de.loading,xe=de.refetch,be=(0,m.t)(b.E6,{onCompleted:function(e){(0,q._)({adminId:n.adminId,type:j,job:he[0],client:r})}}),ve=(0,c.Z)(be,2),fe=ve[0],ge=ve[1].data,he=(ge=void 0===ge?{job:null}:ge).job,Ie=function(e,t,r){e.stopPropagation(),f(r),fe({variables:{adminId:n.accountId,number:t.jobNumber,id:t.jobId}})},Ze=function(e){e.adminId,e.filterVariable;return(0,K.jsx)(te,{children:(0,K.jsx)(S.Z,{context:"white",onClick:function(e){e.stopPropagation();var t=me.map((function(e){e.jobId;return(0,s.Z)(e,M)})),n=g().unparse(t),r="data:application/octet-stream,"+encodeURIComponent(n);(0,V.S)(r,"FinancialData.csv")},title:"Export to CSV",size:"md",children:(0,K.jsx)($.Z,{context:"secondary",icon:"file-csv",size:"lg"})})})},ye=[{hidden:!0},{hidden:!0},{hidden:!0},{text:"Job ID",formatter:function(e){var t,n,r=e.row;return(0,K.jsx)(R.D,{id:r.jobId,number:r.jobNumber,invoiceNumber:null===(t=r.invoiceNumber)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.id,numberPrefix:a,numberSuffix:i,openCanvas:!0,type:r.jobType})}},{text:"Customer"},{text:"Job Date",formatter:function(e){var t=e.row;return(0,_.Z)(t.startDate)}},{text:"Pay Date",formatter:function(e){var t=e.row;return t.payDate&&(0,_.Z)(t.payDate)}},{text:"Completed Date",formatter:function(e){var t=e.row;return t.completedDate&&(0,_.Z)(t.completedDate)}},{text:"Invoiced Date",formatter:function(e){var t=e.row;return t.invoicedDate&&(0,_.Z)(t.invoicedDate)}},{text:"Closed Date",formatter:function(e){var t=e.row;return t.closedDate&&(0,_.Z)(t.closedDate)}},{text:"Customer Amount",formatter:function(e){var t=e.row;return(0,w.Z)(t.jobTotal)}},{text:"Supplier Amount",formatter:function(e){var t=e.row;return(0,w.Z)(t.supplierAmount)}},{text:"Customer Expenses",formatter:function(e){var t=e.row;return(0,w.Z)(t.expensesAmount)}},{text:"Supplier Expenses",formatter:function(e){var t=e.row;return(0,w.Z)(t.expensesAmountSupplier)}},{text:"Revenue",formatter:function(e){var t=e.row;return(0,w.Z)(t.revenue)}},{text:"Status",formatter:function(e){var t=e.row;return(0,B.B)({value:t.jobStatus})}},{text:"Service"},{formatter:E.Z,formatterData:[{context:"secondary",icon:["fas","download"],onClick:function(e,t){return Ie(e,t,"customerVat")},tooltip:"Customer Invoice"},{context:"primary",icon:["fas","download"],onClick:function(e,t){return Ie(e,t,"supplier")},tooltip:"Supplier Invoice"}],text:"Actions"}],De={control:ae,errors:ie,register:ce};return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(O.Z,{title:"Filters",children:(0,K.jsxs)(P.Z,{handleSubmit:se((function(e){var t,n,r,o;D({customerId:null===(t=e.customerId)||void 0===t?void 0:t.value,invoiceNumber:e.invoiceNumber?+e.invoiceNumber:null,jobId:e.invoiceNumber||null,durationStatus:e.durationStatus,durationEndDate:(0,y.Z)(e.durationEndDate),durationStartDate:(0,Z.Z)(e.durationStartDate),locationId:null===(n=e.locationId)||void 0===n?void 0:n.value,outstandingLevel:e.outstandingLevel>-1?e.outstandingLevel:null,supplierId:null===(r=e.supplierId)||void 0===r?void 0:r.value,managerId:null===(o=e.managerId)||void 0===o?void 0:o.value})})),children:[(0,K.jsx)(C.Z,{children:(0,K.jsx)(N.Z,{md:6,children:(0,K.jsx)(F.Z,W(W({},De),{},{name:"durationStatus",options:Y}))})}),(0,K.jsx)(A.Z,{marginBottom:"sm"}),(0,K.jsx)(k.C,W(W({},De),{},{nameEnd:"durationEndDate",nameStart:"durationStartDate",placeholderEnd:"End date",placeholderStart:"Start date"})),(0,K.jsxs)(C.Z,{children:[(0,K.jsx)(N.Z,{md:6,children:(0,K.jsx)(z.Z,W(W({},De),{},{name:"invoiceNumber",placeholder:"Id / Invoice"}))}),(0,K.jsx)(N.Z,{md:6,children:(0,K.jsx)(F.Z,W(W({},De),{},{name:"outstandingLevel",options:J.r}))})]}),(0,K.jsxs)(C.Z,{children:[(0,K.jsx)(N.Z,{md:6,children:(0,K.jsx)(X.P,W(W({},De),{},{label:"",name:"customerId",placeholder:"Select customer",type:"customer"}))}),(0,K.jsx)(N.Z,{md:6,children:(0,K.jsx)(X.P,W(W({},De),{},{label:"",name:"locationId",placeholder:"Select Location",type:"property"}))})]}),(0,K.jsxs)(C.Z,{children:[(0,K.jsx)(N.Z,{md:6,children:(0,K.jsx)(X.P,W(W({},De),{},{label:"",name:"supplierId",placeholder:"Select supplier",type:"supplier"}))}),(0,K.jsx)(N.Z,{md:6,children:(0,K.jsx)(X.P,W(W({},De),{},{accountId:n.accountId,label:"",name:"managerId",placeholder:"Select user",type:"user"}))})]}),(0,K.jsx)(A.Z,{marginBottom:"sm"}),(0,K.jsx)(S.Z,{content:"Filter",context:"secondary",size:"sm",type:"submit"})]})}),(0,K.jsxs)(O.Z,{dataSet:{"data-cy":"Financial Data"},open:!0,title:"Financial Data",toolbar:(0,K.jsx)(Ze,{adminId:n.accountId,filterVariable:I}),children:[(0,K.jsx)(L.t,{columns:ye,loading:je,meta:pe,ref:re,refetch:xe,rows:me.map((function(e){return{invoiceNumber:e.invoiceNumber,jobId:e.jobId,jobNumber:e.jobNumber,jobType:e.jobType,account:e.account,startDate:e.startDate,payDate:e.payDate,completedDate:e.completedDate,invoicedDate:e.invoicedDate,closedDate:e.closedDate,jobTotal:e.jobTotal,supplierAmount:e.supplierAmount,expensesAmount:e.expensesAmount,expensesAmountSupplier:e.expensesAmountSupplier,revenue:e.jobTotal-e.supplierAmount,jobStatus:e.jobStatus,serviceLine:e.serviceLine,actions:""}}))}),(0,K.jsx)(A.Z,{}),pe&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)(C.Z,{children:[(0,K.jsx)(N.Z,{md:1,children:"Total:"}),(0,K.jsx)(T.Z,{content:(0,K.jsxs)(K.Fragment,{children:["Customer Amount: ",(0,K.jsx)("b",{children:(0,w.Z)(pe.aggregate.sum.customer_amount)})]}),context:"secondary",shape:"round",size:"sm"}),(0,K.jsx)(T.Z,{content:(0,K.jsxs)(K.Fragment,{children:["Supplier Amount:",(0,K.jsx)("b",{children:(0,w.Z)(pe.aggregate.sum.supplier_amount)})]}),context:"secondary",shape:"round",size:"sm"}),(0,K.jsx)(T.Z,{content:(0,K.jsxs)(K.Fragment,{children:["Customer Expense:",(0,K.jsx)("b",{children:(0,w.Z)(pe.aggregate.sum.job_expenses_customer)})]}),context:"secondary",shape:"round",size:"sm"}),(0,K.jsx)(T.Z,{content:(0,K.jsxs)(K.Fragment,{children:["Supplier Expense:",(0,K.jsx)("b",{children:(0,w.Z)(pe.aggregate.sum.job_expenses_supplier)})]}),context:"secondary",shape:"round",size:"sm"})]}),(0,K.jsxs)(C.Z,{children:[(0,K.jsx)(N.Z,{md:1,children:"Average:"}),(0,K.jsx)(T.Z,{content:(0,K.jsxs)(K.Fragment,{children:["Customer Amount:",(0,K.jsx)("b",{children:(0,w.Z)(pe.aggregate.avg.customer_amount)})]}),context:"secondary",shape:"round",size:"sm"}),(0,K.jsx)(T.Z,{content:(0,K.jsxs)(K.Fragment,{children:["Supplier Amount:",(0,K.jsx)("b",{children:(0,w.Z)(pe.aggregate.avg.supplier_amount)})]}),context:"secondary",shape:"round",size:"sm"}),(0,K.jsx)(T.Z,{content:(0,K.jsxs)(K.Fragment,{children:["Customer Expense:",(0,K.jsx)("b",{children:(0,w.Z)(pe.aggregate.avg.job_expenses_customer)})]}),context:"secondary",shape:"round",size:"sm"}),(0,K.jsx)(T.Z,{content:(0,K.jsxs)(K.Fragment,{children:["Supplier Expense:",(0,K.jsx)("b",{children:(0,w.Z)(pe.aggregate.avg.job_expenses_supplier)})]}),context:"secondary",shape:"round",size:"sm"})]}),pe&&(0,K.jsxs)(C.Z,{children:[(0,K.jsx)(N.Z,{md:1,children:"Total Jobs:"}),(0,K.jsx)(T.Z,{content:"".concat(pe.aggregate.totalCount),context:"success"})]})]})]})]})},re=function(){return(0,K.jsx)(a.Z,{pageHeading:{heading:"Financial Data"},View:(0,K.jsx)(ne,{})})}},83892:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/data/financial",function(){return n(7119)}])}},function(e){e.O(0,[367,284,4195,5312,7287,2002,3086,7134,3486,9082,3515,4712,1265,6996,9666,4177,4894,1252,5146,899,3016,8606,9774,2888,179],(function(){return t=83892,e(e.s=t);var t}));var t=e.O();_N_E=t}]);