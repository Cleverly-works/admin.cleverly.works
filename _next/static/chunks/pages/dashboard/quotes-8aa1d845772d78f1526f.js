(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4064],{76585:function(e,n,t){"use strict";t.d(n,{z:function(){return a}});var r,i=t(52209),a=(0,t(54397).Ps)(r||(r=(0,i.Z)(["\n  fragment AccountFields on Account {\n    id\n    type\n    name\n    status\n    vatId\n  }\n"])))},35450:function(e,n,t){"use strict";t.d(n,{r:function(){return h}});var r=t(92809),i=t(80318),a=t(67294),o=t(42593),s=t(78215),u=t(2356),d=t(65375),l=t(93515),c=t(55148),m=t(95146),p=t(76800),f=t(83894),b=t(24237),y=t(85893);function g(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function v(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?g(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var h=function(e){var n=e.control,t=e.errors,r=e.initialValues,l=e.register,b=e.setFilters,g=e.setValue,h=e.watch,$=(0,a.useContext)(o.Z).hasRole,q={control:n,errors:t,register:l},I=h("customerId"),j=h("supplierId"),S=h("startDate"),x=!r.customerId;(0,a.useEffect)((function(){var e=O.filter((function(e){return"quoteOffered"===e.value})),n=(0,i.Z)(e,1)[0];b((function(e){return v(v({},e),{},{status:S?[n.value]:null})})),g("status",S?[n]:null)}),[S]);var O=c.iz.map((function(e){return $("supplier")?{label:e.supplierText,value:e.value}:$("customer")?{label:e.customerText,value:e.value}:{label:e.text,value:e.value}})).filter((function(e){return null!==e.label}));(0,a.useEffect)((function(){x&&b((function(e){return v(v({},e),{},{customerId:(null===I||void 0===I?void 0:I.value)||null})}))}),[I]),(0,a.useEffect)((function(){x&&b((function(e){return v(v({},e),{},{supplierId:(null===j||void 0===j?void 0:j.value)||null})}))}),[j]);return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(s.Z,{children:[(0,y.jsx)(u.Z,{md:6,children:(0,y.jsx)(p.M,v(v({},q),{},{name:"startDate",onChange:function(e){b((function(n){return v(v({},n),{},{startDate:e||null})})),g("startDate",e)},placeholder:"Quote offered date"}))}),(0,y.jsx)(u.Z,{md:6,children:(0,y.jsx)(p.M,v(v({},q),{},{name:"endDate",onChange:function(e){var n=e?(0,f.Z)(e):e;b((function(e){return v(v({},e),{},{endDate:n})})),g("endDate",n)},placeholder:"Quote due date"}))})]}),(0,y.jsxs)(s.Z,{align:"baseline",children:[(0,y.jsx)(u.Z,{md:6,children:(0,y.jsx)(d.Z,{label:null,children:(0,y.jsx)(_,v(v({},q),{},{isDisabled:Boolean(S),placeholder:"Select status",name:"status",isMulti:Boolean(!S),onChange:function(e){var n=e.map((function(e){return e.value}));b((function(e){return v(v({},e),{},{status:n.length>0?n:null})})),g("status",e)},options:O}))})}),!$(["customer","supplier"])&&(0,y.jsx)(u.Z,{md:6,children:(0,y.jsx)(m.P,v(v({},q),{},{label:"",name:"customerId",placeholder:"Select customer",isClearable:!0,type:"customer"}))})]}),!$(["supplier","customer"])&&!S&&(0,y.jsx)(s.Z,{children:(0,y.jsx)(u.Z,{md:6,children:(0,y.jsx)(m.P,v(v({},q),{},{label:"",name:"supplierId",isClearable:!0,placeholder:"Select supplier",type:"supplier"}))})})]})},_=(0,b.ZP)(l.Z).withConfig({displayName:"filter__StyledSelect",componentId:"sc-18vz0yz-0"})(["div > div > div{background:",";}div > div{background:",";}"],(function(e){return e.isDisabled&&"#dddddd"}),(function(e){return e.isDisabled&&"#dddddd"}))},37415:function(e,n,t){"use strict";t.d(n,{v:function(){return re}});var r,i,a,o,s,u,d=t(83789),l=t(80318),c=t(92809),m=t(67294),p=t(11163),f=t(93633),b=t(38460),y=t(57460),g=t.n(y),v=t(80880),h=t(29444),_=t(80285),$=t(18862),q=t(91126),I=t(58448),j=t(22796),S=t(14347),x=t(55657),O=t(80284),w=t(52209),D=t(54397),k=t(76585),Z=t(38478),A=t(88402),P=(0,D.Ps)(r||(r=(0,w.Z)(["\n  fragment QuoteFields on Job {\n    quoteNumber\n    quoteDue\n    quoteCharge\n  }\n"]))),N=((0,D.Ps)(i||(i=(0,w.Z)(["\n  query Quote($id: Int!) {\n    job: Job_by_pk(id: $id) {\n      id\n      title\n      description\n      costCategory\n      status\n      workStatus\n      scheduledAt\n      createdAt\n      customerId\n      customerUserId\n      locationId\n      managerId\n      parentId\n      serviceId\n      slaId\n      tenantId\n      reference\n      amount\n      accountByTenantid {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      customer: Account {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      customerUser: CustomerUser {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        vat\n      }\n      location: Location {\n        id\n        access\n        createdAt\n        name\n        contactUserId\n      }\n      messages: Messages {\n        id\n        message\n        priority\n        taskId\n        jobId\n        locationId\n        description\n      }\n      service: Service {\n        id\n        name\n        countryId\n        currencyId\n      }\n      supplier: Suplier {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      manager: Manager {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]))),t(27834)),C=(0,D.Ps)(a||(a=(0,w.Z)(["\n  query GetQuotes(\n    $endDate: timestamptz\n    $number: String\n    $limit: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $q: String\n    $startDate: timestamptz\n    $status: [String!]\n    $type: String\n  ) {\n    quotes: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        number: { _eq: $number }\n        status: { _in: $status }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n      }\n      order_by: [$orderBy]\n    ) {\n      ...JobFields\n      ...JobSupplierFields\n      ...QuoteFields\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n      }\n      location: Location {\n        id\n        name\n      }\n      service: Service {\n        id\n        name\n      }\n      timings: JobTimings {\n        id\n        status\n        notes\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        number: { _eq: $number }\n        status: { _in: $status }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n"])),k.z,Z.aL,P,Z.H_,N.Px),F=(0,D.Ps)(o||(o=(0,w.Z)(["\n  query GetQuotes(\n    $customerId: Int\n    $date: timestamptz\n    $endDate: timestamptz\n    $number: String\n    $limit: Int\n    $locationId: Int\n    $managerId: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $q: String\n    $startDate: timestamptz\n    $status: [String!]\n    $supplierId: Int\n    $type: String\n  ) {\n    quotes: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        type: { _eq: $type }\n        number: { _eq: $number }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        supplierId: { _eq: $supplierId }\n        quoted: { _eq: true }\n      }\n      order_by: [$orderBy]\n    ) {\n      ...JobFields\n      ...JobAdminFields\n      ...QuoteFields\n      statusLog\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n        lineItems: SupplierQuoteLineItems {\n          id\n          total\n        }\n      }\n      supplier: Supplier {\n        ...AccountFields\n      }\n      admin: Admin {\n        id\n        name\n      }\n      customer: Customer {\n        ...AccountFields\n      }\n      location: Location {\n        id\n        name\n      }\n      manager: Manager {\n        ...UserFields\n      }\n      service: Service {\n        id\n        name\n      }\n      timings: JobTimings {\n        id\n        status\n        notes\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        number: { _eq: $number }\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        supplierId: { _eq: $supplierId }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"])),k.z,A.WW,Z.aL,Z.wd,P,N.Px),E=((0,D.Ps)(s||(s=(0,w.Z)(["\n  query getFinancialList(\n    $adminId: Int!\n    $customerId: Int\n    $invoiceNumber: jsonb\n    $jobId: String\n    $jobEndDate: timestamptz\n    $jobStartDate: timestamptz\n    $limit: Int\n    $managerId: Int\n    $locationId: Int\n    $offset: Int\n    $paymentStartDate: timestamptz\n    $paymentEndDate: timestamptz\n    $supplierId: Int\n  ) {\n    getFinancialList(\n      adminId: $adminId\n      customerId: $customerId\n      invoiceNumber: $invoiceNumber\n      jobId: $jobId\n      jobEndDate: $jobEndDate\n      jobStartDate: $jobStartDate\n      limit: $limit\n      managerId: $managerId\n      locationId: $locationId\n      offset: $offset\n      paymentStartDate: $paymentStartDate\n      paymentEndDate: $paymentEndDate\n      supplierId: $supplierId\n    ) {\n      jobFinancial\n      meta\n      __typename\n    }\n  }\n"]))),(0,D.Ps)(u||(u=(0,w.Z)(['\n  query GetDashboardList(\n    $accountId: Int\n    $adminId: Int\n    $customerId: Int\n    $supplierId: Int\n    $number: String\n    $asAt: timestamptz\n    $jobHoldReasonId: Int\n    $limit: Int\n    $monthStart: timestamptz\n    $offset: Int\n    $orderBy: dashboard_home_details_order_by!\n    $q: String\n    $tileName: String\n    $dayStart: timestamptz\n    $userId: Int\n    $status: [String!]\n    $yearStart: timestamptz\n    $type: String\n  ) {\n    quotes: getDashboard_HomeTile_Details(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        number: { _eq: $number }\n        status: { _in: $status }\n        Job: { type: { _eq: $type } }\n      }\n      order_by: [$orderBy]\n      limit: $limit\n      offset: $offset\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n        __typename\n      }\n      ...JobFields\n      ...JobAdminFields\n      admin: Admin {\n        id\n        name\n        __typename\n      }\n      customer: Customer {\n        ...AccountFields\n        __typename\n      }\n      location: Location {\n        id\n        name\n        __typename\n      }\n      manager: Manager {\n        ...UserFields\n        __typename\n      }\n      service: Service {\n        id\n        name\n        __typename\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n          __typename\n        }\n        __typename\n      }\n      sla: SLA {\n        id\n        name\n        __typename\n      }\n      supplier: Supplier {\n        ...AccountFields\n        __typename\n      }\n      supplierOffers: SupplierOffers {\n        status\n        rate\n        supplier: Supplier {\n          ...AccountFields\n          __typename\n        }\n        __typename\n      }\n      job: Job {\n        type\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n          __typename\n        }\n        __typename\n      }\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n      }\n      id: jobId\n      number\n      # location\n      priority\n      scheduledAt\n      assignedTo\n      jobHoldReason\n      locationId\n      meta\n      managerId\n      description\n      customerName\n      customerId\n      reference\n      serviceName\n      status\n      supplierId\n      supplierName\n      timingStart\n      type\n      quoteNumber\n      quoteDue\n      createdAt\n    }\n    meta: getDashboard_HomeTile_Details_aggregate(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        number: { _eq: $number }\n        status: { _in: $status }\n        Job: { type: { _eq: $type } }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n        __typename\n      }\n      __typename\n    }\n  }\n  ',"\n  ","\n  ","\n  ","\n  ","\n"])),k.z,A.WW,Z.aL,Z.wd,N.Px)),T=t(83894),R=t(23855);function J(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function U(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?J(Object(t),!0).forEach((function(n){(0,c.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):J(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var L=t(81185),Q=t(55148),z=t(80937),M=t(65570),V=t(1323),B=t(78586),H=t(42772),W=t(49705),X=t(91110),G=t(99362),K=t(13304),Y=t(24237),ee=t(85893);function ne(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function te(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ne(Object(t),!0).forEach((function(n){(0,c.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ne(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var re=function(e){var n,t,r,i=e.filters,a=(0,m.useContext)(v.Z),o=(0,B.q)(),s=(0,p.useRouter)().query,u=(0,m.useState)(!1),c=u[0],y=u[1],w=null===(n=o.admin.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,D=null===(t=o.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,k=(0,V.x)(),Z=k.hasRole,A=k.user,P=(0,W.x)({filters:i}),N=P.initialData,J=P.ref,Y=te(te({},N),{},{managerId:i.managerId?A.id:null,number:N.id?String(N.id):null}),ne=new Date(s.asAt)||new Date,re=(0,m.useState)({monthStart:(0,G.X)(ne).monthStart,todayEnd:(0,G.X)(ne).todayEnd,todayStart:(0,G.X)(ne).todayStart,yearStart:(0,G.X)(ne).yearStart,asAt:s.asAt}),se=re[0],ue=re[1];(0,m.useEffect)((function(){var e=(0,G.X)(ne),n=e.monthStart,t=e.todayEnd,r=e.todayStart,i=e.yearStart;ue({monthStart:n,todayEnd:t,todayStart:r,yearStart:i,asAt:s.asAt})}),[null===i||void 0===i?void 0:i.asAt]);var de=function(e,n,t,r){var i=e.limit,a=e.offset,o=e.orderBy,s=e.q,u=e.status;if(t.hasOwnProperty("tileName"))return{query:E,variables:U({q:null,accountId:null,userId:null,currentUserId:null===n||void 0===n?void 0:n.id,asAt:(0,T.Z)((0,R.Z)(r.asAt)),tileName:null===t||void 0===t?void 0:t.tileName,limit:50,offset:0,orderBy:{jobId:"desc"},monthStart:r.monthStart,dayStart:r.todayStart,yearStart:r.yearStart,adminId:null===n||void 0===n?void 0:n.adminId},e)};switch(n.accountType){case"supplier":return{query:C,variables:U({limit:i,offset:a,orderBy:o,q:s,status:u},e)};default:return{query:F,variables:U({},e)}}}(Y,A,s,se),le=de.query,ce=de.variables;"Accepted"===ce.status?(ce.type="reactive",delete ce.status):delete ce.type;var me=(0,f.a)(le,{variables:ce}),pe=me.data,fe=(pe=void 0===pe?{quotes:[],meta:{aggregate:{totalCount:0}}}:pe).quotes,be=pe.meta,ye=me.loading,ge=me.refetch,ve=(0,b.t)(le,{variables:te(te({},ce),{},{limit:(null===be||void 0===be||null===(r=be.aggregate)||void 0===r?void 0:r.totalCount)||150}),onCompleted:function(e){var n=e.quotes;if(c){var t=g().unparse(Ae(n,!0)),r="data:application/octet-stream,"+encodeURIComponent(t);(0,H.S)(r,"quotes.csv"),y(!1)}},skip:!0}),he=(0,l.Z)(ve,2),_e=he[0],$e=he[1].loading,qe=void 0===$e||$e,Ie=function(){ge(),a.close()},je=function(e){e.stopPropagation(),_e(),y(!0)},Se={content:"Edit",context:"secondary",icon:["fas","edit"],onClick:function(e,n){e.stopPropagation(),p.default.push("/dashboard/issues/manage?id=".concat(n.number,"&quoted=1"))},tooltip:"Edit"},xe={context:"info",icon:["fas","receipt"],onClick:function(e,n){return function(e){var n=e.e,t=e.row;n.stopPropagation(),a.show({content:(0,ee.jsx)(X.m,{onSuccess:Ie,quotationId:t.quotationsId}),title:"Quotation",width:"50%"})}({e:e,row:n})},tooltip:"Fill quotation"},Oe={context:"secondary",icon:["fas","receipt"],onClick:function(e,n){return p.default.push("/dashboard/issues/view?id=".concat(n.number))},tooltip:"info"},we=[{sortable:!0,text:"ID",sortName:"id",formatter:function(e){var n=e.row;return(0,ee.jsx)(M.D,{id:n.id,number:n.number,numberPrefix:w,numberSuffix:D,status:n.status,openCanvas:!0,type:n.type,isQuote:n.quoted})}},{text:"Creator"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(e){var n=e.row;return(0,ee.jsx)(ee.Fragment,{children:(0,ee.jsx)(ae,{children:n.type})})},text:"Type",sortName:"type"},{formatter:function(e){var n=e.row;return(0,ee.jsx)(ee.Fragment,{children:(0,ee.jsx)(ae,{children:n.description})})},text:"Description"},{sortable:!0,hidden:!Z("admin"),formatter:(0,h.Z)("/dashboard/users/view","managerId","manager"),sortName:'{"Manager": {"nameFirst": "ORDER"}}',text:"Assigned to"},{sortable:!0,hidden:!Z(["admin","customer"]),formatter:(0,h.Z)("/dashboard/properties/view","propertyId","location"),text:"Location",sortName:'{"Location": {"name": "ORDER"}}'},{sortable:!0,hidden:Z(["admin","customer"]),text:"Location",sortName:'{"Location": {"name": "ORDER"}}'},{sortable:!0,hidden:!Z("admin"),formatter:(0,h.Z)("/dashboard/customers/view","customerId","customer"),text:"Customer",sortName:'{"Customer": {"name": "ORDER"}}'},{sortable:!0,hidden:!Z("admin")&&!Z("supplier"),formatter:(0,h.Z)("/dashboard/suppliers/view","supplierId","acceptSupplier"),text:"Accepted Supplier",sortName:'{"Supplier": {"name": "ORDER"}}'},{sortable:!0,hidden:!Z("admin")&&!Z("supplier"),formatter:function(e){var n,t=e.row;e.data;return(0,ee.jsx)(ee.Fragment,{children:(null===t||void 0===t||null===(n=t.offeredSupplier)||void 0===n?void 0:n.length)>0?(0,ee.jsx)(ee.Fragment,{children:((null===t||void 0===t?void 0:t.offeredSupplier)||[]).map((function(e){var n;return(0,ee.jsx)(ie,{onClick:function(n){var t;return De(n,null===e||void 0===e||null===(t=e.supplier)||void 0===t?void 0:t.id)},children:null===e||void 0===e||null===(n=e.supplier)||void 0===n?void 0:n.name})}))}):"-"})},text:"Offered Supplier",sortName:'{"Supplier": {"name": "ORDER"}}'},{hidden:!Z("admin"),text:"Quotations"},{hidden:!Z("admin")&&!Z("supplier"),text:"Received"},{hidden:!Z("admin"),text:"Quotations Range (if multiple)",formatter:function(e){var n=e.row.range;return n?(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsxs)(oe,{children:["high: ",(0,_.Z)(n.high)]}),(0,ee.jsxs)(oe,{children:["low:\xa0 ",(0,_.Z)(n.low)]})]}):"-"}},{sortable:!0,text:"Quote Due",sortName:"quoteDue",formatter:function(e){var n=e.row,t=(0,$.Z)(new Date),r="Quote"===n.type,i=n.status.includes("quoteSent");return r&&n.due<t&&!i?(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(K.Z,{color:"error"})," ",n.due]}):n.due}},{text:"Scheduled",sortable:!0,sortName:"scheduledAt"},{text:"Created",sortable:!0,sortName:"createdAt"},{formatter:function(e){var n=e.row;return(null===n||void 0===n?void 0:n.offeredSupplier.length)>0&&null!==n&&void 0!==n&&n.offeredSupplier.every((function(e){return"quotationRejected"===e.status}))?"Rejected":n.statusText},text:"Status",sortable:!0,sortName:"status"},{hidden:!0},{hidden:!0},{formatter:q.Z,formatterData:function(e){var n=[];return Z("admin")&&n.push(Se),Z("admin")&&n.push(Oe),(Z("admin")||Z("supplier"))&&"quoteOffered"===e.status&&n.push(xe),n},text:"Actions"}],De=function(e,n){e.stopPropagation(),p.default.push("/dashboard/suppliers/view?id=".concat(n))},ke=function(e){e.stopPropagation(),p.default.push("/dashboard/issues/manage?quoted=1")},Ze=function(e){var n=null;if(e.length>1){var t=e.map((function(e){var n;return null===(n=e.lineItems)||void 0===n?void 0:n.reduce((function(e,n){return e+(n.total||0)}),0)}));n={high:Math.max.apply(Math,(0,d.Z)(t||[])),low:Math.min.apply(Math,(0,d.Z)(t||[]))}}return n},Ae=function(e,n){return e.map((function(e){var t,r,i,a,o,s,u,l,c,m,p,f,b,y,g=(0,d.Z)(Q.iz).find((function(n){return n.value===e.status}))||{text:"Accepted"},v=g.text,h=g.supplierText,_=g.customerText,q=((0,d.Z)(z.x).find((function(n){return n.value===e.type}))||{text:"Quote"}).text,I=e.manager?"".concat(e.manager.nameFirst," ").concat(e.manager.nameLast):"Unassigned",j=e.scheduledAt?(0,$.Z)(e.scheduledAt,!0):"-";return{id:e.id,creator:(null===e||void 0===e||null===(t=e.timings[0])||void 0===t||null===(r=t.user)||void 0===r?void 0:r.fullName)||"-",description:null!==e&&void 0!==e&&e.description?null===e||void 0===e?void 0:e.description:"-",number:e.number,type:q,status:e.status,propertyId:null===(i=e.location)||void 0===i?void 0:i.id,managerId:null===(a=e.manager)||void 0===a?void 0:a.id,customerId:null===(o=e.customer)||void 0===o?void 0:o.id,supplierId:e.supplier?e.supplier.id:"",siteVisitStart:e.siteVisitStart,siteVisitEnd:e.siteVisitEnd,siteVisitWeekends:e.siteVisitWeekends,service:(null===(s=e.service)||void 0===s?void 0:s.name)||"-",manager:I,location:(null===(u=e.location)||void 0===u?void 0:u.name)||"-",property:(null===(l=e.location)||void 0===l?void 0:l.name)||"-",customer:(null===(c=e.customer)||void 0===c?void 0:c.name)||"-",acceptSupplier:e.supplier?e.supplier.name:"-",offeredSupplier:(null===e||void 0===e||null===(m=e.quotations)||void 0===m?void 0:m.length)>0?(y=e.quotations,n?y.map((function(e){var n;return null===e||void 0===e||null===(n=e.supplier)||void 0===n?void 0:n.name})).join(" / "):y):[],quotations:"".concat((null===(p=e.quotations)||void 0===p?void 0:p.length)||0,"/").concat(e.quoteNumber),received:"".concat(null===(f=e.quotations||[])||void 0===f?void 0:f.reduce((function(e,n){return"supplierQuoteComplete"===n.status?e+1:e}),0),"/").concat((null===(b=e.quotations)||void 0===b?void 0:b.length)||0),range:Ze(e.quotations),due:(0,$.Z)(e.quoteDue),scheduleDate:j,date:(0,$.Z)(e.createdAt),statusText:Z("admin")?v:Z("supplier")?h||"Accepted":Z("customer")?_||"Accepted":v,quoted:e.quoted||!1,quotationsId:e.quotations[0]&&e.quotations[0].id,actions:""}}))},Pe=function(){return(0,ee.jsxs)(I.Z,{children:[(0,ee.jsx)(j.Z,{marginRight:"xs",children:(0,ee.jsx)(S.Z,{content:"Export to excel",context:"secondary",size:"sm",disabled:qe,onClick:je,children:(0,ee.jsx)(x.Z,{context:"white",icon:"file-csv",size:"lg"})})}),Z("admin")&&(0,ee.jsx)(S.Z,{context:"secondary",content:"Add Quote",onClick:ke,size:"sm"})]})};return(0,ee.jsx)(O.Z,{toolbar:(0,ee.jsx)(Pe,{}),open:!0,title:"Quotes",children:(0,ee.jsx)(L.t,{columns:we,loading:ye,meta:be,ref:J,refetch:ge,rowClick:function(e){p.default.push("/dashboard/issues/view?id=".concat(e.number))},rows:Ae(fe)})})},ie=Y.ZP.button.withConfig({displayName:"table__LinkWrapper",componentId:"sc-1opq252-0"})(["cursor:pointer;margin:2px 0px;padding:8px 5px;color:rgb(41,41,204);background-color:transparent;border:none;&:hover{background-color:#dddddd;border-radius:5px;}"]),ae=Y.ZP.div.withConfig({displayName:"table__StyledLink",componentId:"sc-1opq252-1"})(["line-height:1.5em;height:3em;overflow:hidden;"]),oe=Y.ZP.div.withConfig({displayName:"table__DivWrapper",componentId:"sc-1opq252-2"})(["white-space:nowrap;"]);re.defaultProps={filters:{customerId:null,date:null,managerId:!1,q:null,status:null,supplierId:null,filterType:"quotes_table"}}},42772:function(e,n,t){"use strict";t.d(n,{S:function(){return r}});var r=function(e,n){var t=document.createElement("a");"string"===typeof t.download?(document.body.appendChild(t),t.download=n,t.href=e,t.click(),document.body.removeChild(t)):location.replace(e)}},99362:function(e,n,t){"use strict";t.d(n,{X:function(){return s}});var r=t(43703),i=t(69119),a=t(83894),o=t(38148),s=function(e){var n=(0,r.Z)(e),t=(0,i.Z)(e);return{monthStart:n,todayEnd:(0,a.Z)(e),todayStart:t,yearStart:(0,o.Z)(e)}}},70316:function(e,n,t){"use strict";t.d(n,{J:function(){return w}});var r=t(92809),i=t(80318),a=t(10219),o=t(11163),s=t(67294),u=t(78215),d=t(2356),l=t(42283),c=t(97202),m=t(80284),p=t(65375),f=t(10973),b=t(14347),y=t(66805),g=t(69119),v=t(23855),h=t(83894);function _(e,n,t){var r=(0,s.useState)((function(){if(JSON.parse(window.sessionStorage.getItem(e))&&!Object.values(JSON.parse(window.sessionStorage[e])).includes(t))return n;try{var r=JSON.parse(window.sessionStorage.getItem(e));return r&&(r.startDate=r.startDate?(0,g.Z)((0,v.Z)(r.startDate)):null,r.endDate=r.endDate?(0,h.Z)((0,v.Z)(r.endDate)):null),r||n}catch(i){return console.log(i),n}})),i=r[0],a=r[1];return[i,function(n){try{var t=n instanceof Function?n(i):n;a(t),window.sessionStorage.setItem(e,JSON.stringify(t))}catch(r){console.log(r)}}]}var $=t(85893);function q(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function I(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?q(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var j=function(e){var n=e.initialValues,t=e.renderFilters,r=e.setFilters,a=e.lastQuery,o=e.filters,g=n.filterType,v=_("form_data",n,g),h=(0,i.Z)(v,2),q=h[0],j=h[1],S=(0,l.cI)({defaultValues:q||n}),x=S.control,O=S.errors,w=S.handleSubmit,D=S.register,k=S.reset,Z=S.watch,A=S.setValue,P=I(I({},Z()),{},{filterType:g});(0,s.useEffect)((function(){k(P)}),[k]),(0,s.useEffect)((function(){j(P)}),[o]);var N=function(e){var t=e.query;if(t!==a){var i={q:"%".concat(t,"%")||0},o=/^\d+$/.test(t);"id"in n&&(i.id=o?Number(t):null),"meta"in n&&(i.meta=o?{invoiceNumbers:[t]}:null),"jobNumber"in n&&(i.jobNumber=o?String(t):null,i.invoiceNumber=o?Number(t):null),(i.id||i.meta||i.jobNumber)&&(i.q=null),r((function(e){return I(I({},e),i)}))}};return(0,$.jsx)(c.Z,{handleSubmit:w(N),children:(0,$.jsxs)(m.Z,{title:"Filters",children:[(0,$.jsxs)(u.Z,{children:[(0,$.jsx)(d.Z,{sm:12,lg:12,children:(0,$.jsx)(p.Z,{label:"",children:(0,$.jsx)(f.Z,{errors:O,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:D,type:"search"})})}),(0,$.jsx)(d.Z,{sm:12,lg:12,children:t({control:x,errors:O,initialValues:n,register:D,setFilters:r,watch:Z,setValue:A,reset:k})})]}),(0,$.jsx)(y.H,{content:"Search",context:"secondary",handleClick:N,type:"submit",children:(0,$.jsx)(b.Z,{content:"Clear",context:"danger",onClick:function(e){Object.keys(n).map((function(e){return A(e,null)})),r(n),k(n),N("")},size:"sm"})})]})})},S=["FiltersComp","initialFilters","TableComp"];function x(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function O(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?x(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):x(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var w=function(e){var n=e.FiltersComp,t=e.initialFilters,r=e.TableComp,l=(0,a.Z)(e,S),c=_("filters",t,t.filterType),m=(0,i.Z)(c,2),p=m[0],f=m[1],b=(0,s.useState)(p||t),y=b[0],g=b[1],v=(0,o.useRouter)().query.show;return(0,s.useEffect)((function(){f(y)}),[y]),(0,$.jsx)(u.Z,{children:(0,$.jsxs)(d.Z,{sm:12,lg:12,children:[(0,$.jsx)(j,{initialValues:t,renderFilters:function(e){return(0,$.jsx)(n,O(O(O({},e),l),{},{show:v}))},setFilters:g,filters:y}),(0,$.jsx)(r,O({filters:y,initialFilters:t},l))]})})}},78250:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return b}});var r=t(92809),i=t(11163),a=t(66918),o=t(70316),s=t(37415),u=t(35450),d=t(23855),l=t(85893),c={customerId:null,id:null,managerId:!1,filterType:"quotes_table",q:null,status:null,supplierId:null},m=function(e){var n=e.endDate,t=e.show,r=e.startDate;switch(c.startDate=r?(0,d.Z)(r):null,c.endDate=n?(0,d.Z)(n):null,t){case"unsent":c.status=["quoteOffered","quoteNew"];break;case"unsentQuote":c.status=["quoteOffered","quoteReceived"];break;case"overdueQuote":c.status=["quoteNew","quoteOffered","quoteReceived","quoteSent"];break;default:c.status=t}return(0,l.jsx)(o.J,{FiltersComp:u.r,initialFilters:c,TableComp:s.v})};function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function f(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var b=function(){var e=(0,i.useRouter)().query;return(0,l.jsx)(a.Z,{pageHeading:{heading:"Quotes"},View:(0,l.jsx)(m,f({},e))})}},63166:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/quotes",function(){return t(78250)}])}},function(e){e.O(0,[367,284,4195,5312,7287,2002,3086,7134,3486,9082,3515,4712,1265,6996,9666,4177,7431,8158,7615,2148,4106,5146,899,3016,1110,9774,2888,179],(function(){return n=63166,e(e.s=n);var n}));var n=e.O();_N_E=n}]);